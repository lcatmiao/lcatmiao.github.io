<!DOCTYPE html>







<html lang="zh-CN"
  
>

  <!--
  The Head
-->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Allow having a localized datetime different from the appearance language -->
  

  

    

    

  

  <!-- Begin Jekyll SEO tag v2.7.1 -->
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content="Linuxç¯å¢ƒé…ç½®åŠ è½½åˆ†æ" />
<meta name="author" content="å°é»‘çŒ«" />
<meta property="og:locale" content="zh_CN" />
<meta name="description" content="æœ¬æ–‡ä»¥ OS: Debian, Shell: bash ä¸ºç¯å¢ƒå†™æˆï¼Œå…¶å®ƒç¯å¢ƒå¦‚ OS: RedHat; Shell: sh, zsh å¯èƒ½ä¸æœ¬æ–‡ç»“è®ºæœ‰æ‰€å‡ºå…¥ã€‚ Shellç¯å¢ƒé…ç½®åŠ è½½åˆ†æ åœ¨ç ”ç©¶shellç¯å¢ƒé…ç½®æ–‡ä»¶åŠ è½½æµç¨‹å‰ï¼Œéœ€è¦å…ˆææ˜ç™½ Interactive Shellã€Login Shell çš„æ¦‚å¿µã€‚ Interactive Shell å®šä¹‰ man è¯´æ˜å¦‚ä¸‹ï¼š 1 bash [options] [command_string | file] 1 2 3 An interactive shell is one started without non-option arguments (unless -s is specified) and without the -c option, whose standard input and error are both connected to terminals (as determined by isatty(3)), or one started with the -i option. ä»¥ä¸‹æ¡ä»¶æ»¡è¶³ä»»æ„ä¸€æ¡ï¼Œå³ä¸º Interactive Shellï¼š å¯åŠ¨æ—¶ï¼Œæ—¢æ²¡æœ‰æŒ‡å®šéé€‰é¡¹å‚æ•°ï¼ˆé™¤éæŒ‡å®š -sï¼‰ä¹Ÿæ²¡æœ‰æŒ‡å®š -c é€‰é¡¹ï¼Œä¸”æ ‡å‡†è¾“å…¥å’Œé”™è¯¯è¾“å‡ºéƒ½ä¸ç»ˆç«¯ç›¸è¿ã€‚ å¯åŠ¨æ—¶ï¼ŒæŒ‡å®šäº† -i é€‰é¡¹ã€‚ æ¢è¨€ä¹‹ï¼š æ²¡æœ‰ -cï¼Œæ²¡æœ‰ -sï¼Œæ²¡æœ‰éé€‰é¡¹å‚æ•°ï¼Œä¸”æ ‡å‡†è¾“å…¥å’Œé”™è¯¯è¾“å‡ºéƒ½ä¸ç»ˆç«¯ç›¸è¿ï¼Œä¸º Interactive Shellã€‚ æ²¡æœ‰ -cï¼Œæœ‰ -sï¼Œä¸”æ ‡å‡†è¾“å…¥å’Œé”™è¯¯è¾“å‡ºéƒ½ä¸ç»ˆç«¯ç›¸è¿ï¼Œä¸º Interactive Shellã€‚ æœ‰ -i é€‰é¡¹ï¼Œä¸º Interactive Shellã€‚ æ„Ÿæ€§è®¤è¯†ï¼šä½ æ•²å‘½ä»¤ï¼Œshellç»™ä½ å›æ˜¾ç»“æœï¼Œåƒè¿™æ ·ä¸äººäº¤äº’çš„shellå°±æ˜¯ Interactive Shellã€‚ åˆ¤å®š man è¯´æ˜å¦‚ä¸‹ï¼š 1 2 PS1 is set and $- includes i if bash is interactive, allowing a shell script or a startup file to test this state. ä»¥ä¸‹æ¡ä»¶æ»¡è¶³ä»»æ„ä¸€æ¡ï¼Œå³ä¸º Interactive Shellï¼š $PS1 ä¸ä¸ºç©ºã€‚ $- ä¸­åŒ…å«å­—æ¯ iã€‚ æ¯”å¦‚ï¼š ssh è¿œç¨‹ç™»å½•åï¼Œå…¶ shell æ˜¯ Interactive Shellï¼š 1 2 3 4 5 orangepi@opidebz3server:~$ echo $PS1 \[\e]0;\u@\h: \w\a\]${debian_chroot:+($debian_chroot)}\[\033[01;32m\]\u@\h\[\033[00m\]:\[\033[01;34m\]\w\[\033[00m\]\$ orangepi@opidebz3server:~$ echo $- himBHs æ‘˜è‡ª /etc/bash.bashrc å’Œ ~/.bashrc ä¸­çš„åˆ¤å®šå†™æ³•ï¼š 1 2 3 4 5 6 7 8 9 10 # /etc/bash.bashrc # If not running interactively, don&#39;t do anything [ -z &quot;$PS1&quot; ] &amp;&amp; return # ~/.bashrc # If not running interactively, don&#39;t do anything case $- in *i*) ;; *) return;; esac Login Shell å®šä¹‰ man è¯´æ˜å¦‚ä¸‹ï¼š 1 2 A login shell is one whose first character of argument zero is a -, or one started with the --login option. ä»¥ä¸‹æ¡ä»¶æ»¡è¶³ä»»æ„ä¸€æ¡ï¼Œå³ä¸º Login Shellï¼š $0 çš„é¦–å­—ç¬¦æ˜¯ -ã€‚ å¯åŠ¨æ—¶ï¼ŒæŒ‡å®šäº† --login(-l) é€‰é¡¹ã€‚ æ„Ÿæ€§è®¤è¯†ï¼šè¾“å…¥å¯†ç ç™»å½•åå¯åŠ¨çš„shellå°±æ˜¯ Login Shellã€‚ åˆ¤å®š åˆ¤å®šæ–¹æ³•ä¸å®šä¹‰ç›¸åŒã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå®æµ‹ä¸­å‘ç°ï¼ŒæŒ‡å®šäº† --login(-l) é€‰é¡¹çš„shellï¼Œå…¶ $0 çš„é¦–å­—ç¬¦å¹¶ä¸æ˜¯ -ã€‚è¿™æ„å‘³ç€ä¸Šè¿°ä¸¤ä¸ªæ¡ä»¶åˆ†åˆ«æ˜¯ Login Shell çš„å……åˆ†ä¸å¿…è¦æ¡ä»¶ã€‚è‹¥æ˜¯ Login Shellï¼Œ$0 çš„é¦–å­—ç¬¦å¹¶ä¸æ€»æ˜¯ -ã€‚å¦å¤–ï¼Œå·²ç„¶ç™»å½•ç³»ç»Ÿåï¼Œåœ¨å°è¯• bash -c &quot;echo $0&quot; æ—¶ï¼Œè¾“å‡ºç«Ÿç„¶æ˜¯ -bashï¼Œä½†è¿™æ˜¾ç„¶æ˜¯ä¸€ä¸ª Non-Interactive Non-Login Shellã€‚ç»¼ä¸Šï¼Œä¾æ®å®šä¹‰æ¥åˆ¤å®š Login Shell å¹¶ä¸ååˆ†å¯é ã€‚ DeepSeekç»™å‡ºäº†ä¸€ä¸ªå·ç§°å¯é çš„æ£€æµ‹æ–¹æ³•ï¼šshopt -q login_shell &amp;&amp; echo &quot;1&quot; || echo &quot;0&quot;ï¼Œå®æµ‹ä¸­æš‚æœªå‘ç°é—®é¢˜ï¼Œä¹Ÿè®¸èƒ½å¤Ÿä½œä¸º Login Shell çš„å……è¦æ¡ä»¶ã€‚ æ¯”å¦‚ï¼š sshè¿œç¨‹ç™»å½•åï¼Œå…¶shellæ˜¯ Login Shellï¼š 1 2 3 4 5 orangepi@opidebz3server:~$ echo $0 -bash orangepi@opidebz3server:~$ shopt -q login_shell &amp;&amp; echo &quot;1&quot; || echo &quot;0&quot; 1 å¯åŠ¨ä¸€ä¸ªæŒ‡å®šäº† --login å‚æ•°çš„subshellï¼ŒæŒ‰ç…§å®šä¹‰ï¼Œå…¶shellæ˜¯ Login Shellï¼š 1 2 3 4 5 6 7 orangepi@opidebz3server:~/Me/Misc$ bash --login orangepi@opidebz3server:~/Me/Misc$ echo $0 bash orangepi@opidebz3server:~$ shopt -q login_shell &amp;&amp; echo &quot;1&quot; || echo &quot;0&quot; 1 ç™»å½•ç³»ç»Ÿåï¼Œä½¿ç”¨ bash -c æ‰§è¡Œå‘½ä»¤ï¼Œå…¶shellæ˜¯ Non-Login Shellï¼š 1 2 3 4 5 orangepi@opidebz3server:~$ bash -c &quot;echo $0&quot; -bash orangepi@opidebz3server:~$ bash -c &#39;shopt -q login_shell &amp;&amp; echo &quot;1&quot; || echo &quot;0&quot;&#39; 0 Shellç±»å‹ä¸¾ä¾‹ ï¼ˆæœ‰äº›å‚æ•°ã€é…ç½®æ˜¯å¯ä»¥è°ƒçš„ï¼Œä»¥ä¸‹åªæ˜¯ä¸€èˆ¬æƒ…å†µã€‚ï¼‰ source ~/.bashrc ç›¸å½“äºåœ¨å½“å‰shellä¸­ä¸€è¡Œè¡Œæ‰§è¡Œäº†æŒ‡å®šçš„æ–‡ä»¶ï¼Œæ ¹æœ¬ä¸ä¼šå¯åŠ¨æ–°shellã€‚ å¯åŠ¨ä¸€ä¸ªæ²¡æœ‰GUIçš„ç³»ç»Ÿï¼Œåœ¨æ§åˆ¶å°ç™»å½•åè¿›å…¥çš„shellï¼Œæ˜¯ Interactive Login Shellã€‚ sshå‘½ä»¤è¡Œè¿œç¨‹ç™»å½•åå¯åŠ¨çš„shellæ˜¯ Interactive Login Shellã€‚ su - user å¯åŠ¨çš„shellæ˜¯ Interactive Login Shellã€‚ åœ¨shellä¸­æ‰‹æ•²bashæ‰“å¼€çš„subshellæ˜¯ Interactive Non-Login Shellã€‚ åœ¨å…·å¤‡GUIçš„ç³»ç»Ÿä¸­ï¼Œç™»å½•åè¿›å…¥æ¡Œé¢ï¼Œæ‰‹åŠ¨æ‰“å¼€ç»ˆç«¯ï¼Œæ­¤æ—¶å¯åŠ¨çš„shellä¸€èˆ¬æ˜¯ Interacive Non-Login Shellã€‚è¿™æ˜¯å› ä¸ºæ¡Œé¢è¿›ç¨‹æœ¬èº«å¯èƒ½åœ¨ä¸€ä¸ª Login Shell ä¸­å¯åŠ¨ï¼Œç™»å½•åè¿›å…¥æ¡Œé¢å†å¯åŠ¨çš„shellæ˜¯å…¶åä»£è¿›ç¨‹ï¼Œä¸€èˆ¬ä¸ä¼šå†æ˜¯ Login Shellã€‚ su user å¯åŠ¨çš„shellæ˜¯ Interacive Non-Login Shellã€‚ ç™»å½•åï¼Œæ¡Œé¢è¿›ç¨‹å¯èƒ½æ˜¯åœ¨ä¸€ä¸ªç”±ç¨‹åºå¯åŠ¨çš„shellä¸­å¯åŠ¨ï¼Œæˆ‘æ¨æµ‹è¿™ä¸ªç”±ç¨‹åºå¯åŠ¨å¹¶ç™»å½•çš„shellæ˜¯ Non-Interactive Login Shellã€‚ åƒ bash --login test.sh è¿™æ ·å¯åŠ¨çš„shellï¼Œå®ƒä¸ä¸äººäº¤äº’ï¼ŒåˆæŒ‡å®šäº† --loginï¼Œæ˜¾ç„¶æ˜¯ Non-Interactive Login Shellã€‚ åƒ bash test.sh æˆ– ./test.sh è¿™æ ·å¯åŠ¨çš„shellï¼Œå®ƒä¸ä¸äººäº¤äº’ï¼Œæ‰§è¡Œè„šæœ¬çš„æ—¶å€™æ˜¾ç„¶å·²ç»ç™»å½•äº†ç³»ç»Ÿï¼Œæ‰€ä»¥æ˜¯ Non-Interactive Non-Login Shellã€‚ æ— è®ºcrontabæ‰§è¡Œçš„æ˜¯ç³»ç»Ÿçº§è¿˜æ˜¯ç”¨æˆ·çº§å®šæ—¶ä»»åŠ¡ï¼Œå®ƒéƒ½ä¸éœ€è¦ç™»å½•ï¼Œå…¶æ‰§è¡Œshellè„šæœ¬æ—¶å¯åŠ¨çš„shelléƒ½æ˜¯ Non-Interactive Non-Login Shellã€‚ ç”±ç¨‹åºå†…éƒ¨å¯åŠ¨çš„shellï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šç‰¹æ®Šå‚æ•°ï¼Œå¤šæ•°æƒ…å†µä¸‹éƒ½æ˜¯ Non-Interactive Non-Login Shellã€‚ å¯åŠ¨æ–‡ä»¶åŠ è½½åˆ†æ åŠ è½½æµç¨‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # Interactive Login Shell /etc/profile â””/etc/bash.bashrc â””/etc/profile.d/*.sh ~/.profile â””~/.bashrc ~/.bash_logout /etc/bash.bash_logout # Interactive Non-Login Shell /etc/bash.bashrc ~/.bashrc # Non-Interactive Login Shell /etc/profile â””/etc/profile.d/*.sh ~/.profile â””~/.bashrc(do nothing and return) ~/.bash_logout /etc/bash.bash_logout # Non-Interactive Non-Login Shell $BASH_ENV -&gt; â”” è¡¨ç¤ºè°ƒç”¨å…³ç³»ã€‚è¿™äº›è°ƒç”¨å…³ç³»å¹¶ä¸ç»å¯¹ï¼Œä¸åŒç¯å¢ƒå¯èƒ½ä¼šæœ‰ä¸åŒæƒ…å†µï¼Œåº”ä»¥å®é™…è„šæœ¬å†…å®¹ä¸ºå‡†ï¼Œä¸è¿‡é€šå¸¸æ˜¯ä¸Šè¿°æƒ…å†µã€‚ -&gt; åœ¨æœ‰äº›Linuxä¸­ï¼ˆéDebianï¼‰ï¼Œ/etc/bash.bashrc å¯èƒ½å«åš /etc/bashrcï¼Œ/etc/bash.bash_logout å¯èƒ½å«åš /etc/bash_logoutã€‚ -&gt; ç¬”è€…æ²¡æœ‰åœ¨å®éªŒç¯å¢ƒä¸­æ–°å»º ~/.bash_profileã€~/.bash_login æ–‡ä»¶ï¼Œåªæœ‰é»˜è®¤å­˜åœ¨çš„ ~/.profile æ–‡ä»¶ã€‚è‹¥ä¸Šè¿°æ–‡ä»¶å­˜åœ¨ï¼Œåº”è¯¥ä¼šæŒ‰ç…§ ~/.bash_profile &gt; ~/.bash_login &gt; ~/.profile çš„ä¼˜å…ˆçº§é¡ºåºä»…åŠ è½½å­˜åœ¨ä¸”å¯è¯»çš„ç¬¬ä¸€ä¸ªæ–‡ä»¶ã€‚è¿™ä¸‰ä¸ªæ–‡ä»¶é€šå¸¸éƒ½ä¼š . &quot;$HOME/.bashrc&quot;ã€‚ -&gt; Interactive Login Shell é€€å‡ºï¼ˆæ¯”å¦‚ Ctrl+Dï¼‰æˆ– Non-Interactive Login Shell æ‰§è¡Œ exit å‘½ä»¤æ—¶ï¼Œbashæ‰ä¼šåŠ è½½ logout æ–‡ä»¶ï¼Œç›´æ¥å…³é—­bashåˆ™ä¸ä¼šåŠ è½½ä¹‹ã€‚ -&gt; /etc/profile æ‘˜å½•å¦‚ä¸‹ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 if [ &quot;${PS1-}&quot; ]; then if [ &quot;${BASH-}&quot; ] &amp;&amp; [ &quot;$BASH&quot; != &quot;/bin/sh&quot; ]; then # The file bash.bashrc already sets the default PS1. # PS1=&#39;\h:\w\$ &#39; if [ -f /etc/bash.bashrc ]; then . /etc/bash.bashrc fi else if [ &quot;$(id -u)&quot; -eq 0 ]; then PS1=&#39;# &#39; else PS1=&#39;$ &#39; fi fi fi if [ &quot;${PS1-}&quot; ] æ˜¯åœ¨åˆ¤æ–­æ˜¯å¦æ˜¯ Interactive Shellï¼Œæ‰€ä»¥ Non-Interactive Login Shell ä¸ä¼šåŠ è½½ /etc/bash.bashrcã€‚ -&gt; ~/.profile æ‘˜å½•å¦‚ä¸‹ï¼š 1 2 3 4 5 6 7 # if running bash if [ -n &quot;$BASH_VERSION&quot; ]; then # include .bashrc if it exists if [ -f &quot;$HOME/.bashrc&quot; ]; then . &quot;$HOME/.bashrc&quot; fi fi ~/.bashrc æ‘˜å½•å¦‚ä¸‹ï¼š 1 2 3 4 5 # If not running interactively, don&#39;t do anything case $- in *i*) ;; *) return;; esac ~/.profile ä¸­åŠ è½½äº† ~/.bashrcï¼Œä½†è‹¥ä¸æ˜¯ Interactive Shellï¼Œ~/.bashrc å°†ç›´æ¥è¿”å›ï¼Œæ‰€ä»¥ Non-Interactive Login Shell è™½ç„¶è¯»äº† ~/.bashrc æ–‡ä»¶ï¼Œä½†å…¶å®ç›¸å½“äºæ²¡æœ‰åŠ è½½å®ƒã€‚ -&gt; ç¯å¢ƒå˜é‡ BASH_ENV çš„å€¼æ˜¯ä¸€ä¸ªæ–‡ä»¶åï¼ŒNon-Interactive Non-Login Shell ä¼šåŠ è½½è¿™ä¸ªæ–‡ä»¶ã€‚ æˆ‘ä»¬å¯ä»¥ç®€å•è®°å¿†ï¼šå¦‚æœæ˜¯ Login Shellï¼Œåˆ™ä¼šåŠ è½½ /etc/profileã€first of ~/.bash_profile &gt; ~/.bash_login &gt; ~/.profileï¼›å¦‚æœæ˜¯ Interactive Shellï¼Œåˆ™ä¼šåŠ è½½ /etc/bash.bashrcã€~/.bashrcã€‚ è¯¦ç»†æ–‡æ¡£å¯å‚è€ƒBash Reference Manual - 6.2 Bash Startup Filesã€‚ å¦é™„ä¸€å¼ å›½å¤–å¤§ä½¬æ•´ç†çš„å›¾ç‰‡ï¼š Bash Initialisation Files ç‰¹åˆ«åˆ†æä¸‹sudo ç¬”è€…åœ¨å„ä¸ªå¯åŠ¨æ–‡ä»¶å’Œæµ‹è¯•æ–‡ä»¶ä¸­éƒ½æ·»åŠ äº†ä¸€äº›æµ‹è¯•è¾“å‡ºï¼Œè¿™äº›è¾“å‡ºè¢«é‡å®šå‘åˆ°ä¸€ä¸ªç‰¹å®šæ–‡ä»¶ä¸­ä»¥ä¾¿æŸ¥çœ‹ã€‚æˆ‘ä»¬å°†åœ¨bashä¸­æ‰‹æ•²ä¸€äº›sudoå‘½ä»¤ï¼Œå¹¶ç»“åˆè®°å½•ä¸‹çš„æµ‹è¯•è¾“å‡ºå†…å®¹è¿›è¡Œåˆ†æã€‚ æå‰å‡†å¤‡ å¯åŠ¨æ–‡ä»¶çš„æµ‹è¯•è¾“å‡ºï¼šç•¥ã€‚ logout æ–‡ä»¶ï¼šç•¥ã€‚ æ–°å»º /root/.profile æ–‡ä»¶ï¼ˆä¸€èˆ¬/rootä¸‹æ²¡æœ‰è¯¥æ–‡ä»¶ï¼‰ï¼Œå¹¶è°ƒç”¨ /root/.bashrcï¼š 1 2 3 4 5 6 7 8 9 echo &quot;$HOME/.profile&quot; &gt;&gt; /home/orangepi/Me/Misc/load_cfg # if running bash if [ -n &quot;$BASH_VERSION&quot; ]; then # include .bashrc if it exists if [ -f &quot;$HOME/.bashrc&quot; ]; then . &quot;$HOME/.bashrc&quot; fi fi è®¾ç½® BASH_ENV ç¯å¢ƒå˜é‡ï¼š 1 2 # ç›´æ¥åœ¨bashé‡Œæ‰‹æ•² export BASH_ENV=/home/orangepi/Me/Misc/test1.sh test1.sh å†…å®¹ï¼š 1 2 3 4 #!/bin/bash echo &#39;test1.sh&#39; &gt;&gt; /home/orangepi/Me/Misc/load_cfg echo &#39;$BASH_ENV&#39; &gt;&gt; /home/orangepi/Me/Misc/load_cfg test.sh å†…å®¹ï¼š 1 2 3 4 5 6 7 8 #!/bin/bash echo &quot;test.sh&quot; &gt;&gt; /home/orangepi/Me/Misc/load_cfg echo &quot;\$BASH_ENV: $BASH_ENV&quot; &gt;&gt; /home/orangepi/Me/Misc/load_cfg pstree &gt;&gt; /home/orangepi/Me/Misc/load_cfg echo &quot;&quot; &gt;&gt; /home/orangepi/Me/Misc/load_cfg echo &quot;123&quot; &gt; /dev/null exit åˆ†æsudo &gt; sudo pwd æ²¡æœ‰æµ‹è¯•è¾“å‡ºå†…å®¹ã€‚ å¯åŠ¨ sudo è¿›ç¨‹ï¼Œå†å¯åŠ¨ pwd å­è¿›ç¨‹ã€‚pwd æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶å¯æ‰§è¡Œç¨‹åºï¼Œä¸æ˜¯shellè„šæœ¬ã€‚æ²¡æœ‰shellè¢«å¯åŠ¨ï¼Œæ‰€ä»¥æ²¡æœ‰æµ‹è¯•è¾“å‡ºå†…å®¹ã€‚ &gt; sudo ./test.sh 1 2 3 test.sh $BASH_ENV: ... å¯åŠ¨ sudo è¿›ç¨‹ï¼Œå‘ç°è¦æ‰§è¡Œä¸€ä¸ªshellè„šæœ¬ï¼Œäºæ˜¯æ ¹æ® shebang å¯åŠ¨äº†ä¸€ä¸ª bash å­è¿›ç¨‹ï¼Œè‡ªç„¶æ˜¯ Non-Interactive Non-Login Shellï¼Œäºæ˜¯åº”è¯¥è¦å…ˆåŠ è½½ç¯å¢ƒå˜é‡ BASH_ENV æŒ‡å®šçš„æ–‡ä»¶ test1.shï¼Œç„¶è€Œè¾“å‡ºç»“æœæ˜¯â€œå¹¶æ²¡æœ‰â€ä¸”èƒ½æ³¨æ„åˆ° BASH_ENV çš„å€¼æ˜¯ç©ºçš„ï¼Œè¿™æ˜¯å› ä¸º sudo åœ¨é»˜è®¤é…ç½®ä¸‹ä¼šé‡ç½®å¹¶ä¿æŒä¸€ä¸ªç‰¹å®šçš„ç¯å¢ƒï¼Œä½¿ç”¨ sudo env å¯ä»¥æŸ¥çœ‹ä¹‹ã€‚bash å¯åŠ¨æ—¶å‘ç°æ²¡æœ‰ BASH_ENVï¼Œè‡ªç„¶å°±ä¸ä¼šåŠ è½½å…¶æŒ‡å®šçš„æ–‡ä»¶ã€‚ &gt; sudo â€“preserve-env=BASH_ENV pwd æ²¡æœ‰æµ‹è¯•è¾“å‡ºå†…å®¹ã€‚ --preserve-env=BASH_ENV ä½¿ç¯å¢ƒå˜é‡ BASH_ENV ä¿ç•™äº†ä¸‹æ¥ï¼Œä½† pwd ä¸æ˜¯shellè„šæœ¬ï¼Œæ²¡æœ‰shellè¢«å¯åŠ¨ï¼Œæ‰€ä»¥æ²¡æœ‰æµ‹è¯•è¾“å‡ºå†…å®¹ã€‚ &gt; sudo â€“preserve-env=BASH_ENV ./test.sh 1 2 3 4 5 test1.sh $BASH_ENV test.sh $BASH_ENV: /home/orangepi/Me/Misc/test1.sh ... --preserve-env=BASH_ENV ä½¿ç¯å¢ƒå˜é‡ BASH_ENV ä¿ç•™äº†ä¸‹æ¥ï¼Œæ‰§è¡Œ test.sh æ—¶å¯åŠ¨äº†ä¸€ä¸ª Non-Interactive Non-Login Shellï¼Œæ‰€ä»¥ BASH_ENV æŒ‡å®šçš„æ–‡ä»¶ test1.sh è¢«åŠ è½½äº†ã€‚ &gt; sudo -i 1 2 3 4 5 /etc/profile /etc/bash.bashrc /etc/profile.d/*.sh /root/.profile /root/.bashrc å¯åŠ¨ sudo è¿›ç¨‹åè¿˜ä¼šå¯åŠ¨ä¸€ä¸ªshellå­è¿›ç¨‹ã€‚-i è¡¨æ˜ä¼šå¯åŠ¨ä¸€ä¸ª Login Shellï¼Œåˆå› ä¸ºæ²¡æœ‰æŒ‡å®šè¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œå¯åŠ¨çš„shellå°†æ˜¯ä¸€ä¸ª Interactive Shellï¼Œå³å¯åŠ¨çš„shellå­è¿›ç¨‹æ˜¯ä¸€ä¸ª Interactive Login Shellã€‚æµ‹è¯•è¾“å‡ºç¬¦åˆé¢„æœŸã€‚è‹¥æ˜¯æ‰‹åŠ¨ Ctrl+D é€€å‡ºshellï¼Œåœ¨æ–‡ä»¶å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œè¿˜ä¼šä¾æ¬¡åŠ è½½ /root/.bash_logoutã€/etc/bash.bash_logoutã€‚ &gt; sudo -i â€“preserve-env=BASH_ENV pwd 1 2 3 4 5 6 /etc/profile /etc/profile.d/*.sh /root/.profile /root/.bashrc(do nothing and return) test1.sh $BASH_ENV å±…ç„¶åŠ è½½äº†BASH_ENVï¼Œä»¤äººæ„å¤–çš„ç»“æœã€‚ é¦–å…ˆå¯åŠ¨ sudo è¿›ç¨‹ã€‚å…¶æ¬¡ï¼Œç”±äº -i ä¸”æŒ‡å®šäº†è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œæ‰€ä»¥å¯åŠ¨ä¸€ä¸ª Non-Interactive Login Shellã€‚æ¥ä¸‹æ¥å°±ä»¤äººæ„å¤–äº†ï¼Œæ ¹æ® man sudo çš„è¯´æ³•ï¼Œæˆ‘çŒœåº”è¯¥æ˜¯ç›¸å½“äºæ‰§è¡Œäº† bash -c &#39;command&#39;ï¼Œå³å¯åŠ¨äº†ä¸€ä¸ª Non-Interactive Non-Login Shell å»æ‰§è¡Œäº† pwdã€‚ man sudoï¼š 1 2 3 4 5 -i, --login ... If a command is specified, it is passed to the shell as a simple command using the -c option. ... ç”±äºä¿ç•™äº† BASH_ENVï¼Œæ‰€ä»¥ test1.sh è¢«åŠ è½½ã€‚ å‘½ä»¤æ‰§è¡Œå®Œæ¯•åï¼Œlogout æ–‡ä»¶ä¸ä¼šè¢«åŠ è½½ï¼Œåº”è¯¥æ˜¯å…¶å†…éƒ¨æ²¡æœ‰æ­£å¸¸ exit Login Shellã€‚ &gt; sudo -i â€“preserve-env=BASH_ENV /home/orangepi/Me/Misc/test.sh 1 2 3 4 5 6 7 8 9 10 11 /etc/profile /etc/profile.d/*.sh /root/.profile /root/.bashrc(do nothing and return) test1.sh $BASH_ENV test1.sh $BASH_ENV test.sh $BASH_ENV: /home/orangepi/Me/Misc/test1.sh ... è¿™é‡Œ test.sh ä½¿ç”¨ç»å¯¹è·¯å¾„æ˜¯å› ä¸º sudo -i ä¼šå°†å½“å‰è·¯å¾„è°ƒæ•´ä¸º /rootã€‚ é¦–å…ˆå¯åŠ¨ sudo è¿›ç¨‹ï¼Œç„¶åå¯åŠ¨ä¸€ä¸ª Non-Interactive Login Shellï¼Œæ¥ç€å¯åŠ¨ä¸€ä¸ª Non-Interactive Non-Login Shell(bash -c &#39;command&#39;)ï¼ŒåŠ è½½äº† BASH_ENVï¼Œæœ€åæ ¹æ® shebang æ‰§è¡Œ test.shï¼Œäºæ˜¯åˆå¯åŠ¨äº†ä¸€ä¸ª Non-Interactive Non-Login Shellï¼Œå†æ¬¡åŠ è½½äº† BASH_ENVï¼Œæœ€ç»ˆå¾—åˆ°ä¸Šè¿°æµ‹è¯•è¾“å‡ºå†…å®¹ã€‚ &gt; sudo su 1 2 /etc/bash.bashrc /root/.bashrc å®¹æ˜“ç†è§£çš„ç»“æœã€‚å¯åŠ¨ sudo è¿›ç¨‹åå†å¯åŠ¨ su è¿›ç¨‹ï¼Œæ­¤å¤„æœªæŒ‡å®šç”¨æˆ·å°±é»˜è®¤ä¸ºæ˜¯ su rootï¼Œç„¶åå¯åŠ¨äº†ä¸€ä¸ª Interactive Non-Login Shellï¼Œäºæ˜¯å¾—åˆ°ä¸Šè¿°æµ‹è¯•è¾“å‡ºå†…å®¹ã€‚ &gt; sudo -i â€“preserve-env=BASH_ENV su - 1 2 3 4 5 6 7 8 9 10 11 /etc/profile /etc/profile.d/*.sh /root/.profile /root/.bashrc(do nothing and return) test1.sh $BASH_ENV /etc/profile /etc/bash.bashrc /etc/profile.d/*.sh /root/.profile /root/.bashrc ç¬”è€…æ•…æ„å †å buffï¼Œé€ å‡ºäº†è¿™ä¸ªé€†å¤©å‘½ä»¤ï¼Œå…¶æµ‹è¯•è¾“å‡ºå†…å®¹ä¹Ÿç¬¦åˆé¢„æœŸã€‚ å¯åŠ¨ sudo è¿›ç¨‹ã€‚ å› ä¸ºæŒ‡å®šäº†è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œåˆå› ä¸º -iï¼Œæ‰€ä»¥å¯åŠ¨äº†ä¸€ä¸ª Non-Interactive Login Shellã€‚ ä»¥ bash -c &#39;su -&#39; çš„å½¢å¼æ‰§è¡Œå‘½ä»¤ï¼Œå°†å¯åŠ¨ä¸€ä¸ª Non-Interactive Non-Login Shellï¼Œåˆå› ä¸ºä¿ç•™äº† BASH_ENVï¼Œæ‰€ä»¥å°†åŠ è½½ test1.shã€‚ å¯åŠ¨ su è¿›ç¨‹ã€‚ å› ä¸º -ï¼Œå°†å¯åŠ¨ä¸€ä¸ª Interacitve Login Shellã€‚ è‹¥æ‰‹åŠ¨ Ctrl+D é€€å‡ºshellï¼Œåœ¨æ–‡ä»¶å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œè¿˜ä¼šåŠ è½½ç›¸åº”çš„ logout æ–‡ä»¶ã€‚ &gt; å…³äºpstreeçš„è¾“å‡º pstree çš„è¾“å‡ºä¸æˆ‘ä»¬çš„ç†è§£å­˜åœ¨å‡ºå…¥ï¼Œæœ‰äº›shellå­è¿›ç¨‹å¹¶æ²¡æœ‰è¢«æ˜¾ç¤ºå‡ºæ¥ã€‚ sudo -i --preserve-env=BASH_ENV /home/orangepi/Me/Misc/test.sh çš„ pstree è¾“å‡ºï¼š 1 2 3 4 systemd-+-NetworkManager---2*[{NetworkManager}] ... |-sshd---sshd---sshd---bash---sudo---sudo---test.sh---pstree ... DeepSeekçš„è§£é‡Šæ˜¯è¿›ç¨‹æ›¿æ¢ï¼ˆexecveï¼‰æœºåˆ¶å¯¼è‡´äº†è¿™ä¸€ç°è±¡ï¼Œå¹¶è‚¯å®šäº†ç¬”è€…ä¸Šé¢çš„ç†è§£ã€‚é‡ç‚¹æ˜¯DeepSeekè‚¯å®šäº†ç¬”è€…çš„ç†è§£ï¼Œé‚£åº”è¯¥é—®é¢˜ä¸å¤§ğŸ¤ªï¼Œè‡³äºä»€ä¹ˆforkã€è¿›ç¨‹æ›¿æ¢äº‘äº‘ï¼Œä¸æ‡‚ï¼Œä¸ç®¡äº†ğŸ¥±ã€‚ å…¶å®ƒç¯å¢ƒé…ç½®åŠ è½½åˆ†æ /etc/environment è¯¥æ–‡ä»¶æ˜¯ä¸€ä¸ªç³»ç»Ÿçº§çš„é…ç½®æ–‡ä»¶ï¼Œä¸»è¦ç”±PAMè®¤è¯æ¨¡å—åŠ è½½ã€‚ å®è·µä¸­ï¼Œè¯¥æ–‡ä»¶å¾ˆå°‘è¢«ä½¿ç”¨ï¼Œå…¶å¯¹åº”çš„ç”¨æˆ·çº§é…ç½®æ–‡ä»¶ ~/.pam_environment åŸºæœ¬å·²è¢«å¼ƒç”¨ã€‚ è¯¥æ–‡ä»¶åªæ”¯æŒç®€å•çš„é”®å€¼å¯¹å†…å®¹ï¼Œå¹¶éshellè„šæœ¬ï¼Œ~/.pam_environment ä¹Ÿå·®ä¸å¤šå¦‚æ­¤ã€‚ å…³äºè¯¥æ–‡ä»¶çš„åŠ è½½æ—¶æœºï¼Œç¬”è€…è®©DeepSeekç”»äº†ä¸€å¼ å›¾ï¼Œä¸€ç›®äº†ç„¶ã€‚æœ€åˆçš„ systemd å°±ä¼šåŠ è½½å®ƒï¼Œè€Œåç”± systemd å¯åŠ¨çš„åç»­è¿›ç¨‹å°†ç»§æ‰¿ç¯å¢ƒæˆ–è€…é€šè¿‡PAMè®¤è¯æ¨¡å—å†æ¬¡åŠ è½½å®ƒï¼Œæ•…ç†è®ºä¸Šï¼Œæ‰€æœ‰è¿›ç¨‹éƒ½èƒ½åƒåˆ°è¯¥æ–‡ä»¶ç¯å¢ƒã€‚ é€šè¿‡è¿™å¼ å›¾è¿˜æƒ³è¯´æ˜å¦ä¸€ä»¶äº‹ï¼šæœ¬æ–‡ä¸Šé¢å¤§ç¯‡å¹…è®¨è®ºçš„è¯¸å¦‚ /etc/profileã€~/.profile ç­‰æ–‡ä»¶åªæ˜¯ shell çš„é…ç½®æ–‡ä»¶ï¼Œå…¶å®ƒè¿›ç¨‹æ˜¯ä¸ä¼šåŠ è½½å®ƒä»¬çš„ï¼Œé™¤éå…¶è¿›ç¨‹å†…éƒ¨ä¸»åŠ¨å¯åŠ¨äº†ä¸€ä¸ªshellæˆ–è€…æœ‰å…¶å®ƒæœªçŸ¥çš„ç‰¹æ®Šæƒ…å†µã€‚æ¯”å¦‚ï¼Œcrontab ä¸æ˜¯shellï¼Œå…¶æœ¬èº«åƒä¸åˆ°shellé…ç½®æ–‡ä»¶ç¯å¢ƒï¼Œè‹¥å…¶æ‰§è¡Œshellè„šæœ¬ï¼Œåˆ™å¯åŠ¨çš„shellå°†ç»§æ‰¿å…¶ç¯å¢ƒï¼Œè€Œè¯¥shellåˆæ˜¯ä¸€ä¸ª Non-Interactive Non-Login Shellï¼Œå¯åŠ¨æ—¶ä¹Ÿä¸ä¼šåŠ è½½é…ç½®æ–‡ä»¶ï¼Œè¿™äº›éƒ½å°†ä½¿å¾—è¯¥shellåœ¨æ‰§è¡Œæ—¶å¤„äºä¸€ä¸ªååˆ†æœ‰é™çš„ç¯å¢ƒï¼Œè¿™æ„å‘³ç€åœ¨ä½¿ç”¨ crontab å®šæ—¶æ‰§è¡Œshellè„šæœ¬æ—¶ï¼Œäºshellé…ç½®æ–‡ä»¶ä¸­è®¾ç½®çš„ç¯å¢ƒå˜é‡å°†ä¸å¯è§ï¼Œæ­¤æ—¶ä¸å¦¨æŠŠè¦ä½¿ç”¨çš„ç¯å¢ƒå˜é‡ç›´æ¥å†™æ­»åœ¨è„šæœ¬é‡Œã€‚ /etc/rc.d/ /etc/rc0.d/, /etc/rc1.d/, ... ç³»åˆ—ç›®å½•å±äºSysVinitä½“ç³»çš„ç»„æˆéƒ¨åˆ†ï¼Œç›®å½•ä¸­æ˜¯è½¯é“¾æ¥ï¼Œé“¾æ¥æŒ‡å‘ /etc/init.d/ ä¸‹çœŸæ­£çš„è„šæœ¬ã€‚SysVinitæ˜¯æ—§çš„åˆå§‹åŒ–ç³»ç»Ÿï¼Œç°å·²è¢«systemdå…¼å®¹å¹¶å–ä»£ã€‚ ï¼ˆDeepSeekï¼‰ä»¥å¾€æ²¡æœ‰systemdæ—¶ï¼Œç¬¬ä¸€ä¸ªè¿›ç¨‹æ˜¯ initï¼Œå®ƒå¯èƒ½ä¼šåŠ è½½ä¸€äº›è‡ªå·±çš„é…ç½®æ–‡ä»¶ï¼Œä½†ä¸ä¼šåŠ è½½ /etc/environmentï¼Œç„¶åæ‰§è¡Œå¯¹åº”è¿è¡Œçº§åˆ«çš„rcè„šæœ¬ï¼ˆå¯åŠ¨çš„shellæ˜¯ Non-Interactive Non-Login Shellï¼‰ï¼Œè¿›è€Œå¯åŠ¨å„é¡¹ç³»ç»ŸæœåŠ¡ã€å®ˆæŠ¤è¿›ç¨‹ç­‰ç¨‹åºã€‚ ï¼ˆDeepSeekï¼‰systemdèƒ½å¤Ÿå…¼å®¹SysVinitï¼Œå®ƒèƒ½å¤Ÿä¸º /etc/init.d/ ä¸‹çš„è„šæœ¬ç”Ÿæˆsystemdè‡ªèº«çš„unitæ–‡ä»¶ï¼Œè¿›è€Œæ‰§è¡Œ /etc/init.d/ ä¸‹çš„è„šæœ¬ã€‚ ï¼ˆå¦ï¼‰service å‘½ä»¤å…¶å®æ˜¯ä¸€ä¸ªshellè„šæœ¬ï¼Œå¦‚æœç³»ç»Ÿä½¿ç”¨SysVinitï¼Œå®ƒï¼ˆservice nginx startï¼‰å°±ç›¸å½“äº /etc/init.d/nginx startï¼›å¦‚æœç³»ç»Ÿä½¿ç”¨systemdï¼Œå®ƒå°±ç›¸å½“äº systemctl start nginx.serviceã€‚ é…ç½®æ–‡ä»¶è§’è‰²å®šä½ /etc/profileï¼šshellçš„ç³»ç»Ÿçº§é…ç½®ï¼ŒLogin Shell çš„ç³»ç»Ÿçº§é…ç½®å…¥å£ï¼Œå…¶ä¸­ä¸€èˆ¬ä¼šåŠ è½½ /etc/bash.bashrcï¼Œéå† /etc/profile.d/ã€‚ /etc/bash.bashrcï¼šbashçš„ç³»ç»Ÿçº§é…ç½®ï¼ŒInteractive Shell çš„ç³»ç»Ÿçº§é…ç½®ï¼Œç”¨äºé…ç½®æ‰€æœ‰ç”¨æˆ·é€šç”¨çš„å‘½ä»¤æç¤ºç¬¦æ ·å¼ã€å‘½ä»¤åˆ«åç­‰ã€‚ /etc/profile.d/ï¼šå­˜æ”¾ Login Shell ç³»ç»Ÿçº§é…ç½®è„šæœ¬çš„ç›®å½•ï¼Œå¸¸ç”¨äºé…ç½®ç³»ç»Ÿçº§ç¯å¢ƒå˜é‡ã€‚ ~/.bash_profileï¼šbashçš„ç”¨æˆ·çº§é…ç½®ï¼ŒLogin Shell çš„ç”¨æˆ·çº§é…ç½®å…¥å£ï¼Œå…¶ä¸­ä¸€èˆ¬ä¼šåŠ è½½ ~/.bashrcã€‚è¯¥æ–‡ä»¶ï¼ˆ~/.bash_profileï¼‰å¯ç”¨äºé…ç½®ç”¨æˆ·çº§ç¯å¢ƒå˜é‡ã€‚è¯¥æ–‡ä»¶æ˜¯bashä¸“ç”¨çš„é…ç½®æ–‡ä»¶ï¼Œåœ¨éœ€è¦ä¸ºbashæä¾›ä¸“æœ‰é…ç½®ä¸”å…¶å®ƒshellç»§ç»­ä½¿ç”¨ ~/.profile é…ç½®æ—¶æ‰ä¼šæ´¾ä¸Šç”¨åœºï¼Œä¸€èˆ¬å¾ˆå°‘ä½¿ç”¨ã€‚bashä¼šæŒ‰ç…§ ~/.bash_profile &gt; ~/.bash_login &gt; ~/.profile çš„ä¼˜å…ˆçº§é¡ºåºä»…åŠ è½½å­˜åœ¨ä¸”å¯è¯»çš„ç¬¬ä¸€ä¸ªæ–‡ä»¶ã€‚ ~/.bash_loginï¼šbashçš„ç”¨æˆ·çº§é…ç½®ï¼ŒLogin Shell çš„ç”¨æˆ·çº§é…ç½®å…¥å£ï¼Œå…¶ä¸­ä¸€èˆ¬ä¼šåŠ è½½ ~/.bashrcã€‚è¯¥æ–‡ä»¶ï¼ˆ~/.bash_loginï¼‰å¯ç”¨äºé…ç½®ç”¨æˆ·çº§ç¯å¢ƒå˜é‡ã€‚è¯¥æ–‡ä»¶æ˜¯bashä¸“ç”¨çš„é…ç½®å¤‡ç”¨æ–‡ä»¶ï¼ŒåŠŸèƒ½ä¸ ~/.bash_profile ç±»ä¼¼ï¼Œå¹³æ—¶æå°‘ä½¿ç”¨ã€‚bashä¼šæŒ‰ç…§ ~/.bash_profile &gt; ~/.bash_login &gt; ~/.profile çš„ä¼˜å…ˆçº§é¡ºåºä»…åŠ è½½å­˜åœ¨ä¸”å¯è¯»çš„ç¬¬ä¸€ä¸ªæ–‡ä»¶ã€‚ ~/.profileï¼šshellçš„ç”¨æˆ·çº§é…ç½®ï¼ŒLogin Shell çš„ç”¨æˆ·çº§é…ç½®å…¥å£ï¼Œå…¶ä¸­ä¸€èˆ¬ä¼šåŠ è½½ ~/.bashrcã€‚è¯¥æ–‡ä»¶ï¼ˆ~/.profileï¼‰å¸¸ç”¨äºé…ç½®ç”¨æˆ·çº§ç¯å¢ƒå˜é‡ã€‚bashä¼šæŒ‰ç…§ ~/.bash_profile &gt; ~/.bash_login &gt; ~/.profile çš„ä¼˜å…ˆçº§é¡ºåºä»…åŠ è½½å­˜åœ¨ä¸”å¯è¯»çš„ç¬¬ä¸€ä¸ªæ–‡ä»¶ã€‚ ~/.bashrcï¼šbashçš„ç”¨æˆ·çº§é…ç½®ï¼ŒInteractive Shell çš„ç”¨æˆ·çº§é…ç½®ï¼Œç”¨äºé…ç½®å½“å‰ç”¨æˆ·çš„å‘½ä»¤æç¤ºç¬¦æ ·å¼ã€å‘½ä»¤åˆ«åç­‰ã€‚ ~/.bash_logoutï¼šbashçš„ç”¨æˆ·çº§é…ç½®ï¼ŒLogin Shell çš„ç”¨æˆ·çº§é…ç½®ï¼Œç”¨äºåœ¨é€€å‡ºshellï¼ˆCtrl+D æˆ– exit è§¦å‘ï¼‰æ—¶æ‰§è¡Œä¸€äº›å½“å‰ç”¨æˆ·çš„æ“ä½œï¼Œå¦‚æ¸…ç†æ“ä½œã€‚ /etc/bash.bash_logoutï¼šbashçš„ç³»ç»Ÿçº§é…ç½®ï¼ŒLogin Shell çš„ç³»ç»Ÿçº§é…ç½®ï¼Œç”¨äºåœ¨é€€å‡ºshellï¼ˆCtrl+D æˆ– exit è§¦å‘ï¼‰æ—¶æ‰§è¡Œä¸€äº›æ‰€æœ‰ç”¨æˆ·é€šç”¨çš„æ“ä½œï¼Œå¦‚æ¸…ç†æ“ä½œã€‚ä¸€èˆ¬å¾ˆå°‘ä½¿ç”¨è¯¥æ–‡ä»¶ã€‚ /etc/environmentï¼šPAMè®¤è¯æ¨¡å—çš„ç³»ç»Ÿçº§é…ç½®ï¼Œä¹Ÿè¢«systemdç›´æ¥åŠ è½½ï¼Œåªèƒ½ç”¨äºé…ç½®ç¯å¢ƒå˜é‡ï¼Œåœ¨ç°ä»£ä½¿ç”¨systemdçš„linuxä¸­ï¼Œç†è®ºä¸Šæ‰€æœ‰è¿›ç¨‹éƒ½èƒ½åƒåˆ°è¯¥ç¯å¢ƒï¼Œä¸è¿‡ä¸€èˆ¬å¾ˆå°‘ä½¿ç”¨ã€‚ ~/.pam_environmentï¼šPAMè®¤è¯æ¨¡å—çš„ç”¨æˆ·çº§é…ç½®ï¼Œåªèƒ½ç”¨äºé…ç½®ç¯å¢ƒå˜é‡ï¼Œä½†åŸºæœ¬å·²è¢«å¼ƒç”¨ã€‚ /etc/rc.d/ï¼š/etc/rc0.d/, /etc/rc1.d/, ... ç³»åˆ—ç›®å½•æ˜¯SysVinitä½“ç³»çš„ç»„æˆéƒ¨åˆ†ï¼Œå…¶å†…å­˜æ”¾æœåŠ¡ç®¡ç†è„šæœ¬çš„è½¯é“¾æ¥ï¼Œé“¾æ¥æŒ‡å‘ /etc/init.d/ã€‚SysVinitç°å·²è¢«systemdå…¼å®¹å¹¶å–ä»£ã€‚ /etc/init.d/ï¼šSysVinitä½“ç³»çš„ç»„æˆéƒ¨åˆ†ï¼Œå…¶å†…å­˜æ”¾æœåŠ¡ç®¡ç†è„šæœ¬ã€‚" />
<meta property="og:description" content="æœ¬æ–‡ä»¥ OS: Debian, Shell: bash ä¸ºç¯å¢ƒå†™æˆï¼Œå…¶å®ƒç¯å¢ƒå¦‚ OS: RedHat; Shell: sh, zsh å¯èƒ½ä¸æœ¬æ–‡ç»“è®ºæœ‰æ‰€å‡ºå…¥ã€‚ Shellç¯å¢ƒé…ç½®åŠ è½½åˆ†æ åœ¨ç ”ç©¶shellç¯å¢ƒé…ç½®æ–‡ä»¶åŠ è½½æµç¨‹å‰ï¼Œéœ€è¦å…ˆææ˜ç™½ Interactive Shellã€Login Shell çš„æ¦‚å¿µã€‚ Interactive Shell å®šä¹‰ man è¯´æ˜å¦‚ä¸‹ï¼š 1 bash [options] [command_string | file] 1 2 3 An interactive shell is one started without non-option arguments (unless -s is specified) and without the -c option, whose standard input and error are both connected to terminals (as determined by isatty(3)), or one started with the -i option. ä»¥ä¸‹æ¡ä»¶æ»¡è¶³ä»»æ„ä¸€æ¡ï¼Œå³ä¸º Interactive Shellï¼š å¯åŠ¨æ—¶ï¼Œæ—¢æ²¡æœ‰æŒ‡å®šéé€‰é¡¹å‚æ•°ï¼ˆé™¤éæŒ‡å®š -sï¼‰ä¹Ÿæ²¡æœ‰æŒ‡å®š -c é€‰é¡¹ï¼Œä¸”æ ‡å‡†è¾“å…¥å’Œé”™è¯¯è¾“å‡ºéƒ½ä¸ç»ˆç«¯ç›¸è¿ã€‚ å¯åŠ¨æ—¶ï¼ŒæŒ‡å®šäº† -i é€‰é¡¹ã€‚ æ¢è¨€ä¹‹ï¼š æ²¡æœ‰ -cï¼Œæ²¡æœ‰ -sï¼Œæ²¡æœ‰éé€‰é¡¹å‚æ•°ï¼Œä¸”æ ‡å‡†è¾“å…¥å’Œé”™è¯¯è¾“å‡ºéƒ½ä¸ç»ˆç«¯ç›¸è¿ï¼Œä¸º Interactive Shellã€‚ æ²¡æœ‰ -cï¼Œæœ‰ -sï¼Œä¸”æ ‡å‡†è¾“å…¥å’Œé”™è¯¯è¾“å‡ºéƒ½ä¸ç»ˆç«¯ç›¸è¿ï¼Œä¸º Interactive Shellã€‚ æœ‰ -i é€‰é¡¹ï¼Œä¸º Interactive Shellã€‚ æ„Ÿæ€§è®¤è¯†ï¼šä½ æ•²å‘½ä»¤ï¼Œshellç»™ä½ å›æ˜¾ç»“æœï¼Œåƒè¿™æ ·ä¸äººäº¤äº’çš„shellå°±æ˜¯ Interactive Shellã€‚ åˆ¤å®š man è¯´æ˜å¦‚ä¸‹ï¼š 1 2 PS1 is set and $- includes i if bash is interactive, allowing a shell script or a startup file to test this state. ä»¥ä¸‹æ¡ä»¶æ»¡è¶³ä»»æ„ä¸€æ¡ï¼Œå³ä¸º Interactive Shellï¼š $PS1 ä¸ä¸ºç©ºã€‚ $- ä¸­åŒ…å«å­—æ¯ iã€‚ æ¯”å¦‚ï¼š ssh è¿œç¨‹ç™»å½•åï¼Œå…¶ shell æ˜¯ Interactive Shellï¼š 1 2 3 4 5 orangepi@opidebz3server:~$ echo $PS1 \[\e]0;\u@\h: \w\a\]${debian_chroot:+($debian_chroot)}\[\033[01;32m\]\u@\h\[\033[00m\]:\[\033[01;34m\]\w\[\033[00m\]\$ orangepi@opidebz3server:~$ echo $- himBHs æ‘˜è‡ª /etc/bash.bashrc å’Œ ~/.bashrc ä¸­çš„åˆ¤å®šå†™æ³•ï¼š 1 2 3 4 5 6 7 8 9 10 # /etc/bash.bashrc # If not running interactively, don&#39;t do anything [ -z &quot;$PS1&quot; ] &amp;&amp; return # ~/.bashrc # If not running interactively, don&#39;t do anything case $- in *i*) ;; *) return;; esac Login Shell å®šä¹‰ man è¯´æ˜å¦‚ä¸‹ï¼š 1 2 A login shell is one whose first character of argument zero is a -, or one started with the --login option. ä»¥ä¸‹æ¡ä»¶æ»¡è¶³ä»»æ„ä¸€æ¡ï¼Œå³ä¸º Login Shellï¼š $0 çš„é¦–å­—ç¬¦æ˜¯ -ã€‚ å¯åŠ¨æ—¶ï¼ŒæŒ‡å®šäº† --login(-l) é€‰é¡¹ã€‚ æ„Ÿæ€§è®¤è¯†ï¼šè¾“å…¥å¯†ç ç™»å½•åå¯åŠ¨çš„shellå°±æ˜¯ Login Shellã€‚ åˆ¤å®š åˆ¤å®šæ–¹æ³•ä¸å®šä¹‰ç›¸åŒã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå®æµ‹ä¸­å‘ç°ï¼ŒæŒ‡å®šäº† --login(-l) é€‰é¡¹çš„shellï¼Œå…¶ $0 çš„é¦–å­—ç¬¦å¹¶ä¸æ˜¯ -ã€‚è¿™æ„å‘³ç€ä¸Šè¿°ä¸¤ä¸ªæ¡ä»¶åˆ†åˆ«æ˜¯ Login Shell çš„å……åˆ†ä¸å¿…è¦æ¡ä»¶ã€‚è‹¥æ˜¯ Login Shellï¼Œ$0 çš„é¦–å­—ç¬¦å¹¶ä¸æ€»æ˜¯ -ã€‚å¦å¤–ï¼Œå·²ç„¶ç™»å½•ç³»ç»Ÿåï¼Œåœ¨å°è¯• bash -c &quot;echo $0&quot; æ—¶ï¼Œè¾“å‡ºç«Ÿç„¶æ˜¯ -bashï¼Œä½†è¿™æ˜¾ç„¶æ˜¯ä¸€ä¸ª Non-Interactive Non-Login Shellã€‚ç»¼ä¸Šï¼Œä¾æ®å®šä¹‰æ¥åˆ¤å®š Login Shell å¹¶ä¸ååˆ†å¯é ã€‚ DeepSeekç»™å‡ºäº†ä¸€ä¸ªå·ç§°å¯é çš„æ£€æµ‹æ–¹æ³•ï¼šshopt -q login_shell &amp;&amp; echo &quot;1&quot; || echo &quot;0&quot;ï¼Œå®æµ‹ä¸­æš‚æœªå‘ç°é—®é¢˜ï¼Œä¹Ÿè®¸èƒ½å¤Ÿä½œä¸º Login Shell çš„å……è¦æ¡ä»¶ã€‚ æ¯”å¦‚ï¼š sshè¿œç¨‹ç™»å½•åï¼Œå…¶shellæ˜¯ Login Shellï¼š 1 2 3 4 5 orangepi@opidebz3server:~$ echo $0 -bash orangepi@opidebz3server:~$ shopt -q login_shell &amp;&amp; echo &quot;1&quot; || echo &quot;0&quot; 1 å¯åŠ¨ä¸€ä¸ªæŒ‡å®šäº† --login å‚æ•°çš„subshellï¼ŒæŒ‰ç…§å®šä¹‰ï¼Œå…¶shellæ˜¯ Login Shellï¼š 1 2 3 4 5 6 7 orangepi@opidebz3server:~/Me/Misc$ bash --login orangepi@opidebz3server:~/Me/Misc$ echo $0 bash orangepi@opidebz3server:~$ shopt -q login_shell &amp;&amp; echo &quot;1&quot; || echo &quot;0&quot; 1 ç™»å½•ç³»ç»Ÿåï¼Œä½¿ç”¨ bash -c æ‰§è¡Œå‘½ä»¤ï¼Œå…¶shellæ˜¯ Non-Login Shellï¼š 1 2 3 4 5 orangepi@opidebz3server:~$ bash -c &quot;echo $0&quot; -bash orangepi@opidebz3server:~$ bash -c &#39;shopt -q login_shell &amp;&amp; echo &quot;1&quot; || echo &quot;0&quot;&#39; 0 Shellç±»å‹ä¸¾ä¾‹ ï¼ˆæœ‰äº›å‚æ•°ã€é…ç½®æ˜¯å¯ä»¥è°ƒçš„ï¼Œä»¥ä¸‹åªæ˜¯ä¸€èˆ¬æƒ…å†µã€‚ï¼‰ source ~/.bashrc ç›¸å½“äºåœ¨å½“å‰shellä¸­ä¸€è¡Œè¡Œæ‰§è¡Œäº†æŒ‡å®šçš„æ–‡ä»¶ï¼Œæ ¹æœ¬ä¸ä¼šå¯åŠ¨æ–°shellã€‚ å¯åŠ¨ä¸€ä¸ªæ²¡æœ‰GUIçš„ç³»ç»Ÿï¼Œåœ¨æ§åˆ¶å°ç™»å½•åè¿›å…¥çš„shellï¼Œæ˜¯ Interactive Login Shellã€‚ sshå‘½ä»¤è¡Œè¿œç¨‹ç™»å½•åå¯åŠ¨çš„shellæ˜¯ Interactive Login Shellã€‚ su - user å¯åŠ¨çš„shellæ˜¯ Interactive Login Shellã€‚ åœ¨shellä¸­æ‰‹æ•²bashæ‰“å¼€çš„subshellæ˜¯ Interactive Non-Login Shellã€‚ åœ¨å…·å¤‡GUIçš„ç³»ç»Ÿä¸­ï¼Œç™»å½•åè¿›å…¥æ¡Œé¢ï¼Œæ‰‹åŠ¨æ‰“å¼€ç»ˆç«¯ï¼Œæ­¤æ—¶å¯åŠ¨çš„shellä¸€èˆ¬æ˜¯ Interacive Non-Login Shellã€‚è¿™æ˜¯å› ä¸ºæ¡Œé¢è¿›ç¨‹æœ¬èº«å¯èƒ½åœ¨ä¸€ä¸ª Login Shell ä¸­å¯åŠ¨ï¼Œç™»å½•åè¿›å…¥æ¡Œé¢å†å¯åŠ¨çš„shellæ˜¯å…¶åä»£è¿›ç¨‹ï¼Œä¸€èˆ¬ä¸ä¼šå†æ˜¯ Login Shellã€‚ su user å¯åŠ¨çš„shellæ˜¯ Interacive Non-Login Shellã€‚ ç™»å½•åï¼Œæ¡Œé¢è¿›ç¨‹å¯èƒ½æ˜¯åœ¨ä¸€ä¸ªç”±ç¨‹åºå¯åŠ¨çš„shellä¸­å¯åŠ¨ï¼Œæˆ‘æ¨æµ‹è¿™ä¸ªç”±ç¨‹åºå¯åŠ¨å¹¶ç™»å½•çš„shellæ˜¯ Non-Interactive Login Shellã€‚ åƒ bash --login test.sh è¿™æ ·å¯åŠ¨çš„shellï¼Œå®ƒä¸ä¸äººäº¤äº’ï¼ŒåˆæŒ‡å®šäº† --loginï¼Œæ˜¾ç„¶æ˜¯ Non-Interactive Login Shellã€‚ åƒ bash test.sh æˆ– ./test.sh è¿™æ ·å¯åŠ¨çš„shellï¼Œå®ƒä¸ä¸äººäº¤äº’ï¼Œæ‰§è¡Œè„šæœ¬çš„æ—¶å€™æ˜¾ç„¶å·²ç»ç™»å½•äº†ç³»ç»Ÿï¼Œæ‰€ä»¥æ˜¯ Non-Interactive Non-Login Shellã€‚ æ— è®ºcrontabæ‰§è¡Œçš„æ˜¯ç³»ç»Ÿçº§è¿˜æ˜¯ç”¨æˆ·çº§å®šæ—¶ä»»åŠ¡ï¼Œå®ƒéƒ½ä¸éœ€è¦ç™»å½•ï¼Œå…¶æ‰§è¡Œshellè„šæœ¬æ—¶å¯åŠ¨çš„shelléƒ½æ˜¯ Non-Interactive Non-Login Shellã€‚ ç”±ç¨‹åºå†…éƒ¨å¯åŠ¨çš„shellï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šç‰¹æ®Šå‚æ•°ï¼Œå¤šæ•°æƒ…å†µä¸‹éƒ½æ˜¯ Non-Interactive Non-Login Shellã€‚ å¯åŠ¨æ–‡ä»¶åŠ è½½åˆ†æ åŠ è½½æµç¨‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # Interactive Login Shell /etc/profile â””/etc/bash.bashrc â””/etc/profile.d/*.sh ~/.profile â””~/.bashrc ~/.bash_logout /etc/bash.bash_logout # Interactive Non-Login Shell /etc/bash.bashrc ~/.bashrc # Non-Interactive Login Shell /etc/profile â””/etc/profile.d/*.sh ~/.profile â””~/.bashrc(do nothing and return) ~/.bash_logout /etc/bash.bash_logout # Non-Interactive Non-Login Shell $BASH_ENV -&gt; â”” è¡¨ç¤ºè°ƒç”¨å…³ç³»ã€‚è¿™äº›è°ƒç”¨å…³ç³»å¹¶ä¸ç»å¯¹ï¼Œä¸åŒç¯å¢ƒå¯èƒ½ä¼šæœ‰ä¸åŒæƒ…å†µï¼Œåº”ä»¥å®é™…è„šæœ¬å†…å®¹ä¸ºå‡†ï¼Œä¸è¿‡é€šå¸¸æ˜¯ä¸Šè¿°æƒ…å†µã€‚ -&gt; åœ¨æœ‰äº›Linuxä¸­ï¼ˆéDebianï¼‰ï¼Œ/etc/bash.bashrc å¯èƒ½å«åš /etc/bashrcï¼Œ/etc/bash.bash_logout å¯èƒ½å«åš /etc/bash_logoutã€‚ -&gt; ç¬”è€…æ²¡æœ‰åœ¨å®éªŒç¯å¢ƒä¸­æ–°å»º ~/.bash_profileã€~/.bash_login æ–‡ä»¶ï¼Œåªæœ‰é»˜è®¤å­˜åœ¨çš„ ~/.profile æ–‡ä»¶ã€‚è‹¥ä¸Šè¿°æ–‡ä»¶å­˜åœ¨ï¼Œåº”è¯¥ä¼šæŒ‰ç…§ ~/.bash_profile &gt; ~/.bash_login &gt; ~/.profile çš„ä¼˜å…ˆçº§é¡ºåºä»…åŠ è½½å­˜åœ¨ä¸”å¯è¯»çš„ç¬¬ä¸€ä¸ªæ–‡ä»¶ã€‚è¿™ä¸‰ä¸ªæ–‡ä»¶é€šå¸¸éƒ½ä¼š . &quot;$HOME/.bashrc&quot;ã€‚ -&gt; Interactive Login Shell é€€å‡ºï¼ˆæ¯”å¦‚ Ctrl+Dï¼‰æˆ– Non-Interactive Login Shell æ‰§è¡Œ exit å‘½ä»¤æ—¶ï¼Œbashæ‰ä¼šåŠ è½½ logout æ–‡ä»¶ï¼Œç›´æ¥å…³é—­bashåˆ™ä¸ä¼šåŠ è½½ä¹‹ã€‚ -&gt; /etc/profile æ‘˜å½•å¦‚ä¸‹ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 if [ &quot;${PS1-}&quot; ]; then if [ &quot;${BASH-}&quot; ] &amp;&amp; [ &quot;$BASH&quot; != &quot;/bin/sh&quot; ]; then # The file bash.bashrc already sets the default PS1. # PS1=&#39;\h:\w\$ &#39; if [ -f /etc/bash.bashrc ]; then . /etc/bash.bashrc fi else if [ &quot;$(id -u)&quot; -eq 0 ]; then PS1=&#39;# &#39; else PS1=&#39;$ &#39; fi fi fi if [ &quot;${PS1-}&quot; ] æ˜¯åœ¨åˆ¤æ–­æ˜¯å¦æ˜¯ Interactive Shellï¼Œæ‰€ä»¥ Non-Interactive Login Shell ä¸ä¼šåŠ è½½ /etc/bash.bashrcã€‚ -&gt; ~/.profile æ‘˜å½•å¦‚ä¸‹ï¼š 1 2 3 4 5 6 7 # if running bash if [ -n &quot;$BASH_VERSION&quot; ]; then # include .bashrc if it exists if [ -f &quot;$HOME/.bashrc&quot; ]; then . &quot;$HOME/.bashrc&quot; fi fi ~/.bashrc æ‘˜å½•å¦‚ä¸‹ï¼š 1 2 3 4 5 # If not running interactively, don&#39;t do anything case $- in *i*) ;; *) return;; esac ~/.profile ä¸­åŠ è½½äº† ~/.bashrcï¼Œä½†è‹¥ä¸æ˜¯ Interactive Shellï¼Œ~/.bashrc å°†ç›´æ¥è¿”å›ï¼Œæ‰€ä»¥ Non-Interactive Login Shell è™½ç„¶è¯»äº† ~/.bashrc æ–‡ä»¶ï¼Œä½†å…¶å®ç›¸å½“äºæ²¡æœ‰åŠ è½½å®ƒã€‚ -&gt; ç¯å¢ƒå˜é‡ BASH_ENV çš„å€¼æ˜¯ä¸€ä¸ªæ–‡ä»¶åï¼ŒNon-Interactive Non-Login Shell ä¼šåŠ è½½è¿™ä¸ªæ–‡ä»¶ã€‚ æˆ‘ä»¬å¯ä»¥ç®€å•è®°å¿†ï¼šå¦‚æœæ˜¯ Login Shellï¼Œåˆ™ä¼šåŠ è½½ /etc/profileã€first of ~/.bash_profile &gt; ~/.bash_login &gt; ~/.profileï¼›å¦‚æœæ˜¯ Interactive Shellï¼Œåˆ™ä¼šåŠ è½½ /etc/bash.bashrcã€~/.bashrcã€‚ è¯¦ç»†æ–‡æ¡£å¯å‚è€ƒBash Reference Manual - 6.2 Bash Startup Filesã€‚ å¦é™„ä¸€å¼ å›½å¤–å¤§ä½¬æ•´ç†çš„å›¾ç‰‡ï¼š Bash Initialisation Files ç‰¹åˆ«åˆ†æä¸‹sudo ç¬”è€…åœ¨å„ä¸ªå¯åŠ¨æ–‡ä»¶å’Œæµ‹è¯•æ–‡ä»¶ä¸­éƒ½æ·»åŠ äº†ä¸€äº›æµ‹è¯•è¾“å‡ºï¼Œè¿™äº›è¾“å‡ºè¢«é‡å®šå‘åˆ°ä¸€ä¸ªç‰¹å®šæ–‡ä»¶ä¸­ä»¥ä¾¿æŸ¥çœ‹ã€‚æˆ‘ä»¬å°†åœ¨bashä¸­æ‰‹æ•²ä¸€äº›sudoå‘½ä»¤ï¼Œå¹¶ç»“åˆè®°å½•ä¸‹çš„æµ‹è¯•è¾“å‡ºå†…å®¹è¿›è¡Œåˆ†æã€‚ æå‰å‡†å¤‡ å¯åŠ¨æ–‡ä»¶çš„æµ‹è¯•è¾“å‡ºï¼šç•¥ã€‚ logout æ–‡ä»¶ï¼šç•¥ã€‚ æ–°å»º /root/.profile æ–‡ä»¶ï¼ˆä¸€èˆ¬/rootä¸‹æ²¡æœ‰è¯¥æ–‡ä»¶ï¼‰ï¼Œå¹¶è°ƒç”¨ /root/.bashrcï¼š 1 2 3 4 5 6 7 8 9 echo &quot;$HOME/.profile&quot; &gt;&gt; /home/orangepi/Me/Misc/load_cfg # if running bash if [ -n &quot;$BASH_VERSION&quot; ]; then # include .bashrc if it exists if [ -f &quot;$HOME/.bashrc&quot; ]; then . &quot;$HOME/.bashrc&quot; fi fi è®¾ç½® BASH_ENV ç¯å¢ƒå˜é‡ï¼š 1 2 # ç›´æ¥åœ¨bashé‡Œæ‰‹æ•² export BASH_ENV=/home/orangepi/Me/Misc/test1.sh test1.sh å†…å®¹ï¼š 1 2 3 4 #!/bin/bash echo &#39;test1.sh&#39; &gt;&gt; /home/orangepi/Me/Misc/load_cfg echo &#39;$BASH_ENV&#39; &gt;&gt; /home/orangepi/Me/Misc/load_cfg test.sh å†…å®¹ï¼š 1 2 3 4 5 6 7 8 #!/bin/bash echo &quot;test.sh&quot; &gt;&gt; /home/orangepi/Me/Misc/load_cfg echo &quot;\$BASH_ENV: $BASH_ENV&quot; &gt;&gt; /home/orangepi/Me/Misc/load_cfg pstree &gt;&gt; /home/orangepi/Me/Misc/load_cfg echo &quot;&quot; &gt;&gt; /home/orangepi/Me/Misc/load_cfg echo &quot;123&quot; &gt; /dev/null exit åˆ†æsudo &gt; sudo pwd æ²¡æœ‰æµ‹è¯•è¾“å‡ºå†…å®¹ã€‚ å¯åŠ¨ sudo è¿›ç¨‹ï¼Œå†å¯åŠ¨ pwd å­è¿›ç¨‹ã€‚pwd æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶å¯æ‰§è¡Œç¨‹åºï¼Œä¸æ˜¯shellè„šæœ¬ã€‚æ²¡æœ‰shellè¢«å¯åŠ¨ï¼Œæ‰€ä»¥æ²¡æœ‰æµ‹è¯•è¾“å‡ºå†…å®¹ã€‚ &gt; sudo ./test.sh 1 2 3 test.sh $BASH_ENV: ... å¯åŠ¨ sudo è¿›ç¨‹ï¼Œå‘ç°è¦æ‰§è¡Œä¸€ä¸ªshellè„šæœ¬ï¼Œäºæ˜¯æ ¹æ® shebang å¯åŠ¨äº†ä¸€ä¸ª bash å­è¿›ç¨‹ï¼Œè‡ªç„¶æ˜¯ Non-Interactive Non-Login Shellï¼Œäºæ˜¯åº”è¯¥è¦å…ˆåŠ è½½ç¯å¢ƒå˜é‡ BASH_ENV æŒ‡å®šçš„æ–‡ä»¶ test1.shï¼Œç„¶è€Œè¾“å‡ºç»“æœæ˜¯â€œå¹¶æ²¡æœ‰â€ä¸”èƒ½æ³¨æ„åˆ° BASH_ENV çš„å€¼æ˜¯ç©ºçš„ï¼Œè¿™æ˜¯å› ä¸º sudo åœ¨é»˜è®¤é…ç½®ä¸‹ä¼šé‡ç½®å¹¶ä¿æŒä¸€ä¸ªç‰¹å®šçš„ç¯å¢ƒï¼Œä½¿ç”¨ sudo env å¯ä»¥æŸ¥çœ‹ä¹‹ã€‚bash å¯åŠ¨æ—¶å‘ç°æ²¡æœ‰ BASH_ENVï¼Œè‡ªç„¶å°±ä¸ä¼šåŠ è½½å…¶æŒ‡å®šçš„æ–‡ä»¶ã€‚ &gt; sudo â€“preserve-env=BASH_ENV pwd æ²¡æœ‰æµ‹è¯•è¾“å‡ºå†…å®¹ã€‚ --preserve-env=BASH_ENV ä½¿ç¯å¢ƒå˜é‡ BASH_ENV ä¿ç•™äº†ä¸‹æ¥ï¼Œä½† pwd ä¸æ˜¯shellè„šæœ¬ï¼Œæ²¡æœ‰shellè¢«å¯åŠ¨ï¼Œæ‰€ä»¥æ²¡æœ‰æµ‹è¯•è¾“å‡ºå†…å®¹ã€‚ &gt; sudo â€“preserve-env=BASH_ENV ./test.sh 1 2 3 4 5 test1.sh $BASH_ENV test.sh $BASH_ENV: /home/orangepi/Me/Misc/test1.sh ... --preserve-env=BASH_ENV ä½¿ç¯å¢ƒå˜é‡ BASH_ENV ä¿ç•™äº†ä¸‹æ¥ï¼Œæ‰§è¡Œ test.sh æ—¶å¯åŠ¨äº†ä¸€ä¸ª Non-Interactive Non-Login Shellï¼Œæ‰€ä»¥ BASH_ENV æŒ‡å®šçš„æ–‡ä»¶ test1.sh è¢«åŠ è½½äº†ã€‚ &gt; sudo -i 1 2 3 4 5 /etc/profile /etc/bash.bashrc /etc/profile.d/*.sh /root/.profile /root/.bashrc å¯åŠ¨ sudo è¿›ç¨‹åè¿˜ä¼šå¯åŠ¨ä¸€ä¸ªshellå­è¿›ç¨‹ã€‚-i è¡¨æ˜ä¼šå¯åŠ¨ä¸€ä¸ª Login Shellï¼Œåˆå› ä¸ºæ²¡æœ‰æŒ‡å®šè¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œå¯åŠ¨çš„shellå°†æ˜¯ä¸€ä¸ª Interactive Shellï¼Œå³å¯åŠ¨çš„shellå­è¿›ç¨‹æ˜¯ä¸€ä¸ª Interactive Login Shellã€‚æµ‹è¯•è¾“å‡ºç¬¦åˆé¢„æœŸã€‚è‹¥æ˜¯æ‰‹åŠ¨ Ctrl+D é€€å‡ºshellï¼Œåœ¨æ–‡ä»¶å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œè¿˜ä¼šä¾æ¬¡åŠ è½½ /root/.bash_logoutã€/etc/bash.bash_logoutã€‚ &gt; sudo -i â€“preserve-env=BASH_ENV pwd 1 2 3 4 5 6 /etc/profile /etc/profile.d/*.sh /root/.profile /root/.bashrc(do nothing and return) test1.sh $BASH_ENV å±…ç„¶åŠ è½½äº†BASH_ENVï¼Œä»¤äººæ„å¤–çš„ç»“æœã€‚ é¦–å…ˆå¯åŠ¨ sudo è¿›ç¨‹ã€‚å…¶æ¬¡ï¼Œç”±äº -i ä¸”æŒ‡å®šäº†è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œæ‰€ä»¥å¯åŠ¨ä¸€ä¸ª Non-Interactive Login Shellã€‚æ¥ä¸‹æ¥å°±ä»¤äººæ„å¤–äº†ï¼Œæ ¹æ® man sudo çš„è¯´æ³•ï¼Œæˆ‘çŒœåº”è¯¥æ˜¯ç›¸å½“äºæ‰§è¡Œäº† bash -c &#39;command&#39;ï¼Œå³å¯åŠ¨äº†ä¸€ä¸ª Non-Interactive Non-Login Shell å»æ‰§è¡Œäº† pwdã€‚ man sudoï¼š 1 2 3 4 5 -i, --login ... If a command is specified, it is passed to the shell as a simple command using the -c option. ... ç”±äºä¿ç•™äº† BASH_ENVï¼Œæ‰€ä»¥ test1.sh è¢«åŠ è½½ã€‚ å‘½ä»¤æ‰§è¡Œå®Œæ¯•åï¼Œlogout æ–‡ä»¶ä¸ä¼šè¢«åŠ è½½ï¼Œåº”è¯¥æ˜¯å…¶å†…éƒ¨æ²¡æœ‰æ­£å¸¸ exit Login Shellã€‚ &gt; sudo -i â€“preserve-env=BASH_ENV /home/orangepi/Me/Misc/test.sh 1 2 3 4 5 6 7 8 9 10 11 /etc/profile /etc/profile.d/*.sh /root/.profile /root/.bashrc(do nothing and return) test1.sh $BASH_ENV test1.sh $BASH_ENV test.sh $BASH_ENV: /home/orangepi/Me/Misc/test1.sh ... è¿™é‡Œ test.sh ä½¿ç”¨ç»å¯¹è·¯å¾„æ˜¯å› ä¸º sudo -i ä¼šå°†å½“å‰è·¯å¾„è°ƒæ•´ä¸º /rootã€‚ é¦–å…ˆå¯åŠ¨ sudo è¿›ç¨‹ï¼Œç„¶åå¯åŠ¨ä¸€ä¸ª Non-Interactive Login Shellï¼Œæ¥ç€å¯åŠ¨ä¸€ä¸ª Non-Interactive Non-Login Shell(bash -c &#39;command&#39;)ï¼ŒåŠ è½½äº† BASH_ENVï¼Œæœ€åæ ¹æ® shebang æ‰§è¡Œ test.shï¼Œäºæ˜¯åˆå¯åŠ¨äº†ä¸€ä¸ª Non-Interactive Non-Login Shellï¼Œå†æ¬¡åŠ è½½äº† BASH_ENVï¼Œæœ€ç»ˆå¾—åˆ°ä¸Šè¿°æµ‹è¯•è¾“å‡ºå†…å®¹ã€‚ &gt; sudo su 1 2 /etc/bash.bashrc /root/.bashrc å®¹æ˜“ç†è§£çš„ç»“æœã€‚å¯åŠ¨ sudo è¿›ç¨‹åå†å¯åŠ¨ su è¿›ç¨‹ï¼Œæ­¤å¤„æœªæŒ‡å®šç”¨æˆ·å°±é»˜è®¤ä¸ºæ˜¯ su rootï¼Œç„¶åå¯åŠ¨äº†ä¸€ä¸ª Interactive Non-Login Shellï¼Œäºæ˜¯å¾—åˆ°ä¸Šè¿°æµ‹è¯•è¾“å‡ºå†…å®¹ã€‚ &gt; sudo -i â€“preserve-env=BASH_ENV su - 1 2 3 4 5 6 7 8 9 10 11 /etc/profile /etc/profile.d/*.sh /root/.profile /root/.bashrc(do nothing and return) test1.sh $BASH_ENV /etc/profile /etc/bash.bashrc /etc/profile.d/*.sh /root/.profile /root/.bashrc ç¬”è€…æ•…æ„å †å buffï¼Œé€ å‡ºäº†è¿™ä¸ªé€†å¤©å‘½ä»¤ï¼Œå…¶æµ‹è¯•è¾“å‡ºå†…å®¹ä¹Ÿç¬¦åˆé¢„æœŸã€‚ å¯åŠ¨ sudo è¿›ç¨‹ã€‚ å› ä¸ºæŒ‡å®šäº†è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œåˆå› ä¸º -iï¼Œæ‰€ä»¥å¯åŠ¨äº†ä¸€ä¸ª Non-Interactive Login Shellã€‚ ä»¥ bash -c &#39;su -&#39; çš„å½¢å¼æ‰§è¡Œå‘½ä»¤ï¼Œå°†å¯åŠ¨ä¸€ä¸ª Non-Interactive Non-Login Shellï¼Œåˆå› ä¸ºä¿ç•™äº† BASH_ENVï¼Œæ‰€ä»¥å°†åŠ è½½ test1.shã€‚ å¯åŠ¨ su è¿›ç¨‹ã€‚ å› ä¸º -ï¼Œå°†å¯åŠ¨ä¸€ä¸ª Interacitve Login Shellã€‚ è‹¥æ‰‹åŠ¨ Ctrl+D é€€å‡ºshellï¼Œåœ¨æ–‡ä»¶å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œè¿˜ä¼šåŠ è½½ç›¸åº”çš„ logout æ–‡ä»¶ã€‚ &gt; å…³äºpstreeçš„è¾“å‡º pstree çš„è¾“å‡ºä¸æˆ‘ä»¬çš„ç†è§£å­˜åœ¨å‡ºå…¥ï¼Œæœ‰äº›shellå­è¿›ç¨‹å¹¶æ²¡æœ‰è¢«æ˜¾ç¤ºå‡ºæ¥ã€‚ sudo -i --preserve-env=BASH_ENV /home/orangepi/Me/Misc/test.sh çš„ pstree è¾“å‡ºï¼š 1 2 3 4 systemd-+-NetworkManager---2*[{NetworkManager}] ... |-sshd---sshd---sshd---bash---sudo---sudo---test.sh---pstree ... DeepSeekçš„è§£é‡Šæ˜¯è¿›ç¨‹æ›¿æ¢ï¼ˆexecveï¼‰æœºåˆ¶å¯¼è‡´äº†è¿™ä¸€ç°è±¡ï¼Œå¹¶è‚¯å®šäº†ç¬”è€…ä¸Šé¢çš„ç†è§£ã€‚é‡ç‚¹æ˜¯DeepSeekè‚¯å®šäº†ç¬”è€…çš„ç†è§£ï¼Œé‚£åº”è¯¥é—®é¢˜ä¸å¤§ğŸ¤ªï¼Œè‡³äºä»€ä¹ˆforkã€è¿›ç¨‹æ›¿æ¢äº‘äº‘ï¼Œä¸æ‡‚ï¼Œä¸ç®¡äº†ğŸ¥±ã€‚ å…¶å®ƒç¯å¢ƒé…ç½®åŠ è½½åˆ†æ /etc/environment è¯¥æ–‡ä»¶æ˜¯ä¸€ä¸ªç³»ç»Ÿçº§çš„é…ç½®æ–‡ä»¶ï¼Œä¸»è¦ç”±PAMè®¤è¯æ¨¡å—åŠ è½½ã€‚ å®è·µä¸­ï¼Œè¯¥æ–‡ä»¶å¾ˆå°‘è¢«ä½¿ç”¨ï¼Œå…¶å¯¹åº”çš„ç”¨æˆ·çº§é…ç½®æ–‡ä»¶ ~/.pam_environment åŸºæœ¬å·²è¢«å¼ƒç”¨ã€‚ è¯¥æ–‡ä»¶åªæ”¯æŒç®€å•çš„é”®å€¼å¯¹å†…å®¹ï¼Œå¹¶éshellè„šæœ¬ï¼Œ~/.pam_environment ä¹Ÿå·®ä¸å¤šå¦‚æ­¤ã€‚ å…³äºè¯¥æ–‡ä»¶çš„åŠ è½½æ—¶æœºï¼Œç¬”è€…è®©DeepSeekç”»äº†ä¸€å¼ å›¾ï¼Œä¸€ç›®äº†ç„¶ã€‚æœ€åˆçš„ systemd å°±ä¼šåŠ è½½å®ƒï¼Œè€Œåç”± systemd å¯åŠ¨çš„åç»­è¿›ç¨‹å°†ç»§æ‰¿ç¯å¢ƒæˆ–è€…é€šè¿‡PAMè®¤è¯æ¨¡å—å†æ¬¡åŠ è½½å®ƒï¼Œæ•…ç†è®ºä¸Šï¼Œæ‰€æœ‰è¿›ç¨‹éƒ½èƒ½åƒåˆ°è¯¥æ–‡ä»¶ç¯å¢ƒã€‚ é€šè¿‡è¿™å¼ å›¾è¿˜æƒ³è¯´æ˜å¦ä¸€ä»¶äº‹ï¼šæœ¬æ–‡ä¸Šé¢å¤§ç¯‡å¹…è®¨è®ºçš„è¯¸å¦‚ /etc/profileã€~/.profile ç­‰æ–‡ä»¶åªæ˜¯ shell çš„é…ç½®æ–‡ä»¶ï¼Œå…¶å®ƒè¿›ç¨‹æ˜¯ä¸ä¼šåŠ è½½å®ƒä»¬çš„ï¼Œé™¤éå…¶è¿›ç¨‹å†…éƒ¨ä¸»åŠ¨å¯åŠ¨äº†ä¸€ä¸ªshellæˆ–è€…æœ‰å…¶å®ƒæœªçŸ¥çš„ç‰¹æ®Šæƒ…å†µã€‚æ¯”å¦‚ï¼Œcrontab ä¸æ˜¯shellï¼Œå…¶æœ¬èº«åƒä¸åˆ°shellé…ç½®æ–‡ä»¶ç¯å¢ƒï¼Œè‹¥å…¶æ‰§è¡Œshellè„šæœ¬ï¼Œåˆ™å¯åŠ¨çš„shellå°†ç»§æ‰¿å…¶ç¯å¢ƒï¼Œè€Œè¯¥shellåˆæ˜¯ä¸€ä¸ª Non-Interactive Non-Login Shellï¼Œå¯åŠ¨æ—¶ä¹Ÿä¸ä¼šåŠ è½½é…ç½®æ–‡ä»¶ï¼Œè¿™äº›éƒ½å°†ä½¿å¾—è¯¥shellåœ¨æ‰§è¡Œæ—¶å¤„äºä¸€ä¸ªååˆ†æœ‰é™çš„ç¯å¢ƒï¼Œè¿™æ„å‘³ç€åœ¨ä½¿ç”¨ crontab å®šæ—¶æ‰§è¡Œshellè„šæœ¬æ—¶ï¼Œäºshellé…ç½®æ–‡ä»¶ä¸­è®¾ç½®çš„ç¯å¢ƒå˜é‡å°†ä¸å¯è§ï¼Œæ­¤æ—¶ä¸å¦¨æŠŠè¦ä½¿ç”¨çš„ç¯å¢ƒå˜é‡ç›´æ¥å†™æ­»åœ¨è„šæœ¬é‡Œã€‚ /etc/rc.d/ /etc/rc0.d/, /etc/rc1.d/, ... ç³»åˆ—ç›®å½•å±äºSysVinitä½“ç³»çš„ç»„æˆéƒ¨åˆ†ï¼Œç›®å½•ä¸­æ˜¯è½¯é“¾æ¥ï¼Œé“¾æ¥æŒ‡å‘ /etc/init.d/ ä¸‹çœŸæ­£çš„è„šæœ¬ã€‚SysVinitæ˜¯æ—§çš„åˆå§‹åŒ–ç³»ç»Ÿï¼Œç°å·²è¢«systemdå…¼å®¹å¹¶å–ä»£ã€‚ ï¼ˆDeepSeekï¼‰ä»¥å¾€æ²¡æœ‰systemdæ—¶ï¼Œç¬¬ä¸€ä¸ªè¿›ç¨‹æ˜¯ initï¼Œå®ƒå¯èƒ½ä¼šåŠ è½½ä¸€äº›è‡ªå·±çš„é…ç½®æ–‡ä»¶ï¼Œä½†ä¸ä¼šåŠ è½½ /etc/environmentï¼Œç„¶åæ‰§è¡Œå¯¹åº”è¿è¡Œçº§åˆ«çš„rcè„šæœ¬ï¼ˆå¯åŠ¨çš„shellæ˜¯ Non-Interactive Non-Login Shellï¼‰ï¼Œè¿›è€Œå¯åŠ¨å„é¡¹ç³»ç»ŸæœåŠ¡ã€å®ˆæŠ¤è¿›ç¨‹ç­‰ç¨‹åºã€‚ ï¼ˆDeepSeekï¼‰systemdèƒ½å¤Ÿå…¼å®¹SysVinitï¼Œå®ƒèƒ½å¤Ÿä¸º /etc/init.d/ ä¸‹çš„è„šæœ¬ç”Ÿæˆsystemdè‡ªèº«çš„unitæ–‡ä»¶ï¼Œè¿›è€Œæ‰§è¡Œ /etc/init.d/ ä¸‹çš„è„šæœ¬ã€‚ ï¼ˆå¦ï¼‰service å‘½ä»¤å…¶å®æ˜¯ä¸€ä¸ªshellè„šæœ¬ï¼Œå¦‚æœç³»ç»Ÿä½¿ç”¨SysVinitï¼Œå®ƒï¼ˆservice nginx startï¼‰å°±ç›¸å½“äº /etc/init.d/nginx startï¼›å¦‚æœç³»ç»Ÿä½¿ç”¨systemdï¼Œå®ƒå°±ç›¸å½“äº systemctl start nginx.serviceã€‚ é…ç½®æ–‡ä»¶è§’è‰²å®šä½ /etc/profileï¼šshellçš„ç³»ç»Ÿçº§é…ç½®ï¼ŒLogin Shell çš„ç³»ç»Ÿçº§é…ç½®å…¥å£ï¼Œå…¶ä¸­ä¸€èˆ¬ä¼šåŠ è½½ /etc/bash.bashrcï¼Œéå† /etc/profile.d/ã€‚ /etc/bash.bashrcï¼šbashçš„ç³»ç»Ÿçº§é…ç½®ï¼ŒInteractive Shell çš„ç³»ç»Ÿçº§é…ç½®ï¼Œç”¨äºé…ç½®æ‰€æœ‰ç”¨æˆ·é€šç”¨çš„å‘½ä»¤æç¤ºç¬¦æ ·å¼ã€å‘½ä»¤åˆ«åç­‰ã€‚ /etc/profile.d/ï¼šå­˜æ”¾ Login Shell ç³»ç»Ÿçº§é…ç½®è„šæœ¬çš„ç›®å½•ï¼Œå¸¸ç”¨äºé…ç½®ç³»ç»Ÿçº§ç¯å¢ƒå˜é‡ã€‚ ~/.bash_profileï¼šbashçš„ç”¨æˆ·çº§é…ç½®ï¼ŒLogin Shell çš„ç”¨æˆ·çº§é…ç½®å…¥å£ï¼Œå…¶ä¸­ä¸€èˆ¬ä¼šåŠ è½½ ~/.bashrcã€‚è¯¥æ–‡ä»¶ï¼ˆ~/.bash_profileï¼‰å¯ç”¨äºé…ç½®ç”¨æˆ·çº§ç¯å¢ƒå˜é‡ã€‚è¯¥æ–‡ä»¶æ˜¯bashä¸“ç”¨çš„é…ç½®æ–‡ä»¶ï¼Œåœ¨éœ€è¦ä¸ºbashæä¾›ä¸“æœ‰é…ç½®ä¸”å…¶å®ƒshellç»§ç»­ä½¿ç”¨ ~/.profile é…ç½®æ—¶æ‰ä¼šæ´¾ä¸Šç”¨åœºï¼Œä¸€èˆ¬å¾ˆå°‘ä½¿ç”¨ã€‚bashä¼šæŒ‰ç…§ ~/.bash_profile &gt; ~/.bash_login &gt; ~/.profile çš„ä¼˜å…ˆçº§é¡ºåºä»…åŠ è½½å­˜åœ¨ä¸”å¯è¯»çš„ç¬¬ä¸€ä¸ªæ–‡ä»¶ã€‚ ~/.bash_loginï¼šbashçš„ç”¨æˆ·çº§é…ç½®ï¼ŒLogin Shell çš„ç”¨æˆ·çº§é…ç½®å…¥å£ï¼Œå…¶ä¸­ä¸€èˆ¬ä¼šåŠ è½½ ~/.bashrcã€‚è¯¥æ–‡ä»¶ï¼ˆ~/.bash_loginï¼‰å¯ç”¨äºé…ç½®ç”¨æˆ·çº§ç¯å¢ƒå˜é‡ã€‚è¯¥æ–‡ä»¶æ˜¯bashä¸“ç”¨çš„é…ç½®å¤‡ç”¨æ–‡ä»¶ï¼ŒåŠŸèƒ½ä¸ ~/.bash_profile ç±»ä¼¼ï¼Œå¹³æ—¶æå°‘ä½¿ç”¨ã€‚bashä¼šæŒ‰ç…§ ~/.bash_profile &gt; ~/.bash_login &gt; ~/.profile çš„ä¼˜å…ˆçº§é¡ºåºä»…åŠ è½½å­˜åœ¨ä¸”å¯è¯»çš„ç¬¬ä¸€ä¸ªæ–‡ä»¶ã€‚ ~/.profileï¼šshellçš„ç”¨æˆ·çº§é…ç½®ï¼ŒLogin Shell çš„ç”¨æˆ·çº§é…ç½®å…¥å£ï¼Œå…¶ä¸­ä¸€èˆ¬ä¼šåŠ è½½ ~/.bashrcã€‚è¯¥æ–‡ä»¶ï¼ˆ~/.profileï¼‰å¸¸ç”¨äºé…ç½®ç”¨æˆ·çº§ç¯å¢ƒå˜é‡ã€‚bashä¼šæŒ‰ç…§ ~/.bash_profile &gt; ~/.bash_login &gt; ~/.profile çš„ä¼˜å…ˆçº§é¡ºåºä»…åŠ è½½å­˜åœ¨ä¸”å¯è¯»çš„ç¬¬ä¸€ä¸ªæ–‡ä»¶ã€‚ ~/.bashrcï¼šbashçš„ç”¨æˆ·çº§é…ç½®ï¼ŒInteractive Shell çš„ç”¨æˆ·çº§é…ç½®ï¼Œç”¨äºé…ç½®å½“å‰ç”¨æˆ·çš„å‘½ä»¤æç¤ºç¬¦æ ·å¼ã€å‘½ä»¤åˆ«åç­‰ã€‚ ~/.bash_logoutï¼šbashçš„ç”¨æˆ·çº§é…ç½®ï¼ŒLogin Shell çš„ç”¨æˆ·çº§é…ç½®ï¼Œç”¨äºåœ¨é€€å‡ºshellï¼ˆCtrl+D æˆ– exit è§¦å‘ï¼‰æ—¶æ‰§è¡Œä¸€äº›å½“å‰ç”¨æˆ·çš„æ“ä½œï¼Œå¦‚æ¸…ç†æ“ä½œã€‚ /etc/bash.bash_logoutï¼šbashçš„ç³»ç»Ÿçº§é…ç½®ï¼ŒLogin Shell çš„ç³»ç»Ÿçº§é…ç½®ï¼Œç”¨äºåœ¨é€€å‡ºshellï¼ˆCtrl+D æˆ– exit è§¦å‘ï¼‰æ—¶æ‰§è¡Œä¸€äº›æ‰€æœ‰ç”¨æˆ·é€šç”¨çš„æ“ä½œï¼Œå¦‚æ¸…ç†æ“ä½œã€‚ä¸€èˆ¬å¾ˆå°‘ä½¿ç”¨è¯¥æ–‡ä»¶ã€‚ /etc/environmentï¼šPAMè®¤è¯æ¨¡å—çš„ç³»ç»Ÿçº§é…ç½®ï¼Œä¹Ÿè¢«systemdç›´æ¥åŠ è½½ï¼Œåªèƒ½ç”¨äºé…ç½®ç¯å¢ƒå˜é‡ï¼Œåœ¨ç°ä»£ä½¿ç”¨systemdçš„linuxä¸­ï¼Œç†è®ºä¸Šæ‰€æœ‰è¿›ç¨‹éƒ½èƒ½åƒåˆ°è¯¥ç¯å¢ƒï¼Œä¸è¿‡ä¸€èˆ¬å¾ˆå°‘ä½¿ç”¨ã€‚ ~/.pam_environmentï¼šPAMè®¤è¯æ¨¡å—çš„ç”¨æˆ·çº§é…ç½®ï¼Œåªèƒ½ç”¨äºé…ç½®ç¯å¢ƒå˜é‡ï¼Œä½†åŸºæœ¬å·²è¢«å¼ƒç”¨ã€‚ /etc/rc.d/ï¼š/etc/rc0.d/, /etc/rc1.d/, ... ç³»åˆ—ç›®å½•æ˜¯SysVinitä½“ç³»çš„ç»„æˆéƒ¨åˆ†ï¼Œå…¶å†…å­˜æ”¾æœåŠ¡ç®¡ç†è„šæœ¬çš„è½¯é“¾æ¥ï¼Œé“¾æ¥æŒ‡å‘ /etc/init.d/ã€‚SysVinitç°å·²è¢«systemdå…¼å®¹å¹¶å–ä»£ã€‚ /etc/init.d/ï¼šSysVinitä½“ç³»çš„ç»„æˆéƒ¨åˆ†ï¼Œå…¶å†…å­˜æ”¾æœåŠ¡ç®¡ç†è„šæœ¬ã€‚" />
<link rel="canonical" href="http://0.0.0.0:4000/posts/Linux%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E5%8A%A0%E8%BD%BD%E5%88%86%E6%9E%90/" />
<meta property="og:url" content="http://0.0.0.0:4000/posts/Linux%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E5%8A%A0%E8%BD%BD%E5%88%86%E6%9E%90/" />
<meta property="og:site_name" content="å°é»‘çŒ«" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-12-04T16:42:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Linuxç¯å¢ƒé…ç½®åŠ è½½åˆ†æ" />
<meta name="twitter:site" content="@twitter_username" />
<meta name="twitter:creator" content="@å°é»‘çŒ«" />
<script type="application/ld+json">
{"headline":"Linuxç¯å¢ƒé…ç½®åŠ è½½åˆ†æ","dateModified":"2025-12-04T16:42:00+08:00","datePublished":"2025-12-04T16:42:00+08:00","url":"http://0.0.0.0:4000/posts/Linux%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E5%8A%A0%E8%BD%BD%E5%88%86%E6%9E%90/","mainEntityOfPage":{"@type":"WebPage","@id":"http://0.0.0.0:4000/posts/Linux%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E5%8A%A0%E8%BD%BD%E5%88%86%E6%9E%90/"},"author":{"@type":"Person","name":"å°é»‘çŒ«"},"@type":"BlogPosting","description":"æœ¬æ–‡ä»¥ OS: Debian, Shell: bash ä¸ºç¯å¢ƒå†™æˆï¼Œå…¶å®ƒç¯å¢ƒå¦‚ OS: RedHat; Shell: sh, zsh å¯èƒ½ä¸æœ¬æ–‡ç»“è®ºæœ‰æ‰€å‡ºå…¥ã€‚ Shellç¯å¢ƒé…ç½®åŠ è½½åˆ†æ åœ¨ç ”ç©¶shellç¯å¢ƒé…ç½®æ–‡ä»¶åŠ è½½æµç¨‹å‰ï¼Œéœ€è¦å…ˆææ˜ç™½ Interactive Shellã€Login Shell çš„æ¦‚å¿µã€‚ Interactive Shell å®šä¹‰ man è¯´æ˜å¦‚ä¸‹ï¼š 1 bash [options] [command_string | file] 1 2 3 An interactive shell is one started without non-option arguments (unless -s is specified) and without the -c option, whose standard input and error are both connected to terminals (as determined by isatty(3)), or one started with the -i option. ä»¥ä¸‹æ¡ä»¶æ»¡è¶³ä»»æ„ä¸€æ¡ï¼Œå³ä¸º Interactive Shellï¼š å¯åŠ¨æ—¶ï¼Œæ—¢æ²¡æœ‰æŒ‡å®šéé€‰é¡¹å‚æ•°ï¼ˆé™¤éæŒ‡å®š -sï¼‰ä¹Ÿæ²¡æœ‰æŒ‡å®š -c é€‰é¡¹ï¼Œä¸”æ ‡å‡†è¾“å…¥å’Œé”™è¯¯è¾“å‡ºéƒ½ä¸ç»ˆç«¯ç›¸è¿ã€‚ å¯åŠ¨æ—¶ï¼ŒæŒ‡å®šäº† -i é€‰é¡¹ã€‚ æ¢è¨€ä¹‹ï¼š æ²¡æœ‰ -cï¼Œæ²¡æœ‰ -sï¼Œæ²¡æœ‰éé€‰é¡¹å‚æ•°ï¼Œä¸”æ ‡å‡†è¾“å…¥å’Œé”™è¯¯è¾“å‡ºéƒ½ä¸ç»ˆç«¯ç›¸è¿ï¼Œä¸º Interactive Shellã€‚ æ²¡æœ‰ -cï¼Œæœ‰ -sï¼Œä¸”æ ‡å‡†è¾“å…¥å’Œé”™è¯¯è¾“å‡ºéƒ½ä¸ç»ˆç«¯ç›¸è¿ï¼Œä¸º Interactive Shellã€‚ æœ‰ -i é€‰é¡¹ï¼Œä¸º Interactive Shellã€‚ æ„Ÿæ€§è®¤è¯†ï¼šä½ æ•²å‘½ä»¤ï¼Œshellç»™ä½ å›æ˜¾ç»“æœï¼Œåƒè¿™æ ·ä¸äººäº¤äº’çš„shellå°±æ˜¯ Interactive Shellã€‚ åˆ¤å®š man è¯´æ˜å¦‚ä¸‹ï¼š 1 2 PS1 is set and $- includes i if bash is interactive, allowing a shell script or a startup file to test this state. ä»¥ä¸‹æ¡ä»¶æ»¡è¶³ä»»æ„ä¸€æ¡ï¼Œå³ä¸º Interactive Shellï¼š $PS1 ä¸ä¸ºç©ºã€‚ $- ä¸­åŒ…å«å­—æ¯ iã€‚ æ¯”å¦‚ï¼š ssh è¿œç¨‹ç™»å½•åï¼Œå…¶ shell æ˜¯ Interactive Shellï¼š 1 2 3 4 5 orangepi@opidebz3server:~$ echo $PS1 \\[\\e]0;\\u@\\h: \\w\\a\\]${debian_chroot:+($debian_chroot)}\\[\\033[01;32m\\]\\u@\\h\\[\\033[00m\\]:\\[\\033[01;34m\\]\\w\\[\\033[00m\\]\\$ orangepi@opidebz3server:~$ echo $- himBHs æ‘˜è‡ª /etc/bash.bashrc å’Œ ~/.bashrc ä¸­çš„åˆ¤å®šå†™æ³•ï¼š 1 2 3 4 5 6 7 8 9 10 # /etc/bash.bashrc # If not running interactively, don&#39;t do anything [ -z &quot;$PS1&quot; ] &amp;&amp; return # ~/.bashrc # If not running interactively, don&#39;t do anything case $- in *i*) ;; *) return;; esac Login Shell å®šä¹‰ man è¯´æ˜å¦‚ä¸‹ï¼š 1 2 A login shell is one whose first character of argument zero is a -, or one started with the --login option. ä»¥ä¸‹æ¡ä»¶æ»¡è¶³ä»»æ„ä¸€æ¡ï¼Œå³ä¸º Login Shellï¼š $0 çš„é¦–å­—ç¬¦æ˜¯ -ã€‚ å¯åŠ¨æ—¶ï¼ŒæŒ‡å®šäº† --login(-l) é€‰é¡¹ã€‚ æ„Ÿæ€§è®¤è¯†ï¼šè¾“å…¥å¯†ç ç™»å½•åå¯åŠ¨çš„shellå°±æ˜¯ Login Shellã€‚ åˆ¤å®š åˆ¤å®šæ–¹æ³•ä¸å®šä¹‰ç›¸åŒã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå®æµ‹ä¸­å‘ç°ï¼ŒæŒ‡å®šäº† --login(-l) é€‰é¡¹çš„shellï¼Œå…¶ $0 çš„é¦–å­—ç¬¦å¹¶ä¸æ˜¯ -ã€‚è¿™æ„å‘³ç€ä¸Šè¿°ä¸¤ä¸ªæ¡ä»¶åˆ†åˆ«æ˜¯ Login Shell çš„å……åˆ†ä¸å¿…è¦æ¡ä»¶ã€‚è‹¥æ˜¯ Login Shellï¼Œ$0 çš„é¦–å­—ç¬¦å¹¶ä¸æ€»æ˜¯ -ã€‚å¦å¤–ï¼Œå·²ç„¶ç™»å½•ç³»ç»Ÿåï¼Œåœ¨å°è¯• bash -c &quot;echo $0&quot; æ—¶ï¼Œè¾“å‡ºç«Ÿç„¶æ˜¯ -bashï¼Œä½†è¿™æ˜¾ç„¶æ˜¯ä¸€ä¸ª Non-Interactive Non-Login Shellã€‚ç»¼ä¸Šï¼Œä¾æ®å®šä¹‰æ¥åˆ¤å®š Login Shell å¹¶ä¸ååˆ†å¯é ã€‚ DeepSeekç»™å‡ºäº†ä¸€ä¸ªå·ç§°å¯é çš„æ£€æµ‹æ–¹æ³•ï¼šshopt -q login_shell &amp;&amp; echo &quot;1&quot; || echo &quot;0&quot;ï¼Œå®æµ‹ä¸­æš‚æœªå‘ç°é—®é¢˜ï¼Œä¹Ÿè®¸èƒ½å¤Ÿä½œä¸º Login Shell çš„å……è¦æ¡ä»¶ã€‚ æ¯”å¦‚ï¼š sshè¿œç¨‹ç™»å½•åï¼Œå…¶shellæ˜¯ Login Shellï¼š 1 2 3 4 5 orangepi@opidebz3server:~$ echo $0 -bash orangepi@opidebz3server:~$ shopt -q login_shell &amp;&amp; echo &quot;1&quot; || echo &quot;0&quot; 1 å¯åŠ¨ä¸€ä¸ªæŒ‡å®šäº† --login å‚æ•°çš„subshellï¼ŒæŒ‰ç…§å®šä¹‰ï¼Œå…¶shellæ˜¯ Login Shellï¼š 1 2 3 4 5 6 7 orangepi@opidebz3server:~/Me/Misc$ bash --login orangepi@opidebz3server:~/Me/Misc$ echo $0 bash orangepi@opidebz3server:~$ shopt -q login_shell &amp;&amp; echo &quot;1&quot; || echo &quot;0&quot; 1 ç™»å½•ç³»ç»Ÿåï¼Œä½¿ç”¨ bash -c æ‰§è¡Œå‘½ä»¤ï¼Œå…¶shellæ˜¯ Non-Login Shellï¼š 1 2 3 4 5 orangepi@opidebz3server:~$ bash -c &quot;echo $0&quot; -bash orangepi@opidebz3server:~$ bash -c &#39;shopt -q login_shell &amp;&amp; echo &quot;1&quot; || echo &quot;0&quot;&#39; 0 Shellç±»å‹ä¸¾ä¾‹ ï¼ˆæœ‰äº›å‚æ•°ã€é…ç½®æ˜¯å¯ä»¥è°ƒçš„ï¼Œä»¥ä¸‹åªæ˜¯ä¸€èˆ¬æƒ…å†µã€‚ï¼‰ source ~/.bashrc ç›¸å½“äºåœ¨å½“å‰shellä¸­ä¸€è¡Œè¡Œæ‰§è¡Œäº†æŒ‡å®šçš„æ–‡ä»¶ï¼Œæ ¹æœ¬ä¸ä¼šå¯åŠ¨æ–°shellã€‚ å¯åŠ¨ä¸€ä¸ªæ²¡æœ‰GUIçš„ç³»ç»Ÿï¼Œåœ¨æ§åˆ¶å°ç™»å½•åè¿›å…¥çš„shellï¼Œæ˜¯ Interactive Login Shellã€‚ sshå‘½ä»¤è¡Œè¿œç¨‹ç™»å½•åå¯åŠ¨çš„shellæ˜¯ Interactive Login Shellã€‚ su - user å¯åŠ¨çš„shellæ˜¯ Interactive Login Shellã€‚ åœ¨shellä¸­æ‰‹æ•²bashæ‰“å¼€çš„subshellæ˜¯ Interactive Non-Login Shellã€‚ åœ¨å…·å¤‡GUIçš„ç³»ç»Ÿä¸­ï¼Œç™»å½•åè¿›å…¥æ¡Œé¢ï¼Œæ‰‹åŠ¨æ‰“å¼€ç»ˆç«¯ï¼Œæ­¤æ—¶å¯åŠ¨çš„shellä¸€èˆ¬æ˜¯ Interacive Non-Login Shellã€‚è¿™æ˜¯å› ä¸ºæ¡Œé¢è¿›ç¨‹æœ¬èº«å¯èƒ½åœ¨ä¸€ä¸ª Login Shell ä¸­å¯åŠ¨ï¼Œç™»å½•åè¿›å…¥æ¡Œé¢å†å¯åŠ¨çš„shellæ˜¯å…¶åä»£è¿›ç¨‹ï¼Œä¸€èˆ¬ä¸ä¼šå†æ˜¯ Login Shellã€‚ su user å¯åŠ¨çš„shellæ˜¯ Interacive Non-Login Shellã€‚ ç™»å½•åï¼Œæ¡Œé¢è¿›ç¨‹å¯èƒ½æ˜¯åœ¨ä¸€ä¸ªç”±ç¨‹åºå¯åŠ¨çš„shellä¸­å¯åŠ¨ï¼Œæˆ‘æ¨æµ‹è¿™ä¸ªç”±ç¨‹åºå¯åŠ¨å¹¶ç™»å½•çš„shellæ˜¯ Non-Interactive Login Shellã€‚ åƒ bash --login test.sh è¿™æ ·å¯åŠ¨çš„shellï¼Œå®ƒä¸ä¸äººäº¤äº’ï¼ŒåˆæŒ‡å®šäº† --loginï¼Œæ˜¾ç„¶æ˜¯ Non-Interactive Login Shellã€‚ åƒ bash test.sh æˆ– ./test.sh è¿™æ ·å¯åŠ¨çš„shellï¼Œå®ƒä¸ä¸äººäº¤äº’ï¼Œæ‰§è¡Œè„šæœ¬çš„æ—¶å€™æ˜¾ç„¶å·²ç»ç™»å½•äº†ç³»ç»Ÿï¼Œæ‰€ä»¥æ˜¯ Non-Interactive Non-Login Shellã€‚ æ— è®ºcrontabæ‰§è¡Œçš„æ˜¯ç³»ç»Ÿçº§è¿˜æ˜¯ç”¨æˆ·çº§å®šæ—¶ä»»åŠ¡ï¼Œå®ƒéƒ½ä¸éœ€è¦ç™»å½•ï¼Œå…¶æ‰§è¡Œshellè„šæœ¬æ—¶å¯åŠ¨çš„shelléƒ½æ˜¯ Non-Interactive Non-Login Shellã€‚ ç”±ç¨‹åºå†…éƒ¨å¯åŠ¨çš„shellï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šç‰¹æ®Šå‚æ•°ï¼Œå¤šæ•°æƒ…å†µä¸‹éƒ½æ˜¯ Non-Interactive Non-Login Shellã€‚ å¯åŠ¨æ–‡ä»¶åŠ è½½åˆ†æ åŠ è½½æµç¨‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # Interactive Login Shell /etc/profile â””/etc/bash.bashrc â””/etc/profile.d/*.sh ~/.profile â””~/.bashrc ~/.bash_logout /etc/bash.bash_logout # Interactive Non-Login Shell /etc/bash.bashrc ~/.bashrc # Non-Interactive Login Shell /etc/profile â””/etc/profile.d/*.sh ~/.profile â””~/.bashrc(do nothing and return) ~/.bash_logout /etc/bash.bash_logout # Non-Interactive Non-Login Shell $BASH_ENV -&gt; â”” è¡¨ç¤ºè°ƒç”¨å…³ç³»ã€‚è¿™äº›è°ƒç”¨å…³ç³»å¹¶ä¸ç»å¯¹ï¼Œä¸åŒç¯å¢ƒå¯èƒ½ä¼šæœ‰ä¸åŒæƒ…å†µï¼Œåº”ä»¥å®é™…è„šæœ¬å†…å®¹ä¸ºå‡†ï¼Œä¸è¿‡é€šå¸¸æ˜¯ä¸Šè¿°æƒ…å†µã€‚ -&gt; åœ¨æœ‰äº›Linuxä¸­ï¼ˆéDebianï¼‰ï¼Œ/etc/bash.bashrc å¯èƒ½å«åš /etc/bashrcï¼Œ/etc/bash.bash_logout å¯èƒ½å«åš /etc/bash_logoutã€‚ -&gt; ç¬”è€…æ²¡æœ‰åœ¨å®éªŒç¯å¢ƒä¸­æ–°å»º ~/.bash_profileã€~/.bash_login æ–‡ä»¶ï¼Œåªæœ‰é»˜è®¤å­˜åœ¨çš„ ~/.profile æ–‡ä»¶ã€‚è‹¥ä¸Šè¿°æ–‡ä»¶å­˜åœ¨ï¼Œåº”è¯¥ä¼šæŒ‰ç…§ ~/.bash_profile &gt; ~/.bash_login &gt; ~/.profile çš„ä¼˜å…ˆçº§é¡ºåºä»…åŠ è½½å­˜åœ¨ä¸”å¯è¯»çš„ç¬¬ä¸€ä¸ªæ–‡ä»¶ã€‚è¿™ä¸‰ä¸ªæ–‡ä»¶é€šå¸¸éƒ½ä¼š . &quot;$HOME/.bashrc&quot;ã€‚ -&gt; Interactive Login Shell é€€å‡ºï¼ˆæ¯”å¦‚ Ctrl+Dï¼‰æˆ– Non-Interactive Login Shell æ‰§è¡Œ exit å‘½ä»¤æ—¶ï¼Œbashæ‰ä¼šåŠ è½½ logout æ–‡ä»¶ï¼Œç›´æ¥å…³é—­bashåˆ™ä¸ä¼šåŠ è½½ä¹‹ã€‚ -&gt; /etc/profile æ‘˜å½•å¦‚ä¸‹ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 if [ &quot;${PS1-}&quot; ]; then if [ &quot;${BASH-}&quot; ] &amp;&amp; [ &quot;$BASH&quot; != &quot;/bin/sh&quot; ]; then # The file bash.bashrc already sets the default PS1. # PS1=&#39;\\h:\\w\\$ &#39; if [ -f /etc/bash.bashrc ]; then . /etc/bash.bashrc fi else if [ &quot;$(id -u)&quot; -eq 0 ]; then PS1=&#39;# &#39; else PS1=&#39;$ &#39; fi fi fi if [ &quot;${PS1-}&quot; ] æ˜¯åœ¨åˆ¤æ–­æ˜¯å¦æ˜¯ Interactive Shellï¼Œæ‰€ä»¥ Non-Interactive Login Shell ä¸ä¼šåŠ è½½ /etc/bash.bashrcã€‚ -&gt; ~/.profile æ‘˜å½•å¦‚ä¸‹ï¼š 1 2 3 4 5 6 7 # if running bash if [ -n &quot;$BASH_VERSION&quot; ]; then # include .bashrc if it exists if [ -f &quot;$HOME/.bashrc&quot; ]; then . &quot;$HOME/.bashrc&quot; fi fi ~/.bashrc æ‘˜å½•å¦‚ä¸‹ï¼š 1 2 3 4 5 # If not running interactively, don&#39;t do anything case $- in *i*) ;; *) return;; esac ~/.profile ä¸­åŠ è½½äº† ~/.bashrcï¼Œä½†è‹¥ä¸æ˜¯ Interactive Shellï¼Œ~/.bashrc å°†ç›´æ¥è¿”å›ï¼Œæ‰€ä»¥ Non-Interactive Login Shell è™½ç„¶è¯»äº† ~/.bashrc æ–‡ä»¶ï¼Œä½†å…¶å®ç›¸å½“äºæ²¡æœ‰åŠ è½½å®ƒã€‚ -&gt; ç¯å¢ƒå˜é‡ BASH_ENV çš„å€¼æ˜¯ä¸€ä¸ªæ–‡ä»¶åï¼ŒNon-Interactive Non-Login Shell ä¼šåŠ è½½è¿™ä¸ªæ–‡ä»¶ã€‚ æˆ‘ä»¬å¯ä»¥ç®€å•è®°å¿†ï¼šå¦‚æœæ˜¯ Login Shellï¼Œåˆ™ä¼šåŠ è½½ /etc/profileã€first of ~/.bash_profile &gt; ~/.bash_login &gt; ~/.profileï¼›å¦‚æœæ˜¯ Interactive Shellï¼Œåˆ™ä¼šåŠ è½½ /etc/bash.bashrcã€~/.bashrcã€‚ è¯¦ç»†æ–‡æ¡£å¯å‚è€ƒBash Reference Manual - 6.2 Bash Startup Filesã€‚ å¦é™„ä¸€å¼ å›½å¤–å¤§ä½¬æ•´ç†çš„å›¾ç‰‡ï¼š Bash Initialisation Files ç‰¹åˆ«åˆ†æä¸‹sudo ç¬”è€…åœ¨å„ä¸ªå¯åŠ¨æ–‡ä»¶å’Œæµ‹è¯•æ–‡ä»¶ä¸­éƒ½æ·»åŠ äº†ä¸€äº›æµ‹è¯•è¾“å‡ºï¼Œè¿™äº›è¾“å‡ºè¢«é‡å®šå‘åˆ°ä¸€ä¸ªç‰¹å®šæ–‡ä»¶ä¸­ä»¥ä¾¿æŸ¥çœ‹ã€‚æˆ‘ä»¬å°†åœ¨bashä¸­æ‰‹æ•²ä¸€äº›sudoå‘½ä»¤ï¼Œå¹¶ç»“åˆè®°å½•ä¸‹çš„æµ‹è¯•è¾“å‡ºå†…å®¹è¿›è¡Œåˆ†æã€‚ æå‰å‡†å¤‡ å¯åŠ¨æ–‡ä»¶çš„æµ‹è¯•è¾“å‡ºï¼šç•¥ã€‚ logout æ–‡ä»¶ï¼šç•¥ã€‚ æ–°å»º /root/.profile æ–‡ä»¶ï¼ˆä¸€èˆ¬/rootä¸‹æ²¡æœ‰è¯¥æ–‡ä»¶ï¼‰ï¼Œå¹¶è°ƒç”¨ /root/.bashrcï¼š 1 2 3 4 5 6 7 8 9 echo &quot;$HOME/.profile&quot; &gt;&gt; /home/orangepi/Me/Misc/load_cfg # if running bash if [ -n &quot;$BASH_VERSION&quot; ]; then # include .bashrc if it exists if [ -f &quot;$HOME/.bashrc&quot; ]; then . &quot;$HOME/.bashrc&quot; fi fi è®¾ç½® BASH_ENV ç¯å¢ƒå˜é‡ï¼š 1 2 # ç›´æ¥åœ¨bashé‡Œæ‰‹æ•² export BASH_ENV=/home/orangepi/Me/Misc/test1.sh test1.sh å†…å®¹ï¼š 1 2 3 4 #!/bin/bash echo &#39;test1.sh&#39; &gt;&gt; /home/orangepi/Me/Misc/load_cfg echo &#39;$BASH_ENV&#39; &gt;&gt; /home/orangepi/Me/Misc/load_cfg test.sh å†…å®¹ï¼š 1 2 3 4 5 6 7 8 #!/bin/bash echo &quot;test.sh&quot; &gt;&gt; /home/orangepi/Me/Misc/load_cfg echo &quot;\\$BASH_ENV: $BASH_ENV&quot; &gt;&gt; /home/orangepi/Me/Misc/load_cfg pstree &gt;&gt; /home/orangepi/Me/Misc/load_cfg echo &quot;&quot; &gt;&gt; /home/orangepi/Me/Misc/load_cfg echo &quot;123&quot; &gt; /dev/null exit åˆ†æsudo &gt; sudo pwd æ²¡æœ‰æµ‹è¯•è¾“å‡ºå†…å®¹ã€‚ å¯åŠ¨ sudo è¿›ç¨‹ï¼Œå†å¯åŠ¨ pwd å­è¿›ç¨‹ã€‚pwd æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶å¯æ‰§è¡Œç¨‹åºï¼Œä¸æ˜¯shellè„šæœ¬ã€‚æ²¡æœ‰shellè¢«å¯åŠ¨ï¼Œæ‰€ä»¥æ²¡æœ‰æµ‹è¯•è¾“å‡ºå†…å®¹ã€‚ &gt; sudo ./test.sh 1 2 3 test.sh $BASH_ENV: ... å¯åŠ¨ sudo è¿›ç¨‹ï¼Œå‘ç°è¦æ‰§è¡Œä¸€ä¸ªshellè„šæœ¬ï¼Œäºæ˜¯æ ¹æ® shebang å¯åŠ¨äº†ä¸€ä¸ª bash å­è¿›ç¨‹ï¼Œè‡ªç„¶æ˜¯ Non-Interactive Non-Login Shellï¼Œäºæ˜¯åº”è¯¥è¦å…ˆåŠ è½½ç¯å¢ƒå˜é‡ BASH_ENV æŒ‡å®šçš„æ–‡ä»¶ test1.shï¼Œç„¶è€Œè¾“å‡ºç»“æœæ˜¯â€œå¹¶æ²¡æœ‰â€ä¸”èƒ½æ³¨æ„åˆ° BASH_ENV çš„å€¼æ˜¯ç©ºçš„ï¼Œè¿™æ˜¯å› ä¸º sudo åœ¨é»˜è®¤é…ç½®ä¸‹ä¼šé‡ç½®å¹¶ä¿æŒä¸€ä¸ªç‰¹å®šçš„ç¯å¢ƒï¼Œä½¿ç”¨ sudo env å¯ä»¥æŸ¥çœ‹ä¹‹ã€‚bash å¯åŠ¨æ—¶å‘ç°æ²¡æœ‰ BASH_ENVï¼Œè‡ªç„¶å°±ä¸ä¼šåŠ è½½å…¶æŒ‡å®šçš„æ–‡ä»¶ã€‚ &gt; sudo â€“preserve-env=BASH_ENV pwd æ²¡æœ‰æµ‹è¯•è¾“å‡ºå†…å®¹ã€‚ --preserve-env=BASH_ENV ä½¿ç¯å¢ƒå˜é‡ BASH_ENV ä¿ç•™äº†ä¸‹æ¥ï¼Œä½† pwd ä¸æ˜¯shellè„šæœ¬ï¼Œæ²¡æœ‰shellè¢«å¯åŠ¨ï¼Œæ‰€ä»¥æ²¡æœ‰æµ‹è¯•è¾“å‡ºå†…å®¹ã€‚ &gt; sudo â€“preserve-env=BASH_ENV ./test.sh 1 2 3 4 5 test1.sh $BASH_ENV test.sh $BASH_ENV: /home/orangepi/Me/Misc/test1.sh ... --preserve-env=BASH_ENV ä½¿ç¯å¢ƒå˜é‡ BASH_ENV ä¿ç•™äº†ä¸‹æ¥ï¼Œæ‰§è¡Œ test.sh æ—¶å¯åŠ¨äº†ä¸€ä¸ª Non-Interactive Non-Login Shellï¼Œæ‰€ä»¥ BASH_ENV æŒ‡å®šçš„æ–‡ä»¶ test1.sh è¢«åŠ è½½äº†ã€‚ &gt; sudo -i 1 2 3 4 5 /etc/profile /etc/bash.bashrc /etc/profile.d/*.sh /root/.profile /root/.bashrc å¯åŠ¨ sudo è¿›ç¨‹åè¿˜ä¼šå¯åŠ¨ä¸€ä¸ªshellå­è¿›ç¨‹ã€‚-i è¡¨æ˜ä¼šå¯åŠ¨ä¸€ä¸ª Login Shellï¼Œåˆå› ä¸ºæ²¡æœ‰æŒ‡å®šè¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œå¯åŠ¨çš„shellå°†æ˜¯ä¸€ä¸ª Interactive Shellï¼Œå³å¯åŠ¨çš„shellå­è¿›ç¨‹æ˜¯ä¸€ä¸ª Interactive Login Shellã€‚æµ‹è¯•è¾“å‡ºç¬¦åˆé¢„æœŸã€‚è‹¥æ˜¯æ‰‹åŠ¨ Ctrl+D é€€å‡ºshellï¼Œåœ¨æ–‡ä»¶å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œè¿˜ä¼šä¾æ¬¡åŠ è½½ /root/.bash_logoutã€/etc/bash.bash_logoutã€‚ &gt; sudo -i â€“preserve-env=BASH_ENV pwd 1 2 3 4 5 6 /etc/profile /etc/profile.d/*.sh /root/.profile /root/.bashrc(do nothing and return) test1.sh $BASH_ENV å±…ç„¶åŠ è½½äº†BASH_ENVï¼Œä»¤äººæ„å¤–çš„ç»“æœã€‚ é¦–å…ˆå¯åŠ¨ sudo è¿›ç¨‹ã€‚å…¶æ¬¡ï¼Œç”±äº -i ä¸”æŒ‡å®šäº†è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œæ‰€ä»¥å¯åŠ¨ä¸€ä¸ª Non-Interactive Login Shellã€‚æ¥ä¸‹æ¥å°±ä»¤äººæ„å¤–äº†ï¼Œæ ¹æ® man sudo çš„è¯´æ³•ï¼Œæˆ‘çŒœåº”è¯¥æ˜¯ç›¸å½“äºæ‰§è¡Œäº† bash -c &#39;command&#39;ï¼Œå³å¯åŠ¨äº†ä¸€ä¸ª Non-Interactive Non-Login Shell å»æ‰§è¡Œäº† pwdã€‚ man sudoï¼š 1 2 3 4 5 -i, --login ... If a command is specified, it is passed to the shell as a simple command using the -c option. ... ç”±äºä¿ç•™äº† BASH_ENVï¼Œæ‰€ä»¥ test1.sh è¢«åŠ è½½ã€‚ å‘½ä»¤æ‰§è¡Œå®Œæ¯•åï¼Œlogout æ–‡ä»¶ä¸ä¼šè¢«åŠ è½½ï¼Œåº”è¯¥æ˜¯å…¶å†…éƒ¨æ²¡æœ‰æ­£å¸¸ exit Login Shellã€‚ &gt; sudo -i â€“preserve-env=BASH_ENV /home/orangepi/Me/Misc/test.sh 1 2 3 4 5 6 7 8 9 10 11 /etc/profile /etc/profile.d/*.sh /root/.profile /root/.bashrc(do nothing and return) test1.sh $BASH_ENV test1.sh $BASH_ENV test.sh $BASH_ENV: /home/orangepi/Me/Misc/test1.sh ... è¿™é‡Œ test.sh ä½¿ç”¨ç»å¯¹è·¯å¾„æ˜¯å› ä¸º sudo -i ä¼šå°†å½“å‰è·¯å¾„è°ƒæ•´ä¸º /rootã€‚ é¦–å…ˆå¯åŠ¨ sudo è¿›ç¨‹ï¼Œç„¶åå¯åŠ¨ä¸€ä¸ª Non-Interactive Login Shellï¼Œæ¥ç€å¯åŠ¨ä¸€ä¸ª Non-Interactive Non-Login Shell(bash -c &#39;command&#39;)ï¼ŒåŠ è½½äº† BASH_ENVï¼Œæœ€åæ ¹æ® shebang æ‰§è¡Œ test.shï¼Œäºæ˜¯åˆå¯åŠ¨äº†ä¸€ä¸ª Non-Interactive Non-Login Shellï¼Œå†æ¬¡åŠ è½½äº† BASH_ENVï¼Œæœ€ç»ˆå¾—åˆ°ä¸Šè¿°æµ‹è¯•è¾“å‡ºå†…å®¹ã€‚ &gt; sudo su 1 2 /etc/bash.bashrc /root/.bashrc å®¹æ˜“ç†è§£çš„ç»“æœã€‚å¯åŠ¨ sudo è¿›ç¨‹åå†å¯åŠ¨ su è¿›ç¨‹ï¼Œæ­¤å¤„æœªæŒ‡å®šç”¨æˆ·å°±é»˜è®¤ä¸ºæ˜¯ su rootï¼Œç„¶åå¯åŠ¨äº†ä¸€ä¸ª Interactive Non-Login Shellï¼Œäºæ˜¯å¾—åˆ°ä¸Šè¿°æµ‹è¯•è¾“å‡ºå†…å®¹ã€‚ &gt; sudo -i â€“preserve-env=BASH_ENV su - 1 2 3 4 5 6 7 8 9 10 11 /etc/profile /etc/profile.d/*.sh /root/.profile /root/.bashrc(do nothing and return) test1.sh $BASH_ENV /etc/profile /etc/bash.bashrc /etc/profile.d/*.sh /root/.profile /root/.bashrc ç¬”è€…æ•…æ„å †å buffï¼Œé€ å‡ºäº†è¿™ä¸ªé€†å¤©å‘½ä»¤ï¼Œå…¶æµ‹è¯•è¾“å‡ºå†…å®¹ä¹Ÿç¬¦åˆé¢„æœŸã€‚ å¯åŠ¨ sudo è¿›ç¨‹ã€‚ å› ä¸ºæŒ‡å®šäº†è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œåˆå› ä¸º -iï¼Œæ‰€ä»¥å¯åŠ¨äº†ä¸€ä¸ª Non-Interactive Login Shellã€‚ ä»¥ bash -c &#39;su -&#39; çš„å½¢å¼æ‰§è¡Œå‘½ä»¤ï¼Œå°†å¯åŠ¨ä¸€ä¸ª Non-Interactive Non-Login Shellï¼Œåˆå› ä¸ºä¿ç•™äº† BASH_ENVï¼Œæ‰€ä»¥å°†åŠ è½½ test1.shã€‚ å¯åŠ¨ su è¿›ç¨‹ã€‚ å› ä¸º -ï¼Œå°†å¯åŠ¨ä¸€ä¸ª Interacitve Login Shellã€‚ è‹¥æ‰‹åŠ¨ Ctrl+D é€€å‡ºshellï¼Œåœ¨æ–‡ä»¶å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œè¿˜ä¼šåŠ è½½ç›¸åº”çš„ logout æ–‡ä»¶ã€‚ &gt; å…³äºpstreeçš„è¾“å‡º pstree çš„è¾“å‡ºä¸æˆ‘ä»¬çš„ç†è§£å­˜åœ¨å‡ºå…¥ï¼Œæœ‰äº›shellå­è¿›ç¨‹å¹¶æ²¡æœ‰è¢«æ˜¾ç¤ºå‡ºæ¥ã€‚ sudo -i --preserve-env=BASH_ENV /home/orangepi/Me/Misc/test.sh çš„ pstree è¾“å‡ºï¼š 1 2 3 4 systemd-+-NetworkManager---2*[{NetworkManager}] ... |-sshd---sshd---sshd---bash---sudo---sudo---test.sh---pstree ... DeepSeekçš„è§£é‡Šæ˜¯è¿›ç¨‹æ›¿æ¢ï¼ˆexecveï¼‰æœºåˆ¶å¯¼è‡´äº†è¿™ä¸€ç°è±¡ï¼Œå¹¶è‚¯å®šäº†ç¬”è€…ä¸Šé¢çš„ç†è§£ã€‚é‡ç‚¹æ˜¯DeepSeekè‚¯å®šäº†ç¬”è€…çš„ç†è§£ï¼Œé‚£åº”è¯¥é—®é¢˜ä¸å¤§ğŸ¤ªï¼Œè‡³äºä»€ä¹ˆforkã€è¿›ç¨‹æ›¿æ¢äº‘äº‘ï¼Œä¸æ‡‚ï¼Œä¸ç®¡äº†ğŸ¥±ã€‚ å…¶å®ƒç¯å¢ƒé…ç½®åŠ è½½åˆ†æ /etc/environment è¯¥æ–‡ä»¶æ˜¯ä¸€ä¸ªç³»ç»Ÿçº§çš„é…ç½®æ–‡ä»¶ï¼Œä¸»è¦ç”±PAMè®¤è¯æ¨¡å—åŠ è½½ã€‚ å®è·µä¸­ï¼Œè¯¥æ–‡ä»¶å¾ˆå°‘è¢«ä½¿ç”¨ï¼Œå…¶å¯¹åº”çš„ç”¨æˆ·çº§é…ç½®æ–‡ä»¶ ~/.pam_environment åŸºæœ¬å·²è¢«å¼ƒç”¨ã€‚ è¯¥æ–‡ä»¶åªæ”¯æŒç®€å•çš„é”®å€¼å¯¹å†…å®¹ï¼Œå¹¶éshellè„šæœ¬ï¼Œ~/.pam_environment ä¹Ÿå·®ä¸å¤šå¦‚æ­¤ã€‚ å…³äºè¯¥æ–‡ä»¶çš„åŠ è½½æ—¶æœºï¼Œç¬”è€…è®©DeepSeekç”»äº†ä¸€å¼ å›¾ï¼Œä¸€ç›®äº†ç„¶ã€‚æœ€åˆçš„ systemd å°±ä¼šåŠ è½½å®ƒï¼Œè€Œåç”± systemd å¯åŠ¨çš„åç»­è¿›ç¨‹å°†ç»§æ‰¿ç¯å¢ƒæˆ–è€…é€šè¿‡PAMè®¤è¯æ¨¡å—å†æ¬¡åŠ è½½å®ƒï¼Œæ•…ç†è®ºä¸Šï¼Œæ‰€æœ‰è¿›ç¨‹éƒ½èƒ½åƒåˆ°è¯¥æ–‡ä»¶ç¯å¢ƒã€‚ é€šè¿‡è¿™å¼ å›¾è¿˜æƒ³è¯´æ˜å¦ä¸€ä»¶äº‹ï¼šæœ¬æ–‡ä¸Šé¢å¤§ç¯‡å¹…è®¨è®ºçš„è¯¸å¦‚ /etc/profileã€~/.profile ç­‰æ–‡ä»¶åªæ˜¯ shell çš„é…ç½®æ–‡ä»¶ï¼Œå…¶å®ƒè¿›ç¨‹æ˜¯ä¸ä¼šåŠ è½½å®ƒä»¬çš„ï¼Œé™¤éå…¶è¿›ç¨‹å†…éƒ¨ä¸»åŠ¨å¯åŠ¨äº†ä¸€ä¸ªshellæˆ–è€…æœ‰å…¶å®ƒæœªçŸ¥çš„ç‰¹æ®Šæƒ…å†µã€‚æ¯”å¦‚ï¼Œcrontab ä¸æ˜¯shellï¼Œå…¶æœ¬èº«åƒä¸åˆ°shellé…ç½®æ–‡ä»¶ç¯å¢ƒï¼Œè‹¥å…¶æ‰§è¡Œshellè„šæœ¬ï¼Œåˆ™å¯åŠ¨çš„shellå°†ç»§æ‰¿å…¶ç¯å¢ƒï¼Œè€Œè¯¥shellåˆæ˜¯ä¸€ä¸ª Non-Interactive Non-Login Shellï¼Œå¯åŠ¨æ—¶ä¹Ÿä¸ä¼šåŠ è½½é…ç½®æ–‡ä»¶ï¼Œè¿™äº›éƒ½å°†ä½¿å¾—è¯¥shellåœ¨æ‰§è¡Œæ—¶å¤„äºä¸€ä¸ªååˆ†æœ‰é™çš„ç¯å¢ƒï¼Œè¿™æ„å‘³ç€åœ¨ä½¿ç”¨ crontab å®šæ—¶æ‰§è¡Œshellè„šæœ¬æ—¶ï¼Œäºshellé…ç½®æ–‡ä»¶ä¸­è®¾ç½®çš„ç¯å¢ƒå˜é‡å°†ä¸å¯è§ï¼Œæ­¤æ—¶ä¸å¦¨æŠŠè¦ä½¿ç”¨çš„ç¯å¢ƒå˜é‡ç›´æ¥å†™æ­»åœ¨è„šæœ¬é‡Œã€‚ /etc/rc.d/ /etc/rc0.d/, /etc/rc1.d/, ... ç³»åˆ—ç›®å½•å±äºSysVinitä½“ç³»çš„ç»„æˆéƒ¨åˆ†ï¼Œç›®å½•ä¸­æ˜¯è½¯é“¾æ¥ï¼Œé“¾æ¥æŒ‡å‘ /etc/init.d/ ä¸‹çœŸæ­£çš„è„šæœ¬ã€‚SysVinitæ˜¯æ—§çš„åˆå§‹åŒ–ç³»ç»Ÿï¼Œç°å·²è¢«systemdå…¼å®¹å¹¶å–ä»£ã€‚ ï¼ˆDeepSeekï¼‰ä»¥å¾€æ²¡æœ‰systemdæ—¶ï¼Œç¬¬ä¸€ä¸ªè¿›ç¨‹æ˜¯ initï¼Œå®ƒå¯èƒ½ä¼šåŠ è½½ä¸€äº›è‡ªå·±çš„é…ç½®æ–‡ä»¶ï¼Œä½†ä¸ä¼šåŠ è½½ /etc/environmentï¼Œç„¶åæ‰§è¡Œå¯¹åº”è¿è¡Œçº§åˆ«çš„rcè„šæœ¬ï¼ˆå¯åŠ¨çš„shellæ˜¯ Non-Interactive Non-Login Shellï¼‰ï¼Œè¿›è€Œå¯åŠ¨å„é¡¹ç³»ç»ŸæœåŠ¡ã€å®ˆæŠ¤è¿›ç¨‹ç­‰ç¨‹åºã€‚ ï¼ˆDeepSeekï¼‰systemdèƒ½å¤Ÿå…¼å®¹SysVinitï¼Œå®ƒèƒ½å¤Ÿä¸º /etc/init.d/ ä¸‹çš„è„šæœ¬ç”Ÿæˆsystemdè‡ªèº«çš„unitæ–‡ä»¶ï¼Œè¿›è€Œæ‰§è¡Œ /etc/init.d/ ä¸‹çš„è„šæœ¬ã€‚ ï¼ˆå¦ï¼‰service å‘½ä»¤å…¶å®æ˜¯ä¸€ä¸ªshellè„šæœ¬ï¼Œå¦‚æœç³»ç»Ÿä½¿ç”¨SysVinitï¼Œå®ƒï¼ˆservice nginx startï¼‰å°±ç›¸å½“äº /etc/init.d/nginx startï¼›å¦‚æœç³»ç»Ÿä½¿ç”¨systemdï¼Œå®ƒå°±ç›¸å½“äº systemctl start nginx.serviceã€‚ é…ç½®æ–‡ä»¶è§’è‰²å®šä½ /etc/profileï¼šshellçš„ç³»ç»Ÿçº§é…ç½®ï¼ŒLogin Shell çš„ç³»ç»Ÿçº§é…ç½®å…¥å£ï¼Œå…¶ä¸­ä¸€èˆ¬ä¼šåŠ è½½ /etc/bash.bashrcï¼Œéå† /etc/profile.d/ã€‚ /etc/bash.bashrcï¼šbashçš„ç³»ç»Ÿçº§é…ç½®ï¼ŒInteractive Shell çš„ç³»ç»Ÿçº§é…ç½®ï¼Œç”¨äºé…ç½®æ‰€æœ‰ç”¨æˆ·é€šç”¨çš„å‘½ä»¤æç¤ºç¬¦æ ·å¼ã€å‘½ä»¤åˆ«åç­‰ã€‚ /etc/profile.d/ï¼šå­˜æ”¾ Login Shell ç³»ç»Ÿçº§é…ç½®è„šæœ¬çš„ç›®å½•ï¼Œå¸¸ç”¨äºé…ç½®ç³»ç»Ÿçº§ç¯å¢ƒå˜é‡ã€‚ ~/.bash_profileï¼šbashçš„ç”¨æˆ·çº§é…ç½®ï¼ŒLogin Shell çš„ç”¨æˆ·çº§é…ç½®å…¥å£ï¼Œå…¶ä¸­ä¸€èˆ¬ä¼šåŠ è½½ ~/.bashrcã€‚è¯¥æ–‡ä»¶ï¼ˆ~/.bash_profileï¼‰å¯ç”¨äºé…ç½®ç”¨æˆ·çº§ç¯å¢ƒå˜é‡ã€‚è¯¥æ–‡ä»¶æ˜¯bashä¸“ç”¨çš„é…ç½®æ–‡ä»¶ï¼Œåœ¨éœ€è¦ä¸ºbashæä¾›ä¸“æœ‰é…ç½®ä¸”å…¶å®ƒshellç»§ç»­ä½¿ç”¨ ~/.profile é…ç½®æ—¶æ‰ä¼šæ´¾ä¸Šç”¨åœºï¼Œä¸€èˆ¬å¾ˆå°‘ä½¿ç”¨ã€‚bashä¼šæŒ‰ç…§ ~/.bash_profile &gt; ~/.bash_login &gt; ~/.profile çš„ä¼˜å…ˆçº§é¡ºåºä»…åŠ è½½å­˜åœ¨ä¸”å¯è¯»çš„ç¬¬ä¸€ä¸ªæ–‡ä»¶ã€‚ ~/.bash_loginï¼šbashçš„ç”¨æˆ·çº§é…ç½®ï¼ŒLogin Shell çš„ç”¨æˆ·çº§é…ç½®å…¥å£ï¼Œå…¶ä¸­ä¸€èˆ¬ä¼šåŠ è½½ ~/.bashrcã€‚è¯¥æ–‡ä»¶ï¼ˆ~/.bash_loginï¼‰å¯ç”¨äºé…ç½®ç”¨æˆ·çº§ç¯å¢ƒå˜é‡ã€‚è¯¥æ–‡ä»¶æ˜¯bashä¸“ç”¨çš„é…ç½®å¤‡ç”¨æ–‡ä»¶ï¼ŒåŠŸèƒ½ä¸ ~/.bash_profile ç±»ä¼¼ï¼Œå¹³æ—¶æå°‘ä½¿ç”¨ã€‚bashä¼šæŒ‰ç…§ ~/.bash_profile &gt; ~/.bash_login &gt; ~/.profile çš„ä¼˜å…ˆçº§é¡ºåºä»…åŠ è½½å­˜åœ¨ä¸”å¯è¯»çš„ç¬¬ä¸€ä¸ªæ–‡ä»¶ã€‚ ~/.profileï¼šshellçš„ç”¨æˆ·çº§é…ç½®ï¼ŒLogin Shell çš„ç”¨æˆ·çº§é…ç½®å…¥å£ï¼Œå…¶ä¸­ä¸€èˆ¬ä¼šåŠ è½½ ~/.bashrcã€‚è¯¥æ–‡ä»¶ï¼ˆ~/.profileï¼‰å¸¸ç”¨äºé…ç½®ç”¨æˆ·çº§ç¯å¢ƒå˜é‡ã€‚bashä¼šæŒ‰ç…§ ~/.bash_profile &gt; ~/.bash_login &gt; ~/.profile çš„ä¼˜å…ˆçº§é¡ºåºä»…åŠ è½½å­˜åœ¨ä¸”å¯è¯»çš„ç¬¬ä¸€ä¸ªæ–‡ä»¶ã€‚ ~/.bashrcï¼šbashçš„ç”¨æˆ·çº§é…ç½®ï¼ŒInteractive Shell çš„ç”¨æˆ·çº§é…ç½®ï¼Œç”¨äºé…ç½®å½“å‰ç”¨æˆ·çš„å‘½ä»¤æç¤ºç¬¦æ ·å¼ã€å‘½ä»¤åˆ«åç­‰ã€‚ ~/.bash_logoutï¼šbashçš„ç”¨æˆ·çº§é…ç½®ï¼ŒLogin Shell çš„ç”¨æˆ·çº§é…ç½®ï¼Œç”¨äºåœ¨é€€å‡ºshellï¼ˆCtrl+D æˆ– exit è§¦å‘ï¼‰æ—¶æ‰§è¡Œä¸€äº›å½“å‰ç”¨æˆ·çš„æ“ä½œï¼Œå¦‚æ¸…ç†æ“ä½œã€‚ /etc/bash.bash_logoutï¼šbashçš„ç³»ç»Ÿçº§é…ç½®ï¼ŒLogin Shell çš„ç³»ç»Ÿçº§é…ç½®ï¼Œç”¨äºåœ¨é€€å‡ºshellï¼ˆCtrl+D æˆ– exit è§¦å‘ï¼‰æ—¶æ‰§è¡Œä¸€äº›æ‰€æœ‰ç”¨æˆ·é€šç”¨çš„æ“ä½œï¼Œå¦‚æ¸…ç†æ“ä½œã€‚ä¸€èˆ¬å¾ˆå°‘ä½¿ç”¨è¯¥æ–‡ä»¶ã€‚ /etc/environmentï¼šPAMè®¤è¯æ¨¡å—çš„ç³»ç»Ÿçº§é…ç½®ï¼Œä¹Ÿè¢«systemdç›´æ¥åŠ è½½ï¼Œåªèƒ½ç”¨äºé…ç½®ç¯å¢ƒå˜é‡ï¼Œåœ¨ç°ä»£ä½¿ç”¨systemdçš„linuxä¸­ï¼Œç†è®ºä¸Šæ‰€æœ‰è¿›ç¨‹éƒ½èƒ½åƒåˆ°è¯¥ç¯å¢ƒï¼Œä¸è¿‡ä¸€èˆ¬å¾ˆå°‘ä½¿ç”¨ã€‚ ~/.pam_environmentï¼šPAMè®¤è¯æ¨¡å—çš„ç”¨æˆ·çº§é…ç½®ï¼Œåªèƒ½ç”¨äºé…ç½®ç¯å¢ƒå˜é‡ï¼Œä½†åŸºæœ¬å·²è¢«å¼ƒç”¨ã€‚ /etc/rc.d/ï¼š/etc/rc0.d/, /etc/rc1.d/, ... ç³»åˆ—ç›®å½•æ˜¯SysVinitä½“ç³»çš„ç»„æˆéƒ¨åˆ†ï¼Œå…¶å†…å­˜æ”¾æœåŠ¡ç®¡ç†è„šæœ¬çš„è½¯é“¾æ¥ï¼Œé“¾æ¥æŒ‡å‘ /etc/init.d/ã€‚SysVinitç°å·²è¢«systemdå…¼å®¹å¹¶å–ä»£ã€‚ /etc/init.d/ï¼šSysVinitä½“ç³»çš„ç»„æˆéƒ¨åˆ†ï¼Œå…¶å†…å­˜æ”¾æœåŠ¡ç®¡ç†è„šæœ¬ã€‚","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <title>Linuxç¯å¢ƒé…ç½®åŠ è½½åˆ†æ | å°é»‘çŒ«
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="å°é»‘çŒ«">
<meta name="application-name" content="å°é»‘çŒ«">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous">
  <link rel="dns-prefetch" href="https://fonts.gstatic.com">

  <!-- GA -->
  

  <!-- jsDelivr CDN -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css">

  <!--
  CSS selector for site.
-->

<link rel="stylesheet" href="/assets/css/style.css">


  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css">



  <!-- Manific Popup -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css">



  <!-- JavaScript -->

  <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>

</head>


  
    <!--
  Switch the mode between dark and light.
-->

<script type="text/javascript">
  class ModeToggle {
    static get MODE_KEY() { return "mode"; }
    static get MODE_ATTR() { return "data-mode"; }
    static get DARK_MODE() { return "dark"; }
    static get LIGHT_MODE() { return "light"; }
    static get ID() { return "mode-toggle"; }

    constructor() {
      if (this.hasMode) {
        if (this.isDarkMode) {
          if (!this.isSysDarkPrefer) {
            this.setDark();
          }
        } else {
          if (this.isSysDarkPrefer) {
            this.setLight();
          }
        }
      }

      let self = this;

      /* always follow the system prefers */
      this.sysDarkPrefers.addEventListener("change", () => {
        if (self.hasMode) {
          if (self.isDarkMode) {
            if (!self.isSysDarkPrefer) {
              self.setDark();
            }

          } else {
            if (self.isSysDarkPrefer) {
              self.setLight();
            }
          }

          self.clearMode();
        }

        self.notify();

      });

    } /* constructor() */

    get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); }

    get isSysDarkPrefer() { return this.sysDarkPrefers.matches; }

    get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; }

    get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; }

    get hasMode() { return this.mode != null; }

    get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); }

    /* get the current mode on screen */
    get modeStatus() {
      if (this.isDarkMode
        || (!this.hasMode && this.isSysDarkPrefer)) {
        return ModeToggle.DARK_MODE;
      } else {
        return ModeToggle.LIGHT_MODE;
      }
    }

    setDark() {
      $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE);
    }

    setLight() {
      $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE);
    }

    clearMode() {
      $('html').removeAttr(ModeToggle.MODE_ATTR);
      sessionStorage.removeItem(ModeToggle.MODE_KEY);
    }

    /* Notify another plugins that the theme mode has changed */
    notify() {
      window.postMessage({
        direction: ModeToggle.ID,
        message: this.modeStatus
      }, "*");
    }

  } /* ModeToggle */

  const toggle = new ModeToggle();

  function flipMode() {
    if (toggle.hasMode) {
      if (toggle.isSysDarkPrefer) {
        if (toggle.isLightMode) {
          toggle.clearMode();
        } else {
          toggle.setLight();
        }

      } else {
        if (toggle.isDarkMode) {
          toggle.clearMode();
        } else {
          toggle.setDark();
        }
      }

    } else {
      if (toggle.isSysDarkPrefer) {
        toggle.setLight();
      } else {
        toggle.setDark();
      }
    }

    toggle.notify();

  } /* flipMode() */

</script>

  

  <body data-spy="scroll" data-target="#toc" data-topbar-visible="true">

    <!--
  The Side Bar
-->

<div id="sidebar" class="d-flex flex-column align-items-end" lang="zh-CN">
  <div class="profile-wrapper text-center">
    <div id="avatar">
      <a href="/" alt="avatar" class="mx-auto">
        
          
          <img src="https://img-host-lcatmiao.oss-cn-hangzhou.aliyuncs.com/202202021358647.png" alt="avatar" onerror="this.style.display='none'">
        
      </a>
    </div>

    <div class="site-title mt-3">
      <a href="/">å°é»‘çŒ«</a>
    </div>
    <div class="site-subtitle font-italic">å–µï½</div>

  </div><!-- .profile-wrapper -->

  <ul class="w-100">

    <!-- home -->
    <li class="nav-item">
      <a href="/" class="nav-link">
        <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
        <span>é¦–é¡µ</span>
      </a>
    </li>
    <!-- the real tabs -->
    
    <li class="nav-item">
      <a href="/categories/" class="nav-link">
        <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>åˆ†ç±»</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/tags/" class="nav-link">
        <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>æ ‡ç­¾</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/archives/" class="nav-link">
        <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>å½’æ¡£</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/about/" class="nav-link">
        <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>å…³äº</span>
      </a>
    </li> <!-- .nav-item -->
    

  </ul> <!-- ul.nav.flex-column -->

  <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center">

    
      <button class="mode-toggle btn" aria-label="Switch Mode">
        <i class="fas fa-adjust"></i>
      </button>

      
        <span class="icon-border"></span>
      
    

    
      

      
      <a href="https://github.com/lcatmiao" aria-label="github"
        target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
      

    
      

      
      <a href="https://twitter.com/twitter_username" aria-label="twitter"
        target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
      

    
      

      
      <a href="
          javascript:location.href = 'mailto:' + ['example','doamin.com'].join('@')" aria-label="email"
        >
        <i class="fas fa-envelope"></i>
      </a>
      

    
      

      
      <a href="/feed.xml" aria-label="rss"
        >
        <i class="fas fa-rss"></i>
      </a>
      

    

  </div> <!-- .sidebar-bottom -->

</div><!-- #sidebar -->


    <!--
  The Top Bar
-->

<div id="topbar-wrapper" class="row justify-content-center">
  <div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between">
    <span id="breadcrumb">

    

    

      

        
          <span>
            <a href="/">
              é¦–é¡µ
            </a>
          </span>

        

      

        

      

        

          
            <span>Linuxç¯å¢ƒé…ç½®åŠ è½½åˆ†æ</span>
          

        

      

    

    </span><!-- endof #breadcrumb -->

    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>

    <div id="topbar-title">
      æ–‡ç« 
    </div>

    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search"
        aria-label="search" autocomplete="off" placeholder="æœç´¢...">
      <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i>
    </span>
    <span id="search-cancel" >å–æ¶ˆ</span>
  </div>

</div>


    <div id="main-wrapper">
      <div id="main">

        



<div class="row">

  <!-- core -->
  <div id="core-wrapper" class="col-12 col-lg-11 col-xl-8">
    <div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">

    

    
      
      
        <!--
  Refactor the HTML structure.
-->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Add attribute 'hide-bullet' to the checkbox list -->



<!-- images -->




  
  

  
    
      
      
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  

  



<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    

    

  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    

    

  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    

    

  

  
  

  




<!-- Wrap prompt element of blockquote with the <div> tag -->







<!-- return -->







<h1 data-toc-skip>Linuxç¯å¢ƒé…ç½®åŠ è½½åˆ†æ</h1>

<div class="post-meta text-muted">

  <!-- author -->
  <div>
    
    

    

    ä½œè€…
    <em>
      
        <a href="https://github.com/lcatmiao">å°é»‘çŒ«</a>
      
    </em>
  </div>

  <div class="d-flex">
    <div>
      <!-- published date -->
      <span>
        å‘è¡¨äº
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/timeago.js
-->

<em class="timeago"
    data-ts="1764837720"
    
      data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll"
    
    >
  2025-12-04
</em>

      </span>

      <!-- lastmod date -->
      

      <!-- read time -->
      <!--
  Calculate the post's reading time, and display the word count in tooltip
 -->



<!-- words per minute  -->










<!-- return element -->
<span class="readtime" data-toggle="tooltip" data-placement="bottom"
  title="4488 å­—">
  <em>24 åˆ†é’Ÿ</em>é˜…è¯»</span>


      <!-- page views -->
      
    </div>

  </div> <!-- .d-flex -->

</div> <!-- .post-meta -->

<div class="post-content">
  <p>æœ¬æ–‡ä»¥ <code class="language-plaintext highlighter-rouge">OS: Debian, Shell: bash</code> ä¸ºç¯å¢ƒå†™æˆï¼Œå…¶å®ƒç¯å¢ƒå¦‚ <code class="language-plaintext highlighter-rouge">OS: RedHat; Shell: sh, zsh</code> å¯èƒ½ä¸æœ¬æ–‡ç»“è®ºæœ‰æ‰€å‡ºå…¥ã€‚</p>

<h1 id="shellç¯å¢ƒé…ç½®åŠ è½½åˆ†æ">Shellç¯å¢ƒé…ç½®åŠ è½½åˆ†æ</h1>

<p>åœ¨ç ”ç©¶shellç¯å¢ƒé…ç½®æ–‡ä»¶åŠ è½½æµç¨‹å‰ï¼Œéœ€è¦å…ˆææ˜ç™½ <code class="language-plaintext highlighter-rouge">Interactive Shell</code>ã€<code class="language-plaintext highlighter-rouge">Login Shell</code> çš„æ¦‚å¿µã€‚</p>

<h2 id="interactive-shell">Interactive Shell <a href="#interactive-shell" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2>

<h3 id="å®šä¹‰">å®šä¹‰ <a href="#å®šä¹‰" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3>

<p><code class="language-plaintext highlighter-rouge">man</code> è¯´æ˜å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>bash [options] [command_string | file]
</pre></td></tr></tbody></table></code></div></div>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>An interactive shell is one started without non-option arguments (unless -s is 
specified) and without the -c option, whose standard input and error are both connected 
to terminals (as determined by isatty(3)), or one started with the -i option.
</pre></td></tr></tbody></table></code></div></div>

<p>ä»¥ä¸‹æ¡ä»¶æ»¡è¶³ä»»æ„ä¸€æ¡ï¼Œå³ä¸º <code class="language-plaintext highlighter-rouge">Interactive Shell</code>ï¼š</p>

<ul>
  <li>å¯åŠ¨æ—¶ï¼Œæ—¢æ²¡æœ‰æŒ‡å®šéé€‰é¡¹å‚æ•°ï¼ˆé™¤éæŒ‡å®š <code class="language-plaintext highlighter-rouge">-s</code>ï¼‰ä¹Ÿæ²¡æœ‰æŒ‡å®š <code class="language-plaintext highlighter-rouge">-c</code> é€‰é¡¹ï¼Œä¸”æ ‡å‡†è¾“å…¥å’Œé”™è¯¯è¾“å‡ºéƒ½ä¸ç»ˆç«¯ç›¸è¿ã€‚</li>
  <li>å¯åŠ¨æ—¶ï¼ŒæŒ‡å®šäº† <code class="language-plaintext highlighter-rouge">-i</code> é€‰é¡¹ã€‚</li>
</ul>

<p>æ¢è¨€ä¹‹ï¼š</p>

<ol>
  <li>æ²¡æœ‰ <code class="language-plaintext highlighter-rouge">-c</code>ï¼Œæ²¡æœ‰ <code class="language-plaintext highlighter-rouge">-s</code>ï¼Œæ²¡æœ‰éé€‰é¡¹å‚æ•°ï¼Œä¸”æ ‡å‡†è¾“å…¥å’Œé”™è¯¯è¾“å‡ºéƒ½ä¸ç»ˆç«¯ç›¸è¿ï¼Œä¸º <code class="language-plaintext highlighter-rouge">Interactive Shell</code>ã€‚</li>
  <li>æ²¡æœ‰ <code class="language-plaintext highlighter-rouge">-c</code>ï¼Œæœ‰ <code class="language-plaintext highlighter-rouge">-s</code>ï¼Œä¸”æ ‡å‡†è¾“å…¥å’Œé”™è¯¯è¾“å‡ºéƒ½ä¸ç»ˆç«¯ç›¸è¿ï¼Œä¸º <code class="language-plaintext highlighter-rouge">Interactive Shell</code>ã€‚</li>
  <li>æœ‰ <code class="language-plaintext highlighter-rouge">-i</code> é€‰é¡¹ï¼Œä¸º <code class="language-plaintext highlighter-rouge">Interactive Shell</code>ã€‚</li>
</ol>

<p><strong>æ„Ÿæ€§è®¤è¯†ï¼š</strong>ä½ æ•²å‘½ä»¤ï¼Œshellç»™ä½ å›æ˜¾ç»“æœï¼Œåƒè¿™æ ·ä¸äººäº¤äº’çš„shellå°±æ˜¯ <code class="language-plaintext highlighter-rouge">Interactive Shell</code>ã€‚</p>

<h3 id="åˆ¤å®š">åˆ¤å®š <a href="#åˆ¤å®š" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3>

<p><code class="language-plaintext highlighter-rouge">man</code> è¯´æ˜å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>PS1 is set and $- includes i if bash is interactive, allowing a shell script or a 
startup file to test this state.
</pre></td></tr></tbody></table></code></div></div>

<p>ä»¥ä¸‹æ¡ä»¶æ»¡è¶³ä»»æ„ä¸€æ¡ï¼Œå³ä¸º <code class="language-plaintext highlighter-rouge">Interactive Shell</code>ï¼š</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">$PS1</code> ä¸ä¸ºç©ºã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">$-</code> ä¸­åŒ…å«å­—æ¯ <code class="language-plaintext highlighter-rouge">i</code>ã€‚</li>
</ul>

<p>æ¯”å¦‚ï¼š</p>

<p>ssh è¿œç¨‹ç™»å½•åï¼Œå…¶ shell æ˜¯ <code class="language-plaintext highlighter-rouge">Interactive Shell</code>ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>orangepi@opidebz3server:~$ echo $PS1
\[\e]0;\u@\h: \w\a\]${debian_chroot:+($debian_chroot)}\[\033[01;32m\]\u@\h\[\033[00m\]:\[\033[01;34m\]\w\[\033[00m\]\$

orangepi@opidebz3server:~$ echo $-
himBHs
</pre></td></tr></tbody></table></code></div></div>

<p>æ‘˜è‡ª <code class="language-plaintext highlighter-rouge">/etc/bash.bashrc</code> å’Œ <code class="language-plaintext highlighter-rouge">~/.bashrc</code> ä¸­çš„åˆ¤å®šå†™æ³•ï¼š</p>

<div class="language-sh highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="c"># /etc/bash.bashrc</span>
<span class="c"># If not running interactively, don't do anything</span>
<span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="nv">$PS1</span><span class="s2">"</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="k">return</span>

<span class="c"># ~/.bashrc</span>
<span class="c"># If not running interactively, don't do anything</span>
<span class="k">case</span> <span class="nv">$-</span> <span class="k">in</span>
    <span class="k">*</span>i<span class="k">*</span><span class="p">)</span> <span class="p">;;</span>
      <span class="k">*</span><span class="p">)</span> <span class="k">return</span><span class="p">;;</span>
<span class="k">esac</span>
</pre></td></tr></tbody></table></code></div></div>

<h2 id="login-shell">Login Shell <a href="#login-shell" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2>

<h3 id="å®šä¹‰-1">å®šä¹‰ <a href="#å®šä¹‰-1" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3>

<p><code class="language-plaintext highlighter-rouge">man</code> è¯´æ˜å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>A login shell is one whose first character of argument zero is a -, or one started with 
the --login option.
</pre></td></tr></tbody></table></code></div></div>

<p>ä»¥ä¸‹æ¡ä»¶æ»¡è¶³ä»»æ„ä¸€æ¡ï¼Œå³ä¸º <code class="language-plaintext highlighter-rouge">Login Shell</code>ï¼š</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">$0</code> çš„é¦–å­—ç¬¦æ˜¯ <code class="language-plaintext highlighter-rouge">-</code>ã€‚</li>
  <li>å¯åŠ¨æ—¶ï¼ŒæŒ‡å®šäº† <code class="language-plaintext highlighter-rouge">--login(-l)</code> é€‰é¡¹ã€‚</li>
</ul>

<p><strong>æ„Ÿæ€§è®¤è¯†ï¼š</strong>è¾“å…¥å¯†ç ç™»å½•åå¯åŠ¨çš„shellå°±æ˜¯ <code class="language-plaintext highlighter-rouge">Login Shell</code>ã€‚</p>

<h3 id="åˆ¤å®š-1">åˆ¤å®š <a href="#åˆ¤å®š-1" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3>

<p>åˆ¤å®šæ–¹æ³•ä¸å®šä¹‰ç›¸åŒã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå®æµ‹ä¸­å‘ç°ï¼ŒæŒ‡å®šäº† <code class="language-plaintext highlighter-rouge">--login(-l)</code> é€‰é¡¹çš„shellï¼Œå…¶ <code class="language-plaintext highlighter-rouge">$0</code> çš„é¦–å­—ç¬¦å¹¶ä¸æ˜¯ <code class="language-plaintext highlighter-rouge">-</code>ã€‚è¿™æ„å‘³ç€ä¸Šè¿°ä¸¤ä¸ªæ¡ä»¶åˆ†åˆ«æ˜¯ <code class="language-plaintext highlighter-rouge">Login Shell</code> çš„å……åˆ†ä¸å¿…è¦æ¡ä»¶ã€‚è‹¥æ˜¯ <code class="language-plaintext highlighter-rouge">Login Shell</code>ï¼Œ<code class="language-plaintext highlighter-rouge">$0</code> çš„é¦–å­—ç¬¦å¹¶ä¸æ€»æ˜¯ <code class="language-plaintext highlighter-rouge">-</code>ã€‚å¦å¤–ï¼Œå·²ç„¶ç™»å½•ç³»ç»Ÿåï¼Œåœ¨å°è¯• <code class="language-plaintext highlighter-rouge">bash -c "echo $0"</code> æ—¶ï¼Œè¾“å‡ºç«Ÿç„¶æ˜¯ <code class="language-plaintext highlighter-rouge">-bash</code>ï¼Œä½†è¿™æ˜¾ç„¶æ˜¯ä¸€ä¸ª <code class="language-plaintext highlighter-rouge">Non-Interactive Non-Login Shell</code>ã€‚ç»¼ä¸Šï¼Œä¾æ®å®šä¹‰æ¥åˆ¤å®š <code class="language-plaintext highlighter-rouge">Login Shell</code> å¹¶ä¸ååˆ†å¯é ã€‚</p>

<p>DeepSeekç»™å‡ºäº†ä¸€ä¸ªå·ç§°å¯é çš„æ£€æµ‹æ–¹æ³•ï¼š<code class="language-plaintext highlighter-rouge">shopt -q login_shell &amp;&amp; echo "1" || echo "0"</code>ï¼Œå®æµ‹ä¸­æš‚æœªå‘ç°é—®é¢˜ï¼Œä¹Ÿè®¸èƒ½å¤Ÿä½œä¸º <code class="language-plaintext highlighter-rouge">Login Shell</code> çš„å……è¦æ¡ä»¶ã€‚</p>

<p>æ¯”å¦‚ï¼š</p>

<p>sshè¿œç¨‹ç™»å½•åï¼Œå…¶shellæ˜¯ <code class="language-plaintext highlighter-rouge">Login Shell</code>ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>orangepi@opidebz3server:~$ echo $0
-bash

orangepi@opidebz3server:~$ shopt -q login_shell &amp;&amp; echo "1" || echo "0"
1
</pre></td></tr></tbody></table></code></div></div>

<p>å¯åŠ¨ä¸€ä¸ªæŒ‡å®šäº† <code class="language-plaintext highlighter-rouge">--login</code> å‚æ•°çš„subshellï¼ŒæŒ‰ç…§å®šä¹‰ï¼Œå…¶shellæ˜¯ <code class="language-plaintext highlighter-rouge">Login Shell</code>ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>orangepi@opidebz3server:~/Me/Misc$ bash --login

orangepi@opidebz3server:~/Me/Misc$ echo $0
bash

orangepi@opidebz3server:~$ shopt -q login_shell &amp;&amp; echo "1" || echo "0"
1
</pre></td></tr></tbody></table></code></div></div>

<p>ç™»å½•ç³»ç»Ÿåï¼Œä½¿ç”¨ <code class="language-plaintext highlighter-rouge">bash -c</code> æ‰§è¡Œå‘½ä»¤ï¼Œå…¶shellæ˜¯ <code class="language-plaintext highlighter-rouge">Non-Login Shell</code>ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>orangepi@opidebz3server:~$ bash -c "echo $0"
-bash

orangepi@opidebz3server:~$ bash -c 'shopt -q login_shell &amp;&amp; echo "1" || echo "0"'
0
</pre></td></tr></tbody></table></code></div></div>

<h2 id="shellç±»å‹ä¸¾ä¾‹">Shellç±»å‹ä¸¾ä¾‹ <a href="#shellç±»å‹ä¸¾ä¾‹" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2>

<p>ï¼ˆæœ‰äº›å‚æ•°ã€é…ç½®æ˜¯å¯ä»¥è°ƒçš„ï¼Œä»¥ä¸‹åªæ˜¯ä¸€èˆ¬æƒ…å†µã€‚ï¼‰</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">source ~/.bashrc</code> ç›¸å½“äºåœ¨å½“å‰shellä¸­ä¸€è¡Œè¡Œæ‰§è¡Œäº†æŒ‡å®šçš„æ–‡ä»¶ï¼Œæ ¹æœ¬ä¸ä¼šå¯åŠ¨æ–°shellã€‚</li>
  <li>å¯åŠ¨ä¸€ä¸ªæ²¡æœ‰GUIçš„ç³»ç»Ÿï¼Œåœ¨æ§åˆ¶å°ç™»å½•åè¿›å…¥çš„shellï¼Œæ˜¯ <code class="language-plaintext highlighter-rouge">Interactive Login Shell</code>ã€‚</li>
  <li>sshå‘½ä»¤è¡Œè¿œç¨‹ç™»å½•åå¯åŠ¨çš„shellæ˜¯ <code class="language-plaintext highlighter-rouge">Interactive Login Shell</code>ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">su - user</code> å¯åŠ¨çš„shellæ˜¯ <code class="language-plaintext highlighter-rouge">Interactive Login Shell</code>ã€‚</li>
  <li>åœ¨shellä¸­æ‰‹æ•²bashæ‰“å¼€çš„subshellæ˜¯ <code class="language-plaintext highlighter-rouge">Interactive Non-Login Shell</code>ã€‚</li>
  <li>åœ¨å…·å¤‡GUIçš„ç³»ç»Ÿä¸­ï¼Œç™»å½•åè¿›å…¥æ¡Œé¢ï¼Œæ‰‹åŠ¨æ‰“å¼€ç»ˆç«¯ï¼Œæ­¤æ—¶å¯åŠ¨çš„shellä¸€èˆ¬æ˜¯ <code class="language-plaintext highlighter-rouge">Interacive Non-Login Shell</code>ã€‚è¿™æ˜¯å› ä¸ºæ¡Œé¢è¿›ç¨‹æœ¬èº«å¯èƒ½åœ¨ä¸€ä¸ª <code class="language-plaintext highlighter-rouge">Login Shell</code> ä¸­å¯åŠ¨ï¼Œç™»å½•åè¿›å…¥æ¡Œé¢å†å¯åŠ¨çš„shellæ˜¯å…¶åä»£è¿›ç¨‹ï¼Œä¸€èˆ¬ä¸ä¼šå†æ˜¯ <code class="language-plaintext highlighter-rouge">Login Shell</code>ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">su user</code> å¯åŠ¨çš„shellæ˜¯ <code class="language-plaintext highlighter-rouge">Interacive Non-Login Shell</code>ã€‚</li>
  <li>ç™»å½•åï¼Œæ¡Œé¢è¿›ç¨‹å¯èƒ½æ˜¯åœ¨ä¸€ä¸ªç”±ç¨‹åºå¯åŠ¨çš„shellä¸­å¯åŠ¨ï¼Œæˆ‘æ¨æµ‹è¿™ä¸ªç”±ç¨‹åºå¯åŠ¨å¹¶ç™»å½•çš„shellæ˜¯ <code class="language-plaintext highlighter-rouge">Non-Interactive Login Shell</code>ã€‚</li>
  <li>åƒ <code class="language-plaintext highlighter-rouge">bash --login test.sh</code> è¿™æ ·å¯åŠ¨çš„shellï¼Œå®ƒä¸ä¸äººäº¤äº’ï¼ŒåˆæŒ‡å®šäº† <code class="language-plaintext highlighter-rouge">--login</code>ï¼Œæ˜¾ç„¶æ˜¯ <code class="language-plaintext highlighter-rouge">Non-Interactive Login Shell</code>ã€‚</li>
  <li>åƒ <code class="language-plaintext highlighter-rouge">bash test.sh</code> æˆ– <code class="language-plaintext highlighter-rouge">./test.sh</code> è¿™æ ·å¯åŠ¨çš„shellï¼Œå®ƒä¸ä¸äººäº¤äº’ï¼Œæ‰§è¡Œè„šæœ¬çš„æ—¶å€™æ˜¾ç„¶å·²ç»ç™»å½•äº†ç³»ç»Ÿï¼Œæ‰€ä»¥æ˜¯ <code class="language-plaintext highlighter-rouge">Non-Interactive Non-Login Shell</code>ã€‚</li>
  <li>æ— è®ºcrontabæ‰§è¡Œçš„æ˜¯ç³»ç»Ÿçº§è¿˜æ˜¯ç”¨æˆ·çº§å®šæ—¶ä»»åŠ¡ï¼Œå®ƒéƒ½ä¸éœ€è¦ç™»å½•ï¼Œå…¶æ‰§è¡Œshellè„šæœ¬æ—¶å¯åŠ¨çš„shelléƒ½æ˜¯ <code class="language-plaintext highlighter-rouge">Non-Interactive Non-Login Shell</code>ã€‚</li>
  <li>ç”±ç¨‹åºå†…éƒ¨å¯åŠ¨çš„shellï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šç‰¹æ®Šå‚æ•°ï¼Œå¤šæ•°æƒ…å†µä¸‹éƒ½æ˜¯ <code class="language-plaintext highlighter-rouge">Non-Interactive Non-Login Shell</code>ã€‚</li>
</ol>

<h2 id="å¯åŠ¨æ–‡ä»¶åŠ è½½åˆ†æ">å¯åŠ¨æ–‡ä»¶åŠ è½½åˆ†æ <a href="#å¯åŠ¨æ–‡ä»¶åŠ è½½åˆ†æ" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2>

<h3 id="åŠ è½½æµç¨‹">åŠ è½½æµç¨‹ <a href="#åŠ è½½æµç¨‹" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre># Interactive Login Shell
/etc/profile
  â””/etc/bash.bashrc
  â””/etc/profile.d/*.sh
~/.profile
  â””~/.bashrc
~/.bash_logout
/etc/bash.bash_logout

# Interactive Non-Login Shell
/etc/bash.bashrc
~/.bashrc

# Non-Interactive Login Shell
/etc/profile
  â””/etc/profile.d/*.sh
~/.profile
  â””~/.bashrc(do nothing and return)
~/.bash_logout
/etc/bash.bash_logout

# Non-Interactive Non-Login Shell
$BASH_ENV
</pre></td></tr></tbody></table></code></div></div>

<p><strong>-&gt;</strong> <code class="language-plaintext highlighter-rouge">â””</code> è¡¨ç¤ºè°ƒç”¨å…³ç³»ã€‚è¿™äº›è°ƒç”¨å…³ç³»å¹¶ä¸ç»å¯¹ï¼Œä¸åŒç¯å¢ƒå¯èƒ½ä¼šæœ‰ä¸åŒæƒ…å†µï¼Œåº”ä»¥å®é™…è„šæœ¬å†…å®¹ä¸ºå‡†ï¼Œä¸è¿‡é€šå¸¸æ˜¯ä¸Šè¿°æƒ…å†µã€‚</p>

<p><strong>-&gt;</strong> åœ¨æœ‰äº›Linuxä¸­ï¼ˆéDebianï¼‰ï¼Œ<code class="language-plaintext highlighter-rouge">/etc/bash.bashrc</code> å¯èƒ½å«åš <code class="language-plaintext highlighter-rouge">/etc/bashrc</code>ï¼Œ<code class="language-plaintext highlighter-rouge">/etc/bash.bash_logout</code> å¯èƒ½å«åš <code class="language-plaintext highlighter-rouge">/etc/bash_logout</code>ã€‚</p>

<p><strong>-&gt;</strong> ç¬”è€…æ²¡æœ‰åœ¨å®éªŒç¯å¢ƒä¸­æ–°å»º <code class="language-plaintext highlighter-rouge">~/.bash_profile</code>ã€<code class="language-plaintext highlighter-rouge">~/.bash_login</code> æ–‡ä»¶ï¼Œåªæœ‰é»˜è®¤å­˜åœ¨çš„ <code class="language-plaintext highlighter-rouge">~/.profile</code> æ–‡ä»¶ã€‚è‹¥ä¸Šè¿°æ–‡ä»¶å­˜åœ¨ï¼Œåº”è¯¥ä¼šæŒ‰ç…§ <code class="language-plaintext highlighter-rouge">~/.bash_profile &gt; ~/.bash_login &gt; ~/.profile</code> çš„ä¼˜å…ˆçº§é¡ºåºä»…åŠ è½½å­˜åœ¨ä¸”å¯è¯»çš„ç¬¬ä¸€ä¸ªæ–‡ä»¶ã€‚è¿™ä¸‰ä¸ªæ–‡ä»¶é€šå¸¸éƒ½ä¼š <code class="language-plaintext highlighter-rouge">. "$HOME/.bashrc"</code>ã€‚</p>

<p><strong>-&gt;</strong> <code class="language-plaintext highlighter-rouge">Interactive Login Shell</code> é€€å‡ºï¼ˆæ¯”å¦‚ <code class="language-plaintext highlighter-rouge">Ctrl+D</code>ï¼‰æˆ– <code class="language-plaintext highlighter-rouge">Non-Interactive Login Shell</code> æ‰§è¡Œ <code class="language-plaintext highlighter-rouge">exit</code> å‘½ä»¤æ—¶ï¼Œbashæ‰ä¼šåŠ è½½ <code class="language-plaintext highlighter-rouge">logout</code> æ–‡ä»¶ï¼Œç›´æ¥å…³é—­bashåˆ™ä¸ä¼šåŠ è½½ä¹‹ã€‚</p>

<p><strong>-&gt;</strong> <code class="language-plaintext highlighter-rouge">/etc/profile</code> æ‘˜å½•å¦‚ä¸‹ï¼š</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="k">${</span><span class="nv">PS1</span><span class="p">-</span><span class="k">}</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
  if</span> <span class="o">[</span> <span class="s2">"</span><span class="k">${</span><span class="nv">BASH</span><span class="p">-</span><span class="k">}</span><span class="s2">"</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$BASH</span><span class="s2">"</span> <span class="o">!=</span> <span class="s2">"/bin/sh"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="c"># The file bash.bashrc already sets the default PS1.</span>
    <span class="c"># PS1='\h:\w\$ '</span>
    <span class="k">if</span> <span class="o">[</span> <span class="nt">-f</span> /etc/bash.bashrc <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
      <span class="nb">.</span> /etc/bash.bashrc
    <span class="k">fi
  else
    if</span> <span class="o">[</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">id</span> <span class="nt">-u</span><span class="si">)</span><span class="s2">"</span> <span class="nt">-eq</span> 0 <span class="o">]</span><span class="p">;</span> <span class="k">then
      </span><span class="nv">PS1</span><span class="o">=</span><span class="s1">'# '</span>
    <span class="k">else
      </span><span class="nv">PS1</span><span class="o">=</span><span class="s1">'$ '</span>
    <span class="k">fi
  fi
fi</span>
</pre></td></tr></tbody></table></code></div></div>

<p><code class="language-plaintext highlighter-rouge">if [ "${PS1-}" ]</code> æ˜¯åœ¨åˆ¤æ–­æ˜¯å¦æ˜¯ <code class="language-plaintext highlighter-rouge">Interactive Shell</code>ï¼Œæ‰€ä»¥ <code class="language-plaintext highlighter-rouge">Non-Interactive Login Shell</code> ä¸ä¼šåŠ è½½ <code class="language-plaintext highlighter-rouge">/etc/bash.bashrc</code>ã€‚</p>

<p><strong>-&gt;</strong> <code class="language-plaintext highlighter-rouge">~/.profile</code> æ‘˜å½•å¦‚ä¸‹ï¼š</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="c"># if running bash</span>
<span class="k">if</span> <span class="o">[</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$BASH_VERSION</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="c"># include .bashrc if it exists</span>
    <span class="k">if</span> <span class="o">[</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/.bashrc"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
        <span class="nb">.</span> <span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/.bashrc"</span>
    <span class="k">fi
fi</span>
</pre></td></tr></tbody></table></code></div></div>

<p><code class="language-plaintext highlighter-rouge">~/.bashrc</code> æ‘˜å½•å¦‚ä¸‹ï¼š</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="c"># If not running interactively, don't do anything</span>
<span class="k">case</span> <span class="nv">$-</span> <span class="k">in</span>
    <span class="k">*</span>i<span class="k">*</span><span class="p">)</span> <span class="p">;;</span>
    <span class="k">*</span><span class="p">)</span> <span class="k">return</span><span class="p">;;</span>
<span class="k">esac</span>
</pre></td></tr></tbody></table></code></div></div>

<p><code class="language-plaintext highlighter-rouge">~/.profile</code> ä¸­åŠ è½½äº† <code class="language-plaintext highlighter-rouge">~/.bashrc</code>ï¼Œä½†è‹¥ä¸æ˜¯ <code class="language-plaintext highlighter-rouge">Interactive Shell</code>ï¼Œ<code class="language-plaintext highlighter-rouge">~/.bashrc</code> å°†ç›´æ¥è¿”å›ï¼Œæ‰€ä»¥ <code class="language-plaintext highlighter-rouge">Non-Interactive Login Shell</code> è™½ç„¶è¯»äº† <code class="language-plaintext highlighter-rouge">~/.bashrc</code> æ–‡ä»¶ï¼Œä½†å…¶å®ç›¸å½“äºæ²¡æœ‰åŠ è½½å®ƒã€‚</p>

<p><strong>-&gt;</strong> ç¯å¢ƒå˜é‡ <code class="language-plaintext highlighter-rouge">BASH_ENV</code> çš„å€¼æ˜¯ä¸€ä¸ªæ–‡ä»¶åï¼Œ<code class="language-plaintext highlighter-rouge">Non-Interactive Non-Login Shell</code> ä¼šåŠ è½½è¿™ä¸ªæ–‡ä»¶ã€‚</p>

<p><br /></p>

<p>æˆ‘ä»¬å¯ä»¥ç®€å•è®°å¿†ï¼šå¦‚æœæ˜¯ <code class="language-plaintext highlighter-rouge">Login Shell</code>ï¼Œåˆ™ä¼šåŠ è½½ <code class="language-plaintext highlighter-rouge">/etc/profile</code>ã€<code class="language-plaintext highlighter-rouge">first of ~/.bash_profile &gt; ~/.bash_login &gt; ~/.profile</code>ï¼›å¦‚æœæ˜¯ <code class="language-plaintext highlighter-rouge">Interactive Shell</code>ï¼Œåˆ™ä¼šåŠ è½½ <code class="language-plaintext highlighter-rouge">/etc/bash.bashrc</code>ã€<code class="language-plaintext highlighter-rouge">~/.bashrc</code>ã€‚</p>

<p>è¯¦ç»†æ–‡æ¡£å¯å‚è€ƒ<a href="https://www.gnu.org/software/bash/manual/bash.html#Bash-Startup-Files-1">Bash Reference Manual - 6.2 Bash Startup Files</a>ã€‚</p>

<hr />

<p>å¦é™„ä¸€å¼ å›½å¤–å¤§ä½¬æ•´ç†çš„å›¾ç‰‡ï¼š</p>

<p><a href="https://www.solipsys.co.uk/new/BashInitialisationFiles.html">Bash Initialisation Files</a></p>

<p><img data-src="https://img-host-lcatmiao.oss-cn-hangzhou.aliyuncs.com/202312202207010.png" alt="" data-proofer-ignore></p>

<h3 id="ç‰¹åˆ«åˆ†æä¸‹sudo">ç‰¹åˆ«åˆ†æä¸‹sudo <a href="#ç‰¹åˆ«åˆ†æä¸‹sudo" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3>

<p>ç¬”è€…åœ¨å„ä¸ªå¯åŠ¨æ–‡ä»¶å’Œæµ‹è¯•æ–‡ä»¶ä¸­éƒ½æ·»åŠ äº†ä¸€äº›æµ‹è¯•è¾“å‡ºï¼Œè¿™äº›è¾“å‡ºè¢«é‡å®šå‘åˆ°ä¸€ä¸ªç‰¹å®šæ–‡ä»¶ä¸­ä»¥ä¾¿æŸ¥çœ‹ã€‚æˆ‘ä»¬å°†åœ¨bashä¸­æ‰‹æ•²ä¸€äº›sudoå‘½ä»¤ï¼Œå¹¶ç»“åˆè®°å½•ä¸‹çš„æµ‹è¯•è¾“å‡ºå†…å®¹è¿›è¡Œåˆ†æã€‚</p>

<h4 id="æå‰å‡†å¤‡">æå‰å‡†å¤‡ <a href="#æå‰å‡†å¤‡" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>

<p>å¯åŠ¨æ–‡ä»¶çš„æµ‹è¯•è¾“å‡ºï¼šç•¥ã€‚</p>

<p><code class="language-plaintext highlighter-rouge">logout</code> æ–‡ä»¶ï¼šç•¥ã€‚</p>

<p>æ–°å»º <code class="language-plaintext highlighter-rouge">/root/.profile</code> æ–‡ä»¶ï¼ˆä¸€èˆ¬/rootä¸‹æ²¡æœ‰è¯¥æ–‡ä»¶ï¼‰ï¼Œå¹¶è°ƒç”¨ <code class="language-plaintext highlighter-rouge">/root/.bashrc</code>ï¼š</p>

<div class="language-shell highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/.profile"</span> <span class="o">&gt;&gt;</span> /home/orangepi/Me/Misc/load_cfg

<span class="c"># if running bash</span>
<span class="k">if</span> <span class="o">[</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$BASH_VERSION</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="c"># include .bashrc if it exists</span>
    <span class="k">if</span> <span class="o">[</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/.bashrc"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
        <span class="nb">.</span> <span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/.bashrc"</span>
    <span class="k">fi
fi</span>
</pre></td></tr></tbody></table></code></div></div>

<p>è®¾ç½® <code class="language-plaintext highlighter-rouge">BASH_ENV</code> ç¯å¢ƒå˜é‡ï¼š</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="c"># ç›´æ¥åœ¨bashé‡Œæ‰‹æ•²</span>
<span class="nb">export </span><span class="nv">BASH_ENV</span><span class="o">=</span>/home/orangepi/Me/Misc/test1.sh
</pre></td></tr></tbody></table></code></div></div>

<p><code class="language-plaintext highlighter-rouge">test1.sh</code> å†…å®¹ï¼š</p>

<div class="language-shell highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="c">#!/bin/bash</span>

<span class="nb">echo</span> <span class="s1">'test1.sh'</span> <span class="o">&gt;&gt;</span> /home/orangepi/Me/Misc/load_cfg
<span class="nb">echo</span> <span class="s1">'$BASH_ENV'</span> <span class="o">&gt;&gt;</span> /home/orangepi/Me/Misc/load_cfg
</pre></td></tr></tbody></table></code></div></div>

<p><code class="language-plaintext highlighter-rouge">test.sh</code> å†…å®¹ï¼š</p>

<div class="language-shell highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="c">#!/bin/bash</span>

<span class="nb">echo</span> <span class="s2">"test.sh"</span> <span class="o">&gt;&gt;</span> /home/orangepi/Me/Misc/load_cfg
<span class="nb">echo</span> <span class="s2">"</span><span class="se">\$</span><span class="s2">BASH_ENV: </span><span class="nv">$BASH_ENV</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> /home/orangepi/Me/Misc/load_cfg
pstree <span class="o">&gt;&gt;</span> /home/orangepi/Me/Misc/load_cfg
<span class="nb">echo</span> <span class="s2">""</span> <span class="o">&gt;&gt;</span> /home/orangepi/Me/Misc/load_cfg
<span class="nb">echo</span> <span class="s2">"123"</span> <span class="o">&gt;</span> /dev/null
<span class="nb">exit</span>
</pre></td></tr></tbody></table></code></div></div>

<h4 id="åˆ†æsudo">åˆ†æsudo <a href="#åˆ†æsudo" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>

<p><strong>&gt; sudo pwd</strong></p>

<p>æ²¡æœ‰æµ‹è¯•è¾“å‡ºå†…å®¹ã€‚</p>

<p>å¯åŠ¨ <code class="language-plaintext highlighter-rouge">sudo</code> è¿›ç¨‹ï¼Œå†å¯åŠ¨ <code class="language-plaintext highlighter-rouge">pwd</code> å­è¿›ç¨‹ã€‚<code class="language-plaintext highlighter-rouge">pwd</code> æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶å¯æ‰§è¡Œç¨‹åºï¼Œä¸æ˜¯shellè„šæœ¬ã€‚æ²¡æœ‰shellè¢«å¯åŠ¨ï¼Œæ‰€ä»¥æ²¡æœ‰æµ‹è¯•è¾“å‡ºå†…å®¹ã€‚</p>

<p><strong>&gt; sudo ./test.sh</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>test.sh
$BASH_ENV: 
...
</pre></td></tr></tbody></table></code></div></div>

<p>å¯åŠ¨ <code class="language-plaintext highlighter-rouge">sudo</code> è¿›ç¨‹ï¼Œå‘ç°è¦æ‰§è¡Œä¸€ä¸ªshellè„šæœ¬ï¼Œäºæ˜¯æ ¹æ® <code class="language-plaintext highlighter-rouge">shebang</code> å¯åŠ¨äº†ä¸€ä¸ª <code class="language-plaintext highlighter-rouge">bash</code> å­è¿›ç¨‹ï¼Œè‡ªç„¶æ˜¯ <code class="language-plaintext highlighter-rouge">Non-Interactive Non-Login Shell</code>ï¼Œäºæ˜¯åº”è¯¥è¦å…ˆåŠ è½½ç¯å¢ƒå˜é‡ <code class="language-plaintext highlighter-rouge">BASH_ENV</code> æŒ‡å®šçš„æ–‡ä»¶ <code class="language-plaintext highlighter-rouge">test1.sh</code>ï¼Œç„¶è€Œè¾“å‡ºç»“æœæ˜¯â€œå¹¶æ²¡æœ‰â€ä¸”èƒ½æ³¨æ„åˆ° <code class="language-plaintext highlighter-rouge">BASH_ENV</code> çš„å€¼æ˜¯ç©ºçš„ï¼Œè¿™æ˜¯å› ä¸º <code class="language-plaintext highlighter-rouge">sudo</code> åœ¨é»˜è®¤é…ç½®ä¸‹ä¼šé‡ç½®å¹¶ä¿æŒä¸€ä¸ªç‰¹å®šçš„ç¯å¢ƒï¼Œä½¿ç”¨ <code class="language-plaintext highlighter-rouge">sudo env</code> å¯ä»¥æŸ¥çœ‹ä¹‹ã€‚<code class="language-plaintext highlighter-rouge">bash</code> å¯åŠ¨æ—¶å‘ç°æ²¡æœ‰ <code class="language-plaintext highlighter-rouge">BASH_ENV</code>ï¼Œè‡ªç„¶å°±ä¸ä¼šåŠ è½½å…¶æŒ‡å®šçš„æ–‡ä»¶ã€‚</p>

<p><strong>&gt; sudo â€“preserve-env=BASH_ENV pwd</strong></p>

<p>æ²¡æœ‰æµ‹è¯•è¾“å‡ºå†…å®¹ã€‚</p>

<p><code class="language-plaintext highlighter-rouge">--preserve-env=BASH_ENV</code> ä½¿ç¯å¢ƒå˜é‡ <code class="language-plaintext highlighter-rouge">BASH_ENV</code> ä¿ç•™äº†ä¸‹æ¥ï¼Œä½† <code class="language-plaintext highlighter-rouge">pwd</code> ä¸æ˜¯shellè„šæœ¬ï¼Œæ²¡æœ‰shellè¢«å¯åŠ¨ï¼Œæ‰€ä»¥æ²¡æœ‰æµ‹è¯•è¾“å‡ºå†…å®¹ã€‚</p>

<p><strong>&gt; sudo â€“preserve-env=BASH_ENV ./test.sh</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>test1.sh
$BASH_ENV
test.sh
$BASH_ENV: /home/orangepi/Me/Misc/test1.sh
...
</pre></td></tr></tbody></table></code></div></div>

<p><code class="language-plaintext highlighter-rouge">--preserve-env=BASH_ENV</code> ä½¿ç¯å¢ƒå˜é‡ <code class="language-plaintext highlighter-rouge">BASH_ENV</code> ä¿ç•™äº†ä¸‹æ¥ï¼Œæ‰§è¡Œ <code class="language-plaintext highlighter-rouge">test.sh</code> æ—¶å¯åŠ¨äº†ä¸€ä¸ª <code class="language-plaintext highlighter-rouge">Non-Interactive Non-Login Shell</code>ï¼Œæ‰€ä»¥ <code class="language-plaintext highlighter-rouge">BASH_ENV</code> æŒ‡å®šçš„æ–‡ä»¶ <code class="language-plaintext highlighter-rouge">test1.sh</code> è¢«åŠ è½½äº†ã€‚</p>

<p><strong>&gt; sudo -i</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>/etc/profile
/etc/bash.bashrc
/etc/profile.d/*.sh
/root/.profile
/root/.bashrc
</pre></td></tr></tbody></table></code></div></div>

<p>å¯åŠ¨ <code class="language-plaintext highlighter-rouge">sudo</code> è¿›ç¨‹åè¿˜ä¼šå¯åŠ¨ä¸€ä¸ªshellå­è¿›ç¨‹ã€‚<code class="language-plaintext highlighter-rouge">-i</code> è¡¨æ˜ä¼šå¯åŠ¨ä¸€ä¸ª <code class="language-plaintext highlighter-rouge">Login Shell</code>ï¼Œåˆå› ä¸ºæ²¡æœ‰æŒ‡å®šè¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œå¯åŠ¨çš„shellå°†æ˜¯ä¸€ä¸ª <code class="language-plaintext highlighter-rouge">Interactive Shell</code>ï¼Œå³å¯åŠ¨çš„shellå­è¿›ç¨‹æ˜¯ä¸€ä¸ª <code class="language-plaintext highlighter-rouge">Interactive Login Shell</code>ã€‚æµ‹è¯•è¾“å‡ºç¬¦åˆé¢„æœŸã€‚è‹¥æ˜¯æ‰‹åŠ¨ <code class="language-plaintext highlighter-rouge">Ctrl+D</code> é€€å‡ºshellï¼Œåœ¨æ–‡ä»¶å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œè¿˜ä¼šä¾æ¬¡åŠ è½½ <code class="language-plaintext highlighter-rouge">/root/.bash_logout</code>ã€<code class="language-plaintext highlighter-rouge">/etc/bash.bash_logout</code>ã€‚</p>

<p><strong>&gt; sudo -i â€“preserve-env=BASH_ENV pwd</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>/etc/profile
/etc/profile.d/*.sh
/root/.profile
/root/.bashrc(do nothing and return)
test1.sh
$BASH_ENV
</pre></td></tr></tbody></table></code></div></div>

<p><strong>å±…ç„¶åŠ è½½äº†BASH_ENVï¼Œä»¤äººæ„å¤–çš„ç»“æœã€‚</strong></p>

<p>é¦–å…ˆå¯åŠ¨ <code class="language-plaintext highlighter-rouge">sudo</code> è¿›ç¨‹ã€‚å…¶æ¬¡ï¼Œç”±äº <code class="language-plaintext highlighter-rouge">-i</code> ä¸”æŒ‡å®šäº†è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œæ‰€ä»¥å¯åŠ¨ä¸€ä¸ª <code class="language-plaintext highlighter-rouge">Non-Interactive Login Shell</code>ã€‚æ¥ä¸‹æ¥å°±ä»¤äººæ„å¤–äº†ï¼Œæ ¹æ® <code class="language-plaintext highlighter-rouge">man sudo</code> çš„è¯´æ³•ï¼Œ<strong>æˆ‘çŒœ</strong>åº”è¯¥æ˜¯ç›¸å½“äºæ‰§è¡Œäº† <code class="language-plaintext highlighter-rouge">bash -c 'command'</code>ï¼Œå³å¯åŠ¨äº†ä¸€ä¸ª <code class="language-plaintext highlighter-rouge">Non-Interactive Non-Login Shell</code> å»æ‰§è¡Œäº† <code class="language-plaintext highlighter-rouge">pwd</code>ã€‚</p>

<p><code class="language-plaintext highlighter-rouge">man sudo</code>ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>-i, --login
...
If a command is specified, it is passed to the shell as a simple command 
using the -c option.
...
</pre></td></tr></tbody></table></code></div></div>

<p>ç”±äºä¿ç•™äº† <code class="language-plaintext highlighter-rouge">BASH_ENV</code>ï¼Œæ‰€ä»¥ <code class="language-plaintext highlighter-rouge">test1.sh</code> è¢«åŠ è½½ã€‚</p>

<p>å‘½ä»¤æ‰§è¡Œå®Œæ¯•åï¼Œ<code class="language-plaintext highlighter-rouge">logout</code> æ–‡ä»¶ä¸ä¼šè¢«åŠ è½½ï¼Œåº”è¯¥æ˜¯å…¶å†…éƒ¨æ²¡æœ‰æ­£å¸¸ <code class="language-plaintext highlighter-rouge">exit</code> <code class="language-plaintext highlighter-rouge">Login Shell</code>ã€‚</p>

<p><strong>&gt; sudo -i â€“preserve-env=BASH_ENV /home/orangepi/Me/Misc/test.sh</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre>/etc/profile
/etc/profile.d/*.sh
/root/.profile
/root/.bashrc(do nothing and return)
test1.sh
$BASH_ENV
test1.sh
$BASH_ENV
test.sh
$BASH_ENV: /home/orangepi/Me/Misc/test1.sh
...
</pre></td></tr></tbody></table></code></div></div>

<blockquote>
  <p>è¿™é‡Œ <code class="language-plaintext highlighter-rouge">test.sh</code> ä½¿ç”¨ç»å¯¹è·¯å¾„æ˜¯å› ä¸º <code class="language-plaintext highlighter-rouge">sudo -i</code> ä¼šå°†å½“å‰è·¯å¾„è°ƒæ•´ä¸º <code class="language-plaintext highlighter-rouge">/root</code>ã€‚</p>
</blockquote>

<p>é¦–å…ˆå¯åŠ¨ <code class="language-plaintext highlighter-rouge">sudo</code> è¿›ç¨‹ï¼Œç„¶åå¯åŠ¨ä¸€ä¸ª <code class="language-plaintext highlighter-rouge">Non-Interactive Login Shell</code>ï¼Œæ¥ç€å¯åŠ¨ä¸€ä¸ª <code class="language-plaintext highlighter-rouge">Non-Interactive Non-Login Shell(bash -c 'command')</code>ï¼ŒåŠ è½½äº† <code class="language-plaintext highlighter-rouge">BASH_ENV</code>ï¼Œæœ€åæ ¹æ® <code class="language-plaintext highlighter-rouge">shebang</code> æ‰§è¡Œ <code class="language-plaintext highlighter-rouge">test.sh</code>ï¼Œäºæ˜¯åˆå¯åŠ¨äº†ä¸€ä¸ª <code class="language-plaintext highlighter-rouge">Non-Interactive Non-Login Shell</code>ï¼Œå†æ¬¡åŠ è½½äº† <code class="language-plaintext highlighter-rouge">BASH_ENV</code>ï¼Œæœ€ç»ˆå¾—åˆ°ä¸Šè¿°æµ‹è¯•è¾“å‡ºå†…å®¹ã€‚</p>

<p><strong>&gt; sudo su</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>/etc/bash.bashrc
/root/.bashrc
</pre></td></tr></tbody></table></code></div></div>

<p>å®¹æ˜“ç†è§£çš„ç»“æœã€‚å¯åŠ¨ <code class="language-plaintext highlighter-rouge">sudo</code> è¿›ç¨‹åå†å¯åŠ¨ <code class="language-plaintext highlighter-rouge">su</code> è¿›ç¨‹ï¼Œæ­¤å¤„æœªæŒ‡å®šç”¨æˆ·å°±é»˜è®¤ä¸ºæ˜¯ <code class="language-plaintext highlighter-rouge">su root</code>ï¼Œç„¶åå¯åŠ¨äº†ä¸€ä¸ª <code class="language-plaintext highlighter-rouge">Interactive Non-Login Shell</code>ï¼Œäºæ˜¯å¾—åˆ°ä¸Šè¿°æµ‹è¯•è¾“å‡ºå†…å®¹ã€‚</p>

<p><strong>&gt; sudo -i â€“preserve-env=BASH_ENV su -</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre>/etc/profile
/etc/profile.d/*.sh
/root/.profile
/root/.bashrc(do nothing and return)
test1.sh
$BASH_ENV
/etc/profile
/etc/bash.bashrc
/etc/profile.d/*.sh
/root/.profile
/root/.bashrc
</pre></td></tr></tbody></table></code></div></div>

<p><strong>ç¬”è€…æ•…æ„å †å buffï¼Œé€ å‡ºäº†è¿™ä¸ªé€†å¤©å‘½ä»¤</strong>ï¼Œå…¶æµ‹è¯•è¾“å‡ºå†…å®¹ä¹Ÿç¬¦åˆé¢„æœŸã€‚</p>

<ol>
  <li>å¯åŠ¨ <code class="language-plaintext highlighter-rouge">sudo</code> è¿›ç¨‹ã€‚</li>
  <li>å› ä¸ºæŒ‡å®šäº†è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œåˆå› ä¸º <code class="language-plaintext highlighter-rouge">-i</code>ï¼Œæ‰€ä»¥å¯åŠ¨äº†ä¸€ä¸ª <code class="language-plaintext highlighter-rouge">Non-Interactive Login Shell</code>ã€‚</li>
  <li>ä»¥ <code class="language-plaintext highlighter-rouge">bash -c 'su -'</code> çš„å½¢å¼æ‰§è¡Œå‘½ä»¤ï¼Œå°†å¯åŠ¨ä¸€ä¸ª <code class="language-plaintext highlighter-rouge">Non-Interactive Non-Login Shell</code>ï¼Œåˆå› ä¸ºä¿ç•™äº† <code class="language-plaintext highlighter-rouge">BASH_ENV</code>ï¼Œæ‰€ä»¥å°†åŠ è½½ <code class="language-plaintext highlighter-rouge">test1.sh</code>ã€‚</li>
  <li>å¯åŠ¨ <code class="language-plaintext highlighter-rouge">su</code> è¿›ç¨‹ã€‚</li>
  <li>å› ä¸º <code class="language-plaintext highlighter-rouge">-</code>ï¼Œå°†å¯åŠ¨ä¸€ä¸ª <code class="language-plaintext highlighter-rouge">Interacitve Login Shell</code>ã€‚</li>
  <li>è‹¥æ‰‹åŠ¨ <code class="language-plaintext highlighter-rouge">Ctrl+D</code> é€€å‡ºshellï¼Œåœ¨æ–‡ä»¶å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œè¿˜ä¼šåŠ è½½ç›¸åº”çš„ <code class="language-plaintext highlighter-rouge">logout</code> æ–‡ä»¶ã€‚</li>
</ol>

<p><strong>&gt; å…³äºpstreeçš„è¾“å‡º</strong></p>

<p><code class="language-plaintext highlighter-rouge">pstree</code> çš„è¾“å‡ºä¸æˆ‘ä»¬çš„ç†è§£å­˜åœ¨å‡ºå…¥ï¼Œæœ‰äº›shellå­è¿›ç¨‹å¹¶æ²¡æœ‰è¢«æ˜¾ç¤ºå‡ºæ¥ã€‚</p>

<p><code class="language-plaintext highlighter-rouge">sudo -i --preserve-env=BASH_ENV /home/orangepi/Me/Misc/test.sh</code> çš„ <code class="language-plaintext highlighter-rouge">pstree</code> è¾“å‡ºï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>systemd-+-NetworkManager---2*[{NetworkManager}]
...
        |-sshd---sshd---sshd---bash---sudo---sudo---test.sh---pstree
...
</pre></td></tr></tbody></table></code></div></div>

<p>DeepSeekçš„è§£é‡Šæ˜¯è¿›ç¨‹æ›¿æ¢ï¼ˆexecveï¼‰æœºåˆ¶å¯¼è‡´äº†è¿™ä¸€ç°è±¡ï¼Œå¹¶è‚¯å®šäº†ç¬”è€…ä¸Šé¢çš„ç†è§£ã€‚é‡ç‚¹æ˜¯DeepSeekè‚¯å®šäº†ç¬”è€…çš„ç†è§£ï¼Œé‚£åº”è¯¥é—®é¢˜ä¸å¤§ğŸ¤ªï¼Œè‡³äºä»€ä¹ˆforkã€è¿›ç¨‹æ›¿æ¢äº‘äº‘ï¼Œä¸æ‡‚ï¼Œä¸ç®¡äº†ğŸ¥±ã€‚</p>

<h1 id="å…¶å®ƒç¯å¢ƒé…ç½®åŠ è½½åˆ†æ">å…¶å®ƒç¯å¢ƒé…ç½®åŠ è½½åˆ†æ</h1>

<h2 id="etcenvironment">/etc/environment <a href="#etcenvironment" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2>

<p>è¯¥æ–‡ä»¶æ˜¯ä¸€ä¸ªç³»ç»Ÿçº§çš„é…ç½®æ–‡ä»¶ï¼Œä¸»è¦ç”±PAMè®¤è¯æ¨¡å—åŠ è½½ã€‚</p>

<p>å®è·µä¸­ï¼Œè¯¥æ–‡ä»¶<strong>å¾ˆå°‘è¢«ä½¿ç”¨</strong>ï¼Œå…¶å¯¹åº”çš„ç”¨æˆ·çº§é…ç½®æ–‡ä»¶ <code class="language-plaintext highlighter-rouge">~/.pam_environment</code> <strong>åŸºæœ¬å·²è¢«å¼ƒç”¨</strong>ã€‚</p>

<p>è¯¥æ–‡ä»¶åªæ”¯æŒç®€å•çš„é”®å€¼å¯¹å†…å®¹ï¼Œå¹¶éshellè„šæœ¬ï¼Œ<code class="language-plaintext highlighter-rouge">~/.pam_environment</code> ä¹Ÿå·®ä¸å¤šå¦‚æ­¤ã€‚</p>

<p>å…³äºè¯¥æ–‡ä»¶çš„åŠ è½½æ—¶æœºï¼Œç¬”è€…è®©DeepSeekç”»äº†ä¸€å¼ å›¾ï¼Œä¸€ç›®äº†ç„¶ã€‚æœ€åˆçš„ <code class="language-plaintext highlighter-rouge">systemd</code> å°±ä¼šåŠ è½½å®ƒï¼Œè€Œåç”± <code class="language-plaintext highlighter-rouge">systemd</code> å¯åŠ¨çš„åç»­è¿›ç¨‹å°†ç»§æ‰¿ç¯å¢ƒæˆ–è€…é€šè¿‡PAMè®¤è¯æ¨¡å—å†æ¬¡åŠ è½½å®ƒï¼Œæ•…ç†è®ºä¸Šï¼Œ<strong>æ‰€æœ‰è¿›ç¨‹éƒ½èƒ½åƒåˆ°è¯¥æ–‡ä»¶ç¯å¢ƒ</strong>ã€‚</p>

<p><img data-src="https://img-host-lcatmiao.oss-cn-hangzhou.aliyuncs.com/202511271710479.png" alt="deepseek_mermaid_20251127_a3c020" data-proofer-ignore></p>

<blockquote>
  <p>é€šè¿‡è¿™å¼ å›¾è¿˜æƒ³è¯´æ˜å¦ä¸€ä»¶äº‹ï¼šæœ¬æ–‡ä¸Šé¢å¤§ç¯‡å¹…è®¨è®ºçš„è¯¸å¦‚ <code class="language-plaintext highlighter-rouge">/etc/profile</code>ã€<code class="language-plaintext highlighter-rouge">~/.profile</code> ç­‰æ–‡ä»¶åªæ˜¯ <code class="language-plaintext highlighter-rouge">shell</code> çš„é…ç½®æ–‡ä»¶ï¼Œå…¶å®ƒè¿›ç¨‹æ˜¯ä¸ä¼šåŠ è½½å®ƒä»¬çš„ï¼Œé™¤éå…¶è¿›ç¨‹å†…éƒ¨ä¸»åŠ¨å¯åŠ¨äº†ä¸€ä¸ªshellæˆ–è€…æœ‰å…¶å®ƒæœªçŸ¥çš„ç‰¹æ®Šæƒ…å†µã€‚æ¯”å¦‚ï¼Œ<code class="language-plaintext highlighter-rouge">crontab</code> ä¸æ˜¯shellï¼Œå…¶æœ¬èº«åƒä¸åˆ°shellé…ç½®æ–‡ä»¶ç¯å¢ƒï¼Œè‹¥å…¶æ‰§è¡Œshellè„šæœ¬ï¼Œåˆ™å¯åŠ¨çš„shellå°†ç»§æ‰¿å…¶ç¯å¢ƒï¼Œè€Œè¯¥shellåˆæ˜¯ä¸€ä¸ª <code class="language-plaintext highlighter-rouge">Non-Interactive Non-Login Shell</code>ï¼Œå¯åŠ¨æ—¶ä¹Ÿä¸ä¼šåŠ è½½é…ç½®æ–‡ä»¶ï¼Œè¿™äº›éƒ½å°†ä½¿å¾—è¯¥shellåœ¨æ‰§è¡Œæ—¶å¤„äºä¸€ä¸ªååˆ†æœ‰é™çš„ç¯å¢ƒï¼Œè¿™æ„å‘³ç€åœ¨ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">crontab</code> å®šæ—¶æ‰§è¡Œshellè„šæœ¬æ—¶ï¼Œäºshellé…ç½®æ–‡ä»¶ä¸­è®¾ç½®çš„ç¯å¢ƒå˜é‡å°†ä¸å¯è§ï¼Œæ­¤æ—¶ä¸å¦¨æŠŠè¦ä½¿ç”¨çš„ç¯å¢ƒå˜é‡ç›´æ¥å†™æ­»åœ¨è„šæœ¬é‡Œã€‚</p>
</blockquote>

<h2 id="etcrcd">/etc/rc.d/ <a href="#etcrcd" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2>

<p><code class="language-plaintext highlighter-rouge">/etc/rc0.d/, /etc/rc1.d/, ...</code> ç³»åˆ—ç›®å½•å±äºSysVinitä½“ç³»çš„ç»„æˆéƒ¨åˆ†ï¼Œç›®å½•ä¸­æ˜¯è½¯é“¾æ¥ï¼Œé“¾æ¥æŒ‡å‘ <code class="language-plaintext highlighter-rouge">/etc/init.d/</code> ä¸‹çœŸæ­£çš„è„šæœ¬ã€‚SysVinitæ˜¯æ—§çš„åˆå§‹åŒ–ç³»ç»Ÿï¼Œç°å·²è¢«systemdå…¼å®¹å¹¶å–ä»£ã€‚</p>

<p>ï¼ˆDeepSeekï¼‰ä»¥å¾€æ²¡æœ‰systemdæ—¶ï¼Œç¬¬ä¸€ä¸ªè¿›ç¨‹æ˜¯ <code class="language-plaintext highlighter-rouge">init</code>ï¼Œå®ƒå¯èƒ½ä¼šåŠ è½½ä¸€äº›è‡ªå·±çš„é…ç½®æ–‡ä»¶ï¼Œä½†ä¸ä¼šåŠ è½½ <code class="language-plaintext highlighter-rouge">/etc/environment</code>ï¼Œç„¶åæ‰§è¡Œå¯¹åº”è¿è¡Œçº§åˆ«çš„rcè„šæœ¬ï¼ˆå¯åŠ¨çš„shellæ˜¯ <code class="language-plaintext highlighter-rouge">Non-Interactive Non-Login Shell</code>ï¼‰ï¼Œè¿›è€Œå¯åŠ¨å„é¡¹ç³»ç»ŸæœåŠ¡ã€å®ˆæŠ¤è¿›ç¨‹ç­‰ç¨‹åºã€‚</p>

<p>ï¼ˆDeepSeekï¼‰systemdèƒ½å¤Ÿå…¼å®¹SysVinitï¼Œå®ƒèƒ½å¤Ÿä¸º <code class="language-plaintext highlighter-rouge">/etc/init.d/</code> ä¸‹çš„è„šæœ¬ç”Ÿæˆsystemdè‡ªèº«çš„unitæ–‡ä»¶ï¼Œè¿›è€Œæ‰§è¡Œ <code class="language-plaintext highlighter-rouge">/etc/init.d/</code> ä¸‹çš„è„šæœ¬ã€‚</p>

<p>ï¼ˆå¦ï¼‰<code class="language-plaintext highlighter-rouge">service</code> å‘½ä»¤å…¶å®æ˜¯ä¸€ä¸ªshellè„šæœ¬ï¼Œå¦‚æœç³»ç»Ÿä½¿ç”¨SysVinitï¼Œå®ƒï¼ˆ<code class="language-plaintext highlighter-rouge">service nginx start</code>ï¼‰å°±ç›¸å½“äº <code class="language-plaintext highlighter-rouge">/etc/init.d/nginx start</code>ï¼›å¦‚æœç³»ç»Ÿä½¿ç”¨systemdï¼Œå®ƒå°±ç›¸å½“äº <code class="language-plaintext highlighter-rouge">systemctl start nginx.service</code>ã€‚</p>

<h1 id="é…ç½®æ–‡ä»¶è§’è‰²å®šä½">é…ç½®æ–‡ä»¶è§’è‰²å®šä½</h1>

<ul>
  <li><code class="language-plaintext highlighter-rouge">/etc/profile</code>ï¼šshellçš„ç³»ç»Ÿçº§é…ç½®ï¼Œ<code class="language-plaintext highlighter-rouge">Login Shell</code> çš„ç³»ç»Ÿçº§é…ç½®å…¥å£ï¼Œå…¶ä¸­ä¸€èˆ¬ä¼šåŠ è½½ <code class="language-plaintext highlighter-rouge">/etc/bash.bashrc</code>ï¼Œéå† <code class="language-plaintext highlighter-rouge">/etc/profile.d/</code>ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">/etc/bash.bashrc</code>ï¼šbashçš„ç³»ç»Ÿçº§é…ç½®ï¼Œ<code class="language-plaintext highlighter-rouge">Interactive Shell</code> çš„ç³»ç»Ÿçº§é…ç½®ï¼Œç”¨äºé…ç½®æ‰€æœ‰ç”¨æˆ·é€šç”¨çš„å‘½ä»¤æç¤ºç¬¦æ ·å¼ã€å‘½ä»¤åˆ«åç­‰ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">/etc/profile.d/</code>ï¼šå­˜æ”¾ <code class="language-plaintext highlighter-rouge">Login Shell</code> ç³»ç»Ÿçº§é…ç½®è„šæœ¬çš„ç›®å½•ï¼Œ<strong>å¸¸ç”¨äºé…ç½®ç³»ç»Ÿçº§ç¯å¢ƒå˜é‡</strong>ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">~/.bash_profile</code>ï¼šbashçš„ç”¨æˆ·çº§é…ç½®ï¼Œ<code class="language-plaintext highlighter-rouge">Login Shell</code> çš„ç”¨æˆ·çº§é…ç½®å…¥å£ï¼Œå…¶ä¸­ä¸€èˆ¬ä¼šåŠ è½½ <code class="language-plaintext highlighter-rouge">~/.bashrc</code>ã€‚è¯¥æ–‡ä»¶ï¼ˆ<code class="language-plaintext highlighter-rouge">~/.bash_profile</code>ï¼‰å¯ç”¨äºé…ç½®ç”¨æˆ·çº§ç¯å¢ƒå˜é‡ã€‚è¯¥æ–‡ä»¶æ˜¯bashä¸“ç”¨çš„é…ç½®æ–‡ä»¶ï¼Œåœ¨éœ€è¦ä¸ºbashæä¾›ä¸“æœ‰é…ç½®ä¸”å…¶å®ƒshellç»§ç»­ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">~/.profile</code> é…ç½®æ—¶æ‰ä¼šæ´¾ä¸Šç”¨åœºï¼Œä¸€èˆ¬<strong>å¾ˆå°‘ä½¿ç”¨</strong>ã€‚bashä¼šæŒ‰ç…§ <code class="language-plaintext highlighter-rouge">~/.bash_profile &gt; ~/.bash_login &gt; ~/.profile</code> çš„ä¼˜å…ˆçº§é¡ºåºä»…åŠ è½½å­˜åœ¨ä¸”å¯è¯»çš„ç¬¬ä¸€ä¸ªæ–‡ä»¶ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">~/.bash_login</code>ï¼šbashçš„ç”¨æˆ·çº§é…ç½®ï¼Œ<code class="language-plaintext highlighter-rouge">Login Shell</code> çš„ç”¨æˆ·çº§é…ç½®å…¥å£ï¼Œå…¶ä¸­ä¸€èˆ¬ä¼šåŠ è½½ <code class="language-plaintext highlighter-rouge">~/.bashrc</code>ã€‚è¯¥æ–‡ä»¶ï¼ˆ<code class="language-plaintext highlighter-rouge">~/.bash_login</code>ï¼‰å¯ç”¨äºé…ç½®ç”¨æˆ·çº§ç¯å¢ƒå˜é‡ã€‚è¯¥æ–‡ä»¶æ˜¯bashä¸“ç”¨çš„é…ç½®å¤‡ç”¨æ–‡ä»¶ï¼ŒåŠŸèƒ½ä¸ <code class="language-plaintext highlighter-rouge">~/.bash_profile</code> ç±»ä¼¼ï¼Œå¹³æ—¶<strong>æå°‘ä½¿ç”¨</strong>ã€‚bashä¼šæŒ‰ç…§ <code class="language-plaintext highlighter-rouge">~/.bash_profile &gt; ~/.bash_login &gt; ~/.profile</code> çš„ä¼˜å…ˆçº§é¡ºåºä»…åŠ è½½å­˜åœ¨ä¸”å¯è¯»çš„ç¬¬ä¸€ä¸ªæ–‡ä»¶ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">~/.profile</code>ï¼šshellçš„ç”¨æˆ·çº§é…ç½®ï¼Œ<code class="language-plaintext highlighter-rouge">Login Shell</code> çš„ç”¨æˆ·çº§é…ç½®å…¥å£ï¼Œå…¶ä¸­ä¸€èˆ¬ä¼šåŠ è½½ <code class="language-plaintext highlighter-rouge">~/.bashrc</code>ã€‚è¯¥æ–‡ä»¶ï¼ˆ<code class="language-plaintext highlighter-rouge">~/.profile</code>ï¼‰<strong>å¸¸ç”¨äºé…ç½®ç”¨æˆ·çº§ç¯å¢ƒå˜é‡</strong>ã€‚bashä¼šæŒ‰ç…§ <code class="language-plaintext highlighter-rouge">~/.bash_profile &gt; ~/.bash_login &gt; ~/.profile</code> çš„ä¼˜å…ˆçº§é¡ºåºä»…åŠ è½½å­˜åœ¨ä¸”å¯è¯»çš„ç¬¬ä¸€ä¸ªæ–‡ä»¶ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">~/.bashrc</code>ï¼šbashçš„ç”¨æˆ·çº§é…ç½®ï¼Œ<code class="language-plaintext highlighter-rouge">Interactive Shell</code> çš„ç”¨æˆ·çº§é…ç½®ï¼Œç”¨äºé…ç½®å½“å‰ç”¨æˆ·çš„å‘½ä»¤æç¤ºç¬¦æ ·å¼ã€å‘½ä»¤åˆ«åç­‰ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">~/.bash_logout</code>ï¼šbashçš„ç”¨æˆ·çº§é…ç½®ï¼Œ<code class="language-plaintext highlighter-rouge">Login Shell</code> çš„ç”¨æˆ·çº§é…ç½®ï¼Œç”¨äºåœ¨é€€å‡ºshellï¼ˆ<code class="language-plaintext highlighter-rouge">Ctrl+D</code> æˆ– <code class="language-plaintext highlighter-rouge">exit</code> è§¦å‘ï¼‰æ—¶æ‰§è¡Œä¸€äº›å½“å‰ç”¨æˆ·çš„æ“ä½œï¼Œå¦‚æ¸…ç†æ“ä½œã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">/etc/bash.bash_logout</code>ï¼šbashçš„ç³»ç»Ÿçº§é…ç½®ï¼Œ<code class="language-plaintext highlighter-rouge">Login Shell</code> çš„ç³»ç»Ÿçº§é…ç½®ï¼Œç”¨äºåœ¨é€€å‡ºshellï¼ˆ<code class="language-plaintext highlighter-rouge">Ctrl+D</code> æˆ– <code class="language-plaintext highlighter-rouge">exit</code> è§¦å‘ï¼‰æ—¶æ‰§è¡Œä¸€äº›æ‰€æœ‰ç”¨æˆ·é€šç”¨çš„æ“ä½œï¼Œå¦‚æ¸…ç†æ“ä½œã€‚ä¸€èˆ¬<strong>å¾ˆå°‘ä½¿ç”¨</strong>è¯¥æ–‡ä»¶ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">/etc/environment</code>ï¼šPAMè®¤è¯æ¨¡å—çš„ç³»ç»Ÿçº§é…ç½®ï¼Œä¹Ÿè¢«systemdç›´æ¥åŠ è½½ï¼Œåªèƒ½ç”¨äºé…ç½®ç¯å¢ƒå˜é‡ï¼Œåœ¨ç°ä»£ä½¿ç”¨systemdçš„linuxä¸­ï¼Œç†è®ºä¸Šæ‰€æœ‰è¿›ç¨‹éƒ½èƒ½åƒåˆ°è¯¥ç¯å¢ƒï¼Œä¸è¿‡ä¸€èˆ¬<strong>å¾ˆå°‘ä½¿ç”¨</strong>ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">~/.pam_environment</code>ï¼šPAMè®¤è¯æ¨¡å—çš„ç”¨æˆ·çº§é…ç½®ï¼Œåªèƒ½ç”¨äºé…ç½®ç¯å¢ƒå˜é‡ï¼Œä½†<strong>åŸºæœ¬å·²è¢«å¼ƒç”¨</strong>ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">/etc/rc.d/</code>ï¼š<code class="language-plaintext highlighter-rouge">/etc/rc0.d/, /etc/rc1.d/, ...</code> ç³»åˆ—ç›®å½•æ˜¯SysVinitä½“ç³»çš„ç»„æˆéƒ¨åˆ†ï¼Œå…¶å†…å­˜æ”¾æœåŠ¡ç®¡ç†è„šæœ¬çš„è½¯é“¾æ¥ï¼Œé“¾æ¥æŒ‡å‘ <code class="language-plaintext highlighter-rouge">/etc/init.d/</code>ã€‚SysVinitç°å·²è¢«systemdå…¼å®¹å¹¶å–ä»£ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">/etc/init.d/</code>ï¼šSysVinitä½“ç³»çš„ç»„æˆéƒ¨åˆ†ï¼Œå…¶å†…å­˜æ”¾æœåŠ¡ç®¡ç†è„šæœ¬ã€‚</li>
</ul>


</div>

<div class="post-tail-wrapper text-muted">

  <!-- categories -->
  
  <div class="post-meta mb-3">
    <i class="far fa-folder-open fa-fw mr-1"></i>
    
      <a href='/categories/tech/'>Tech</a>,
      <a href='/categories/linux/'>Linux</a>
  </div>
  

  <!-- tags -->
  
  <div class="post-tags">
    <i class="fa fa-tags fa-fw mr-1"></i>
      
      <a href="/tags/shell/"
          class="post-tag no-text-decoration" >shell</a>
      
      <a href="/tags/bash/"
          class="post-tag no-text-decoration" >bash</a>
      
  </div>
  

  <div class="post-tail-bottom
    d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
    <div class="license-wrapper">

      

        

        æœ¬æ–‡ç”±ä½œè€…æŒ‰ç…§ 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         è¿›è¡Œæˆæƒ

      
    </div>

    <!--
 Post sharing snippet
-->

<div class="share-wrapper">
  <span class="share-label text-muted mr-1">åˆ†äº«</span>
  <span class="share-icons">
    
    

    
      
        <a href="https://twitter.com/intent/tweet?text=Linuxç¯å¢ƒé…ç½®åŠ è½½åˆ†æ - å°é»‘çŒ«&amp;url=http://0.0.0.0:4000/posts/Linux%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E5%8A%A0%E8%BD%BD%E5%88%86%E6%9E%90/" data-toggle="tooltip" data-placement="top"
          title="Twitter" target="_blank" rel="noopener" aria-label="Twitter">
          <i class="fa-fw fab fa-twitter"></i>
        </a>
    
      
        <a href="https://www.facebook.com/sharer/sharer.php?title=Linuxç¯å¢ƒé…ç½®åŠ è½½åˆ†æ - å°é»‘çŒ«&amp;u=http://0.0.0.0:4000/posts/Linux%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E5%8A%A0%E8%BD%BD%E5%88%86%E6%9E%90/" data-toggle="tooltip" data-placement="top"
          title="Facebook" target="_blank" rel="noopener" aria-label="Facebook">
          <i class="fa-fw fab fa-facebook-square"></i>
        </a>
    
      
        <a href="https://t.me/share/url?url=http://0.0.0.0:4000/posts/Linux%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E5%8A%A0%E8%BD%BD%E5%88%86%E6%9E%90/&amp;text=Linuxç¯å¢ƒé…ç½®åŠ è½½åˆ†æ - å°é»‘çŒ«" data-toggle="tooltip" data-placement="top"
          title="Telegram" target="_blank" rel="noopener" aria-label="Telegram">
          <i class="fa-fw fab fa-telegram"></i>
        </a>
    

    <i id="copy-link" class="fa-fw fas fa-link small"
        data-toggle="tooltip" data-placement="top"
        title="åˆ†äº«é“¾æ¥"
        data-title-succeed="é“¾æ¥å·²å¤åˆ¶ï¼">
    </i>

  </span>
</div>


  </div><!-- .post-tail-bottom -->

</div><!-- div.post-tail-wrapper -->


      
    
    

    </div>
  </div> <!-- #core-wrapper -->

  <!-- pannel -->
  <div id="panel-wrapper" class="col-xl-3 pl-2 text-muted">

    <div class="access">
      















  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">çƒ­é—¨æ ‡ç­¾</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

    
      
      <a class="post-tag" href="/tags/gdb/">gdb</a>
    
      
      <a class="post-tag" href="/tags/bash/">bash</a>
    
      
      <a class="post-tag" href="/tags/git/">git</a>
    
      
      <a class="post-tag" href="/tags/kdb/">kdb</a>
    
      
      <a class="post-tag" href="/tags/shell/">shell</a>
    
      
      <a class="post-tag" href="/tags/tls/">tls</a>
    

    </div>
  </div>


    </div>

    
      
      



<!-- BS-toc.js will be loaded at medium priority -->
<script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script>

<div id="toc-wrapper" class="pl-0 pr-4 mb-5">
  <div class="panel-heading pl-3 pt-2 mb-2">æ–‡ç« å†…å®¹</div>
  <nav id="toc" data-toggle="toc"></nav>
</div>


    
  </div>

</div>

<!-- tail -->

<div class="row">
  <div class="col-12 col-lg-11 col-xl-8">
    <div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">
      
        
        <!--
 Recommend the other 3 posts according to the tags and categories of the current post,
 if the number is not enough, use the other latest posts to supplement.
-->

<!-- The total size of related posts  -->


<!-- An random integer that bigger than 0  -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy}  -->








  

  
    
  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  








<!-- Fill with the other newlest posts  -->






  <div id="related-posts" class="mt-5 mb-2 mb-sm-4">
    <h3 class="pt-2 mt-1 mb-4 ml-1"
      data-toc-skip>ç›¸å…³æ–‡ç« </h3>
    <div class="card-deck mb-4">
    
      
      
      <div class="card">
        <a href="/posts/%E6%AD%BB%E6%9C%BA%E5%AE%9A%E4%BD%8D-%E5%86%85%E5%AD%98%E4%B8%8D%E8%B6%B3%E6%AD%BB%E5%9C%A8vmalloc/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/timeago.js
-->

<em class="timeago small"
    data-ts="1748781000"
    
    >
  2025-06-01
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>æ­»æœºå®šä½-å†…å­˜ä¸è¶³æ­»åœ¨vmalloc</h3>
            <div class="text-muted small">
              <p>
                





                å®šä½è¿‡ç¨‹

æ­»æœºè°ƒç”¨æ ˆå¦‚ä¸‹ï¼Œæ¨æ ˆç»“æœä¸ bt ç»“æœå¤§å·®ä¸å·®ã€‚ç”±ä¸€ä¸ªç»ˆç«¯ç¨‹åºä¸€è·¯è°ƒç”¨åˆ° vmallocï¼Œæœ€åæ­»åœ¨å…¶å†…éƒ¨ã€‚æ³¨æ„åˆ°å‡½æ•° out_of_memoryï¼Œè¿™è¡¨æ˜å¯èƒ½æ˜¯ç³»ç»Ÿå†…å­˜å¿«è€—å°½äº†ã€‚

[0]kdb&amp;gt; bt
Stack traceback for pid 693
0xffff880362416740      693        1  1    0   R  0xffff880...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/%E5%87%BD%E6%95%B0%E4%BC%A0%E5%8F%82/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/timeago.js
-->

<em class="timeago small"
    data-ts="1669563000"
    
    >
  2022-11-27
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>å‡½æ•°ä¼ å‚</h3>
            <div class="text-muted small">
              <p>
                





                ä¼ å‚åˆ†ç±»

ä»ä¼ å‚ç±»å‹ä¸Šçœ‹

ä¼ å‚åˆ†ä¸ºä¼ å€¼å’Œä¼ æŒ‡é’ˆã€‚


  ä¼ æŒ‡é’ˆæœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¼ å€¼ï¼Œåªä¸è¿‡ä¼ çš„æ˜¯æŒ‡é’ˆå€¼ã€‚ç”±äºä¼ ä¸€èˆ¬å€¼å’Œä¼ æŒ‡é’ˆå€¼è¿˜æ˜¯æœ‰ç‚¹åŒºåˆ«ï¼Œæ‰€ä»¥åˆ†æˆä¸¤ç§è¯´æ³•ã€‚ä¼ å€¼ä¸€èˆ¬å°±æŒ‡ä¼ ä¸€èˆ¬å€¼ï¼Œä¼ æŒ‡é’ˆä¸“é—¨ç”¨äºæè¿°ä¼ æŒ‡é’ˆå€¼ã€‚


ä»ä¼ å‚è¡Œä¸ºä¸Šçœ‹

ä¼ å‚åˆ†ä¸ºå€¼å¤åˆ¶å’Œä¼ è‡ªå·±ã€‚


  ä¼ è‡ªå·±æœ¬è´¨ä¸Šä¹Ÿæ˜¯å€¼å¤åˆ¶ï¼Œåªä¸è¿‡æ˜¯å–åœ°å€ä¼ æ— åæŒ‡é’ˆï¼Œå½¢å‚ç›´æ¥æ¥ä¸Šï¼›è€Œä¸æ˜¯ç›´æ¥ä¼ æœ‰åæŒ‡é’ˆã€‚ä¾‹å¦‚ï¼š


// å‡½æ•°è°ƒç”¨
func1(i...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/C%E8%AF%AD%E8%A8%80%E6%A0%87%E5%87%86%E5%8F%91%E5%B1%95%E5%8E%86%E5%8F%B2/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/timeago.js
-->

<em class="timeago small"
    data-ts="1708764817"
    
    >
  2024-02-24
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Cè¯­è¨€æ ‡å‡†å‘å±•å†å²</h3>
            <div class="text-muted small">
              <p>
                





                å¯¹å„ç§ C æ ‡å‡†è¿›è¡Œç®€è¿°ã€‚

å‚è€ƒèµ„æ–™ï¼šStandards (Using the GNU Compiler Collection (GCC))

ANSI Cï¼ŒISO C89/90

ANSI C æ˜¯æœ€åˆçš„ C è¯­è¨€æ ‡å‡†ï¼Œåœ¨ 1989 å¹´è·å¾—æ‰¹å‡†ï¼Œ1990 å¹´å‘å¸ƒã€‚

1990 å¹´æ™šäº›æ—¶å€™ï¼Œè¯¥æ ‡å‡†æˆä¸ºäº† ISO C89/90 æ ‡å‡†ã€‚

è¿™ä¸¤ä¸ªæ ‡å‡†ä¹‹é—´æ²¡æœ‰æŠ€æœ¯ä¸Šçš„å·®å¼‚ï¼Œå¯ä»¥å½“ä½œå°±æ˜¯ä¸€ä¸ªæ ‡å‡†ã€‚
...
              </p>
            </div>
          </div>
        </a>
      </div>
    
    </div> <!-- .card-deck -->
  </div> <!-- #related-posts -->


      
        
        <!--
  Navigation buttons at the bottom of the post.
-->

<div class="post-navigation d-flex justify-content-between">
  
  <a href="/posts/%E8%BF%90%E7%AE%97%E7%AC%A6%E4%BC%98%E5%85%88%E7%BA%A7%E5%92%8C%E7%BB%93%E5%90%88%E6%80%A7/" class="btn btn-outline-primary"
    prompt="ä¸Šä¸€ç¯‡">
    <p>ä½ çœŸçš„ææ‡‚ä¼˜å…ˆçº§å’Œç»“åˆæ€§äº†å—ï¼Ÿ</p>
  </a>
  

  
  <span class="btn btn-outline-primary disabled"
    prompt="ä¸‹ä¸€ç¯‡">
    <p>-</p>
  </span>
  

</div>

      
        
        <!--  The comments switcher -->


      
    </div>
  </div>
</div> <!-- .row -->



        <!--
  The Footer
-->

<footer class="d-flex w-100 justify-content-center">
  <div class="d-flex justify-content-between align-items-center text-muted">
    <div class="footer-left">
      <p class="mb-0">
        Â© 2025
        <a href="https://github.com/lcatmiao">å°é»‘çŒ«</a>.
        
        <span data-toggle="tooltip" data-placement="top"
          title="é™¤éå¦æœ‰è¯´æ˜ï¼Œæœ¬ç½‘ç«™ä¸Šçš„åšå®¢æ–‡ç« å‡ç”±ä½œè€…æŒ‰ç…§çŸ¥è¯†å…±äº«ç½²å 4.0 å›½é™… (CC BY 4.0) è®¸å¯åè®®è¿›è¡Œæˆæƒã€‚">ä¿ç•™éƒ¨åˆ†æƒåˆ©ã€‚</span>
        
      </p>
    </div>

    <div class="footer-right">
      <p class="mb-0">
        

        

        æœ¬ç«™ç”± 
          <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>
         ç”Ÿæˆï¼Œé‡‡ç”¨ 
          <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a>
         ä¸»é¢˜ã€‚

      </p>
    </div>

  </div> <!-- div.d-flex -->
</footer>


      </div>

      <!--
  The Search results
-->
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-12 col-sm-11 post-content">
    <div id="search-hints">
      















  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">çƒ­é—¨æ ‡ç­¾</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

    
      
      <a class="post-tag" href="/tags/gdb/">gdb</a>
    
      
      <a class="post-tag" href="/tags/bash/">bash</a>
    
      
      <a class="post-tag" href="/tags/git/">git</a>
    
      
      <a class="post-tag" href="/tags/kdb/">kdb</a>
    
      
      <a class="post-tag" href="/tags/shell/">shell</a>
    
      
      <a class="post-tag" href="/tags/tls/">tls</a>
    

    </div>
  </div>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>


    </div> <!-- #main-wrapper -->

    

    <div id="mask"></div>

    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a>

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script>

<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="{url}">{title}</a>  <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    {categories}    {tags}  </div>  <p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5">æœç´¢ç»“æœä¸ºç©º</p>',
  templateMiddleware: function(prop, value, template) {
    if (prop === 'categories') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
      }
    }

    if (prop === 'tags') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
      }
    }
  }
});
</script>


    <!--
  JS selector for site.
-->

<!-- layout specified -->


  



  <!-- image lazy-loading & popup -->
  <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script>




  

  <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1,npm/dayjs@1/locale/zh.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script>





<script defer src="/assets/js/dist/post.min.js"></script>



<!-- commons -->

<script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script>




  </body>

</html>

