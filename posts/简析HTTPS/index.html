<!DOCTYPE html>







<html lang="zh-CN"
  
>

  <!--
  The Head
-->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Allow having a localized datetime different from the appearance language -->
  

  

    

    

  

  <!-- Begin Jekyll SEO tag v2.7.1 -->
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content="ç®€æžHTTPS" />
<meta name="author" content="å°é»‘çŒ«" />
<meta property="og:locale" content="zh_CN" />
<meta name="description" content="å†™åœ¨å‰é¢ é˜…è¯»ã€Šå›¾è§£HTTPã€‹ï¼Œå¤§è‡´ç†è§£äº† SSL/TLS çš„æ¡æ‰‹è¿‡ç¨‹å’Œæ€æƒ³åŽŸç†ã€‚ç„¶è€Œä½œä¸ºå…¥é—¨ä¹¦ï¼Œå®ƒæ²¡æœ‰ä»‹ç»åŸºäºŽ DH ç®—æ³•çš„ TLS æ¡æ‰‹è¿‡ç¨‹ï¼Œä¹Ÿæ²¡æœ‰ä»‹ç»è¯ä¹¦é“¾ç›¸å…³çš„çŸ¥è¯†ðŸ˜¡ã€‚æˆ‘ Google äº†ä¸å°‘èµ„æ–™ï¼Œç€é‡å•ƒäº†å‡ ç¯‡æ–‡ç« ï¼Œç»“åˆæŠ“åŒ…åˆ†æžï¼Œæœ¬æƒ³â€œå·®ä¸å¤šå¾—äº†â€ï¼Œå´æ²¡æ–™åˆ°å…¥äº†å¤§å‘ï¼Œç–‘é—®ä¸å‡åå¢žã€‚ ä¸€ç­¹èŽ«å±•ä¹‹é™…ï¼ŒAI æŠ€æœ¯å¤§ç«ï¼Œæ•‘æˆ‘ç‹—å‘½ã€‚å—æ­¤é¼“èˆžï¼Œå€ŸåŠ© AI è§£æƒ‘ï¼Œåˆæ‰“èµ·ç²¾ç¥žå•ƒè¯»äº†å¤šä¸ª RFC ç‰‡æ®µï¼Œé‚æ‹¨äº‘è§æ—¥ã€‚æœ¬æ–‡æ—¢æˆï¼Œè™½å¾—ç›ŠäºŽå¤©æ—¶ï¼Œç„¶äº¦å¯è°“ä¸€æ³¢ä¸‰æŠ˜ï¼ŒåŽ†å°½è‰°è¾›ã€‚æˆ‘çœŸç‰›é€¼ðŸ‘ã€‚ æœ¬æ–‡ä¸»è¦åŸºäºŽ TLS1.2 ç ”å†™ï¼ŒçŸ¥è¯†æ•´ç†äºŽæ­¤ðŸ‘‡ã€‚ å…ˆè¡Œæ¦‚å¿µ &gt; å¯†ç ä½“åˆ¶ å¯†ç å­¦ä¸»è¦æœ‰ä¸¤ç§ä½“åˆ¶ï¼š å…±äº«å¯†ç ä½“åˆ¶ï¼ˆå¯¹ç§°å¯†ç ä½“åˆ¶ï¼‰ å…¬é’¥å¯†ç ä½“åˆ¶ï¼ˆéžå¯¹ç§°å¯†ç ä½“åˆ¶ï¼‰ &gt; æ•°å­¦éš¾é¢˜ å…¬é’¥å¯†ç ä½“åˆ¶ä¸»è¦åŸºäºŽä»¥ä¸‹æ•°å­¦éš¾é¢˜ï¼š å¤§æ•´æ•°åˆ†è§£é—®é¢˜ ç¦»æ•£å¯¹æ•°é—®é¢˜ï¼ˆDLPï¼‰ ä¸€èˆ¬çš„ç¦»æ•£å¯¹æ•°é—®é¢˜ æ¤­åœ†æ›²çº¿ç¦»æ•£å¯¹æ•°é—®é¢˜ï¼ˆECDLPï¼‰ ä¸€èˆ¬çš„è¯´æ³•ä¸­ï¼Œé€šå¸¸å°†æ¤­åœ†æ›²çº¿ç¦»æ•£å¯¹æ•°é—®é¢˜å•ç‹¬ä½œä¸ºä¸€ç±»ï¼Œä¸Žç¦»æ•£å¯¹æ•°é—®é¢˜ã€å¤§æ•´æ•°åˆ†è§£é—®é¢˜ä¸€èµ·ï¼Œå¹¶ç§°å¯†ç å­¦ä¸‰å¤§æ•°å­¦éš¾é¢˜ã€‚æ¤­åœ†æ›²çº¿ç¦»æ•£å¯¹æ•°é—®é¢˜æ¯”ä¸€èˆ¬çš„ç¦»æ•£å¯¹æ•°é—®é¢˜æ›´åŠ å›°éš¾ï¼Œè‡ªç„¶å°±è¯žç”Ÿäº†åŸºäºŽæ¤­åœ†æ›²çº¿çš„å¯†ç å­¦ï¼Œè¢«ç§°ä½œæ¤­åœ†æ›²çº¿å¯†ç å­¦ï¼ˆECCï¼‰ã€‚ä¸€äº›åŽŸæœ¬åŸºäºŽä¸€èˆ¬ç¦»æ•£å¯¹æ•°é—®é¢˜çš„ç®—æ³•è¢«ç§»æ¤åˆ°æ¤­åœ†æ›²çº¿ä¸Šï¼Œå°±æœ‰äº† ECC çš„ç®—æ³•ç‰ˆæœ¬ï¼Œæ¯”å¦‚ DH ç®—æ³•çš„æ¤­åœ†æ›²çº¿ç‰ˆæœ¬ï¼Œå°±å« ECDH ç®—æ³•ã€‚ ä¸€äº›å…¬é’¥ç®—æ³•ä¸Žæ•°å­¦éš¾é¢˜çš„å¯¹åº”å…³ç³»ï¼š RSA - å¤§æ•´æ•°åˆ†è§£é—®é¢˜ DHã€DSA - ä¸€èˆ¬çš„ç¦»æ•£å¯¹æ•°é—®é¢˜ ECDHã€ECDHEã€ECDSA - æ¤­åœ†æ›²çº¿ç¦»æ•£å¯¹æ•°é—®é¢˜ TLS æ¡æ‰‹è¿‡ç¨‹ TLS åœ¨æ¡æ‰‹ä¸­ä¸»è¦åšäº†ä¸‰ä»¶äº‹â€”â€”èº«ä»½è®¤è¯ã€å¯†é’¥äº¤æ¢å’Œå®Œæ•´æ€§æ ¡éªŒã€‚æ¡æ‰‹ä¸»è¦æ˜¯ä¸ºäº†ç”Ÿæˆå¹¶äº¤æ¢å…±äº«å¯†é’¥ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯ä½¿ç”¨å…¬é’¥ç®—æ³•è¿›è¡Œçš„ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½æ‹¥æœ‰å…±äº«å¯†é’¥åŽï¼ŒåŽç»­çš„é€šä¿¡å†ä½¿ç”¨å…±äº«å¯†é’¥ç®—æ³•è¿›è¡ŒåŠ å¯†ã€‚è¿™æ˜¯å®‰å…¨å’Œæ€§èƒ½ç»¼åˆè€ƒé‡çš„ç»“æžœã€‚å…¬é’¥ç®—æ³•å®‰å…¨ä½†æ€§èƒ½æ¶ˆè€—å¤šï¼Œå…±äº«å¯†é’¥ç®—æ³•ç›¸å¯¹ä¸é‚£ä¹ˆå®‰å…¨ä½†æ€§èƒ½æ¶ˆè€—å°‘ï¼Œæ‰€ä»¥çœŸæ­£çš„åŠ å¯†é€šä¿¡ä½¿ç”¨å…±äº«å¯†é’¥åŠ å¯†ï¼Œè€Œä¸”å…±äº«å¯†é’¥çš„äº¤æ¢åˆ™ç”±å…¬é’¥ç®—æ³•å®žçŽ°ã€‚ ä»¥ä¸‹åŸºäºŽ TLS1.2 é˜è¿°å…¶æ¡æ‰‹è¿‡ç¨‹ã€‚ åŸºäºŽ RSA ç®—æ³• æ­¥éª¤ 1 - å‘èµ·è¿žæŽ¥ï¼Œåå•†å‚æ•° å®¢æˆ·ç«¯å‘é€ `Client Hello`ã€‚ å®¢æˆ·ç«¯ç”Ÿæˆéšæœºæ•° Client Randomï¼Œå¹¶å‘é€ Client Hello æŠ¥æ–‡ã€‚è¯¥æŠ¥æ–‡ä¸­åŒ…å« Client Random éšæœºæ•°ä»¥åŠå®¢æˆ·ç«¯æ”¯æŒçš„ç®—æ³•å¥—ä»¶ç­‰ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯è¢«ä¼ é€’ç»™æœåŠ¡å™¨ç”¨äºŽåå•†ã€‚ æ­¥éª¤ 2 - åå•†å‚æ•°ï¼Œå‘é€è¯ä¹¦ æœåŠ¡å™¨å‘é€ `Server Hello, Certificate, Server Hello Done`ã€‚ æœåŠ¡å™¨ä»Ž Client Hello ä¸­èŽ·å¾—éšæœºæ•° Client Randomã€‚ æœåŠ¡å™¨ç”Ÿæˆ Server Randomï¼Œå°†è¯¥éšæœºæ•°åŒ…å«è¿› Server Hello ä¸­ã€‚æœåŠ¡å™¨ä¾æ®è‡ªèº«æƒ…å†µï¼Œä»Žå®¢æˆ·ç«¯ç®—æ³•å¥—ä»¶ä¸­æŒ‘é€‰ä¸€ä¸ªè‡ªèº«æ”¯æŒçš„ç®—æ³•ï¼Œå°†å…¶åŒ…å«è¿› Server Hello ä¸­ã€‚ æœåŠ¡å™¨å‘é€è‡ªå·±çš„è¯ä¹¦ã€‚è¯ä¹¦ä¸­ä¸»è¦åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š æœåŠ¡å™¨çš„å…¬é’¥ æœåŠ¡å™¨çš„åŸŸå å…¶å®ƒé™„åŠ ä¿¡æ¯ CA çš„ç­¾åï¼šä½¿ç”¨ CA çš„ç§é’¥å¯¹ä¸Šè¿°è¯ä¹¦ä¿¡æ¯çš„å“ˆå¸Œå€¼åŠ å¯†æ‰€å¾—çš„ç»“æžœã€‚ 1 signature = ca-private-key((hash(cert-info))) æœåŠ¡å™¨å‘é€ Server Hello Doneã€‚ å¦‚ä¸‹å›¾ï¼ŒæœåŠ¡å™¨å‘é€æŠ¥æ–‡ã€‚ å¦‚ä¸‹å›¾ï¼ŒæœåŠ¡å™¨é€‰æ‹©äº†ç®—æ³• TLS_RSA_WITH_AES_256_CBC_SHAã€‚ å¦‚ä¸‹å›¾ï¼ŒæœåŠ¡å™¨å‘é€äº†è‡ªå·±çš„è¯ä¹¦ï¼Œè¯¥è¯ä¹¦è¢« CA ç­¾åï¼Œç­¾åä½¿ç”¨çš„ç­¾åç®—æ³•æ˜¯ RSAï¼Œå“ˆå¸Œç®—æ³•æ˜¯ SHA256ã€‚ æ­¥éª¤ 3 - èº«ä»½è®¤è¯ï¼Œå¯†é’¥äº¤æ¢ï¼Œç”Ÿæˆä¼šè¯å¯†é’¥ å®¢æˆ·ç«¯å‘é€ `Client Key Exchange, Change Cipher Spec, Encrypted Handshake Message`ã€‚ å®¢æˆ·ç«¯ä»Ž Server Hello ä¸­èŽ·å¾—éšæœºæ•° Server Randomã€‚ å®¢æˆ·ç«¯ä½¿ç”¨ CA çš„è¯ä¹¦ï¼ˆä¸€èˆ¬å·²é¢„ç½®åœ¨æµè§ˆå™¨ä¸­ï¼‰éªŒè¯æœåŠ¡å™¨çš„è¯ä¹¦ã€‚ä½¿ç”¨ CA è¯ä¹¦ä¸­åŒ…å«çš„å…¬é’¥è§£å¯†æœåŠ¡å™¨è¯ä¹¦ä¸­çš„ç­¾åï¼Œå¾—åˆ°å“ˆå¸Œå€¼ï¼Œå†è®¡ç®—æœåŠ¡å™¨è¯ä¹¦ä¿¡æ¯çš„å“ˆå¸Œå€¼ï¼ŒäºŒè€…å¯¹æ¯”ï¼Œè‹¥ä¸€è‡´åˆ™éªŒè¯é€šè¿‡ã€‚éªŒè¯é€šè¿‡ï¼Œè¯æ˜Žäº†æœåŠ¡å™¨è¯ä¹¦æ˜¯ç”±æµè§ˆå™¨å†…ç½®çš„ CA è¯ä¹¦æ‰€ä»£è¡¨çš„ CA é¢å‘çš„ï¼Œå³è¯æ˜Žäº†å†…ç½® CA ä¿¡ä»»æœåŠ¡å™¨ï¼›è€Œå†…ç½®çš„ CA æ˜¯å¹¿å—ç¤¾ä¼šä¿¡ä»»çš„ CAï¼Œå·²ç»æ˜¯ä¿¡ä»»é”šç‚¹ã€‚å°±è¿™æ ·ï¼Œæµè§ˆå™¨ä¿¡ä»» CAï¼ŒCA ä¿¡ä»»æœåŠ¡å™¨ï¼Œæ‰€ä»¥æµè§ˆå™¨ä¿¡ä»»æœåŠ¡å™¨ã€‚è¿™ä¸€ä¿¡ä»»é“¾è¯æ˜Žäº†æœåŠ¡å™¨çš„èº«ä»½å€¼å¾—ä¿¡èµ–ï¼Œä¸”è¯ä¹¦ä¸­çš„å…¬é’¥çš„ç¡®å±žäºŽæœåŠ¡å™¨ï¼Œæ­¤å³èº«ä»½è®¤è¯ã€‚ å®¢æˆ·ç«¯ç”Ÿæˆ PreMaster Secretï¼Œå¹¶ä½¿ç”¨æœåŠ¡å™¨çš„å…¬é’¥åŠ å¯†ï¼Œä½¿ç”¨ Client Key Exchange å‘é€ç»™æœåŠ¡å™¨ï¼Œæ­¤å³å¯†é’¥äº¤æ¢ã€‚ å®¢æˆ·ç«¯ä½¿ç”¨ Client Random, Server Random, PreMaster Secret ç”Ÿæˆä¼šè¯å¯†é’¥ Session Keyã€‚ Change Cipher Spec å‘æœåŠ¡å™¨è¡¨æ˜Žï¼šå®¢æˆ·ç«¯å·²ç»æ‹¥æœ‰ä¼šè¯å¯†é’¥ï¼ŒæŽ¥ä¸‹æ¥å‘é€çš„æ‰€æœ‰æ•°æ®éƒ½ä¼šä½¿ç”¨ä¼šè¯å¯†é’¥åŠ å¯†ã€‚ å®¢æˆ·ç«¯è®¡ç®—å‡ºä¸€ä¸ªæ ¡éªŒæ•°æ®ï¼Œä½¿ç”¨ä¼šè¯å¯†é’¥åŠ å¯†åŽï¼Œä½œä¸º Encrypted Handshake Message1 å‘é€ç»™æœåŠ¡å™¨ã€‚ å¦‚ä¸‹å›¾ï¼Œå®¢æˆ·ç«¯å‘é€æŠ¥æ–‡ã€‚ å¦‚ä¸‹å›¾ï¼Œåœ¨ Client Key Exchange éƒ¨åˆ†å¯ä»¥çœ‹åˆ°ä½¿ç”¨æœåŠ¡å™¨çš„ RSA å…¬é’¥åŠ å¯†å‘é€çš„ PreMaster Secretã€‚ æ­¥éª¤ 4 - å¯†é’¥äº¤æ¢ï¼Œç”Ÿæˆä¼šè¯å¯†é’¥ æœåŠ¡å™¨å‘é€ `Change Cipher Spec, Encrypted Handshake Message`ã€‚ æœåŠ¡å™¨ä½¿ç”¨è‡ªå·±çš„ç§é’¥è§£å¯†å¾—åˆ° PreMaster Secretï¼Œæ­¤å³å¯†é’¥äº¤æ¢ã€‚ æœåŠ¡å™¨ä½¿ç”¨ Client Random, Server Random, PreMaster Secret ç”Ÿæˆä¼šè¯å¯†é’¥ Session Keyã€‚ æœåŠ¡å™¨ä½¿ç”¨ Session Key è§£å¯†å®¢æˆ·ç«¯å‘æ¥çš„æ ¡éªŒæ•°æ®ï¼Œå¹¶è®¡ç®—æŠ¥æ–‡å“ˆå¸Œå€¼ä¸Žæ ¡éªŒæ•°æ®è¿›è¡Œå¯¹æ¯”ã€‚ Change Cipher Spec å‘å®¢æˆ·ç«¯è¡¨æ˜Žï¼šæœåŠ¡å™¨å·²ç»æ‹¥æœ‰ä¼šè¯å¯†é’¥ï¼ŒæŽ¥ä¸‹æ¥å‘é€çš„æ‰€æœ‰æ•°æ®éƒ½ä¼šä½¿ç”¨ä¼šè¯å¯†é’¥åŠ å¯†ã€‚ æœåŠ¡å™¨è®¡ç®—å‡ºä¸€ä¸ªæ ¡éªŒæ•°æ®ï¼Œä½¿ç”¨ä¼šè¯å¯†é’¥åŠ å¯†åŽï¼Œä½œä¸º Encrypted Handshake Message2 å‘é€ç»™å®¢æˆ·ç«¯ã€‚ å¦‚ä¸‹å›¾ï¼ŒæœåŠ¡å™¨å‘é€æŠ¥æ–‡ã€‚ å¦‚ä¸‹å›¾ï¼ŒæŠ¥æ–‡ä¿¡æ¯é•¿è¿™æ ·ã€‚ æ­¥éª¤ 5 - å®Œæˆæ¡æ‰‹ï¼ŒåŠ å¯†é€šä¿¡ åŒæ–¹å‘é€ `Application Data`ã€‚ å®¢æˆ·ç«¯ä½¿ç”¨ Session Key è§£å¯†æœåŠ¡å™¨å‘æ¥çš„æ ¡éªŒæ•°æ®ï¼Œå¹¶è®¡ç®—æŠ¥æ–‡å“ˆå¸Œå€¼ä¸Žæ ¡éªŒæ•°æ®è¿›è¡Œå¯¹æ¯”ã€‚ TLS è¿žæŽ¥å»ºç«‹å®Œæˆã€‚æŽ¥ä¸‹æ¥åŒæ–¹ä½¿ç”¨ Session Key åŠ å¯†æ•°æ®ï¼Œè¿›è¡Œ HTTPS é€šä¿¡ã€‚ å¦‚ä¸‹å›¾ï¼Œå‘é€åŠ å¯†çš„ HTTP æŠ¥æ–‡ã€‚ æ­¥éª¤ 6 - æ–­å¼€è¿žæŽ¥ å®¢æˆ·ç«¯å‘é€ `Encrypted Alert`ã€‚ å®¢æˆ·ç«¯ä½¿ç”¨ Session Key åŠ å¯†ä¸€ä¸ªå‘Šè­¦ä¿¡æ¯ï¼Œå‘é€ Encrypted Alert3 ä»¥æ–­å¼€ TLS è¿žæŽ¥ã€‚åŽç»­å†å…³é—­ TCP çš„è¿žæŽ¥ã€‚ åŸºäºŽ ECDHE ç®—æ³• åœ¨ RSA æ¡æ‰‹ä¸­ï¼ŒPreMaster Secret ç”±å®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡å™¨ï¼Œä»Žè€Œå®Œæˆå¯†é’¥äº¤æ¢ï¼›è€Œåœ¨ DH ç®—æ³•ä¸­ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åŸºäºŽæ•°å­¦åŽŸç†ï¼Œæ ¹æ®ä¸€äº›å…¬å¼€çš„ä¿¡æ¯ç›´æŽ¥åœ¨å„è‡ªçš„æœ¬åœ°è®¡ç®—å‡º PreMaster Secretï¼Œè¿žç½‘ç»œä¼ è¾“éƒ½ç»™å¹²æŽ‰äº†ï¼Œæ‰€ä»¥ DH ç®—æ³•æ›´åŠ å®‰å…¨ã€‚ DH ç®—æ³•ç®€ä»‹ åŽŸç† DH ç®—æ³•æ˜¯ä¸€ç§å¯†é’¥äº¤æ¢ç®—æ³•ï¼Œæˆ‘ä»¬ä¸ç®¡æ•°å­¦ç»†èŠ‚ï¼Œæžç®€é˜è¿°åŽŸç†ï¼š 1 2 3 4 5 6 # å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å„æŒæœ‰ä¸€å¯¹ DH å…¬ç§é’¥ï¼Œä½¿ç”¨å®ƒä»¬å„è‡ªçš„ç§é’¥å’Œå¯¹ç«¯çš„å…¬é’¥å¯ä»¥ç”Ÿæˆä¸€ä¸ªä¼šè¯å¯†é’¥ï¼Œ # è€Œä¸¤ç«¯å„è‡ªç”Ÿæˆçš„ä¼šè¯å¯†é’¥åœ¨æ•°å­¦ä¸Šè¢«è¯æ˜Žæ˜¯ç›¸ç­‰çš„ã€‚æ¢è¨€ä¹‹ï¼Œåªè¦ä¸¤ç«¯äº’ç›¸äº¤æ¢å…¬é’¥å°±å¯ä»¥å®žçŽ° # æ— éœ€ç½‘ç»œä¼ è¾“çš„ä¼šè¯å¯†é’¥äº¤æ¢ã€‚ client-session-key = dh(client-private-key, server-public-key) server-session-key = dh(server-private-key, client-public-key) session-key = client-session-key = server-session-key åˆ†ç±» DH ç®—æ³•åŸºäºŽç¦»æ•£å¯¹æ•°é—®é¢˜è€Œè¯žç”Ÿï¼Œæ ¹æ®ç¦»æ•£å¯¹æ•°çš„è®¡ç®—æ–¹å¼ï¼ˆè§æ•°å­¦éš¾é¢˜ï¼‰å¯ä»¥åˆ†ä¸ºï¼š ä¸€èˆ¬çš„ DH ç®—æ³• ECDH ç®—æ³• æ ¹æ® DH çš„ç§é’¥æ˜¯å¦å›ºå®šï¼Œå¯ä»¥åˆ†ä¸ºï¼š Static DH Ephemeral DH(DHE) åœ¨ Static DH ç®—æ³•ä¸­ï¼ŒæœåŠ¡å™¨æ¯æ¬¡è¿žæŽ¥æ‰€ä½¿ç”¨çš„ DH ç§é’¥æ˜¯ä¸å˜çš„ï¼Œåº”è¯¥æ˜¯ç›´æŽ¥ä½¿ç”¨çš„ä¸Žå…¬é’¥è¯ä¹¦æˆå¯¹çš„é‚£ä¸ªç§é’¥ï¼Œé•¿æœŸä½¿ç”¨å®¹æ˜“æ³„éœ²ï¼Œä¸€æ—¦æ³„éœ²ï¼Œé»‘å®¢å°±èƒ½è§£å¯†å½“å‰å’Œä»¥å¾€æ¯æ¬¡è¿žæŽ¥çš„é€šä¿¡ï¼Œè¿™æ ·çš„ç®—æ³•ä¸å…·å¤‡å‰å‘å®‰å…¨æ€§ï¼›è€Œåœ¨ Ephemeral DH ç®—æ³•ä¸­ï¼ŒæœåŠ¡å™¨ä¼šä¸ºæ¯æ¬¡è¿žæŽ¥é‡æ–°ç”Ÿæˆä¸€ä¸ªä¸´æ—¶çš„ DH ç§é’¥ï¼Œè¿™æ ·å°±ç®—ç§é’¥æ³„éœ²ï¼Œä¹Ÿåªèƒ½è§£å¯†è¿™ä¸€æ¬¡è¿žæŽ¥çš„é€šä¿¡ï¼Œæ— æ³•è§£å¯†ä»¥å¾€çš„é€šä¿¡ï¼Œæ‰€ä»¥ç®—æ³•å…·å¤‡å‰å‘å®‰å…¨æ€§ã€‚ ECDHE æ¡æ‰‹æµç¨‹ æ­¥éª¤ 1 - å‘èµ·è¿žæŽ¥ï¼Œåå•†å‚æ•° å®¢æˆ·ç«¯å‘é€ `Client Hello`ã€‚ åŒ RSA æ¡æ‰‹ã€‚ æ­¥éª¤ 2 - åå•†å‚æ•°ï¼Œå‘é€è¯ä¹¦å’Œ ECDH ä¿¡æ¯ æœåŠ¡å™¨å‘é€ `Server Hello, Certificate, Server Key Exchange, Server Hello Done`ã€‚ ç›¸æ¯” RSA æ¡æ‰‹ï¼Œå¤šäº†ä¸€ä¸ª Server Key Exchangeï¼Œé˜è¿°å¦‚ä¸‹ã€‚ åœ¨è¿™æ­¥ï¼ŒæœåŠ¡å™¨ä¼šé€‰æ‹©ä¸€ç§æ¤­åœ†æ›²çº¿ï¼Œç”Ÿæˆä¸€å¯¹ ECDH å…¬ç§é’¥ï¼Œå¹¶ä½¿ç”¨ Server Private Key å¯¹ Client Random, Server Random, Curve Info, Server DH Public Key çš„ç»„åˆè¿›è¡Œç­¾åï¼Œæœ€åŽå°†æ›²çº¿ä¿¡æ¯ã€ECDH å…¬é’¥ã€ç­¾åéƒ½åŒ…å«è¿› Server Key Exchange ä¸­ã€‚ 1 2 3 signature = server-private-key( hash(client-random, server-random, curve-info, server-dh-public-key) ) æ­¤å¤„ç­¾åå’ŒåŽç»­éªŒç­¾çš„æ„ä¹‰åœ¨äºŽè¯æ˜Ž ECDH ä¿¡æ¯çš„ç¡®æ˜¯ç”±è¯ä¹¦ä¸­çš„å…¬é’¥æ‰€ä»£è¡¨çš„æœåŠ¡å™¨å‘é€çš„ã€‚ æœåŠ¡å™¨æ˜¯åå•†é€‰æ‹©æ¤­åœ†æ›²çº¿çš„ã€‚å®¢æˆ·ç«¯ä¼šé€šè¿‡ elliptic_curves æˆ– supported_groups æ‰©å±•å­—æ®µå‘é€å…¶æ”¯æŒçš„å…¨éƒ¨æ›²çº¿ï¼ŒéšåŽæœåŠ¡å™¨å†ä»Žä¸­é€‰æ‹©ä¸€ä¸ªã€‚éšç€æ ‡å‡†çš„ä¸æ–­å‘å±•ï¼Œelliptic_curves å·²ç»é€æ­¥è¢« supported_groups å–ä»£ã€‚å›  TLS ç‰ˆæœ¬çš„ä¸åŒï¼Œä¸Šè¿°è¯´æ³•å­˜åœ¨ä¸€äº›ç»†èŠ‚å‡ºå…¥ï¼Œä½†å¤§ä½“ä¸Šæ²¡é—®é¢˜ã€‚ å¦‚ä¸‹å›¾ï¼ŒæœåŠ¡å™¨å‘é€æŠ¥æ–‡ã€‚ å¦‚ä¸‹å›¾ï¼ŒæœåŠ¡å™¨é€‰æ‹©äº†ç®—æ³• TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256ã€‚è¿™é‡Œæˆ‘ä»¬æœåŠ¡å™¨çš„å¯†é’¥å¯¹æ˜¯ ECC å¯†é’¥å¯¹ï¼Œæ‰€ä»¥åå•†é€‰æ‹©äº† ECDSA ç­¾åç®—æ³•ã€‚ å¦‚ä¸‹å›¾ï¼ŒæœåŠ¡å™¨å‘é€äº†è‡ªå·±çš„è¯ä¹¦ï¼Œè¯¥è¯ä¹¦è¢« CA ç­¾åï¼Œç­¾åç®—æ³•æ˜¯ ECDSAï¼Œå“ˆå¸Œç®—æ³•æ˜¯ SHA256ã€‚è¿™é‡Œæˆ‘ä»¬ CA çš„å¯†é’¥å¯¹ä¹Ÿæ˜¯ ECC å¯†é’¥å¯¹ï¼Œä½¿ç”¨çš„ ECDSA ç®—æ³•ç­¾å‘çš„å…¬é’¥è¯ä¹¦ã€‚ å¦‚ä¸‹å›¾ï¼ŒæœåŠ¡å™¨å‘é€äº†è‡ªå·±ç”Ÿæˆçš„ ECDH å…¬é’¥ï¼Œå…¶é‡‡ç”¨çš„ ECC æ›²çº¿ä¸º Named Curve: secp256r1 (0x0017)ã€‚è®¡ç®—å‡ºçš„æ•°å­—ç­¾åä¹Ÿè¢«å‘é€ï¼Œç”±äºŽæœåŠ¡å™¨çš„ç§é’¥æ˜¯ ECC çš„ï¼Œæ‰€ä»¥ç­¾åç®—æ³•é€‰æ‹©äº† ECDSAã€‚ æ­¥éª¤ 3 - èº«ä»½è®¤è¯ï¼Œå¯†é’¥äº¤æ¢ï¼Œç”Ÿæˆä¼šè¯å¯†é’¥ å®¢æˆ·ç«¯å‘é€ `Client Key Exchange, Change Cipher Spec, Encrypted Handshake Message`ã€‚ å®¢æˆ·ç«¯ä»Ž Server Hello ä¸­èŽ·å¾—éšæœºæ•° Server Randomã€‚ å®¢æˆ·ç«¯ä½¿ç”¨ CA çš„è¯ä¹¦ï¼ˆä¸€èˆ¬å·²é¢„ç½®åœ¨æµè§ˆå™¨ä¸­ï¼‰éªŒè¯æœåŠ¡å™¨çš„è¯ä¹¦ï¼Œç”±æ­¤è¯æ˜ŽæœåŠ¡å™¨çš„èº«ä»½å€¼å¾—ä¿¡èµ–ï¼Œè¯ä¹¦ä¸­çš„å…¬é’¥çš„ç¡®ä»£è¡¨æœåŠ¡å™¨çš„èº«ä»½ï¼Œæ­¤å³èº«ä»½è®¤è¯ã€‚ å®¢æˆ·ç«¯ä½¿ç”¨è¯ä¹¦ä¸­çš„å…¬é’¥éªŒè¯ Server Key Exchange ä¸­çš„ç­¾åï¼Œç”±æ­¤è¯æ˜Ž ECDH ä¿¡æ¯çš„å‘é€è€…çš„ç¡®æ˜¯å…¬é’¥æ‰€ä»£è¡¨çš„æœåŠ¡å™¨ï¼Œæ­¤å³èº«ä»½è®¤è¯ã€‚ å®¢æˆ·ç«¯åŸºäºŽæœåŠ¡å™¨é€‰æ‹©çš„æ›²çº¿ç”Ÿæˆä¸€å¯¹ ECDH å…¬ç§é’¥ã€‚ å®¢æˆ·ç«¯å°†ç”Ÿæˆçš„ Client DH Public Key æ”¾å…¥ Client Key Exchange ä»¥å‘é€ç»™æœåŠ¡å™¨ã€‚ å®¢æˆ·ç«¯ä½¿ç”¨ Client DH Private Key, Server DH Public Key ç›´æŽ¥åœ¨æœ¬åœ°è®¡ç®—å‡º PreMaster Secretï¼ŒåŽç»­æœåŠ¡å™¨ä¹Ÿä¼šç›´æŽ¥åœ¨æœ¬åœ°è®¡ç®—å‡ºåŒæ ·çš„ PreMaster Secretï¼Œæ­¤å³å¯†é’¥äº¤æ¢ã€‚ å®¢æˆ·ç«¯ä½¿ç”¨ Client Random, Server Random, PreMaster Secret ç”Ÿæˆä¼šè¯å¯†é’¥ Session Keyã€‚ åŒ RSA æ¡æ‰‹ï¼Œå‘é€ Change Cipher Spec å’Œ Encrypted Handshake Message1ã€‚ å¦‚ä¸‹å›¾ï¼Œåœ¨ Client Key Exchange éƒ¨åˆ†å¯ä»¥çœ‹åˆ°å‘é€çš„ Client DH Public Keyã€‚ æ­¥éª¤ 4 - å¯†é’¥äº¤æ¢ï¼Œç”Ÿæˆä¼šè¯å¯†é’¥ æœåŠ¡å™¨å‘é€ `Change Cipher Spec, Encrypted Handshake Message`ã€‚ æœåŠ¡å™¨ä½¿ç”¨ Client DH Public Key, Server DH Private Key ç›´æŽ¥åœ¨æœ¬åœ°è®¡ç®—å‡ºä¸Žå®¢æˆ·ç«¯ä¸€è‡´çš„ PreMaster Secretï¼Œæ­¤å³å¯†é’¥äº¤æ¢ã€‚ æœåŠ¡å™¨ä½¿ç”¨ Client Random, Server Random, PreMaster Secret ç”Ÿæˆä¼šè¯å¯†é’¥ Session Keyã€‚ æœåŠ¡å™¨ä½¿ç”¨ Session Key è§£å¯†å®¢æˆ·ç«¯å‘æ¥çš„æ ¡éªŒæ•°æ®ï¼Œå¹¶è®¡ç®—æŠ¥æ–‡å“ˆå¸Œå€¼ä¸Žæ ¡éªŒæ•°æ®è¿›è¡Œå¯¹æ¯”ã€‚ åŒ RSA æ¡æ‰‹ï¼Œå‘é€ Change Cipher Spec å’Œ Encrypted Handshake Message2ã€‚ æ­¥éª¤ 5 - å®Œæˆæ¡æ‰‹ï¼ŒåŠ å¯†é€šä¿¡ åŒæ–¹å‘é€ `Application Data`ã€‚ åŒ RSA æ¡æ‰‹ã€‚ æ­¥éª¤ 6 - æ–­å¼€è¿žæŽ¥ å®¢æˆ·ç«¯å‘é€ `Encrypted Alert`ã€‚ åŒ RSA æ¡æ‰‹ã€‚ è¡¥å……è¯´æ˜Ž æ ¡éªŒæ•°æ® Finished Message The Illustrated TLS Connection: Every Byte Explained è¾ƒä¸ºè¯¦ç»†åœ°å±•ç¤ºäº† ECDHE æ¡æ‰‹çš„æµç¨‹ï¼Œå…¶è¯´æ³•å¦‚ä¸‹ï¼š 1 The verification data is built from a hash of all handshake messages and verifies the integrity of the handshake process. RFC5246 The Transport Layer Security (TLS) Protocol Version 1.2 çš„è¯´æ³•å¦‚ä¸‹ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 # 7.4.9 Finished The value handshake_messages includes all handshake messages starting at ClientHello up to, but not including, this Finished message. This may be different from handshake_messages in Section 7.4.8 because it would include the CertificateVerify message (if sent). Also, the handshake_messages for the Finished message sent by the client will be different from that for the Finished message sent by the server, because the one that is sent second will include the prior one. Note: ChangeCipherSpec messages, alerts, and any other record types are not handshake messages and are not included in the hash computations. Also, HelloRequest messages are omitted from handshake hashes. æ®æ­¤çŒœæµ‹ï¼Œæœ¬æ–‡ä¾‹å­ä¸­ï¼Œå‚ä¸Žå“ˆå¸Œçš„æŠ¥æ–‡åŒºé—´å¤§æ¦‚æ˜¯ [Client Hello, Client/Server Finished), Exclude(Change Cipher Spec)ã€‚ MAC æ‘˜è¦ æ‰€æœ‰ä½¿ç”¨ Session Key åŠ å¯†çš„æ•°æ®ï¼Œå…¶å†…éƒ½åŒ…å«äº†ä¸€ä¸ªåä¸º MAC (Message Authentication Code) çš„æŠ¥æ–‡æ‘˜è¦ã€‚MAC æœ‰å¤šç§å®žçŽ°ï¼Œæ¯”å¦‚ HMAC å’Œ GMACã€‚ HMAC å’Œ GMAC çš„ç‰¹ç‚¹ï¼ˆAIï¼‰ï¼š HMAC åŸºäºŽå“ˆå¸Œå‡½æ•°ï¼ˆå¦‚ SHA256ï¼‰ é€‚ç”¨äºŽé€šç”¨åœºæ™¯ éœ€è¦æ˜¾å¼åœ°ä¸ŽåŠ å¯†ç®—æ³•ï¼ˆå¦‚ AES-CBCï¼‰ç»“åˆä½¿ç”¨ GMAC åŸºäºŽ Galois åŸŸè¿ç®— ä¸“ä¸º GCM æ¨¡å¼è®¾è®¡ï¼Œé€šå¸¸ä¸Ž AES-GCM ç»“åˆä½¿ç”¨ã€‚ æä¾›æ›´é«˜çš„æ€§èƒ½ï¼Œå°¤å…¶æ˜¯åœ¨ç¡¬ä»¶åŠ é€Ÿçš„åœºæ™¯ä¸­ã€‚ å…·ä½“æœºåˆ¶æœ¬æ–‡ä¸ç ”ç©¶ï¼Œæˆ‘çš„ç†è§£æ˜¯æ•°æ®å’Œ MAC ä¸€èµ·è¢«åŠ å¯†ä¼ è¾“ï¼Œå¯¹ç«¯è§£å¯†åŽï¼Œå†è®¡ç®—æ•°æ®çš„ MAC ä¸ŽæŽ¥æ”¶åˆ°çš„ MAC å€¼å¯¹æ¯”ï¼Œä»Žè€ŒæŽ¢çŸ¥æ•°æ®æ˜¯å¦è¢«ç¯¡æ”¹ï¼Œæ­¤å³å®Œæ•´æ€§æ ¡éªŒã€‚ è¯•è®¡ç®— Server Key Exchange ä¸­çš„ç­¾åå¹¶éªŒç­¾ åœ¨ ECDHE æ¡æ‰‹-æ­¥éª¤ 2 ä¸­ï¼Œæˆ‘ä»¬æåˆ°ç­¾åæ˜¯å¯¹ Client Random, Server Random, Curve Info, Server DH Public Key çš„ç»„åˆè¿›è¡Œçš„ã€‚ä¿¡æ¯æ”¶é›†å¦‚ä¸‹ï¼š 1 2 # client random \x5b\x70\x1c\x25\x8a\xf4\x56\x6a\x81\xa7\xee\xcf\xa0\x9f\xbb\xcb\x35\xfd\x64\xae\xe5\xb0\x46\x03\xda\x92\x4e\xa0\x07\x79\x35\x2a 1 2 # server random \xcc\x26\xf9\x66\x00\x00\x00\x00\x67\x78\x0a\x00\x00\x00\x00\x00\x3f\x00\x00\x00\x3f\x00\x00\x00\x3f\x00\x00\x00\x3f\x00\x00\x00 1 2 3 4 5 6 # curve info \x03\x00\x17 # server dh public key \x41 \x04\x39\x3b\x76\x31\x87\x80\xe0\x0b\x27\xd4\xe7\xc4\x95\x27\x9c\x2f\xeb\x96\xa6\xe8\xd9\x87\x42\x2e\xce\xac\x84\xa2\x68\xda\x6f\x6f\x08\x05\xaa\xf9\x5d\x23\xa0\x24\xd1\x25\x30\x84\x11\x55\xcb\xe9\x69\xeb\xfb\xcf\xa8\xbd\xf8\x96\x8a\x0a\x7e\xad\x1c\xef\x84\xa8 å°†è¿™äº›æ•°æ®åˆå¹¶åœ¨ä¸€èµ·ï¼š 1 2 # compose the data together echo -n &quot;\x5b\x70\x1c\x25\x8a\xf4\x56\x6a\x81\xa7\xee\xcf\xa0\x9f\xbb\xcb\x35\xfd\x64\xae\xe5\xb0\x46\x03\xda\x92\x4e\xa0\x07\x79\x35\x2a\xcc\x26\xf9\x66\x00\x00\x00\x00\x67\x78\x0a\x00\x00\x00\x00\x00\x3f\x00\x00\x00\x3f\x00\x00\x00\x3f\x00\x00\x00\x3f\x00\x00\x00\x03\x00\x17\x41\x04\x39\x3b\x76\x31\x87\x80\xe0\x0b\x27\xd4\xe7\xc4\x95\x27\x9c\x2f\xeb\x96\xa6\xe8\xd9\x87\x42\x2e\xce\xac\x84\xa2\x68\xda\x6f\x6f\x08\x05\xaa\xf9\x5d\x23\xa0\x24\xd1\x25\x30\x84\x11\x55\xcb\xe9\x69\xeb\xfb\xcf\xa8\xbd\xf8\x96\x8a\x0a\x7e\xad\x1c\xef\x84\xa8&quot; &gt; data æœåŠ¡å™¨æœ¬èº«çš„ç§é’¥ä¹Ÿè´´åœ¨æ­¤å¤„ï¼Œæ–‡ä»¶ä»¥ \n ç»“å°¾ã€‚è¿™æ˜¯ä¸€ä¸ªåŸºäºŽæ›²çº¿ prime256v1(secp256r1) çš„ ECC ç§é’¥ã€‚ 1 2 3 4 5 6 7 8 9 10 # server private key -----BEGIN EC PARAMETERS----- BggqhkjOPQMBBw== -----END EC PARAMETERS----- -----BEGIN EC PRIVATE KEY----- MHcCAQEEIIshQQR4px7Ek+5jRugTnySv5cjqSs1PbDlnmR1SSC4joAoGCCqGSM49 AwEHoUQDQgAE4Q+9ZBPkV4b2buqwPLB9EskoGByXTcPuF22znhtFG2R9gVlFyU4S 3GyXx3QaFOfLLNdyl/puch+GlZAZZsYKPw== -----END EC PRIVATE KEY----- å…¶åå…­è¿›åˆ¶ä¸ºï¼š 1 2 3 # server private key hex xxd -ps server-ecc-key.pem | tr -d &quot;\n&quot; | sed &#39;s/\(..\)/\\x\1/g&#39; \x2d\x2d\x2d\x2d\x2d\x42\x45\x47\x49\x4e\x20\x45\x43\x20\x50\x41\x52\x41\x4d\x45\x54\x45\x52\x53\x2d\x2d\x2d\x2d\x2d\x0a\x42\x67\x67\x71\x68\x6b\x6a\x4f\x50\x51\x4d\x42\x42\x77\x3d\x3d\x0a\x2d\x2d\x2d\x2d\x2d\x45\x4e\x44\x20\x45\x43\x20\x50\x41\x52\x41\x4d\x45\x54\x45\x52\x53\x2d\x2d\x2d\x2d\x2d\x0a\x2d\x2d\x2d\x2d\x2d\x42\x45\x47\x49\x4e\x20\x45\x43\x20\x50\x52\x49\x56\x41\x54\x45\x20\x4b\x45\x59\x2d\x2d\x2d\x2d\x2d\x0a\x4d\x48\x63\x43\x41\x51\x45\x45\x49\x49\x73\x68\x51\x51\x52\x34\x70\x78\x37\x45\x6b\x2b\x35\x6a\x52\x75\x67\x54\x6e\x79\x53\x76\x35\x63\x6a\x71\x53\x73\x31\x50\x62\x44\x6c\x6e\x6d\x52\x31\x53\x53\x43\x34\x6a\x6f\x41\x6f\x47\x43\x43\x71\x47\x53\x4d\x34\x39\x0a\x41\x77\x45\x48\x6f\x55\x51\x44\x51\x67\x41\x45\x34\x51\x2b\x39\x5a\x42\x50\x6b\x56\x34\x62\x32\x62\x75\x71\x77\x50\x4c\x42\x39\x45\x73\x6b\x6f\x47\x42\x79\x58\x54\x63\x50\x75\x46\x32\x32\x7a\x6e\x68\x74\x46\x47\x32\x52\x39\x67\x56\x6c\x46\x79\x55\x34\x53\x0a\x33\x47\x79\x58\x78\x33\x51\x61\x46\x4f\x66\x4c\x4c\x4e\x64\x79\x6c\x2f\x70\x75\x63\x68\x2b\x47\x6c\x5a\x41\x5a\x5a\x73\x59\x4b\x50\x77\x3d\x3d\x0a\x2d\x2d\x2d\x2d\x2d\x45\x4e\x44\x20\x45\x43\x20\x50\x52\x49\x56\x41\x54\x45\x20\x4b\x45\x59\x2d\x2d\x2d\x2d\x2d\x0a çŽ°åœ¨ä½¿ç”¨ç§é’¥å¯¹æ•°æ®ç­¾åï¼Œopenssl ä¼šæ ¹æ®ç§é’¥ç±»åž‹è‡ªåŠ¨é€‰æ‹©ç›¸åº”çš„ç­¾åç®—æ³•ï¼Œå¯¹äºŽ ECC ç§é’¥ï¼Œä¼šé»˜è®¤é€‰æ‹© ECDSA ç®—æ³•ã€‚æŠ¥æ–‡ä¸­å®žé™…ä½¿ç”¨çš„ç­¾åç®—æ³•ä¸º ecdsa_secp256r1_sha256ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ -sha256ï¼Œä½¿å“ˆå¸Œç®—æ³•ä¹Ÿä¿æŒä¸€è‡´ã€‚ 1 2 3 4 5 6 7 8 9 10 # sign the data with the server private key openssl dgst -sign server-ecc-key.pem -sha256 -out sig data # see the signature xxd -ps sig # result: 3044022020b6c7803f90785be49b6d70744f82bc7a421718da24e39abb74 3505fe23882b02203b56f27ca41156b86948f658e07eda922f06dc6c4284 bbd179c6da108a48b4e5 è‡³æ­¤æˆ‘ä»¬å¾—åˆ°äº†ç­¾åï¼Œä½†æ˜¯è¯¥ç­¾åä¸ŽæŠ¥æ–‡ä¸­çš„å®žé™…å€¼å¹¶ä¸ç›¸åŒã€‚ä¸ä»…å¦‚æ­¤ï¼Œä½ ä¼šå‘çŽ°æ¯æ¬¡ç­¾åå¾—åˆ°çš„ç»“æžœéƒ½æ˜¯ä¸åŒçš„ã€‚è¿™æ˜¯å› ä¸º ECDSA ç­¾åç®—æ³•å†…éƒ¨æ··å…¥äº†éšæœºå€¼ï¼Œå³ä¾¿ä½¿ç”¨åŒä¸€ç§é’¥å¯¹åŒä¸€æ¶ˆæ¯è¿›è¡Œå¤šæ¬¡ç­¾åï¼Œç»“æžœä¹Ÿä¼šä¸åŒã€‚ å¦‚æžœæ˜¯ RSA ç§é’¥ï¼Œé‚£ä¹ˆè®¡ç®—å¾—åˆ°çš„ RSA ç­¾åæ˜¯å¯ä»¥ä¸ŽæŠ¥æ–‡ä¸­çš„å®žé™…å€¼å¯¹ä¸Šçš„ã€‚ä½¿ç”¨åŒä¸€ç§é’¥å¯¹åŒä¸€æ¶ˆæ¯è¿›è¡Œå¤šæ¬¡ç­¾åï¼Œç»“æžœæ˜¯ç›¸åŒçš„ã€‚ ä¸è¿‡è¿™å¹¶ä¸ä¼šå½±å“éªŒç­¾çš„ç»“æžœã€‚ä¸‹é¢æˆ‘ä»¬è¿›è¡ŒéªŒç­¾ã€‚ å®žé™…éªŒç­¾æ—¶ï¼Œå®¢æˆ·ç«¯ä¼šä»ŽæœåŠ¡å™¨è¯ä¹¦ä¸­æå–å‡ºå…¬é’¥ã€‚å¦‚ä¸‹ï¼Œæ–‡ä»¶ä»¥ \n ç»“å°¾ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 # extract the public key from the server certificate openssl x509 -in server-ecc-cert.pem -pubkey -noout &gt; server-ecc-pub.pem # server public key -----BEGIN PUBLIC KEY----- MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAE4Q+9ZBPkV4b2buqwPLB9EskoGByX TcPuF22znhtFG2R9gVlFyU4S3GyXx3QaFOfLLNdyl/puch+GlZAZZsYKPw== -----END PUBLIC KEY----- # server public key hex xxd -ps server-ecc-pub.pem | tr -d &quot;\n&quot; | sed &#39;s/\(..\)/\\x\1/g&#39; \x2d\x2d\x2d\x2d\x2d\x42\x45\x47\x49\x4e\x20\x50\x55\x42\x4c\x49\x43\x20\x4b\x45\x59\x2d\x2d\x2d\x2d\x2d\x0a\x4d\x46\x6b\x77\x45\x77\x59\x48\x4b\x6f\x5a\x49\x7a\x6a\x30\x43\x41\x51\x59\x49\x4b\x6f\x5a\x49\x7a\x6a\x30\x44\x41\x51\x63\x44\x51\x67\x41\x45\x34\x51\x2b\x39\x5a\x42\x50\x6b\x56\x34\x62\x32\x62\x75\x71\x77\x50\x4c\x42\x39\x45\x73\x6b\x6f\x47\x42\x79\x58\x0a\x54\x63\x50\x75\x46\x32\x32\x7a\x6e\x68\x74\x46\x47\x32\x52\x39\x67\x56\x6c\x46\x79\x55\x34\x53\x33\x47\x79\x58\x78\x33\x51\x61\x46\x4f\x66\x4c\x4c\x4e\x64\x79\x6c\x2f\x70\x75\x63\x68\x2b\x47\x6c\x5a\x41\x5a\x5a\x73\x59\x4b\x50\x77\x3d\x3d\x0a\x2d\x2d\x2d\x2d\x2d\x45\x4e\x44\x20\x50\x55\x42\x4c\x49\x43\x20\x4b\x45\x59\x2d\x2d\x2d\x2d\x2d\x0a ä½¿ç”¨å…¬é’¥éªŒç­¾ã€‚ 1 2 3 # verify the signature openssl dgst -verify server-ecc-pub.pem -signature sig -sha256 data Verified OK éªŒè¯é€šè¿‡ã€‚ ä¸ºä»€ä¹ˆéªŒç­¾è¦ä½¿ç”¨è¯ä¹¦è€Œä¸èƒ½ç›´æŽ¥ä½¿ç”¨å…¬é’¥ï¼Ÿ çŽ°æœ‰ä¸¤ä¸ªäºº A å’Œ Bï¼ŒB ç”¨è‡ªå·±çš„ç§é’¥ç­¾åäº†ä¸€æ®µä¿¡æ¯ï¼Œå‘ç»™ Aã€‚çŽ°åœ¨ A ç”¨ B çš„å…¬é’¥éªŒç­¾ï¼Œå‘çŽ°èƒ½å¤ŸæˆåŠŸè§£å¯†ï¼Œæ‰€ä»¥ä»¥æ­¤è®¤å®šä¿¡æ¯çš„å‘é€è€…æ˜¯ Bã€‚è¿™ä¼¼ä¹Žæ²¡æœ‰é—®é¢˜ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦å…¬é’¥è¯ä¹¦å‘¢ï¼Ÿ é—®é¢˜çš„å…³é”®åœ¨äºŽï¼ŒB çš„å…¬é’¥æ˜¯å¦å¯ä¿¡ï¼ŒB çš„å…¬é’¥æ˜¯å¦çœŸçš„æ˜¯ B çš„å…¬é’¥ã€‚å¦‚æžœæœ‰ä¸­é—´äººæ”»å‡»ï¼Œæ”»å‡»è€… C æŽ‰åŒ…äº† B çš„å…¬é’¥ä¸ºè‡ªå·±çš„å…¬é’¥ï¼Œç„¶åŽè‡ªå·±ç­¾åå‘é€ä¸€æ®µä¿¡æ¯ç»™ Aï¼Œé‚£ä¹ˆ A å°±ä¼šè¯¯ä»¥ä¸ºä¿¡æ¯çš„å‘é€è€…æ˜¯ Bï¼Œè€Œå®žé™…å‘é€è€…å´æ˜¯ Aã€‚ æ‰€ä»¥ï¼Œæœ‰å¿…è¦ç¡®ä¿å…¬é’¥çš„ç¡®æ˜¯ B çš„ï¼Œè€Œè¯ä¹¦èƒ½å¤Ÿè¯æ˜Žè¿™ä¸€ç‚¹ã€‚è¯ä¹¦ç”±å¹¿å—ç¤¾ä¼šä¿¡ä»»çš„ CA ç­¾å‘ï¼Œå…¶ä¸­åŒ…å«äº†å…¬é’¥æœ¬èº«å’Œå…¬é’¥æ‰€ä»£è¡¨çš„èº«ä»½ä¿¡æ¯ã€‚A åœ¨æ”¶åˆ° B çš„è¯ä¹¦åŽï¼Œä½¿ç”¨ CA çš„è¯ä¹¦éªŒè¯ B çš„è¯ä¹¦ï¼ŒéªŒè¯é€šè¿‡å³ä»£è¡¨ B çš„è¯ä¹¦çš„ç¡®æ˜¯ç”± CA ç­¾å‘çš„ï¼ŒCA ä¿¡ä»» B çš„èº«ä»½ï¼Œè€Œ CA æ˜¯å¹¿å—ä¿¡ä»»çš„ï¼ŒA è‡ªç„¶ä¹Ÿä¿¡ä»» CAï¼ŒäºŽæ˜¯ A å¯ä»¥ä¿¡ä»» B çš„èº«ä»½ï¼Œä¹Ÿå³ï¼šåªè¦éªŒè¿‡äº†è¯ä¹¦ï¼Œå°±å¯ä»¥ç›¸ä¿¡å…¬é’¥æ‰€ä»£è¡¨çš„èº«ä»½ï¼Œå°±è¯æ˜Žå…¬é’¥çš„ç¡®å±žäºŽå®ƒæ‰€ä»£è¡¨çš„é‚£ä¸ªèº«ä»½æœºæž„ã€‚ å³ä¾¿æ”»å‡»è€…æŽ‰åŒ… B çš„å…¬é’¥ï¼Œä»–ä¹Ÿæ— æ³•ä¼ªé€  CA çš„ç­¾åï¼Œæ‰€ä»¥æ”»å‡»è€…æ˜¯æ— æ³•ä¼ªé€ è¯ä¹¦çš„ã€‚è¯ä¹¦/ä¿¡ä»»é“¾æœºåˆ¶ä»¥ CA è¿™æ ·çš„ç¬¬ä¸‰æ–¹æƒå¨æœºæž„ä½œèƒŒä¹¦ï¼Œèƒ½å¤Ÿé˜²èŒƒä¸­é—´äººæ”»å‡»ï¼Œç¡®ä¿å…¬é’¥çš„çœŸå®žæ€§ã€‚ å¯¹äºŽä»¥ä¸‹æƒ…å†µï¼š A å’Œ B æ˜¯å¥½å‹ï¼ŒçŽ°åœ¨å°±é¢å¯¹é¢ç«™ç€äº¤æŽ¥å…¬é’¥ã€‚ B ä»¥ç”¨æˆ·åå¯†ç çš„æ–¹å¼å·²ç»é€šè¿‡äº† A çš„èº«ä»½è®¤è¯ï¼Œå†äº¤æŽ¥å…¬é’¥ã€‚ A èƒ½å¤Ÿç›´æŽ¥ä¿¡ä»» Bï¼Œç›´æŽ¥è®¤å¯å…¬é’¥çš„çœŸå®žæ€§ï¼Œè¿™å°±ä¸éœ€è¦è¯ä¹¦äº†ã€‚A ä»¥åŽç›´æŽ¥ä½¿ç”¨å…¬é’¥éªŒç­¾å³å¯ã€‚ç„¶è€Œï¼Œåœ¨å¼€æ”¾çš„ç½‘ç»œé€šä¿¡ä¸­ï¼Œè¯ä¹¦/ä¿¡ä»»é“¾æœºåˆ¶ä¸å¯æˆ–ç¼ºã€‚ TLS ç®—æ³•åç§°çš„å«ä¹‰ åœ¨ç†Ÿæ‚‰äº†æ¡æ‰‹çš„çŸ¥è¯†ä»¥åŽï¼Œæˆ‘ä»¬å†æ¥ç†è§£ç®—æ³•åç§°çš„å«ä¹‰ã€‚è¿™å¹¶æ²¡æœ‰æƒ³è±¡ä¸­é‚£ä¹ˆç®€å•ï¼Œç”±äºŽç®—æ³•ç‰ˆæœ¬çš„æ›´è¿­ï¼Œç®—æ³•åç§°çš„å«ä¹‰ä¼šæœ‰ä¸€äº›å·®åˆ«ã€‚å…ˆè´´ä¸Šå‡ ä¸ªç®—æ³•åç§°çš„ä¾‹å­ï¼š 1 2 3 4 5 6 7 8 9 TLS_RSA_WITH_AES_256_CBC_SHA256 TLS_RSA_WITH_AES_128_GCM_SHA256 TLS_RSA_WITH_AES_256_GCM_SHA384 TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256 TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384 TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 TLS_ECDH_RSA_WITH_AES_256_CBC_SHA TLS_ECDH_ECDSA_WITH_AES_256_CBC_SHA SHA æ˜¯æŒ‡ HMAC è®¡ç®—ä»¥åŠ Finished æ ¡éªŒç­‰æµç¨‹æ‰€ä½¿ç”¨çš„å“ˆå¸Œç®—æ³•ï¼ŒCBC/GCM æ˜¯åˆ†ç»„å¯†ç å·¥ä½œæ¨¡å¼ï¼ŒAES_256 æ˜¯å…±äº«å¯†ç ç®—æ³•å’Œå…±äº«å¯†é’¥é•¿åº¦ã€‚ç´§è·Ÿåœ¨ TLS åŽé¢çš„ RSA/ECDHE/ECDH æ˜¯å¯†é’¥äº¤æ¢ç®—æ³•ï¼Œå…¶ä¸­ DHE å¯†é’¥äº¤æ¢è¿‡ç¨‹ä¸­ä¼šç”¨åˆ°ç­¾åï¼Œæ‰€ä»¥åŽé¢è¿˜è·Ÿäº†ä¸€ä¸ªç­¾åç®—æ³•â€”â€”ECDSA/RSAã€‚ é—®é¢˜å‡ºçŽ°äº†ï¼ŒECDH å¯†é’¥äº¤æ¢ä¸­ï¼ŒECDH å¯†é’¥å¯¹ä¸æ˜¯ä¸´æ—¶ç”Ÿæˆçš„ï¼ŒæœåŠ¡å™¨æ˜¯ç›´æŽ¥å°†è¯ä¹¦ä½œä¸º ECDH å…¬é’¥å‘ç»™å®¢æˆ·ç«¯çš„ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­æœåŠ¡å™¨ä¸éœ€è¦è¿›è¡Œé¢å¤–çš„ç­¾åï¼Œé‚£ä¸ºä»€ä¹ˆä¼šå­˜åœ¨ ECDH_RSA/ECDH_ECDSA è¿™æ ·çš„ç®—æ³•åç§°å‘¢ï¼Ÿè¿™æ¶‰åŠä¸€ä¸ªè¢«å¹¿æ³›è¯¯è§£çš„é—®é¢˜ï¼šç®—æ³•åç§°ä¸­çš„ç­¾åç®—æ³•åˆ°åº•æ˜¯æŒ‡è¯ä¹¦ä¸Šæ‰€ä½¿ç”¨çš„ç­¾åè¿˜æ˜¯æ¡æ‰‹è¿‡ç¨‹ä¸­æ‰€ä½¿ç”¨çš„ç­¾åï¼Ÿæžæ¸…è¿™ä¸ªé—®é¢˜å¤§æ¦‚æ²¡ä»€ä¹ˆå®žç”¨ä»·å€¼ï¼Œä½†ä¸æžæ¸…å®žåœ¨è®©æˆ‘ä¸èˆ’æœðŸ˜£ã€‚åœ¨ä¸€ä¼— RFC ä¸­ï¼Œæˆ‘é€æ¸æ‰¾åˆ°äº†ç­”æ¡ˆã€‚ RFC4346 The Transport Layer Security (TLS) Protocol Version 1.1 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # 7.4.2 Server Certificate The certificate type MUST be appropriate for the selected cipher suite&#39;s key exchange algorithm, and is generally an X.509v3 certificate. It MUST contain a key that matches the key exchange method, as follows. Unless otherwise specified, the signing algorithm for the certificate MUST be the same as the algorithm for the certificate key. Unless otherwise specified, the public key MAY be of any length. Key Exchange Algorithm Certificate Key Type RSA RSA public key; the certificate MUST allow the key to be used for encryption. DHE_DSS DSS public key. DHE_RSA RSA public key that can be used for signing. DH_DSS Diffie-Hellman key. The algorithm used to sign the certificate MUST be DSS. DH_RSA Diffie-Hellman key. The algorithm used to sign the certificate MUST be RSA. è¿™æ˜¯ TLS1.1 çš„ RFCã€‚ä¸Šé¢çš„æ„æ€æ˜¯ï¼šè¯ä¹¦çš„ç­¾åç®—æ³•å¿…é¡»ä¸Žç¡®å®šå¯†é’¥å¯¹ç±»åž‹çš„ç®—æ³•ä¿æŒä¸€è‡´ã€‚æ–‡ä¸­è¿˜ä¸¾äº†å‡ ä¸ªä¾‹å­ï¼š å¯†é’¥äº¤æ¢ç®—æ³• å¯†é’¥å¯¹ç±»åž‹ æ¡æ‰‹ç­¾åç®—æ³•ï¼ˆæŽ¨ç†ï¼‰ è¯ä¹¦ç­¾åç®—æ³•ï¼ˆæŽ¨ç†ï¼‰ RSA RSA / RSA DHE_DSS DSS DSS DSS DHE_RSA RSA RSA RSA DH_DSS DH / DSS DH_RSA DH / RSA æ³¨ï¼ˆAIï¼‰ï¼šDSS æ˜¯ä¸€ä¸ªæ•°å­—ç­¾åæ ‡å‡†ï¼ŒDSA ç®—æ³•æ˜¯å…¶æœ€åˆçš„æ ¸å¿ƒå®žçŽ°ï¼Œéšç€ DSS æ ‡å‡†çš„ç‰ˆæœ¬æ›´æ–°ï¼ŒRSA å’Œ ECDSA ä¹Ÿè¢«çº³å…¥æ ‡å‡†ä¸­ã€‚ æˆ‘ä»¬å¯ä»¥å‘çŽ°ä¸Šè¡¨ä¸­çš„ä¸¤ä¸ª DH å¯†é’¥äº¤æ¢ç®—æ³•æ²¡æœ‰éµå®ˆâ€œè¯ä¹¦çš„ç­¾åç®—æ³•å¿…é¡»ä¸Žç¡®å®šå¯†é’¥å¯¹ç±»åž‹çš„ç®—æ³•ä¿æŒä¸€è‡´â€çš„è§„å®šï¼Œè¿™æ˜¯å› ä¸º DH ç®—æ³•åªèƒ½ç”¨ä½œå¯†é’¥äº¤æ¢ï¼Œä¸èƒ½ç”¨æ¥ç­¾åï¼Œè¿™æ‰é¢å¤–è¿½åŠ äº†ä¸€ä¸ªç®—æ³•åç§°ï¼Œç”¨äºŽæŒ‡å®šè¯ä¹¦çš„ç­¾åç®—æ³•ã€‚ RFC4346 The Transport Layer Security (TLS) Protocol Version 1.1 1 2 3 4 5 6 7 8 9 # F.1.1.3 Diffie-Hellman Key Exchange with Authentication When Diffie-Hellman key exchange is used, the server can either supply a certificate containing fixed Diffie-Hellman parameters or use the server key exchange message to send a set of temporary Diffie-Hellman parameters signed with a DSS or RSA certificate. Temporary parameters are hashed with the hello.random values before signing to ensure that attackers do not replay old parameters. In either case, the client can verify the certificate or signature to ensure that the parameters belong to the server. è¿™æ®µè¯´æ˜ŽæœåŠ¡å™¨å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼æä¾› DH å‚æ•°ï¼šä¸€ç§æ˜¯ç›´æŽ¥å‘é€ DH è¯ä¹¦ï¼Œå®¢æˆ·ç«¯é€šè¿‡éªŒè¯è¯ä¹¦è¯æ˜Ž DH å‚æ•°çš„ç¡®å±žäºŽæœåŠ¡å™¨ï¼›ä¸€ç§æ˜¯å‘é€å¸¦ç­¾åçš„ä¸´æ—¶ç”Ÿæˆçš„ DHE å‚æ•°ï¼Œå®¢æˆ·ç«¯é€šè¿‡éªŒç­¾è¯æ˜Ž DHE å‚æ•°çš„ç¡®å±žäºŽæœåŠ¡å™¨ã€‚ è¿™æ®µè‡³å°‘å¯ä»¥ä½è¯æˆ‘å¯¹ DH å’Œ DHE çš„ç†è§£æ˜¯æ­£ç¡®çš„ã€‚ RFC4492 Elliptic Curve Cryptography (ECC) Cipher Suites for Transport Layer Security (TLS) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # 2.1 ECDH_ECDSA In ECDH_ECDSA, the serverâ€™s certificate MUST contain an ECDH-capable public key and be signed with ECDSA. # 2.2 ECDHE_ECDSA In ECDHE_ECDSA, the serverâ€™s certificate MUST contain an ECDSA capable public key and be signed with ECDSA. # 2.3 ECDH_RSA This key exchange algorithm is the same as ECDH_ECDSA except that the serverâ€™s certificate MUST be signed with RSA rather than ECDSA. # 2.4 ECDHE_RSA This key exchange algorithm is the same as ECDHE_ECDSA except that the serverâ€™s certificate MUST contain an RSA public key authorized for signing, and that the signature in the ServerKeyExchange message must be computed with the corresponding RSA private key. The server certificate MUST be signed with RSA. è¿™æ˜¯ TLS1.1 ECC ç®—æ³•çš„ RFCã€‚æ‰€è¿°é€»è¾‘ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œä¸Žä¸Šé¢çš„è¯´æ³•éƒ½å¯¹å¾—ä¸Šã€‚ é—®é¢˜æ€»ç»“ - TLS1.1ï¼š è¯ä¹¦çš„ç­¾åç®—æ³•å¿…é¡»ä¸Žç¡®å®šå¯†é’¥å¯¹ç±»åž‹çš„ç®—æ³•ä¿æŒä¸€è‡´ã€‚ RSA å¯†é’¥äº¤æ¢ä¸­æ²¡æœ‰ç­¾åçš„è¿‡ç¨‹ï¼Œæ•…ç®—æ³•åç§°ä¸­æ²¡æœ‰ç­¾åç®—æ³•ã€‚è¯ä¹¦çš„ç­¾åç®—æ³•é¡»ä¸º RSAã€‚ DHE å¯†é’¥äº¤æ¢ä¸­æœ‰ç­¾åçš„è¿‡ç¨‹ï¼Œæ•…ç®—æ³•åç§°ä¸­æŒ‡å®šäº†ç­¾åç®—æ³•ï¼Œå¦‚ ECDHE_RSAã€‚è¯ä¹¦çš„ç­¾åç®—æ³•é¡»ä¸Žè¯¥ç­¾åç®—æ³•ä¸€è‡´ã€‚ DH å¯†é’¥äº¤æ¢ä¸­æ²¡æœ‰ç­¾åçš„è¿‡ç¨‹ï¼Œå…¶ç®—æ³•åç§°ä¸­æœ¬ä¸éœ€è¦æŒ‡å®šç­¾åç®—æ³•ï¼Œç„¶è¯ä¹¦çš„ç­¾åç®—æ³•é¡»ä¸Žç¡®å®šå¯†é’¥å¯¹ç±»åž‹çš„ç®—æ³•ï¼ˆDHï¼‰ä¿æŒä¸€è‡´ï¼Œè€Œ DH ç®—æ³•æ— æ³•ç”¨äºŽç­¾åï¼Œæ•…ç®—æ³•åç§°ä¸­é¢å¤–æŒ‡å®šäº†è¯ä¹¦çš„ç­¾åç®—æ³•ï¼Œå¦‚ ECDH_RSAã€‚ RFC5246 The Transport Layer Security (TLS) Protocol Version 1.2 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 # A.7 Changes to RFC 4492 As described in Sections 7.4.2 and 7.4.6, the restrictions on the signature algorithms used to sign certificates are no longer tied to the cipher suite (when used by the server) or the ClientCertificateType (when used by the client). Thus, the restrictions on the algorithm used to sign certificates specified in Sections 2 and 3 of RFC 4492 are also relaxed. # 7.4.2 Server Certificate If the client provided a &quot;signature_algorithms&quot; extension, then all certificates provided by the server MUST be signed by a hash/signature algorithm pair that appears in that extension. Note that this implies that a certificate containing a key for one signature algorithm MAY be signed using a different signature algorithm (for instance, an RSA key signed with a DSA key). This is a departure from TLS 1.1, which required that the algorithms be the same. Note that this also implies that the DH_DSS, DH_RSA, ECDH_ECDSA, and ECDH_RSA key exchange algorithms do not restrict the algorithm used to sign the certificate. Fixed DH certificates MAY be signed with any hash/signature algorithm pair appearing in the extension. The names DH_DSS, DH_RSA, ECDH_ECDSA, and ECDH_RSA are historical. # 7.4.1.4.1 Signature Algorithms The client uses the &quot;signature_algorithms&quot; extension to indicate to the server which signature/hash algorithm pairs may be used in digital signatures. # 7.4.1.4.1 Signature Algorithms The semantics of this extension are somewhat complicated because the cipher suite indicates permissible signature algorithms but not hash algorithms. Sections 7.4.2 and 7.4.3 describe the appropriate rules. # 7.4.3 Server Key Exchange Message If the client has offered the &quot;signature_algorithms&quot; extension, the signature algorithm and hash algorithm MUST be a pair listed in that extension. Note that there is a possibility for inconsistencies here. For instance, the client might offer DHE_DSS key exchange but omit any DSA pairs from its &quot;signature_algorithms&quot; extension. In order to negotiate correctly, the server MUST check any candidate cipher suites against the &quot;signature_algorithms&quot; extension before selecting them. This is somewhat inelegant but is a compromise designed to minimize changes to the original cipher suite design. è¿™æ˜¯ TLS1.2 çš„ RFCã€‚æ–°å¢žäº† signature_algorithms æ‰©å±•å­—æ®µï¼Œå®ƒä»£è¡¨äº†å®¢æˆ·ç«¯æ”¯æŒçš„ç­¾åç®—æ³•ã€‚å¯†é’¥äº¤æ¢è¿‡ç¨‹ä¸­å¯èƒ½ç”¨åˆ°çš„ç­¾åç®—æ³•ç”±æ­¤å­—æ®µåå•†è€Œæ¥ã€‚è¯ä¹¦çš„ç­¾åç®—æ³•ä¸å†å— TLS ç®—æ³•åç§°çº¦æŸï¼Œåªé¡»ä½åˆ— signature_algorithms æ‰€æ”¯æŒçš„ç®—æ³•åˆ—è¡¨ä¸­ã€‚ å¯¹äºŽå¯†é’¥äº¤æ¢è¿‡ç¨‹ä¸­å¯èƒ½å‡ºçŽ°çš„ç­¾åè¿‡ç¨‹ï¼ŒTLS ç®—æ³•åç§°ä¸­åªæŒ‡å®šäº†ç­¾åç®—æ³•ï¼Œå´æ²¡æœ‰å“ˆå¸Œç®—æ³•ï¼ˆåç§°ä¸­çš„å“ˆå¸Œç®—æ³•ä¸º HMAC æˆ– Finished æŠ¥æ–‡æ‰€ç”¨ï¼‰ï¼Œé‚æœ‰ signature_algorithmsï¼Œå…¶ä¸­çš„åç§°åŒæ—¶åŒ…å«äº†ç­¾åå’Œå“ˆå¸Œç®—æ³•ã€‚å¦‚æ­¤ï¼ŒTLS ç®—æ³•åç§°å’Œæ‰©å±•å­—æ®µéƒ½ç»™å‡ºäº†ç­¾åç®—æ³•åç§°ï¼Œä¸ºåŒæ—¶æ»¡è¶³äºŒè€…çº¦æŸï¼ŒæœåŠ¡å™¨å¿…é¡»äºˆä»¥æ£€æŸ¥ï¼Œæœ€ç»ˆåå•†é€‰æ‹©å‡ºçš„ç­¾åç®—æ³•é¡»åŒæ—¶å…¼å®¹ TLS ç®—æ³•åç§°å’Œæ‰©å±•å­—æ®µã€‚ ä¸¾ä¾‹ï¼Œè‹¥ TLS ç®—æ³•åç§°ä¸º ECDHE_ECDSAï¼Œæ‰©å±• signature_algorithms ä¸­å«æœ‰ ecdsa_secp256r1_sha256, rsa_pkcs1_sha256ï¼Œé‚£ä¹ˆæœåŠ¡å™¨åº”åå•†é€‰æ‹©å‡º ecdsa_secp256r1_sha256 ä½œä¸ºç­¾åç®—æ³•ã€‚æ—¢å¦‚æ­¤ï¼Œè¯ä¹¦åº”é€‰ç”¨ ECC è¯ä¹¦ï¼Œä½†è¯ä¹¦è‡ªå·±çš„ç­¾åå¯ä»¥æ˜¯ RSAã€‚ å¦ï¼Œå¯¹äºŽé™æ€ DH å¯†é’¥äº¤æ¢ç®—æ³•å¦‚ ECDH_ECDSA, ECDH_RSAï¼Œå…¶åç§°ä¸­çš„ç­¾åç®—æ³•å·²ç»ä¸å«æœ‰ä»»ä½•å®žé™…çº¦æŸæ„ä¹‰ï¼Œæ­¤ç±»è¿·æƒ‘æ€§åè¶³çš„åç§°ä¹‹å­˜åœ¨çš†ç³»åŽ†å²åŽŸå› ã€‚ RFC8422 Elliptic Curve Cryptography (ECC) Cipher Suites for Transport Layer Security (TLS) Versions 1.2 and Earlier 1 2 3 4 5 6 7 8 9 # 2.1 ECDHE_ECDSA In ECDHE_ECDSA, the serverâ€™s certificate MUST contain an ECDSA- or EdDSA-capable public key. # 2.2 ECDHE_RSA This key exchange algorithm is the same as ECDHE_ECDSA except that the serverâ€™s certificate MUST contain an RSA public key authorized for signing and the signature in the ServerKeyExchange message must be computed with the corresponding RSA private key. è¿™æ˜¯ TLS1.2 å‡ºçŽ°åŽï¼Œæœ‰å…³ ECC ç®—æ³•çš„ RFCã€‚ç›¸æ¯” RFC4492 çš„è¡¨è¿°ï¼Œè¯¥è¡¨è¿°æ²¡æœ‰å†ç‰¹åˆ«æåŠè¯ä¹¦æœ¬èº«çš„ç­¾ååº”ä¸ºä½•ç®—æ³•ï¼Œå› ä¸ºè¯ä¹¦çš„ç­¾åç®—æ³•å·²ä¸å†å— TLS ç®—æ³•åç§°çº¦æŸï¼Œåªè¦ä½åˆ— signature_algorithms çš„ç®—æ³•åˆ—è¡¨ï¼Œæ˜¯ä»€ä¹ˆç®—æ³•éƒ½æœ‰å¯èƒ½ã€‚ é—®é¢˜æ€»ç»“ - TLS1.2ï¼š å¯†é’¥äº¤æ¢è¿‡ç¨‹ä¸­å¯èƒ½ç”¨åˆ°çš„ç­¾åç®—æ³•æ ¹æ®å®¢æˆ·ç«¯æ”¯æŒçš„ TLS ç®—æ³•å’Œ signature_algorithms æ‰©å±•åå•†è€Œæ¥ã€‚ è¯ä¹¦çš„ç­¾åç®—æ³•ä¸å†å— TLS ç®—æ³•åç§°çº¦æŸï¼Œåªé¡»ä½åˆ— signature_algorithms æ‰€æ”¯æŒçš„ç®—æ³•åˆ—è¡¨ä¸­ã€‚ é™æ€ DH å¯†é’¥äº¤æ¢ç®—æ³•å¦‚ ECDH_ECDSA, ECDH_RSAï¼Œå…¶åç§°ä¸­çš„ç­¾åç®—æ³•ä¸å…·æœ‰ä»»ä½•å®žé™…çº¦æŸæ„ä¹‰ï¼Œæ­¤ç±»åç§°ä¹‹å­˜åœ¨çš†ç³»åŽ†å²åŽŸå› ã€‚ é—®é¢˜ç»“è®ºï¼š TLS ç®—æ³•åç§°ä¸­çš„ç­¾åç®—æ³•åŸºæœ¬æŒ‡çš„æ˜¯æ¡æ‰‹è¿‡ç¨‹ä¸­æ‰€ä½¿ç”¨çš„ç­¾åï¼Œè€Œéžç‰¹æŒ‡è¯ä¹¦æœ¬èº«çš„ç­¾åï¼Œä¸è¿‡äºŒè€…ä¹Ÿå¹¶éžæ¯«æ— å…³è”ï¼Œå…·ä½“ç»†èŠ‚å‚è§ä¸Šé¢çš„åˆ†æžå’Œæ€»ç»“ã€‚ æž„å»ºè¯ä¹¦é“¾ å°è¯•ä½¿ç”¨ openssl æž„å»ºå¦‚ä¸‹è¯ä¹¦é“¾ã€‚ 1 Root CA Cert -&gt; Intermediate CA Cert -&gt; End Entity Cert æ ¹ CA ä½œä¸ºä¿¡ä»»é”šç‚¹ï¼Œå®ƒçš„è¯ä¹¦æ˜¯è‡ªç­¾åè¯ä¹¦ï¼›æ ¹ CA ç»™ä¸­çº§ CA é¢å‘ä¸­çº§è¯ä¹¦ï¼›ä¸­çº§ CA ç»™ç”¨æˆ·é¢å‘æœ«ç«¯è¯ä¹¦ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 # build the root cert # generate private key for the root ca openssl genrsa -out root-ca-key.pem 2048 # generate cert sign request of the root ca # here the key content of the `openssl-ca.cnf` will show at the end openssl req -new -key root-ca-key.pem -out root-ca-csr.pem -config openssl-ca.cnf # fill the prompted fields like follows Country Name (2 letter code) [AU]:CN State or Province Name (full name) [Some-State]:Zhejiang Locality Name (eg, city) []:Hangzhou Organization Name (eg, company) [Internet Widgits Pty Ltd]:lcatmiao Organizational Unit Name (eg, section) []:lcatmiao-ca Common Name (e.g. server FQDN or YOUR name) []:lcatmiao-ca.com Email Address []:lcatmiao@test.com # self-sign the public key retrived implicitly from the cert sign request # of the root ca with the private key of also the root ca then get the # root cert openssl x509 -req -days 3650 -sha256 -extfile openssl-ca.cnf -extensions v3_ca -in root-ca-csr.pem -signkey root-ca-key.pem -out root-ca-cert.pem # build the intermediate cert # generate private key for the intermediate ca openssl genrsa -out intermediate-ca-key.pem 2048 # generate cert sign request of the intermediate ca openssl req -new -key intermediate-ca-key.pem -out intermediate-ca-csr.pem -config openssl-ca.cnf # fill the prompted fields like follows Country Name (2 letter code) [AU]:CN State or Province Name (full name) [Some-State]:Zhejiang Locality Name (eg, city) []:Hangzhou Organization Name (eg, company) [Internet Widgits Pty Ltd]:lcatmiao Organizational Unit Name (eg, section) []:lcatmiao-ca Common Name (e.g. server FQDN or YOUR name) []:lcatmiao-ca.com Email Address []:lcatmiao@test.com # sign the public key retrived implicitly from the cert sign request # of the intermediate ca with the private key of the root ca then # get the intermediate cert openssl x509 -req -days 3650 -sha256 -extfile openssl-ca.cnf -extensions v3_ca -in intermediate-ca-csr.pem -CA root-ca-cert.pem -CAkey root-ca-key.pem -CAcreateserial -out intermediate-ca-cert.pem # build the end entity cert # generate private key for the end entity openssl genrsa -out end-entity-key.pem 2048 # generate cert sign request of the end entity # here the key content of the `openssl-user.cnf` will show at the end openssl req -new -key end-entity-key.pem -out end-entity-csr.pem -config openssl-user.cnf # fill the prompted fields like follows Country Name (2 letter code) [AU]:CN State or Province Name (full name) [Some-State]:Zhejiang Locality Name (eg, city) []:Hangzhou Organization Name (eg, company) [Internet Widgits Pty Ltd]:lcatmiao Organizational Unit Name (eg, section) []:lcatmiao-user Common Name (e.g. server FQDN or YOUR name) []:172.168.10.110 Email Address []:lcatmiao@test.com # sign the public key retrived implicitly from the cert sign request # of the end entity with the private key of the intermediate ca then # get the end entity cert openssl x509 -req -days 3650 -sha256 -extfile openssl-user.cnf -extensions usr_cert -in end-entity-csr.pem -CA intermediate-ca-cert.pem -CAkey intermediate-ca-key.pem -CAcreateserial -out end-entity-cert.pem # After doing all the operations above, `ls` shows that # all the files we have are as follows. end-entity-cert.pem end-entity-csr.pem end-entity-key.pem intermediate-ca-cert.pem intermediate-ca-cert.srl intermediate-ca-csr.pem intermediate-ca-key.pem openssl-ca.cnf openssl-user.cnf root-ca-cert.pem root-ca-cert.srl root-ca-csr.pem root-ca-key.pem # we can see the cert info by using this cmd openssl x509 -in end-entity-cert.pem -noout -text 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # key content of the openssl-ca.cnf # the following is just a test example that only lists the modified cfg items [ req ] req_extensions = v3_req # The extensions to add to a certificate request [ v3_req ] basicConstraints = CA:TRUE # keyUsage = nonRepudiation, digitalSignature, keyEncipherment subjectAltName = @alt_names [ v3_ca ] subjectAltName = @alt_names [ alt_names ] DNS.1 = lcatmiao-ca.com 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # key content of the openssl-user.cnf # the following is just a test example that only lists the modified cfg items [ req ] req_extensions = v3_req # The extensions to add to a certificate request [ usr_cert ] subjectAltName = @alt_names [ v3_req ] basicConstraints = CA:FALSE # keyUsage = nonRepudiation, digitalSignature, keyEncipherment subjectAltName = @alt_names [ alt_names ] IP.1 = 172.168.10.110 IP.2 = 172.168.10.105 IP.3 = 172.168.10.106 IP.4 = 172.168.10.107 IP.5 = 172.168.10.108 è‡³æ­¤ï¼Œä¸€ä¸ªç®€å•çš„è¯ä¹¦é“¾å°±æž„å»ºå¥½äº†ã€‚ä¸‹é¢æˆ‘ä»¬æ¥éªŒè¯ä¸€ä¸‹è¿™ä¸ªè¯ä¹¦é“¾ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # verify the root cert which is a self-sign cert openssl verify -CAfile root-ca-cert.pem root-ca-cert.pem # output: root-ca-cert.pem: OK # verify the intermediate cert openssl verify -trusted root-ca-cert.pem intermediate-ca-cert.pem # output: intermediate-ca-cert.pem: OK # verify the end entity cert openssl verify -partial_chain -trusted intermediate-ca-cert.pem end-entity-cert.pem # output: end-entity-cert.pem: OK # directly verify the whole cert chain which has only three levels openssl verify -CAfile root-ca-cert.pem -untrusted intermediate-ca-cert.pem end-entity-cert.pem # output: end-entity-cert.pem: OK æœ¬åœ°ä½¿ç”¨å‘½ä»¤è¡Œéƒ½èƒ½éªŒè¿‡ï¼Œä¸ä»£è¡¨ç½‘ç»œé€šä¿¡æ—¶ä¹Ÿèƒ½éªŒè¿‡ã€‚å®žé™…é€šä¿¡çš„è¡Œä¸ºå—å„ç§é…ç½®çš„å½±å“ ï¼Œæ¯”å¦‚å®žæµ‹å‘çŽ°æœ«ç«¯è¯ä¹¦ä¸­é…ç½®çš„ IP åœ°å€æˆ–è€…åŸŸåè¦ä¸ŽæœåŠ¡å™¨ä¿æŒä¸€è‡´ï¼Œå¦åˆ™ä¸é€šã€‚ é¡ºå¸¦ä¸€æï¼Œå®žé™…æŠ¥æ–‡ä¸­ï¼Œè¯ä¹¦é“¾çš„é¡ºåºï¼šæœ«ç«¯è¯ä¹¦åœ¨å‰ï¼Œä¸­çº§è¯ä¹¦æŒ‰å±‚çº§é¡ºåºä¾æ¬¡è·Ÿéšï¼Œæ ¹è¯ä¹¦ä¸€èˆ¬ä¸åŒ…å«åœ¨é“¾ä¸­ã€‚ RFC5246 The Transport Layer Security (TLS) Protocol Version 1.2 1 2 3 4 5 6 7 8 9 10 # 7.4.2 Server Certificate certificate_list This is a sequence (chain) of certificates. The sender&#39;s certificate MUST come first in the list. Each following certificate MUST directly certify the one preceding it. Because certificate validation requires that root keys be distributed independently, the self-signed certificate that specifies the root certificate authority MAY be omitted from the chain, under the assumption that the remote end must already possess it in order to validate it in any case. æ¶ˆé™¤æµè§ˆå™¨å®‰å…¨è­¦å‘Š å½“å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰æ²¡èƒ½éªŒè¿‡æœåŠ¡å™¨å‘æ¥çš„è¯ä¹¦æ—¶ï¼Œå°±ä¼šæ˜¾ç¤ºå¦‚ä¸‹çš„å®‰å…¨è­¦å‘Šé¡µé¢ï¼Œå¹¶ä¸” URI æ ä¼šæœ‰â€œä¸å®‰å…¨â€çš„æç¤ºã€‚å¦‚æžœæœåŠ¡å™¨çš„è¯ä¹¦æ˜¯æˆ‘ä»¬è‡ªå·±ç­¾å‘çš„ï¼Œè‡ªç„¶æ— æ³•è¢«æµè§ˆå™¨å†…ç½®çš„ CA è¯ä¹¦éªŒè¿‡ï¼Œæˆ‘ä»¬éœ€è¦å°†è‡ªå·±ç”Ÿæˆçš„æ ¹è¯ä¹¦å¯¼å…¥æµè§ˆå™¨æ‰è¡Œã€‚ å°†è‡ªå·±ç”Ÿæˆçš„æ ¹è¯ä¹¦å¯¼å…¥æµè§ˆå™¨ï¼Œä½œä¸ºå—ä¿¡ä»»çš„é¢å‘æœºæž„ã€‚ æ­¤åŽå†è®¿é—®æœåŠ¡å™¨ï¼Œå°±æ˜¯æ­£å¸¸çš„ https è®¿é—®äº†ã€‚ å¦‚æžœæœåŠ¡å™¨å‘æ¥çš„è¯ä¹¦ä¸æ­¢ä¸€ä¸ªï¼Œè€Œæ˜¯å¤šçº§è¯ä¹¦ï¼Œå³è¯ä¹¦é“¾çš„ä¸€éƒ¨åˆ†ï¼Œé‚£ä¹ˆç†è®ºä¸Šå¯¼å…¥æµè§ˆå™¨çš„è¯ä¹¦åº”è¯¥æ˜¯è¯ä¹¦é“¾çš„å¦ä¸€éƒ¨åˆ†ï¼ŒäºŒè€…åˆä¸€è¦èƒ½æž„æˆå®Œæ•´çš„è¯ä¹¦é“¾æ‰è¡Œã€‚ å‚è€ƒèµ„æ–™ ã€Šå›¾è§£HTTPã€‹ Keyless SSL: The Nitty Gritty Technical Details The Illustrated TLS Connection: Every Byte Explained RFC4346 The Transport Layer Security (TLS) Protocol Version 1.1 RFC4492 Elliptic Curve Cryptography (ECC) Cipher Suites for Transport Layer Security (TLS) RFC5246 The Transport Layer Security (TLS) Protocol Version 1.2 RFC8422 Elliptic Curve Cryptography (ECC) Cipher Suites for Transport Layer Security (TLS) Versions 1.2 and Earlier RFC7919 Negotiated Finite Field Diffie-Hellman Ephemeral Parameters for Transport Layer Security (TLS) è„šæ³¨ ä½¿ç”¨ä¼šè¯å¯†é’¥åŠ å¯†åŽçš„ Client Finished æŠ¥æ–‡ã€‚Â &#8617;Â &#8617;2 ä½¿ç”¨ä¼šè¯å¯†é’¥åŠ å¯†åŽçš„ Server Finished æŠ¥æ–‡ã€‚Â &#8617;Â &#8617;2 ä½¿ç”¨ä¼šè¯å¯†é’¥åŠ å¯†åŽçš„ Close Notify æŠ¥æ–‡ã€‚Â &#8617;" />
<meta property="og:description" content="å†™åœ¨å‰é¢ é˜…è¯»ã€Šå›¾è§£HTTPã€‹ï¼Œå¤§è‡´ç†è§£äº† SSL/TLS çš„æ¡æ‰‹è¿‡ç¨‹å’Œæ€æƒ³åŽŸç†ã€‚ç„¶è€Œä½œä¸ºå…¥é—¨ä¹¦ï¼Œå®ƒæ²¡æœ‰ä»‹ç»åŸºäºŽ DH ç®—æ³•çš„ TLS æ¡æ‰‹è¿‡ç¨‹ï¼Œä¹Ÿæ²¡æœ‰ä»‹ç»è¯ä¹¦é“¾ç›¸å…³çš„çŸ¥è¯†ðŸ˜¡ã€‚æˆ‘ Google äº†ä¸å°‘èµ„æ–™ï¼Œç€é‡å•ƒäº†å‡ ç¯‡æ–‡ç« ï¼Œç»“åˆæŠ“åŒ…åˆ†æžï¼Œæœ¬æƒ³â€œå·®ä¸å¤šå¾—äº†â€ï¼Œå´æ²¡æ–™åˆ°å…¥äº†å¤§å‘ï¼Œç–‘é—®ä¸å‡åå¢žã€‚ ä¸€ç­¹èŽ«å±•ä¹‹é™…ï¼ŒAI æŠ€æœ¯å¤§ç«ï¼Œæ•‘æˆ‘ç‹—å‘½ã€‚å—æ­¤é¼“èˆžï¼Œå€ŸåŠ© AI è§£æƒ‘ï¼Œåˆæ‰“èµ·ç²¾ç¥žå•ƒè¯»äº†å¤šä¸ª RFC ç‰‡æ®µï¼Œé‚æ‹¨äº‘è§æ—¥ã€‚æœ¬æ–‡æ—¢æˆï¼Œè™½å¾—ç›ŠäºŽå¤©æ—¶ï¼Œç„¶äº¦å¯è°“ä¸€æ³¢ä¸‰æŠ˜ï¼ŒåŽ†å°½è‰°è¾›ã€‚æˆ‘çœŸç‰›é€¼ðŸ‘ã€‚ æœ¬æ–‡ä¸»è¦åŸºäºŽ TLS1.2 ç ”å†™ï¼ŒçŸ¥è¯†æ•´ç†äºŽæ­¤ðŸ‘‡ã€‚ å…ˆè¡Œæ¦‚å¿µ &gt; å¯†ç ä½“åˆ¶ å¯†ç å­¦ä¸»è¦æœ‰ä¸¤ç§ä½“åˆ¶ï¼š å…±äº«å¯†ç ä½“åˆ¶ï¼ˆå¯¹ç§°å¯†ç ä½“åˆ¶ï¼‰ å…¬é’¥å¯†ç ä½“åˆ¶ï¼ˆéžå¯¹ç§°å¯†ç ä½“åˆ¶ï¼‰ &gt; æ•°å­¦éš¾é¢˜ å…¬é’¥å¯†ç ä½“åˆ¶ä¸»è¦åŸºäºŽä»¥ä¸‹æ•°å­¦éš¾é¢˜ï¼š å¤§æ•´æ•°åˆ†è§£é—®é¢˜ ç¦»æ•£å¯¹æ•°é—®é¢˜ï¼ˆDLPï¼‰ ä¸€èˆ¬çš„ç¦»æ•£å¯¹æ•°é—®é¢˜ æ¤­åœ†æ›²çº¿ç¦»æ•£å¯¹æ•°é—®é¢˜ï¼ˆECDLPï¼‰ ä¸€èˆ¬çš„è¯´æ³•ä¸­ï¼Œé€šå¸¸å°†æ¤­åœ†æ›²çº¿ç¦»æ•£å¯¹æ•°é—®é¢˜å•ç‹¬ä½œä¸ºä¸€ç±»ï¼Œä¸Žç¦»æ•£å¯¹æ•°é—®é¢˜ã€å¤§æ•´æ•°åˆ†è§£é—®é¢˜ä¸€èµ·ï¼Œå¹¶ç§°å¯†ç å­¦ä¸‰å¤§æ•°å­¦éš¾é¢˜ã€‚æ¤­åœ†æ›²çº¿ç¦»æ•£å¯¹æ•°é—®é¢˜æ¯”ä¸€èˆ¬çš„ç¦»æ•£å¯¹æ•°é—®é¢˜æ›´åŠ å›°éš¾ï¼Œè‡ªç„¶å°±è¯žç”Ÿäº†åŸºäºŽæ¤­åœ†æ›²çº¿çš„å¯†ç å­¦ï¼Œè¢«ç§°ä½œæ¤­åœ†æ›²çº¿å¯†ç å­¦ï¼ˆECCï¼‰ã€‚ä¸€äº›åŽŸæœ¬åŸºäºŽä¸€èˆ¬ç¦»æ•£å¯¹æ•°é—®é¢˜çš„ç®—æ³•è¢«ç§»æ¤åˆ°æ¤­åœ†æ›²çº¿ä¸Šï¼Œå°±æœ‰äº† ECC çš„ç®—æ³•ç‰ˆæœ¬ï¼Œæ¯”å¦‚ DH ç®—æ³•çš„æ¤­åœ†æ›²çº¿ç‰ˆæœ¬ï¼Œå°±å« ECDH ç®—æ³•ã€‚ ä¸€äº›å…¬é’¥ç®—æ³•ä¸Žæ•°å­¦éš¾é¢˜çš„å¯¹åº”å…³ç³»ï¼š RSA - å¤§æ•´æ•°åˆ†è§£é—®é¢˜ DHã€DSA - ä¸€èˆ¬çš„ç¦»æ•£å¯¹æ•°é—®é¢˜ ECDHã€ECDHEã€ECDSA - æ¤­åœ†æ›²çº¿ç¦»æ•£å¯¹æ•°é—®é¢˜ TLS æ¡æ‰‹è¿‡ç¨‹ TLS åœ¨æ¡æ‰‹ä¸­ä¸»è¦åšäº†ä¸‰ä»¶äº‹â€”â€”èº«ä»½è®¤è¯ã€å¯†é’¥äº¤æ¢å’Œå®Œæ•´æ€§æ ¡éªŒã€‚æ¡æ‰‹ä¸»è¦æ˜¯ä¸ºäº†ç”Ÿæˆå¹¶äº¤æ¢å…±äº«å¯†é’¥ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯ä½¿ç”¨å…¬é’¥ç®—æ³•è¿›è¡Œçš„ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½æ‹¥æœ‰å…±äº«å¯†é’¥åŽï¼ŒåŽç»­çš„é€šä¿¡å†ä½¿ç”¨å…±äº«å¯†é’¥ç®—æ³•è¿›è¡ŒåŠ å¯†ã€‚è¿™æ˜¯å®‰å…¨å’Œæ€§èƒ½ç»¼åˆè€ƒé‡çš„ç»“æžœã€‚å…¬é’¥ç®—æ³•å®‰å…¨ä½†æ€§èƒ½æ¶ˆè€—å¤šï¼Œå…±äº«å¯†é’¥ç®—æ³•ç›¸å¯¹ä¸é‚£ä¹ˆå®‰å…¨ä½†æ€§èƒ½æ¶ˆè€—å°‘ï¼Œæ‰€ä»¥çœŸæ­£çš„åŠ å¯†é€šä¿¡ä½¿ç”¨å…±äº«å¯†é’¥åŠ å¯†ï¼Œè€Œä¸”å…±äº«å¯†é’¥çš„äº¤æ¢åˆ™ç”±å…¬é’¥ç®—æ³•å®žçŽ°ã€‚ ä»¥ä¸‹åŸºäºŽ TLS1.2 é˜è¿°å…¶æ¡æ‰‹è¿‡ç¨‹ã€‚ åŸºäºŽ RSA ç®—æ³• æ­¥éª¤ 1 - å‘èµ·è¿žæŽ¥ï¼Œåå•†å‚æ•° å®¢æˆ·ç«¯å‘é€ `Client Hello`ã€‚ å®¢æˆ·ç«¯ç”Ÿæˆéšæœºæ•° Client Randomï¼Œå¹¶å‘é€ Client Hello æŠ¥æ–‡ã€‚è¯¥æŠ¥æ–‡ä¸­åŒ…å« Client Random éšæœºæ•°ä»¥åŠå®¢æˆ·ç«¯æ”¯æŒçš„ç®—æ³•å¥—ä»¶ç­‰ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯è¢«ä¼ é€’ç»™æœåŠ¡å™¨ç”¨äºŽåå•†ã€‚ æ­¥éª¤ 2 - åå•†å‚æ•°ï¼Œå‘é€è¯ä¹¦ æœåŠ¡å™¨å‘é€ `Server Hello, Certificate, Server Hello Done`ã€‚ æœåŠ¡å™¨ä»Ž Client Hello ä¸­èŽ·å¾—éšæœºæ•° Client Randomã€‚ æœåŠ¡å™¨ç”Ÿæˆ Server Randomï¼Œå°†è¯¥éšæœºæ•°åŒ…å«è¿› Server Hello ä¸­ã€‚æœåŠ¡å™¨ä¾æ®è‡ªèº«æƒ…å†µï¼Œä»Žå®¢æˆ·ç«¯ç®—æ³•å¥—ä»¶ä¸­æŒ‘é€‰ä¸€ä¸ªè‡ªèº«æ”¯æŒçš„ç®—æ³•ï¼Œå°†å…¶åŒ…å«è¿› Server Hello ä¸­ã€‚ æœåŠ¡å™¨å‘é€è‡ªå·±çš„è¯ä¹¦ã€‚è¯ä¹¦ä¸­ä¸»è¦åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š æœåŠ¡å™¨çš„å…¬é’¥ æœåŠ¡å™¨çš„åŸŸå å…¶å®ƒé™„åŠ ä¿¡æ¯ CA çš„ç­¾åï¼šä½¿ç”¨ CA çš„ç§é’¥å¯¹ä¸Šè¿°è¯ä¹¦ä¿¡æ¯çš„å“ˆå¸Œå€¼åŠ å¯†æ‰€å¾—çš„ç»“æžœã€‚ 1 signature = ca-private-key((hash(cert-info))) æœåŠ¡å™¨å‘é€ Server Hello Doneã€‚ å¦‚ä¸‹å›¾ï¼ŒæœåŠ¡å™¨å‘é€æŠ¥æ–‡ã€‚ å¦‚ä¸‹å›¾ï¼ŒæœåŠ¡å™¨é€‰æ‹©äº†ç®—æ³• TLS_RSA_WITH_AES_256_CBC_SHAã€‚ å¦‚ä¸‹å›¾ï¼ŒæœåŠ¡å™¨å‘é€äº†è‡ªå·±çš„è¯ä¹¦ï¼Œè¯¥è¯ä¹¦è¢« CA ç­¾åï¼Œç­¾åä½¿ç”¨çš„ç­¾åç®—æ³•æ˜¯ RSAï¼Œå“ˆå¸Œç®—æ³•æ˜¯ SHA256ã€‚ æ­¥éª¤ 3 - èº«ä»½è®¤è¯ï¼Œå¯†é’¥äº¤æ¢ï¼Œç”Ÿæˆä¼šè¯å¯†é’¥ å®¢æˆ·ç«¯å‘é€ `Client Key Exchange, Change Cipher Spec, Encrypted Handshake Message`ã€‚ å®¢æˆ·ç«¯ä»Ž Server Hello ä¸­èŽ·å¾—éšæœºæ•° Server Randomã€‚ å®¢æˆ·ç«¯ä½¿ç”¨ CA çš„è¯ä¹¦ï¼ˆä¸€èˆ¬å·²é¢„ç½®åœ¨æµè§ˆå™¨ä¸­ï¼‰éªŒè¯æœåŠ¡å™¨çš„è¯ä¹¦ã€‚ä½¿ç”¨ CA è¯ä¹¦ä¸­åŒ…å«çš„å…¬é’¥è§£å¯†æœåŠ¡å™¨è¯ä¹¦ä¸­çš„ç­¾åï¼Œå¾—åˆ°å“ˆå¸Œå€¼ï¼Œå†è®¡ç®—æœåŠ¡å™¨è¯ä¹¦ä¿¡æ¯çš„å“ˆå¸Œå€¼ï¼ŒäºŒè€…å¯¹æ¯”ï¼Œè‹¥ä¸€è‡´åˆ™éªŒè¯é€šè¿‡ã€‚éªŒè¯é€šè¿‡ï¼Œè¯æ˜Žäº†æœåŠ¡å™¨è¯ä¹¦æ˜¯ç”±æµè§ˆå™¨å†…ç½®çš„ CA è¯ä¹¦æ‰€ä»£è¡¨çš„ CA é¢å‘çš„ï¼Œå³è¯æ˜Žäº†å†…ç½® CA ä¿¡ä»»æœåŠ¡å™¨ï¼›è€Œå†…ç½®çš„ CA æ˜¯å¹¿å—ç¤¾ä¼šä¿¡ä»»çš„ CAï¼Œå·²ç»æ˜¯ä¿¡ä»»é”šç‚¹ã€‚å°±è¿™æ ·ï¼Œæµè§ˆå™¨ä¿¡ä»» CAï¼ŒCA ä¿¡ä»»æœåŠ¡å™¨ï¼Œæ‰€ä»¥æµè§ˆå™¨ä¿¡ä»»æœåŠ¡å™¨ã€‚è¿™ä¸€ä¿¡ä»»é“¾è¯æ˜Žäº†æœåŠ¡å™¨çš„èº«ä»½å€¼å¾—ä¿¡èµ–ï¼Œä¸”è¯ä¹¦ä¸­çš„å…¬é’¥çš„ç¡®å±žäºŽæœåŠ¡å™¨ï¼Œæ­¤å³èº«ä»½è®¤è¯ã€‚ å®¢æˆ·ç«¯ç”Ÿæˆ PreMaster Secretï¼Œå¹¶ä½¿ç”¨æœåŠ¡å™¨çš„å…¬é’¥åŠ å¯†ï¼Œä½¿ç”¨ Client Key Exchange å‘é€ç»™æœåŠ¡å™¨ï¼Œæ­¤å³å¯†é’¥äº¤æ¢ã€‚ å®¢æˆ·ç«¯ä½¿ç”¨ Client Random, Server Random, PreMaster Secret ç”Ÿæˆä¼šè¯å¯†é’¥ Session Keyã€‚ Change Cipher Spec å‘æœåŠ¡å™¨è¡¨æ˜Žï¼šå®¢æˆ·ç«¯å·²ç»æ‹¥æœ‰ä¼šè¯å¯†é’¥ï¼ŒæŽ¥ä¸‹æ¥å‘é€çš„æ‰€æœ‰æ•°æ®éƒ½ä¼šä½¿ç”¨ä¼šè¯å¯†é’¥åŠ å¯†ã€‚ å®¢æˆ·ç«¯è®¡ç®—å‡ºä¸€ä¸ªæ ¡éªŒæ•°æ®ï¼Œä½¿ç”¨ä¼šè¯å¯†é’¥åŠ å¯†åŽï¼Œä½œä¸º Encrypted Handshake Message1 å‘é€ç»™æœåŠ¡å™¨ã€‚ å¦‚ä¸‹å›¾ï¼Œå®¢æˆ·ç«¯å‘é€æŠ¥æ–‡ã€‚ å¦‚ä¸‹å›¾ï¼Œåœ¨ Client Key Exchange éƒ¨åˆ†å¯ä»¥çœ‹åˆ°ä½¿ç”¨æœåŠ¡å™¨çš„ RSA å…¬é’¥åŠ å¯†å‘é€çš„ PreMaster Secretã€‚ æ­¥éª¤ 4 - å¯†é’¥äº¤æ¢ï¼Œç”Ÿæˆä¼šè¯å¯†é’¥ æœåŠ¡å™¨å‘é€ `Change Cipher Spec, Encrypted Handshake Message`ã€‚ æœåŠ¡å™¨ä½¿ç”¨è‡ªå·±çš„ç§é’¥è§£å¯†å¾—åˆ° PreMaster Secretï¼Œæ­¤å³å¯†é’¥äº¤æ¢ã€‚ æœåŠ¡å™¨ä½¿ç”¨ Client Random, Server Random, PreMaster Secret ç”Ÿæˆä¼šè¯å¯†é’¥ Session Keyã€‚ æœåŠ¡å™¨ä½¿ç”¨ Session Key è§£å¯†å®¢æˆ·ç«¯å‘æ¥çš„æ ¡éªŒæ•°æ®ï¼Œå¹¶è®¡ç®—æŠ¥æ–‡å“ˆå¸Œå€¼ä¸Žæ ¡éªŒæ•°æ®è¿›è¡Œå¯¹æ¯”ã€‚ Change Cipher Spec å‘å®¢æˆ·ç«¯è¡¨æ˜Žï¼šæœåŠ¡å™¨å·²ç»æ‹¥æœ‰ä¼šè¯å¯†é’¥ï¼ŒæŽ¥ä¸‹æ¥å‘é€çš„æ‰€æœ‰æ•°æ®éƒ½ä¼šä½¿ç”¨ä¼šè¯å¯†é’¥åŠ å¯†ã€‚ æœåŠ¡å™¨è®¡ç®—å‡ºä¸€ä¸ªæ ¡éªŒæ•°æ®ï¼Œä½¿ç”¨ä¼šè¯å¯†é’¥åŠ å¯†åŽï¼Œä½œä¸º Encrypted Handshake Message2 å‘é€ç»™å®¢æˆ·ç«¯ã€‚ å¦‚ä¸‹å›¾ï¼ŒæœåŠ¡å™¨å‘é€æŠ¥æ–‡ã€‚ å¦‚ä¸‹å›¾ï¼ŒæŠ¥æ–‡ä¿¡æ¯é•¿è¿™æ ·ã€‚ æ­¥éª¤ 5 - å®Œæˆæ¡æ‰‹ï¼ŒåŠ å¯†é€šä¿¡ åŒæ–¹å‘é€ `Application Data`ã€‚ å®¢æˆ·ç«¯ä½¿ç”¨ Session Key è§£å¯†æœåŠ¡å™¨å‘æ¥çš„æ ¡éªŒæ•°æ®ï¼Œå¹¶è®¡ç®—æŠ¥æ–‡å“ˆå¸Œå€¼ä¸Žæ ¡éªŒæ•°æ®è¿›è¡Œå¯¹æ¯”ã€‚ TLS è¿žæŽ¥å»ºç«‹å®Œæˆã€‚æŽ¥ä¸‹æ¥åŒæ–¹ä½¿ç”¨ Session Key åŠ å¯†æ•°æ®ï¼Œè¿›è¡Œ HTTPS é€šä¿¡ã€‚ å¦‚ä¸‹å›¾ï¼Œå‘é€åŠ å¯†çš„ HTTP æŠ¥æ–‡ã€‚ æ­¥éª¤ 6 - æ–­å¼€è¿žæŽ¥ å®¢æˆ·ç«¯å‘é€ `Encrypted Alert`ã€‚ å®¢æˆ·ç«¯ä½¿ç”¨ Session Key åŠ å¯†ä¸€ä¸ªå‘Šè­¦ä¿¡æ¯ï¼Œå‘é€ Encrypted Alert3 ä»¥æ–­å¼€ TLS è¿žæŽ¥ã€‚åŽç»­å†å…³é—­ TCP çš„è¿žæŽ¥ã€‚ åŸºäºŽ ECDHE ç®—æ³• åœ¨ RSA æ¡æ‰‹ä¸­ï¼ŒPreMaster Secret ç”±å®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡å™¨ï¼Œä»Žè€Œå®Œæˆå¯†é’¥äº¤æ¢ï¼›è€Œåœ¨ DH ç®—æ³•ä¸­ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åŸºäºŽæ•°å­¦åŽŸç†ï¼Œæ ¹æ®ä¸€äº›å…¬å¼€çš„ä¿¡æ¯ç›´æŽ¥åœ¨å„è‡ªçš„æœ¬åœ°è®¡ç®—å‡º PreMaster Secretï¼Œè¿žç½‘ç»œä¼ è¾“éƒ½ç»™å¹²æŽ‰äº†ï¼Œæ‰€ä»¥ DH ç®—æ³•æ›´åŠ å®‰å…¨ã€‚ DH ç®—æ³•ç®€ä»‹ åŽŸç† DH ç®—æ³•æ˜¯ä¸€ç§å¯†é’¥äº¤æ¢ç®—æ³•ï¼Œæˆ‘ä»¬ä¸ç®¡æ•°å­¦ç»†èŠ‚ï¼Œæžç®€é˜è¿°åŽŸç†ï¼š 1 2 3 4 5 6 # å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å„æŒæœ‰ä¸€å¯¹ DH å…¬ç§é’¥ï¼Œä½¿ç”¨å®ƒä»¬å„è‡ªçš„ç§é’¥å’Œå¯¹ç«¯çš„å…¬é’¥å¯ä»¥ç”Ÿæˆä¸€ä¸ªä¼šè¯å¯†é’¥ï¼Œ # è€Œä¸¤ç«¯å„è‡ªç”Ÿæˆçš„ä¼šè¯å¯†é’¥åœ¨æ•°å­¦ä¸Šè¢«è¯æ˜Žæ˜¯ç›¸ç­‰çš„ã€‚æ¢è¨€ä¹‹ï¼Œåªè¦ä¸¤ç«¯äº’ç›¸äº¤æ¢å…¬é’¥å°±å¯ä»¥å®žçŽ° # æ— éœ€ç½‘ç»œä¼ è¾“çš„ä¼šè¯å¯†é’¥äº¤æ¢ã€‚ client-session-key = dh(client-private-key, server-public-key) server-session-key = dh(server-private-key, client-public-key) session-key = client-session-key = server-session-key åˆ†ç±» DH ç®—æ³•åŸºäºŽç¦»æ•£å¯¹æ•°é—®é¢˜è€Œè¯žç”Ÿï¼Œæ ¹æ®ç¦»æ•£å¯¹æ•°çš„è®¡ç®—æ–¹å¼ï¼ˆè§æ•°å­¦éš¾é¢˜ï¼‰å¯ä»¥åˆ†ä¸ºï¼š ä¸€èˆ¬çš„ DH ç®—æ³• ECDH ç®—æ³• æ ¹æ® DH çš„ç§é’¥æ˜¯å¦å›ºå®šï¼Œå¯ä»¥åˆ†ä¸ºï¼š Static DH Ephemeral DH(DHE) åœ¨ Static DH ç®—æ³•ä¸­ï¼ŒæœåŠ¡å™¨æ¯æ¬¡è¿žæŽ¥æ‰€ä½¿ç”¨çš„ DH ç§é’¥æ˜¯ä¸å˜çš„ï¼Œåº”è¯¥æ˜¯ç›´æŽ¥ä½¿ç”¨çš„ä¸Žå…¬é’¥è¯ä¹¦æˆå¯¹çš„é‚£ä¸ªç§é’¥ï¼Œé•¿æœŸä½¿ç”¨å®¹æ˜“æ³„éœ²ï¼Œä¸€æ—¦æ³„éœ²ï¼Œé»‘å®¢å°±èƒ½è§£å¯†å½“å‰å’Œä»¥å¾€æ¯æ¬¡è¿žæŽ¥çš„é€šä¿¡ï¼Œè¿™æ ·çš„ç®—æ³•ä¸å…·å¤‡å‰å‘å®‰å…¨æ€§ï¼›è€Œåœ¨ Ephemeral DH ç®—æ³•ä¸­ï¼ŒæœåŠ¡å™¨ä¼šä¸ºæ¯æ¬¡è¿žæŽ¥é‡æ–°ç”Ÿæˆä¸€ä¸ªä¸´æ—¶çš„ DH ç§é’¥ï¼Œè¿™æ ·å°±ç®—ç§é’¥æ³„éœ²ï¼Œä¹Ÿåªèƒ½è§£å¯†è¿™ä¸€æ¬¡è¿žæŽ¥çš„é€šä¿¡ï¼Œæ— æ³•è§£å¯†ä»¥å¾€çš„é€šä¿¡ï¼Œæ‰€ä»¥ç®—æ³•å…·å¤‡å‰å‘å®‰å…¨æ€§ã€‚ ECDHE æ¡æ‰‹æµç¨‹ æ­¥éª¤ 1 - å‘èµ·è¿žæŽ¥ï¼Œåå•†å‚æ•° å®¢æˆ·ç«¯å‘é€ `Client Hello`ã€‚ åŒ RSA æ¡æ‰‹ã€‚ æ­¥éª¤ 2 - åå•†å‚æ•°ï¼Œå‘é€è¯ä¹¦å’Œ ECDH ä¿¡æ¯ æœåŠ¡å™¨å‘é€ `Server Hello, Certificate, Server Key Exchange, Server Hello Done`ã€‚ ç›¸æ¯” RSA æ¡æ‰‹ï¼Œå¤šäº†ä¸€ä¸ª Server Key Exchangeï¼Œé˜è¿°å¦‚ä¸‹ã€‚ åœ¨è¿™æ­¥ï¼ŒæœåŠ¡å™¨ä¼šé€‰æ‹©ä¸€ç§æ¤­åœ†æ›²çº¿ï¼Œç”Ÿæˆä¸€å¯¹ ECDH å…¬ç§é’¥ï¼Œå¹¶ä½¿ç”¨ Server Private Key å¯¹ Client Random, Server Random, Curve Info, Server DH Public Key çš„ç»„åˆè¿›è¡Œç­¾åï¼Œæœ€åŽå°†æ›²çº¿ä¿¡æ¯ã€ECDH å…¬é’¥ã€ç­¾åéƒ½åŒ…å«è¿› Server Key Exchange ä¸­ã€‚ 1 2 3 signature = server-private-key( hash(client-random, server-random, curve-info, server-dh-public-key) ) æ­¤å¤„ç­¾åå’ŒåŽç»­éªŒç­¾çš„æ„ä¹‰åœ¨äºŽè¯æ˜Ž ECDH ä¿¡æ¯çš„ç¡®æ˜¯ç”±è¯ä¹¦ä¸­çš„å…¬é’¥æ‰€ä»£è¡¨çš„æœåŠ¡å™¨å‘é€çš„ã€‚ æœåŠ¡å™¨æ˜¯åå•†é€‰æ‹©æ¤­åœ†æ›²çº¿çš„ã€‚å®¢æˆ·ç«¯ä¼šé€šè¿‡ elliptic_curves æˆ– supported_groups æ‰©å±•å­—æ®µå‘é€å…¶æ”¯æŒçš„å…¨éƒ¨æ›²çº¿ï¼ŒéšåŽæœåŠ¡å™¨å†ä»Žä¸­é€‰æ‹©ä¸€ä¸ªã€‚éšç€æ ‡å‡†çš„ä¸æ–­å‘å±•ï¼Œelliptic_curves å·²ç»é€æ­¥è¢« supported_groups å–ä»£ã€‚å›  TLS ç‰ˆæœ¬çš„ä¸åŒï¼Œä¸Šè¿°è¯´æ³•å­˜åœ¨ä¸€äº›ç»†èŠ‚å‡ºå…¥ï¼Œä½†å¤§ä½“ä¸Šæ²¡é—®é¢˜ã€‚ å¦‚ä¸‹å›¾ï¼ŒæœåŠ¡å™¨å‘é€æŠ¥æ–‡ã€‚ å¦‚ä¸‹å›¾ï¼ŒæœåŠ¡å™¨é€‰æ‹©äº†ç®—æ³• TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256ã€‚è¿™é‡Œæˆ‘ä»¬æœåŠ¡å™¨çš„å¯†é’¥å¯¹æ˜¯ ECC å¯†é’¥å¯¹ï¼Œæ‰€ä»¥åå•†é€‰æ‹©äº† ECDSA ç­¾åç®—æ³•ã€‚ å¦‚ä¸‹å›¾ï¼ŒæœåŠ¡å™¨å‘é€äº†è‡ªå·±çš„è¯ä¹¦ï¼Œè¯¥è¯ä¹¦è¢« CA ç­¾åï¼Œç­¾åç®—æ³•æ˜¯ ECDSAï¼Œå“ˆå¸Œç®—æ³•æ˜¯ SHA256ã€‚è¿™é‡Œæˆ‘ä»¬ CA çš„å¯†é’¥å¯¹ä¹Ÿæ˜¯ ECC å¯†é’¥å¯¹ï¼Œä½¿ç”¨çš„ ECDSA ç®—æ³•ç­¾å‘çš„å…¬é’¥è¯ä¹¦ã€‚ å¦‚ä¸‹å›¾ï¼ŒæœåŠ¡å™¨å‘é€äº†è‡ªå·±ç”Ÿæˆçš„ ECDH å…¬é’¥ï¼Œå…¶é‡‡ç”¨çš„ ECC æ›²çº¿ä¸º Named Curve: secp256r1 (0x0017)ã€‚è®¡ç®—å‡ºçš„æ•°å­—ç­¾åä¹Ÿè¢«å‘é€ï¼Œç”±äºŽæœåŠ¡å™¨çš„ç§é’¥æ˜¯ ECC çš„ï¼Œæ‰€ä»¥ç­¾åç®—æ³•é€‰æ‹©äº† ECDSAã€‚ æ­¥éª¤ 3 - èº«ä»½è®¤è¯ï¼Œå¯†é’¥äº¤æ¢ï¼Œç”Ÿæˆä¼šè¯å¯†é’¥ å®¢æˆ·ç«¯å‘é€ `Client Key Exchange, Change Cipher Spec, Encrypted Handshake Message`ã€‚ å®¢æˆ·ç«¯ä»Ž Server Hello ä¸­èŽ·å¾—éšæœºæ•° Server Randomã€‚ å®¢æˆ·ç«¯ä½¿ç”¨ CA çš„è¯ä¹¦ï¼ˆä¸€èˆ¬å·²é¢„ç½®åœ¨æµè§ˆå™¨ä¸­ï¼‰éªŒè¯æœåŠ¡å™¨çš„è¯ä¹¦ï¼Œç”±æ­¤è¯æ˜ŽæœåŠ¡å™¨çš„èº«ä»½å€¼å¾—ä¿¡èµ–ï¼Œè¯ä¹¦ä¸­çš„å…¬é’¥çš„ç¡®ä»£è¡¨æœåŠ¡å™¨çš„èº«ä»½ï¼Œæ­¤å³èº«ä»½è®¤è¯ã€‚ å®¢æˆ·ç«¯ä½¿ç”¨è¯ä¹¦ä¸­çš„å…¬é’¥éªŒè¯ Server Key Exchange ä¸­çš„ç­¾åï¼Œç”±æ­¤è¯æ˜Ž ECDH ä¿¡æ¯çš„å‘é€è€…çš„ç¡®æ˜¯å…¬é’¥æ‰€ä»£è¡¨çš„æœåŠ¡å™¨ï¼Œæ­¤å³èº«ä»½è®¤è¯ã€‚ å®¢æˆ·ç«¯åŸºäºŽæœåŠ¡å™¨é€‰æ‹©çš„æ›²çº¿ç”Ÿæˆä¸€å¯¹ ECDH å…¬ç§é’¥ã€‚ å®¢æˆ·ç«¯å°†ç”Ÿæˆçš„ Client DH Public Key æ”¾å…¥ Client Key Exchange ä»¥å‘é€ç»™æœåŠ¡å™¨ã€‚ å®¢æˆ·ç«¯ä½¿ç”¨ Client DH Private Key, Server DH Public Key ç›´æŽ¥åœ¨æœ¬åœ°è®¡ç®—å‡º PreMaster Secretï¼ŒåŽç»­æœåŠ¡å™¨ä¹Ÿä¼šç›´æŽ¥åœ¨æœ¬åœ°è®¡ç®—å‡ºåŒæ ·çš„ PreMaster Secretï¼Œæ­¤å³å¯†é’¥äº¤æ¢ã€‚ å®¢æˆ·ç«¯ä½¿ç”¨ Client Random, Server Random, PreMaster Secret ç”Ÿæˆä¼šè¯å¯†é’¥ Session Keyã€‚ åŒ RSA æ¡æ‰‹ï¼Œå‘é€ Change Cipher Spec å’Œ Encrypted Handshake Message1ã€‚ å¦‚ä¸‹å›¾ï¼Œåœ¨ Client Key Exchange éƒ¨åˆ†å¯ä»¥çœ‹åˆ°å‘é€çš„ Client DH Public Keyã€‚ æ­¥éª¤ 4 - å¯†é’¥äº¤æ¢ï¼Œç”Ÿæˆä¼šè¯å¯†é’¥ æœåŠ¡å™¨å‘é€ `Change Cipher Spec, Encrypted Handshake Message`ã€‚ æœåŠ¡å™¨ä½¿ç”¨ Client DH Public Key, Server DH Private Key ç›´æŽ¥åœ¨æœ¬åœ°è®¡ç®—å‡ºä¸Žå®¢æˆ·ç«¯ä¸€è‡´çš„ PreMaster Secretï¼Œæ­¤å³å¯†é’¥äº¤æ¢ã€‚ æœåŠ¡å™¨ä½¿ç”¨ Client Random, Server Random, PreMaster Secret ç”Ÿæˆä¼šè¯å¯†é’¥ Session Keyã€‚ æœåŠ¡å™¨ä½¿ç”¨ Session Key è§£å¯†å®¢æˆ·ç«¯å‘æ¥çš„æ ¡éªŒæ•°æ®ï¼Œå¹¶è®¡ç®—æŠ¥æ–‡å“ˆå¸Œå€¼ä¸Žæ ¡éªŒæ•°æ®è¿›è¡Œå¯¹æ¯”ã€‚ åŒ RSA æ¡æ‰‹ï¼Œå‘é€ Change Cipher Spec å’Œ Encrypted Handshake Message2ã€‚ æ­¥éª¤ 5 - å®Œæˆæ¡æ‰‹ï¼ŒåŠ å¯†é€šä¿¡ åŒæ–¹å‘é€ `Application Data`ã€‚ åŒ RSA æ¡æ‰‹ã€‚ æ­¥éª¤ 6 - æ–­å¼€è¿žæŽ¥ å®¢æˆ·ç«¯å‘é€ `Encrypted Alert`ã€‚ åŒ RSA æ¡æ‰‹ã€‚ è¡¥å……è¯´æ˜Ž æ ¡éªŒæ•°æ® Finished Message The Illustrated TLS Connection: Every Byte Explained è¾ƒä¸ºè¯¦ç»†åœ°å±•ç¤ºäº† ECDHE æ¡æ‰‹çš„æµç¨‹ï¼Œå…¶è¯´æ³•å¦‚ä¸‹ï¼š 1 The verification data is built from a hash of all handshake messages and verifies the integrity of the handshake process. RFC5246 The Transport Layer Security (TLS) Protocol Version 1.2 çš„è¯´æ³•å¦‚ä¸‹ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 # 7.4.9 Finished The value handshake_messages includes all handshake messages starting at ClientHello up to, but not including, this Finished message. This may be different from handshake_messages in Section 7.4.8 because it would include the CertificateVerify message (if sent). Also, the handshake_messages for the Finished message sent by the client will be different from that for the Finished message sent by the server, because the one that is sent second will include the prior one. Note: ChangeCipherSpec messages, alerts, and any other record types are not handshake messages and are not included in the hash computations. Also, HelloRequest messages are omitted from handshake hashes. æ®æ­¤çŒœæµ‹ï¼Œæœ¬æ–‡ä¾‹å­ä¸­ï¼Œå‚ä¸Žå“ˆå¸Œçš„æŠ¥æ–‡åŒºé—´å¤§æ¦‚æ˜¯ [Client Hello, Client/Server Finished), Exclude(Change Cipher Spec)ã€‚ MAC æ‘˜è¦ æ‰€æœ‰ä½¿ç”¨ Session Key åŠ å¯†çš„æ•°æ®ï¼Œå…¶å†…éƒ½åŒ…å«äº†ä¸€ä¸ªåä¸º MAC (Message Authentication Code) çš„æŠ¥æ–‡æ‘˜è¦ã€‚MAC æœ‰å¤šç§å®žçŽ°ï¼Œæ¯”å¦‚ HMAC å’Œ GMACã€‚ HMAC å’Œ GMAC çš„ç‰¹ç‚¹ï¼ˆAIï¼‰ï¼š HMAC åŸºäºŽå“ˆå¸Œå‡½æ•°ï¼ˆå¦‚ SHA256ï¼‰ é€‚ç”¨äºŽé€šç”¨åœºæ™¯ éœ€è¦æ˜¾å¼åœ°ä¸ŽåŠ å¯†ç®—æ³•ï¼ˆå¦‚ AES-CBCï¼‰ç»“åˆä½¿ç”¨ GMAC åŸºäºŽ Galois åŸŸè¿ç®— ä¸“ä¸º GCM æ¨¡å¼è®¾è®¡ï¼Œé€šå¸¸ä¸Ž AES-GCM ç»“åˆä½¿ç”¨ã€‚ æä¾›æ›´é«˜çš„æ€§èƒ½ï¼Œå°¤å…¶æ˜¯åœ¨ç¡¬ä»¶åŠ é€Ÿçš„åœºæ™¯ä¸­ã€‚ å…·ä½“æœºåˆ¶æœ¬æ–‡ä¸ç ”ç©¶ï¼Œæˆ‘çš„ç†è§£æ˜¯æ•°æ®å’Œ MAC ä¸€èµ·è¢«åŠ å¯†ä¼ è¾“ï¼Œå¯¹ç«¯è§£å¯†åŽï¼Œå†è®¡ç®—æ•°æ®çš„ MAC ä¸ŽæŽ¥æ”¶åˆ°çš„ MAC å€¼å¯¹æ¯”ï¼Œä»Žè€ŒæŽ¢çŸ¥æ•°æ®æ˜¯å¦è¢«ç¯¡æ”¹ï¼Œæ­¤å³å®Œæ•´æ€§æ ¡éªŒã€‚ è¯•è®¡ç®— Server Key Exchange ä¸­çš„ç­¾åå¹¶éªŒç­¾ åœ¨ ECDHE æ¡æ‰‹-æ­¥éª¤ 2 ä¸­ï¼Œæˆ‘ä»¬æåˆ°ç­¾åæ˜¯å¯¹ Client Random, Server Random, Curve Info, Server DH Public Key çš„ç»„åˆè¿›è¡Œçš„ã€‚ä¿¡æ¯æ”¶é›†å¦‚ä¸‹ï¼š 1 2 # client random \x5b\x70\x1c\x25\x8a\xf4\x56\x6a\x81\xa7\xee\xcf\xa0\x9f\xbb\xcb\x35\xfd\x64\xae\xe5\xb0\x46\x03\xda\x92\x4e\xa0\x07\x79\x35\x2a 1 2 # server random \xcc\x26\xf9\x66\x00\x00\x00\x00\x67\x78\x0a\x00\x00\x00\x00\x00\x3f\x00\x00\x00\x3f\x00\x00\x00\x3f\x00\x00\x00\x3f\x00\x00\x00 1 2 3 4 5 6 # curve info \x03\x00\x17 # server dh public key \x41 \x04\x39\x3b\x76\x31\x87\x80\xe0\x0b\x27\xd4\xe7\xc4\x95\x27\x9c\x2f\xeb\x96\xa6\xe8\xd9\x87\x42\x2e\xce\xac\x84\xa2\x68\xda\x6f\x6f\x08\x05\xaa\xf9\x5d\x23\xa0\x24\xd1\x25\x30\x84\x11\x55\xcb\xe9\x69\xeb\xfb\xcf\xa8\xbd\xf8\x96\x8a\x0a\x7e\xad\x1c\xef\x84\xa8 å°†è¿™äº›æ•°æ®åˆå¹¶åœ¨ä¸€èµ·ï¼š 1 2 # compose the data together echo -n &quot;\x5b\x70\x1c\x25\x8a\xf4\x56\x6a\x81\xa7\xee\xcf\xa0\x9f\xbb\xcb\x35\xfd\x64\xae\xe5\xb0\x46\x03\xda\x92\x4e\xa0\x07\x79\x35\x2a\xcc\x26\xf9\x66\x00\x00\x00\x00\x67\x78\x0a\x00\x00\x00\x00\x00\x3f\x00\x00\x00\x3f\x00\x00\x00\x3f\x00\x00\x00\x3f\x00\x00\x00\x03\x00\x17\x41\x04\x39\x3b\x76\x31\x87\x80\xe0\x0b\x27\xd4\xe7\xc4\x95\x27\x9c\x2f\xeb\x96\xa6\xe8\xd9\x87\x42\x2e\xce\xac\x84\xa2\x68\xda\x6f\x6f\x08\x05\xaa\xf9\x5d\x23\xa0\x24\xd1\x25\x30\x84\x11\x55\xcb\xe9\x69\xeb\xfb\xcf\xa8\xbd\xf8\x96\x8a\x0a\x7e\xad\x1c\xef\x84\xa8&quot; &gt; data æœåŠ¡å™¨æœ¬èº«çš„ç§é’¥ä¹Ÿè´´åœ¨æ­¤å¤„ï¼Œæ–‡ä»¶ä»¥ \n ç»“å°¾ã€‚è¿™æ˜¯ä¸€ä¸ªåŸºäºŽæ›²çº¿ prime256v1(secp256r1) çš„ ECC ç§é’¥ã€‚ 1 2 3 4 5 6 7 8 9 10 # server private key -----BEGIN EC PARAMETERS----- BggqhkjOPQMBBw== -----END EC PARAMETERS----- -----BEGIN EC PRIVATE KEY----- MHcCAQEEIIshQQR4px7Ek+5jRugTnySv5cjqSs1PbDlnmR1SSC4joAoGCCqGSM49 AwEHoUQDQgAE4Q+9ZBPkV4b2buqwPLB9EskoGByXTcPuF22znhtFG2R9gVlFyU4S 3GyXx3QaFOfLLNdyl/puch+GlZAZZsYKPw== -----END EC PRIVATE KEY----- å…¶åå…­è¿›åˆ¶ä¸ºï¼š 1 2 3 # server private key hex xxd -ps server-ecc-key.pem | tr -d &quot;\n&quot; | sed &#39;s/\(..\)/\\x\1/g&#39; \x2d\x2d\x2d\x2d\x2d\x42\x45\x47\x49\x4e\x20\x45\x43\x20\x50\x41\x52\x41\x4d\x45\x54\x45\x52\x53\x2d\x2d\x2d\x2d\x2d\x0a\x42\x67\x67\x71\x68\x6b\x6a\x4f\x50\x51\x4d\x42\x42\x77\x3d\x3d\x0a\x2d\x2d\x2d\x2d\x2d\x45\x4e\x44\x20\x45\x43\x20\x50\x41\x52\x41\x4d\x45\x54\x45\x52\x53\x2d\x2d\x2d\x2d\x2d\x0a\x2d\x2d\x2d\x2d\x2d\x42\x45\x47\x49\x4e\x20\x45\x43\x20\x50\x52\x49\x56\x41\x54\x45\x20\x4b\x45\x59\x2d\x2d\x2d\x2d\x2d\x0a\x4d\x48\x63\x43\x41\x51\x45\x45\x49\x49\x73\x68\x51\x51\x52\x34\x70\x78\x37\x45\x6b\x2b\x35\x6a\x52\x75\x67\x54\x6e\x79\x53\x76\x35\x63\x6a\x71\x53\x73\x31\x50\x62\x44\x6c\x6e\x6d\x52\x31\x53\x53\x43\x34\x6a\x6f\x41\x6f\x47\x43\x43\x71\x47\x53\x4d\x34\x39\x0a\x41\x77\x45\x48\x6f\x55\x51\x44\x51\x67\x41\x45\x34\x51\x2b\x39\x5a\x42\x50\x6b\x56\x34\x62\x32\x62\x75\x71\x77\x50\x4c\x42\x39\x45\x73\x6b\x6f\x47\x42\x79\x58\x54\x63\x50\x75\x46\x32\x32\x7a\x6e\x68\x74\x46\x47\x32\x52\x39\x67\x56\x6c\x46\x79\x55\x34\x53\x0a\x33\x47\x79\x58\x78\x33\x51\x61\x46\x4f\x66\x4c\x4c\x4e\x64\x79\x6c\x2f\x70\x75\x63\x68\x2b\x47\x6c\x5a\x41\x5a\x5a\x73\x59\x4b\x50\x77\x3d\x3d\x0a\x2d\x2d\x2d\x2d\x2d\x45\x4e\x44\x20\x45\x43\x20\x50\x52\x49\x56\x41\x54\x45\x20\x4b\x45\x59\x2d\x2d\x2d\x2d\x2d\x0a çŽ°åœ¨ä½¿ç”¨ç§é’¥å¯¹æ•°æ®ç­¾åï¼Œopenssl ä¼šæ ¹æ®ç§é’¥ç±»åž‹è‡ªåŠ¨é€‰æ‹©ç›¸åº”çš„ç­¾åç®—æ³•ï¼Œå¯¹äºŽ ECC ç§é’¥ï¼Œä¼šé»˜è®¤é€‰æ‹© ECDSA ç®—æ³•ã€‚æŠ¥æ–‡ä¸­å®žé™…ä½¿ç”¨çš„ç­¾åç®—æ³•ä¸º ecdsa_secp256r1_sha256ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ -sha256ï¼Œä½¿å“ˆå¸Œç®—æ³•ä¹Ÿä¿æŒä¸€è‡´ã€‚ 1 2 3 4 5 6 7 8 9 10 # sign the data with the server private key openssl dgst -sign server-ecc-key.pem -sha256 -out sig data # see the signature xxd -ps sig # result: 3044022020b6c7803f90785be49b6d70744f82bc7a421718da24e39abb74 3505fe23882b02203b56f27ca41156b86948f658e07eda922f06dc6c4284 bbd179c6da108a48b4e5 è‡³æ­¤æˆ‘ä»¬å¾—åˆ°äº†ç­¾åï¼Œä½†æ˜¯è¯¥ç­¾åä¸ŽæŠ¥æ–‡ä¸­çš„å®žé™…å€¼å¹¶ä¸ç›¸åŒã€‚ä¸ä»…å¦‚æ­¤ï¼Œä½ ä¼šå‘çŽ°æ¯æ¬¡ç­¾åå¾—åˆ°çš„ç»“æžœéƒ½æ˜¯ä¸åŒçš„ã€‚è¿™æ˜¯å› ä¸º ECDSA ç­¾åç®—æ³•å†…éƒ¨æ··å…¥äº†éšæœºå€¼ï¼Œå³ä¾¿ä½¿ç”¨åŒä¸€ç§é’¥å¯¹åŒä¸€æ¶ˆæ¯è¿›è¡Œå¤šæ¬¡ç­¾åï¼Œç»“æžœä¹Ÿä¼šä¸åŒã€‚ å¦‚æžœæ˜¯ RSA ç§é’¥ï¼Œé‚£ä¹ˆè®¡ç®—å¾—åˆ°çš„ RSA ç­¾åæ˜¯å¯ä»¥ä¸ŽæŠ¥æ–‡ä¸­çš„å®žé™…å€¼å¯¹ä¸Šçš„ã€‚ä½¿ç”¨åŒä¸€ç§é’¥å¯¹åŒä¸€æ¶ˆæ¯è¿›è¡Œå¤šæ¬¡ç­¾åï¼Œç»“æžœæ˜¯ç›¸åŒçš„ã€‚ ä¸è¿‡è¿™å¹¶ä¸ä¼šå½±å“éªŒç­¾çš„ç»“æžœã€‚ä¸‹é¢æˆ‘ä»¬è¿›è¡ŒéªŒç­¾ã€‚ å®žé™…éªŒç­¾æ—¶ï¼Œå®¢æˆ·ç«¯ä¼šä»ŽæœåŠ¡å™¨è¯ä¹¦ä¸­æå–å‡ºå…¬é’¥ã€‚å¦‚ä¸‹ï¼Œæ–‡ä»¶ä»¥ \n ç»“å°¾ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 # extract the public key from the server certificate openssl x509 -in server-ecc-cert.pem -pubkey -noout &gt; server-ecc-pub.pem # server public key -----BEGIN PUBLIC KEY----- MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAE4Q+9ZBPkV4b2buqwPLB9EskoGByX TcPuF22znhtFG2R9gVlFyU4S3GyXx3QaFOfLLNdyl/puch+GlZAZZsYKPw== -----END PUBLIC KEY----- # server public key hex xxd -ps server-ecc-pub.pem | tr -d &quot;\n&quot; | sed &#39;s/\(..\)/\\x\1/g&#39; \x2d\x2d\x2d\x2d\x2d\x42\x45\x47\x49\x4e\x20\x50\x55\x42\x4c\x49\x43\x20\x4b\x45\x59\x2d\x2d\x2d\x2d\x2d\x0a\x4d\x46\x6b\x77\x45\x77\x59\x48\x4b\x6f\x5a\x49\x7a\x6a\x30\x43\x41\x51\x59\x49\x4b\x6f\x5a\x49\x7a\x6a\x30\x44\x41\x51\x63\x44\x51\x67\x41\x45\x34\x51\x2b\x39\x5a\x42\x50\x6b\x56\x34\x62\x32\x62\x75\x71\x77\x50\x4c\x42\x39\x45\x73\x6b\x6f\x47\x42\x79\x58\x0a\x54\x63\x50\x75\x46\x32\x32\x7a\x6e\x68\x74\x46\x47\x32\x52\x39\x67\x56\x6c\x46\x79\x55\x34\x53\x33\x47\x79\x58\x78\x33\x51\x61\x46\x4f\x66\x4c\x4c\x4e\x64\x79\x6c\x2f\x70\x75\x63\x68\x2b\x47\x6c\x5a\x41\x5a\x5a\x73\x59\x4b\x50\x77\x3d\x3d\x0a\x2d\x2d\x2d\x2d\x2d\x45\x4e\x44\x20\x50\x55\x42\x4c\x49\x43\x20\x4b\x45\x59\x2d\x2d\x2d\x2d\x2d\x0a ä½¿ç”¨å…¬é’¥éªŒç­¾ã€‚ 1 2 3 # verify the signature openssl dgst -verify server-ecc-pub.pem -signature sig -sha256 data Verified OK éªŒè¯é€šè¿‡ã€‚ ä¸ºä»€ä¹ˆéªŒç­¾è¦ä½¿ç”¨è¯ä¹¦è€Œä¸èƒ½ç›´æŽ¥ä½¿ç”¨å…¬é’¥ï¼Ÿ çŽ°æœ‰ä¸¤ä¸ªäºº A å’Œ Bï¼ŒB ç”¨è‡ªå·±çš„ç§é’¥ç­¾åäº†ä¸€æ®µä¿¡æ¯ï¼Œå‘ç»™ Aã€‚çŽ°åœ¨ A ç”¨ B çš„å…¬é’¥éªŒç­¾ï¼Œå‘çŽ°èƒ½å¤ŸæˆåŠŸè§£å¯†ï¼Œæ‰€ä»¥ä»¥æ­¤è®¤å®šä¿¡æ¯çš„å‘é€è€…æ˜¯ Bã€‚è¿™ä¼¼ä¹Žæ²¡æœ‰é—®é¢˜ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦å…¬é’¥è¯ä¹¦å‘¢ï¼Ÿ é—®é¢˜çš„å…³é”®åœ¨äºŽï¼ŒB çš„å…¬é’¥æ˜¯å¦å¯ä¿¡ï¼ŒB çš„å…¬é’¥æ˜¯å¦çœŸçš„æ˜¯ B çš„å…¬é’¥ã€‚å¦‚æžœæœ‰ä¸­é—´äººæ”»å‡»ï¼Œæ”»å‡»è€… C æŽ‰åŒ…äº† B çš„å…¬é’¥ä¸ºè‡ªå·±çš„å…¬é’¥ï¼Œç„¶åŽè‡ªå·±ç­¾åå‘é€ä¸€æ®µä¿¡æ¯ç»™ Aï¼Œé‚£ä¹ˆ A å°±ä¼šè¯¯ä»¥ä¸ºä¿¡æ¯çš„å‘é€è€…æ˜¯ Bï¼Œè€Œå®žé™…å‘é€è€…å´æ˜¯ Aã€‚ æ‰€ä»¥ï¼Œæœ‰å¿…è¦ç¡®ä¿å…¬é’¥çš„ç¡®æ˜¯ B çš„ï¼Œè€Œè¯ä¹¦èƒ½å¤Ÿè¯æ˜Žè¿™ä¸€ç‚¹ã€‚è¯ä¹¦ç”±å¹¿å—ç¤¾ä¼šä¿¡ä»»çš„ CA ç­¾å‘ï¼Œå…¶ä¸­åŒ…å«äº†å…¬é’¥æœ¬èº«å’Œå…¬é’¥æ‰€ä»£è¡¨çš„èº«ä»½ä¿¡æ¯ã€‚A åœ¨æ”¶åˆ° B çš„è¯ä¹¦åŽï¼Œä½¿ç”¨ CA çš„è¯ä¹¦éªŒè¯ B çš„è¯ä¹¦ï¼ŒéªŒè¯é€šè¿‡å³ä»£è¡¨ B çš„è¯ä¹¦çš„ç¡®æ˜¯ç”± CA ç­¾å‘çš„ï¼ŒCA ä¿¡ä»» B çš„èº«ä»½ï¼Œè€Œ CA æ˜¯å¹¿å—ä¿¡ä»»çš„ï¼ŒA è‡ªç„¶ä¹Ÿä¿¡ä»» CAï¼ŒäºŽæ˜¯ A å¯ä»¥ä¿¡ä»» B çš„èº«ä»½ï¼Œä¹Ÿå³ï¼šåªè¦éªŒè¿‡äº†è¯ä¹¦ï¼Œå°±å¯ä»¥ç›¸ä¿¡å…¬é’¥æ‰€ä»£è¡¨çš„èº«ä»½ï¼Œå°±è¯æ˜Žå…¬é’¥çš„ç¡®å±žäºŽå®ƒæ‰€ä»£è¡¨çš„é‚£ä¸ªèº«ä»½æœºæž„ã€‚ å³ä¾¿æ”»å‡»è€…æŽ‰åŒ… B çš„å…¬é’¥ï¼Œä»–ä¹Ÿæ— æ³•ä¼ªé€  CA çš„ç­¾åï¼Œæ‰€ä»¥æ”»å‡»è€…æ˜¯æ— æ³•ä¼ªé€ è¯ä¹¦çš„ã€‚è¯ä¹¦/ä¿¡ä»»é“¾æœºåˆ¶ä»¥ CA è¿™æ ·çš„ç¬¬ä¸‰æ–¹æƒå¨æœºæž„ä½œèƒŒä¹¦ï¼Œèƒ½å¤Ÿé˜²èŒƒä¸­é—´äººæ”»å‡»ï¼Œç¡®ä¿å…¬é’¥çš„çœŸå®žæ€§ã€‚ å¯¹äºŽä»¥ä¸‹æƒ…å†µï¼š A å’Œ B æ˜¯å¥½å‹ï¼ŒçŽ°åœ¨å°±é¢å¯¹é¢ç«™ç€äº¤æŽ¥å…¬é’¥ã€‚ B ä»¥ç”¨æˆ·åå¯†ç çš„æ–¹å¼å·²ç»é€šè¿‡äº† A çš„èº«ä»½è®¤è¯ï¼Œå†äº¤æŽ¥å…¬é’¥ã€‚ A èƒ½å¤Ÿç›´æŽ¥ä¿¡ä»» Bï¼Œç›´æŽ¥è®¤å¯å…¬é’¥çš„çœŸå®žæ€§ï¼Œè¿™å°±ä¸éœ€è¦è¯ä¹¦äº†ã€‚A ä»¥åŽç›´æŽ¥ä½¿ç”¨å…¬é’¥éªŒç­¾å³å¯ã€‚ç„¶è€Œï¼Œåœ¨å¼€æ”¾çš„ç½‘ç»œé€šä¿¡ä¸­ï¼Œè¯ä¹¦/ä¿¡ä»»é“¾æœºåˆ¶ä¸å¯æˆ–ç¼ºã€‚ TLS ç®—æ³•åç§°çš„å«ä¹‰ åœ¨ç†Ÿæ‚‰äº†æ¡æ‰‹çš„çŸ¥è¯†ä»¥åŽï¼Œæˆ‘ä»¬å†æ¥ç†è§£ç®—æ³•åç§°çš„å«ä¹‰ã€‚è¿™å¹¶æ²¡æœ‰æƒ³è±¡ä¸­é‚£ä¹ˆç®€å•ï¼Œç”±äºŽç®—æ³•ç‰ˆæœ¬çš„æ›´è¿­ï¼Œç®—æ³•åç§°çš„å«ä¹‰ä¼šæœ‰ä¸€äº›å·®åˆ«ã€‚å…ˆè´´ä¸Šå‡ ä¸ªç®—æ³•åç§°çš„ä¾‹å­ï¼š 1 2 3 4 5 6 7 8 9 TLS_RSA_WITH_AES_256_CBC_SHA256 TLS_RSA_WITH_AES_128_GCM_SHA256 TLS_RSA_WITH_AES_256_GCM_SHA384 TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256 TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384 TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 TLS_ECDH_RSA_WITH_AES_256_CBC_SHA TLS_ECDH_ECDSA_WITH_AES_256_CBC_SHA SHA æ˜¯æŒ‡ HMAC è®¡ç®—ä»¥åŠ Finished æ ¡éªŒç­‰æµç¨‹æ‰€ä½¿ç”¨çš„å“ˆå¸Œç®—æ³•ï¼ŒCBC/GCM æ˜¯åˆ†ç»„å¯†ç å·¥ä½œæ¨¡å¼ï¼ŒAES_256 æ˜¯å…±äº«å¯†ç ç®—æ³•å’Œå…±äº«å¯†é’¥é•¿åº¦ã€‚ç´§è·Ÿåœ¨ TLS åŽé¢çš„ RSA/ECDHE/ECDH æ˜¯å¯†é’¥äº¤æ¢ç®—æ³•ï¼Œå…¶ä¸­ DHE å¯†é’¥äº¤æ¢è¿‡ç¨‹ä¸­ä¼šç”¨åˆ°ç­¾åï¼Œæ‰€ä»¥åŽé¢è¿˜è·Ÿäº†ä¸€ä¸ªç­¾åç®—æ³•â€”â€”ECDSA/RSAã€‚ é—®é¢˜å‡ºçŽ°äº†ï¼ŒECDH å¯†é’¥äº¤æ¢ä¸­ï¼ŒECDH å¯†é’¥å¯¹ä¸æ˜¯ä¸´æ—¶ç”Ÿæˆçš„ï¼ŒæœåŠ¡å™¨æ˜¯ç›´æŽ¥å°†è¯ä¹¦ä½œä¸º ECDH å…¬é’¥å‘ç»™å®¢æˆ·ç«¯çš„ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­æœåŠ¡å™¨ä¸éœ€è¦è¿›è¡Œé¢å¤–çš„ç­¾åï¼Œé‚£ä¸ºä»€ä¹ˆä¼šå­˜åœ¨ ECDH_RSA/ECDH_ECDSA è¿™æ ·çš„ç®—æ³•åç§°å‘¢ï¼Ÿè¿™æ¶‰åŠä¸€ä¸ªè¢«å¹¿æ³›è¯¯è§£çš„é—®é¢˜ï¼šç®—æ³•åç§°ä¸­çš„ç­¾åç®—æ³•åˆ°åº•æ˜¯æŒ‡è¯ä¹¦ä¸Šæ‰€ä½¿ç”¨çš„ç­¾åè¿˜æ˜¯æ¡æ‰‹è¿‡ç¨‹ä¸­æ‰€ä½¿ç”¨çš„ç­¾åï¼Ÿæžæ¸…è¿™ä¸ªé—®é¢˜å¤§æ¦‚æ²¡ä»€ä¹ˆå®žç”¨ä»·å€¼ï¼Œä½†ä¸æžæ¸…å®žåœ¨è®©æˆ‘ä¸èˆ’æœðŸ˜£ã€‚åœ¨ä¸€ä¼— RFC ä¸­ï¼Œæˆ‘é€æ¸æ‰¾åˆ°äº†ç­”æ¡ˆã€‚ RFC4346 The Transport Layer Security (TLS) Protocol Version 1.1 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # 7.4.2 Server Certificate The certificate type MUST be appropriate for the selected cipher suite&#39;s key exchange algorithm, and is generally an X.509v3 certificate. It MUST contain a key that matches the key exchange method, as follows. Unless otherwise specified, the signing algorithm for the certificate MUST be the same as the algorithm for the certificate key. Unless otherwise specified, the public key MAY be of any length. Key Exchange Algorithm Certificate Key Type RSA RSA public key; the certificate MUST allow the key to be used for encryption. DHE_DSS DSS public key. DHE_RSA RSA public key that can be used for signing. DH_DSS Diffie-Hellman key. The algorithm used to sign the certificate MUST be DSS. DH_RSA Diffie-Hellman key. The algorithm used to sign the certificate MUST be RSA. è¿™æ˜¯ TLS1.1 çš„ RFCã€‚ä¸Šé¢çš„æ„æ€æ˜¯ï¼šè¯ä¹¦çš„ç­¾åç®—æ³•å¿…é¡»ä¸Žç¡®å®šå¯†é’¥å¯¹ç±»åž‹çš„ç®—æ³•ä¿æŒä¸€è‡´ã€‚æ–‡ä¸­è¿˜ä¸¾äº†å‡ ä¸ªä¾‹å­ï¼š å¯†é’¥äº¤æ¢ç®—æ³• å¯†é’¥å¯¹ç±»åž‹ æ¡æ‰‹ç­¾åç®—æ³•ï¼ˆæŽ¨ç†ï¼‰ è¯ä¹¦ç­¾åç®—æ³•ï¼ˆæŽ¨ç†ï¼‰ RSA RSA / RSA DHE_DSS DSS DSS DSS DHE_RSA RSA RSA RSA DH_DSS DH / DSS DH_RSA DH / RSA æ³¨ï¼ˆAIï¼‰ï¼šDSS æ˜¯ä¸€ä¸ªæ•°å­—ç­¾åæ ‡å‡†ï¼ŒDSA ç®—æ³•æ˜¯å…¶æœ€åˆçš„æ ¸å¿ƒå®žçŽ°ï¼Œéšç€ DSS æ ‡å‡†çš„ç‰ˆæœ¬æ›´æ–°ï¼ŒRSA å’Œ ECDSA ä¹Ÿè¢«çº³å…¥æ ‡å‡†ä¸­ã€‚ æˆ‘ä»¬å¯ä»¥å‘çŽ°ä¸Šè¡¨ä¸­çš„ä¸¤ä¸ª DH å¯†é’¥äº¤æ¢ç®—æ³•æ²¡æœ‰éµå®ˆâ€œè¯ä¹¦çš„ç­¾åç®—æ³•å¿…é¡»ä¸Žç¡®å®šå¯†é’¥å¯¹ç±»åž‹çš„ç®—æ³•ä¿æŒä¸€è‡´â€çš„è§„å®šï¼Œè¿™æ˜¯å› ä¸º DH ç®—æ³•åªèƒ½ç”¨ä½œå¯†é’¥äº¤æ¢ï¼Œä¸èƒ½ç”¨æ¥ç­¾åï¼Œè¿™æ‰é¢å¤–è¿½åŠ äº†ä¸€ä¸ªç®—æ³•åç§°ï¼Œç”¨äºŽæŒ‡å®šè¯ä¹¦çš„ç­¾åç®—æ³•ã€‚ RFC4346 The Transport Layer Security (TLS) Protocol Version 1.1 1 2 3 4 5 6 7 8 9 # F.1.1.3 Diffie-Hellman Key Exchange with Authentication When Diffie-Hellman key exchange is used, the server can either supply a certificate containing fixed Diffie-Hellman parameters or use the server key exchange message to send a set of temporary Diffie-Hellman parameters signed with a DSS or RSA certificate. Temporary parameters are hashed with the hello.random values before signing to ensure that attackers do not replay old parameters. In either case, the client can verify the certificate or signature to ensure that the parameters belong to the server. è¿™æ®µè¯´æ˜ŽæœåŠ¡å™¨å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼æä¾› DH å‚æ•°ï¼šä¸€ç§æ˜¯ç›´æŽ¥å‘é€ DH è¯ä¹¦ï¼Œå®¢æˆ·ç«¯é€šè¿‡éªŒè¯è¯ä¹¦è¯æ˜Ž DH å‚æ•°çš„ç¡®å±žäºŽæœåŠ¡å™¨ï¼›ä¸€ç§æ˜¯å‘é€å¸¦ç­¾åçš„ä¸´æ—¶ç”Ÿæˆçš„ DHE å‚æ•°ï¼Œå®¢æˆ·ç«¯é€šè¿‡éªŒç­¾è¯æ˜Ž DHE å‚æ•°çš„ç¡®å±žäºŽæœåŠ¡å™¨ã€‚ è¿™æ®µè‡³å°‘å¯ä»¥ä½è¯æˆ‘å¯¹ DH å’Œ DHE çš„ç†è§£æ˜¯æ­£ç¡®çš„ã€‚ RFC4492 Elliptic Curve Cryptography (ECC) Cipher Suites for Transport Layer Security (TLS) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # 2.1 ECDH_ECDSA In ECDH_ECDSA, the serverâ€™s certificate MUST contain an ECDH-capable public key and be signed with ECDSA. # 2.2 ECDHE_ECDSA In ECDHE_ECDSA, the serverâ€™s certificate MUST contain an ECDSA capable public key and be signed with ECDSA. # 2.3 ECDH_RSA This key exchange algorithm is the same as ECDH_ECDSA except that the serverâ€™s certificate MUST be signed with RSA rather than ECDSA. # 2.4 ECDHE_RSA This key exchange algorithm is the same as ECDHE_ECDSA except that the serverâ€™s certificate MUST contain an RSA public key authorized for signing, and that the signature in the ServerKeyExchange message must be computed with the corresponding RSA private key. The server certificate MUST be signed with RSA. è¿™æ˜¯ TLS1.1 ECC ç®—æ³•çš„ RFCã€‚æ‰€è¿°é€»è¾‘ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œä¸Žä¸Šé¢çš„è¯´æ³•éƒ½å¯¹å¾—ä¸Šã€‚ é—®é¢˜æ€»ç»“ - TLS1.1ï¼š è¯ä¹¦çš„ç­¾åç®—æ³•å¿…é¡»ä¸Žç¡®å®šå¯†é’¥å¯¹ç±»åž‹çš„ç®—æ³•ä¿æŒä¸€è‡´ã€‚ RSA å¯†é’¥äº¤æ¢ä¸­æ²¡æœ‰ç­¾åçš„è¿‡ç¨‹ï¼Œæ•…ç®—æ³•åç§°ä¸­æ²¡æœ‰ç­¾åç®—æ³•ã€‚è¯ä¹¦çš„ç­¾åç®—æ³•é¡»ä¸º RSAã€‚ DHE å¯†é’¥äº¤æ¢ä¸­æœ‰ç­¾åçš„è¿‡ç¨‹ï¼Œæ•…ç®—æ³•åç§°ä¸­æŒ‡å®šäº†ç­¾åç®—æ³•ï¼Œå¦‚ ECDHE_RSAã€‚è¯ä¹¦çš„ç­¾åç®—æ³•é¡»ä¸Žè¯¥ç­¾åç®—æ³•ä¸€è‡´ã€‚ DH å¯†é’¥äº¤æ¢ä¸­æ²¡æœ‰ç­¾åçš„è¿‡ç¨‹ï¼Œå…¶ç®—æ³•åç§°ä¸­æœ¬ä¸éœ€è¦æŒ‡å®šç­¾åç®—æ³•ï¼Œç„¶è¯ä¹¦çš„ç­¾åç®—æ³•é¡»ä¸Žç¡®å®šå¯†é’¥å¯¹ç±»åž‹çš„ç®—æ³•ï¼ˆDHï¼‰ä¿æŒä¸€è‡´ï¼Œè€Œ DH ç®—æ³•æ— æ³•ç”¨äºŽç­¾åï¼Œæ•…ç®—æ³•åç§°ä¸­é¢å¤–æŒ‡å®šäº†è¯ä¹¦çš„ç­¾åç®—æ³•ï¼Œå¦‚ ECDH_RSAã€‚ RFC5246 The Transport Layer Security (TLS) Protocol Version 1.2 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 # A.7 Changes to RFC 4492 As described in Sections 7.4.2 and 7.4.6, the restrictions on the signature algorithms used to sign certificates are no longer tied to the cipher suite (when used by the server) or the ClientCertificateType (when used by the client). Thus, the restrictions on the algorithm used to sign certificates specified in Sections 2 and 3 of RFC 4492 are also relaxed. # 7.4.2 Server Certificate If the client provided a &quot;signature_algorithms&quot; extension, then all certificates provided by the server MUST be signed by a hash/signature algorithm pair that appears in that extension. Note that this implies that a certificate containing a key for one signature algorithm MAY be signed using a different signature algorithm (for instance, an RSA key signed with a DSA key). This is a departure from TLS 1.1, which required that the algorithms be the same. Note that this also implies that the DH_DSS, DH_RSA, ECDH_ECDSA, and ECDH_RSA key exchange algorithms do not restrict the algorithm used to sign the certificate. Fixed DH certificates MAY be signed with any hash/signature algorithm pair appearing in the extension. The names DH_DSS, DH_RSA, ECDH_ECDSA, and ECDH_RSA are historical. # 7.4.1.4.1 Signature Algorithms The client uses the &quot;signature_algorithms&quot; extension to indicate to the server which signature/hash algorithm pairs may be used in digital signatures. # 7.4.1.4.1 Signature Algorithms The semantics of this extension are somewhat complicated because the cipher suite indicates permissible signature algorithms but not hash algorithms. Sections 7.4.2 and 7.4.3 describe the appropriate rules. # 7.4.3 Server Key Exchange Message If the client has offered the &quot;signature_algorithms&quot; extension, the signature algorithm and hash algorithm MUST be a pair listed in that extension. Note that there is a possibility for inconsistencies here. For instance, the client might offer DHE_DSS key exchange but omit any DSA pairs from its &quot;signature_algorithms&quot; extension. In order to negotiate correctly, the server MUST check any candidate cipher suites against the &quot;signature_algorithms&quot; extension before selecting them. This is somewhat inelegant but is a compromise designed to minimize changes to the original cipher suite design. è¿™æ˜¯ TLS1.2 çš„ RFCã€‚æ–°å¢žäº† signature_algorithms æ‰©å±•å­—æ®µï¼Œå®ƒä»£è¡¨äº†å®¢æˆ·ç«¯æ”¯æŒçš„ç­¾åç®—æ³•ã€‚å¯†é’¥äº¤æ¢è¿‡ç¨‹ä¸­å¯èƒ½ç”¨åˆ°çš„ç­¾åç®—æ³•ç”±æ­¤å­—æ®µåå•†è€Œæ¥ã€‚è¯ä¹¦çš„ç­¾åç®—æ³•ä¸å†å— TLS ç®—æ³•åç§°çº¦æŸï¼Œåªé¡»ä½åˆ— signature_algorithms æ‰€æ”¯æŒçš„ç®—æ³•åˆ—è¡¨ä¸­ã€‚ å¯¹äºŽå¯†é’¥äº¤æ¢è¿‡ç¨‹ä¸­å¯èƒ½å‡ºçŽ°çš„ç­¾åè¿‡ç¨‹ï¼ŒTLS ç®—æ³•åç§°ä¸­åªæŒ‡å®šäº†ç­¾åç®—æ³•ï¼Œå´æ²¡æœ‰å“ˆå¸Œç®—æ³•ï¼ˆåç§°ä¸­çš„å“ˆå¸Œç®—æ³•ä¸º HMAC æˆ– Finished æŠ¥æ–‡æ‰€ç”¨ï¼‰ï¼Œé‚æœ‰ signature_algorithmsï¼Œå…¶ä¸­çš„åç§°åŒæ—¶åŒ…å«äº†ç­¾åå’Œå“ˆå¸Œç®—æ³•ã€‚å¦‚æ­¤ï¼ŒTLS ç®—æ³•åç§°å’Œæ‰©å±•å­—æ®µéƒ½ç»™å‡ºäº†ç­¾åç®—æ³•åç§°ï¼Œä¸ºåŒæ—¶æ»¡è¶³äºŒè€…çº¦æŸï¼ŒæœåŠ¡å™¨å¿…é¡»äºˆä»¥æ£€æŸ¥ï¼Œæœ€ç»ˆåå•†é€‰æ‹©å‡ºçš„ç­¾åç®—æ³•é¡»åŒæ—¶å…¼å®¹ TLS ç®—æ³•åç§°å’Œæ‰©å±•å­—æ®µã€‚ ä¸¾ä¾‹ï¼Œè‹¥ TLS ç®—æ³•åç§°ä¸º ECDHE_ECDSAï¼Œæ‰©å±• signature_algorithms ä¸­å«æœ‰ ecdsa_secp256r1_sha256, rsa_pkcs1_sha256ï¼Œé‚£ä¹ˆæœåŠ¡å™¨åº”åå•†é€‰æ‹©å‡º ecdsa_secp256r1_sha256 ä½œä¸ºç­¾åç®—æ³•ã€‚æ—¢å¦‚æ­¤ï¼Œè¯ä¹¦åº”é€‰ç”¨ ECC è¯ä¹¦ï¼Œä½†è¯ä¹¦è‡ªå·±çš„ç­¾åå¯ä»¥æ˜¯ RSAã€‚ å¦ï¼Œå¯¹äºŽé™æ€ DH å¯†é’¥äº¤æ¢ç®—æ³•å¦‚ ECDH_ECDSA, ECDH_RSAï¼Œå…¶åç§°ä¸­çš„ç­¾åç®—æ³•å·²ç»ä¸å«æœ‰ä»»ä½•å®žé™…çº¦æŸæ„ä¹‰ï¼Œæ­¤ç±»è¿·æƒ‘æ€§åè¶³çš„åç§°ä¹‹å­˜åœ¨çš†ç³»åŽ†å²åŽŸå› ã€‚ RFC8422 Elliptic Curve Cryptography (ECC) Cipher Suites for Transport Layer Security (TLS) Versions 1.2 and Earlier 1 2 3 4 5 6 7 8 9 # 2.1 ECDHE_ECDSA In ECDHE_ECDSA, the serverâ€™s certificate MUST contain an ECDSA- or EdDSA-capable public key. # 2.2 ECDHE_RSA This key exchange algorithm is the same as ECDHE_ECDSA except that the serverâ€™s certificate MUST contain an RSA public key authorized for signing and the signature in the ServerKeyExchange message must be computed with the corresponding RSA private key. è¿™æ˜¯ TLS1.2 å‡ºçŽ°åŽï¼Œæœ‰å…³ ECC ç®—æ³•çš„ RFCã€‚ç›¸æ¯” RFC4492 çš„è¡¨è¿°ï¼Œè¯¥è¡¨è¿°æ²¡æœ‰å†ç‰¹åˆ«æåŠè¯ä¹¦æœ¬èº«çš„ç­¾ååº”ä¸ºä½•ç®—æ³•ï¼Œå› ä¸ºè¯ä¹¦çš„ç­¾åç®—æ³•å·²ä¸å†å— TLS ç®—æ³•åç§°çº¦æŸï¼Œåªè¦ä½åˆ— signature_algorithms çš„ç®—æ³•åˆ—è¡¨ï¼Œæ˜¯ä»€ä¹ˆç®—æ³•éƒ½æœ‰å¯èƒ½ã€‚ é—®é¢˜æ€»ç»“ - TLS1.2ï¼š å¯†é’¥äº¤æ¢è¿‡ç¨‹ä¸­å¯èƒ½ç”¨åˆ°çš„ç­¾åç®—æ³•æ ¹æ®å®¢æˆ·ç«¯æ”¯æŒçš„ TLS ç®—æ³•å’Œ signature_algorithms æ‰©å±•åå•†è€Œæ¥ã€‚ è¯ä¹¦çš„ç­¾åç®—æ³•ä¸å†å— TLS ç®—æ³•åç§°çº¦æŸï¼Œåªé¡»ä½åˆ— signature_algorithms æ‰€æ”¯æŒçš„ç®—æ³•åˆ—è¡¨ä¸­ã€‚ é™æ€ DH å¯†é’¥äº¤æ¢ç®—æ³•å¦‚ ECDH_ECDSA, ECDH_RSAï¼Œå…¶åç§°ä¸­çš„ç­¾åç®—æ³•ä¸å…·æœ‰ä»»ä½•å®žé™…çº¦æŸæ„ä¹‰ï¼Œæ­¤ç±»åç§°ä¹‹å­˜åœ¨çš†ç³»åŽ†å²åŽŸå› ã€‚ é—®é¢˜ç»“è®ºï¼š TLS ç®—æ³•åç§°ä¸­çš„ç­¾åç®—æ³•åŸºæœ¬æŒ‡çš„æ˜¯æ¡æ‰‹è¿‡ç¨‹ä¸­æ‰€ä½¿ç”¨çš„ç­¾åï¼Œè€Œéžç‰¹æŒ‡è¯ä¹¦æœ¬èº«çš„ç­¾åï¼Œä¸è¿‡äºŒè€…ä¹Ÿå¹¶éžæ¯«æ— å…³è”ï¼Œå…·ä½“ç»†èŠ‚å‚è§ä¸Šé¢çš„åˆ†æžå’Œæ€»ç»“ã€‚ æž„å»ºè¯ä¹¦é“¾ å°è¯•ä½¿ç”¨ openssl æž„å»ºå¦‚ä¸‹è¯ä¹¦é“¾ã€‚ 1 Root CA Cert -&gt; Intermediate CA Cert -&gt; End Entity Cert æ ¹ CA ä½œä¸ºä¿¡ä»»é”šç‚¹ï¼Œå®ƒçš„è¯ä¹¦æ˜¯è‡ªç­¾åè¯ä¹¦ï¼›æ ¹ CA ç»™ä¸­çº§ CA é¢å‘ä¸­çº§è¯ä¹¦ï¼›ä¸­çº§ CA ç»™ç”¨æˆ·é¢å‘æœ«ç«¯è¯ä¹¦ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 # build the root cert # generate private key for the root ca openssl genrsa -out root-ca-key.pem 2048 # generate cert sign request of the root ca # here the key content of the `openssl-ca.cnf` will show at the end openssl req -new -key root-ca-key.pem -out root-ca-csr.pem -config openssl-ca.cnf # fill the prompted fields like follows Country Name (2 letter code) [AU]:CN State or Province Name (full name) [Some-State]:Zhejiang Locality Name (eg, city) []:Hangzhou Organization Name (eg, company) [Internet Widgits Pty Ltd]:lcatmiao Organizational Unit Name (eg, section) []:lcatmiao-ca Common Name (e.g. server FQDN or YOUR name) []:lcatmiao-ca.com Email Address []:lcatmiao@test.com # self-sign the public key retrived implicitly from the cert sign request # of the root ca with the private key of also the root ca then get the # root cert openssl x509 -req -days 3650 -sha256 -extfile openssl-ca.cnf -extensions v3_ca -in root-ca-csr.pem -signkey root-ca-key.pem -out root-ca-cert.pem # build the intermediate cert # generate private key for the intermediate ca openssl genrsa -out intermediate-ca-key.pem 2048 # generate cert sign request of the intermediate ca openssl req -new -key intermediate-ca-key.pem -out intermediate-ca-csr.pem -config openssl-ca.cnf # fill the prompted fields like follows Country Name (2 letter code) [AU]:CN State or Province Name (full name) [Some-State]:Zhejiang Locality Name (eg, city) []:Hangzhou Organization Name (eg, company) [Internet Widgits Pty Ltd]:lcatmiao Organizational Unit Name (eg, section) []:lcatmiao-ca Common Name (e.g. server FQDN or YOUR name) []:lcatmiao-ca.com Email Address []:lcatmiao@test.com # sign the public key retrived implicitly from the cert sign request # of the intermediate ca with the private key of the root ca then # get the intermediate cert openssl x509 -req -days 3650 -sha256 -extfile openssl-ca.cnf -extensions v3_ca -in intermediate-ca-csr.pem -CA root-ca-cert.pem -CAkey root-ca-key.pem -CAcreateserial -out intermediate-ca-cert.pem # build the end entity cert # generate private key for the end entity openssl genrsa -out end-entity-key.pem 2048 # generate cert sign request of the end entity # here the key content of the `openssl-user.cnf` will show at the end openssl req -new -key end-entity-key.pem -out end-entity-csr.pem -config openssl-user.cnf # fill the prompted fields like follows Country Name (2 letter code) [AU]:CN State or Province Name (full name) [Some-State]:Zhejiang Locality Name (eg, city) []:Hangzhou Organization Name (eg, company) [Internet Widgits Pty Ltd]:lcatmiao Organizational Unit Name (eg, section) []:lcatmiao-user Common Name (e.g. server FQDN or YOUR name) []:172.168.10.110 Email Address []:lcatmiao@test.com # sign the public key retrived implicitly from the cert sign request # of the end entity with the private key of the intermediate ca then # get the end entity cert openssl x509 -req -days 3650 -sha256 -extfile openssl-user.cnf -extensions usr_cert -in end-entity-csr.pem -CA intermediate-ca-cert.pem -CAkey intermediate-ca-key.pem -CAcreateserial -out end-entity-cert.pem # After doing all the operations above, `ls` shows that # all the files we have are as follows. end-entity-cert.pem end-entity-csr.pem end-entity-key.pem intermediate-ca-cert.pem intermediate-ca-cert.srl intermediate-ca-csr.pem intermediate-ca-key.pem openssl-ca.cnf openssl-user.cnf root-ca-cert.pem root-ca-cert.srl root-ca-csr.pem root-ca-key.pem # we can see the cert info by using this cmd openssl x509 -in end-entity-cert.pem -noout -text 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # key content of the openssl-ca.cnf # the following is just a test example that only lists the modified cfg items [ req ] req_extensions = v3_req # The extensions to add to a certificate request [ v3_req ] basicConstraints = CA:TRUE # keyUsage = nonRepudiation, digitalSignature, keyEncipherment subjectAltName = @alt_names [ v3_ca ] subjectAltName = @alt_names [ alt_names ] DNS.1 = lcatmiao-ca.com 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # key content of the openssl-user.cnf # the following is just a test example that only lists the modified cfg items [ req ] req_extensions = v3_req # The extensions to add to a certificate request [ usr_cert ] subjectAltName = @alt_names [ v3_req ] basicConstraints = CA:FALSE # keyUsage = nonRepudiation, digitalSignature, keyEncipherment subjectAltName = @alt_names [ alt_names ] IP.1 = 172.168.10.110 IP.2 = 172.168.10.105 IP.3 = 172.168.10.106 IP.4 = 172.168.10.107 IP.5 = 172.168.10.108 è‡³æ­¤ï¼Œä¸€ä¸ªç®€å•çš„è¯ä¹¦é“¾å°±æž„å»ºå¥½äº†ã€‚ä¸‹é¢æˆ‘ä»¬æ¥éªŒè¯ä¸€ä¸‹è¿™ä¸ªè¯ä¹¦é“¾ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # verify the root cert which is a self-sign cert openssl verify -CAfile root-ca-cert.pem root-ca-cert.pem # output: root-ca-cert.pem: OK # verify the intermediate cert openssl verify -trusted root-ca-cert.pem intermediate-ca-cert.pem # output: intermediate-ca-cert.pem: OK # verify the end entity cert openssl verify -partial_chain -trusted intermediate-ca-cert.pem end-entity-cert.pem # output: end-entity-cert.pem: OK # directly verify the whole cert chain which has only three levels openssl verify -CAfile root-ca-cert.pem -untrusted intermediate-ca-cert.pem end-entity-cert.pem # output: end-entity-cert.pem: OK æœ¬åœ°ä½¿ç”¨å‘½ä»¤è¡Œéƒ½èƒ½éªŒè¿‡ï¼Œä¸ä»£è¡¨ç½‘ç»œé€šä¿¡æ—¶ä¹Ÿèƒ½éªŒè¿‡ã€‚å®žé™…é€šä¿¡çš„è¡Œä¸ºå—å„ç§é…ç½®çš„å½±å“ ï¼Œæ¯”å¦‚å®žæµ‹å‘çŽ°æœ«ç«¯è¯ä¹¦ä¸­é…ç½®çš„ IP åœ°å€æˆ–è€…åŸŸåè¦ä¸ŽæœåŠ¡å™¨ä¿æŒä¸€è‡´ï¼Œå¦åˆ™ä¸é€šã€‚ é¡ºå¸¦ä¸€æï¼Œå®žé™…æŠ¥æ–‡ä¸­ï¼Œè¯ä¹¦é“¾çš„é¡ºåºï¼šæœ«ç«¯è¯ä¹¦åœ¨å‰ï¼Œä¸­çº§è¯ä¹¦æŒ‰å±‚çº§é¡ºåºä¾æ¬¡è·Ÿéšï¼Œæ ¹è¯ä¹¦ä¸€èˆ¬ä¸åŒ…å«åœ¨é“¾ä¸­ã€‚ RFC5246 The Transport Layer Security (TLS) Protocol Version 1.2 1 2 3 4 5 6 7 8 9 10 # 7.4.2 Server Certificate certificate_list This is a sequence (chain) of certificates. The sender&#39;s certificate MUST come first in the list. Each following certificate MUST directly certify the one preceding it. Because certificate validation requires that root keys be distributed independently, the self-signed certificate that specifies the root certificate authority MAY be omitted from the chain, under the assumption that the remote end must already possess it in order to validate it in any case. æ¶ˆé™¤æµè§ˆå™¨å®‰å…¨è­¦å‘Š å½“å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰æ²¡èƒ½éªŒè¿‡æœåŠ¡å™¨å‘æ¥çš„è¯ä¹¦æ—¶ï¼Œå°±ä¼šæ˜¾ç¤ºå¦‚ä¸‹çš„å®‰å…¨è­¦å‘Šé¡µé¢ï¼Œå¹¶ä¸” URI æ ä¼šæœ‰â€œä¸å®‰å…¨â€çš„æç¤ºã€‚å¦‚æžœæœåŠ¡å™¨çš„è¯ä¹¦æ˜¯æˆ‘ä»¬è‡ªå·±ç­¾å‘çš„ï¼Œè‡ªç„¶æ— æ³•è¢«æµè§ˆå™¨å†…ç½®çš„ CA è¯ä¹¦éªŒè¿‡ï¼Œæˆ‘ä»¬éœ€è¦å°†è‡ªå·±ç”Ÿæˆçš„æ ¹è¯ä¹¦å¯¼å…¥æµè§ˆå™¨æ‰è¡Œã€‚ å°†è‡ªå·±ç”Ÿæˆçš„æ ¹è¯ä¹¦å¯¼å…¥æµè§ˆå™¨ï¼Œä½œä¸ºå—ä¿¡ä»»çš„é¢å‘æœºæž„ã€‚ æ­¤åŽå†è®¿é—®æœåŠ¡å™¨ï¼Œå°±æ˜¯æ­£å¸¸çš„ https è®¿é—®äº†ã€‚ å¦‚æžœæœåŠ¡å™¨å‘æ¥çš„è¯ä¹¦ä¸æ­¢ä¸€ä¸ªï¼Œè€Œæ˜¯å¤šçº§è¯ä¹¦ï¼Œå³è¯ä¹¦é“¾çš„ä¸€éƒ¨åˆ†ï¼Œé‚£ä¹ˆç†è®ºä¸Šå¯¼å…¥æµè§ˆå™¨çš„è¯ä¹¦åº”è¯¥æ˜¯è¯ä¹¦é“¾çš„å¦ä¸€éƒ¨åˆ†ï¼ŒäºŒè€…åˆä¸€è¦èƒ½æž„æˆå®Œæ•´çš„è¯ä¹¦é“¾æ‰è¡Œã€‚ å‚è€ƒèµ„æ–™ ã€Šå›¾è§£HTTPã€‹ Keyless SSL: The Nitty Gritty Technical Details The Illustrated TLS Connection: Every Byte Explained RFC4346 The Transport Layer Security (TLS) Protocol Version 1.1 RFC4492 Elliptic Curve Cryptography (ECC) Cipher Suites for Transport Layer Security (TLS) RFC5246 The Transport Layer Security (TLS) Protocol Version 1.2 RFC8422 Elliptic Curve Cryptography (ECC) Cipher Suites for Transport Layer Security (TLS) Versions 1.2 and Earlier RFC7919 Negotiated Finite Field Diffie-Hellman Ephemeral Parameters for Transport Layer Security (TLS) è„šæ³¨ ä½¿ç”¨ä¼šè¯å¯†é’¥åŠ å¯†åŽçš„ Client Finished æŠ¥æ–‡ã€‚Â &#8617;Â &#8617;2 ä½¿ç”¨ä¼šè¯å¯†é’¥åŠ å¯†åŽçš„ Server Finished æŠ¥æ–‡ã€‚Â &#8617;Â &#8617;2 ä½¿ç”¨ä¼šè¯å¯†é’¥åŠ å¯†åŽçš„ Close Notify æŠ¥æ–‡ã€‚Â &#8617;" />
<link rel="canonical" href="http://0.0.0.0:4000/posts/%E7%AE%80%E6%9E%90HTTPS/" />
<meta property="og:url" content="http://0.0.0.0:4000/posts/%E7%AE%80%E6%9E%90HTTPS/" />
<meta property="og:site_name" content="å°é»‘çŒ«" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-04-15T18:50:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="ç®€æžHTTPS" />
<meta name="twitter:site" content="@twitter_username" />
<meta name="twitter:creator" content="@å°é»‘çŒ«" />
<script type="application/ld+json">
{"headline":"ç®€æžHTTPS","dateModified":"2025-04-15T18:50:00+08:00","datePublished":"2025-04-15T18:50:00+08:00","url":"http://0.0.0.0:4000/posts/%E7%AE%80%E6%9E%90HTTPS/","mainEntityOfPage":{"@type":"WebPage","@id":"http://0.0.0.0:4000/posts/%E7%AE%80%E6%9E%90HTTPS/"},"author":{"@type":"Person","name":"å°é»‘çŒ«"},"@type":"BlogPosting","description":"å†™åœ¨å‰é¢ é˜…è¯»ã€Šå›¾è§£HTTPã€‹ï¼Œå¤§è‡´ç†è§£äº† SSL/TLS çš„æ¡æ‰‹è¿‡ç¨‹å’Œæ€æƒ³åŽŸç†ã€‚ç„¶è€Œä½œä¸ºå…¥é—¨ä¹¦ï¼Œå®ƒæ²¡æœ‰ä»‹ç»åŸºäºŽ DH ç®—æ³•çš„ TLS æ¡æ‰‹è¿‡ç¨‹ï¼Œä¹Ÿæ²¡æœ‰ä»‹ç»è¯ä¹¦é“¾ç›¸å…³çš„çŸ¥è¯†ðŸ˜¡ã€‚æˆ‘ Google äº†ä¸å°‘èµ„æ–™ï¼Œç€é‡å•ƒäº†å‡ ç¯‡æ–‡ç« ï¼Œç»“åˆæŠ“åŒ…åˆ†æžï¼Œæœ¬æƒ³â€œå·®ä¸å¤šå¾—äº†â€ï¼Œå´æ²¡æ–™åˆ°å…¥äº†å¤§å‘ï¼Œç–‘é—®ä¸å‡åå¢žã€‚ ä¸€ç­¹èŽ«å±•ä¹‹é™…ï¼ŒAI æŠ€æœ¯å¤§ç«ï¼Œæ•‘æˆ‘ç‹—å‘½ã€‚å—æ­¤é¼“èˆžï¼Œå€ŸåŠ© AI è§£æƒ‘ï¼Œåˆæ‰“èµ·ç²¾ç¥žå•ƒè¯»äº†å¤šä¸ª RFC ç‰‡æ®µï¼Œé‚æ‹¨äº‘è§æ—¥ã€‚æœ¬æ–‡æ—¢æˆï¼Œè™½å¾—ç›ŠäºŽå¤©æ—¶ï¼Œç„¶äº¦å¯è°“ä¸€æ³¢ä¸‰æŠ˜ï¼ŒåŽ†å°½è‰°è¾›ã€‚æˆ‘çœŸç‰›é€¼ðŸ‘ã€‚ æœ¬æ–‡ä¸»è¦åŸºäºŽ TLS1.2 ç ”å†™ï¼ŒçŸ¥è¯†æ•´ç†äºŽæ­¤ðŸ‘‡ã€‚ å…ˆè¡Œæ¦‚å¿µ &gt; å¯†ç ä½“åˆ¶ å¯†ç å­¦ä¸»è¦æœ‰ä¸¤ç§ä½“åˆ¶ï¼š å…±äº«å¯†ç ä½“åˆ¶ï¼ˆå¯¹ç§°å¯†ç ä½“åˆ¶ï¼‰ å…¬é’¥å¯†ç ä½“åˆ¶ï¼ˆéžå¯¹ç§°å¯†ç ä½“åˆ¶ï¼‰ &gt; æ•°å­¦éš¾é¢˜ å…¬é’¥å¯†ç ä½“åˆ¶ä¸»è¦åŸºäºŽä»¥ä¸‹æ•°å­¦éš¾é¢˜ï¼š å¤§æ•´æ•°åˆ†è§£é—®é¢˜ ç¦»æ•£å¯¹æ•°é—®é¢˜ï¼ˆDLPï¼‰ ä¸€èˆ¬çš„ç¦»æ•£å¯¹æ•°é—®é¢˜ æ¤­åœ†æ›²çº¿ç¦»æ•£å¯¹æ•°é—®é¢˜ï¼ˆECDLPï¼‰ ä¸€èˆ¬çš„è¯´æ³•ä¸­ï¼Œé€šå¸¸å°†æ¤­åœ†æ›²çº¿ç¦»æ•£å¯¹æ•°é—®é¢˜å•ç‹¬ä½œä¸ºä¸€ç±»ï¼Œä¸Žç¦»æ•£å¯¹æ•°é—®é¢˜ã€å¤§æ•´æ•°åˆ†è§£é—®é¢˜ä¸€èµ·ï¼Œå¹¶ç§°å¯†ç å­¦ä¸‰å¤§æ•°å­¦éš¾é¢˜ã€‚æ¤­åœ†æ›²çº¿ç¦»æ•£å¯¹æ•°é—®é¢˜æ¯”ä¸€èˆ¬çš„ç¦»æ•£å¯¹æ•°é—®é¢˜æ›´åŠ å›°éš¾ï¼Œè‡ªç„¶å°±è¯žç”Ÿäº†åŸºäºŽæ¤­åœ†æ›²çº¿çš„å¯†ç å­¦ï¼Œè¢«ç§°ä½œæ¤­åœ†æ›²çº¿å¯†ç å­¦ï¼ˆECCï¼‰ã€‚ä¸€äº›åŽŸæœ¬åŸºäºŽä¸€èˆ¬ç¦»æ•£å¯¹æ•°é—®é¢˜çš„ç®—æ³•è¢«ç§»æ¤åˆ°æ¤­åœ†æ›²çº¿ä¸Šï¼Œå°±æœ‰äº† ECC çš„ç®—æ³•ç‰ˆæœ¬ï¼Œæ¯”å¦‚ DH ç®—æ³•çš„æ¤­åœ†æ›²çº¿ç‰ˆæœ¬ï¼Œå°±å« ECDH ç®—æ³•ã€‚ ä¸€äº›å…¬é’¥ç®—æ³•ä¸Žæ•°å­¦éš¾é¢˜çš„å¯¹åº”å…³ç³»ï¼š RSA - å¤§æ•´æ•°åˆ†è§£é—®é¢˜ DHã€DSA - ä¸€èˆ¬çš„ç¦»æ•£å¯¹æ•°é—®é¢˜ ECDHã€ECDHEã€ECDSA - æ¤­åœ†æ›²çº¿ç¦»æ•£å¯¹æ•°é—®é¢˜ TLS æ¡æ‰‹è¿‡ç¨‹ TLS åœ¨æ¡æ‰‹ä¸­ä¸»è¦åšäº†ä¸‰ä»¶äº‹â€”â€”èº«ä»½è®¤è¯ã€å¯†é’¥äº¤æ¢å’Œå®Œæ•´æ€§æ ¡éªŒã€‚æ¡æ‰‹ä¸»è¦æ˜¯ä¸ºäº†ç”Ÿæˆå¹¶äº¤æ¢å…±äº«å¯†é’¥ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯ä½¿ç”¨å…¬é’¥ç®—æ³•è¿›è¡Œçš„ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½æ‹¥æœ‰å…±äº«å¯†é’¥åŽï¼ŒåŽç»­çš„é€šä¿¡å†ä½¿ç”¨å…±äº«å¯†é’¥ç®—æ³•è¿›è¡ŒåŠ å¯†ã€‚è¿™æ˜¯å®‰å…¨å’Œæ€§èƒ½ç»¼åˆè€ƒé‡çš„ç»“æžœã€‚å…¬é’¥ç®—æ³•å®‰å…¨ä½†æ€§èƒ½æ¶ˆè€—å¤šï¼Œå…±äº«å¯†é’¥ç®—æ³•ç›¸å¯¹ä¸é‚£ä¹ˆå®‰å…¨ä½†æ€§èƒ½æ¶ˆè€—å°‘ï¼Œæ‰€ä»¥çœŸæ­£çš„åŠ å¯†é€šä¿¡ä½¿ç”¨å…±äº«å¯†é’¥åŠ å¯†ï¼Œè€Œä¸”å…±äº«å¯†é’¥çš„äº¤æ¢åˆ™ç”±å…¬é’¥ç®—æ³•å®žçŽ°ã€‚ ä»¥ä¸‹åŸºäºŽ TLS1.2 é˜è¿°å…¶æ¡æ‰‹è¿‡ç¨‹ã€‚ åŸºäºŽ RSA ç®—æ³• æ­¥éª¤ 1 - å‘èµ·è¿žæŽ¥ï¼Œåå•†å‚æ•° å®¢æˆ·ç«¯å‘é€ `Client Hello`ã€‚ å®¢æˆ·ç«¯ç”Ÿæˆéšæœºæ•° Client Randomï¼Œå¹¶å‘é€ Client Hello æŠ¥æ–‡ã€‚è¯¥æŠ¥æ–‡ä¸­åŒ…å« Client Random éšæœºæ•°ä»¥åŠå®¢æˆ·ç«¯æ”¯æŒçš„ç®—æ³•å¥—ä»¶ç­‰ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯è¢«ä¼ é€’ç»™æœåŠ¡å™¨ç”¨äºŽåå•†ã€‚ æ­¥éª¤ 2 - åå•†å‚æ•°ï¼Œå‘é€è¯ä¹¦ æœåŠ¡å™¨å‘é€ `Server Hello, Certificate, Server Hello Done`ã€‚ æœåŠ¡å™¨ä»Ž Client Hello ä¸­èŽ·å¾—éšæœºæ•° Client Randomã€‚ æœåŠ¡å™¨ç”Ÿæˆ Server Randomï¼Œå°†è¯¥éšæœºæ•°åŒ…å«è¿› Server Hello ä¸­ã€‚æœåŠ¡å™¨ä¾æ®è‡ªèº«æƒ…å†µï¼Œä»Žå®¢æˆ·ç«¯ç®—æ³•å¥—ä»¶ä¸­æŒ‘é€‰ä¸€ä¸ªè‡ªèº«æ”¯æŒçš„ç®—æ³•ï¼Œå°†å…¶åŒ…å«è¿› Server Hello ä¸­ã€‚ æœåŠ¡å™¨å‘é€è‡ªå·±çš„è¯ä¹¦ã€‚è¯ä¹¦ä¸­ä¸»è¦åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š æœåŠ¡å™¨çš„å…¬é’¥ æœåŠ¡å™¨çš„åŸŸå å…¶å®ƒé™„åŠ ä¿¡æ¯ CA çš„ç­¾åï¼šä½¿ç”¨ CA çš„ç§é’¥å¯¹ä¸Šè¿°è¯ä¹¦ä¿¡æ¯çš„å“ˆå¸Œå€¼åŠ å¯†æ‰€å¾—çš„ç»“æžœã€‚ 1 signature = ca-private-key((hash(cert-info))) æœåŠ¡å™¨å‘é€ Server Hello Doneã€‚ å¦‚ä¸‹å›¾ï¼ŒæœåŠ¡å™¨å‘é€æŠ¥æ–‡ã€‚ å¦‚ä¸‹å›¾ï¼ŒæœåŠ¡å™¨é€‰æ‹©äº†ç®—æ³• TLS_RSA_WITH_AES_256_CBC_SHAã€‚ å¦‚ä¸‹å›¾ï¼ŒæœåŠ¡å™¨å‘é€äº†è‡ªå·±çš„è¯ä¹¦ï¼Œè¯¥è¯ä¹¦è¢« CA ç­¾åï¼Œç­¾åä½¿ç”¨çš„ç­¾åç®—æ³•æ˜¯ RSAï¼Œå“ˆå¸Œç®—æ³•æ˜¯ SHA256ã€‚ æ­¥éª¤ 3 - èº«ä»½è®¤è¯ï¼Œå¯†é’¥äº¤æ¢ï¼Œç”Ÿæˆä¼šè¯å¯†é’¥ å®¢æˆ·ç«¯å‘é€ `Client Key Exchange, Change Cipher Spec, Encrypted Handshake Message`ã€‚ å®¢æˆ·ç«¯ä»Ž Server Hello ä¸­èŽ·å¾—éšæœºæ•° Server Randomã€‚ å®¢æˆ·ç«¯ä½¿ç”¨ CA çš„è¯ä¹¦ï¼ˆä¸€èˆ¬å·²é¢„ç½®åœ¨æµè§ˆå™¨ä¸­ï¼‰éªŒè¯æœåŠ¡å™¨çš„è¯ä¹¦ã€‚ä½¿ç”¨ CA è¯ä¹¦ä¸­åŒ…å«çš„å…¬é’¥è§£å¯†æœåŠ¡å™¨è¯ä¹¦ä¸­çš„ç­¾åï¼Œå¾—åˆ°å“ˆå¸Œå€¼ï¼Œå†è®¡ç®—æœåŠ¡å™¨è¯ä¹¦ä¿¡æ¯çš„å“ˆå¸Œå€¼ï¼ŒäºŒè€…å¯¹æ¯”ï¼Œè‹¥ä¸€è‡´åˆ™éªŒè¯é€šè¿‡ã€‚éªŒè¯é€šè¿‡ï¼Œè¯æ˜Žäº†æœåŠ¡å™¨è¯ä¹¦æ˜¯ç”±æµè§ˆå™¨å†…ç½®çš„ CA è¯ä¹¦æ‰€ä»£è¡¨çš„ CA é¢å‘çš„ï¼Œå³è¯æ˜Žäº†å†…ç½® CA ä¿¡ä»»æœåŠ¡å™¨ï¼›è€Œå†…ç½®çš„ CA æ˜¯å¹¿å—ç¤¾ä¼šä¿¡ä»»çš„ CAï¼Œå·²ç»æ˜¯ä¿¡ä»»é”šç‚¹ã€‚å°±è¿™æ ·ï¼Œæµè§ˆå™¨ä¿¡ä»» CAï¼ŒCA ä¿¡ä»»æœåŠ¡å™¨ï¼Œæ‰€ä»¥æµè§ˆå™¨ä¿¡ä»»æœåŠ¡å™¨ã€‚è¿™ä¸€ä¿¡ä»»é“¾è¯æ˜Žäº†æœåŠ¡å™¨çš„èº«ä»½å€¼å¾—ä¿¡èµ–ï¼Œä¸”è¯ä¹¦ä¸­çš„å…¬é’¥çš„ç¡®å±žäºŽæœåŠ¡å™¨ï¼Œæ­¤å³èº«ä»½è®¤è¯ã€‚ å®¢æˆ·ç«¯ç”Ÿæˆ PreMaster Secretï¼Œå¹¶ä½¿ç”¨æœåŠ¡å™¨çš„å…¬é’¥åŠ å¯†ï¼Œä½¿ç”¨ Client Key Exchange å‘é€ç»™æœåŠ¡å™¨ï¼Œæ­¤å³å¯†é’¥äº¤æ¢ã€‚ å®¢æˆ·ç«¯ä½¿ç”¨ Client Random, Server Random, PreMaster Secret ç”Ÿæˆä¼šè¯å¯†é’¥ Session Keyã€‚ Change Cipher Spec å‘æœåŠ¡å™¨è¡¨æ˜Žï¼šå®¢æˆ·ç«¯å·²ç»æ‹¥æœ‰ä¼šè¯å¯†é’¥ï¼ŒæŽ¥ä¸‹æ¥å‘é€çš„æ‰€æœ‰æ•°æ®éƒ½ä¼šä½¿ç”¨ä¼šè¯å¯†é’¥åŠ å¯†ã€‚ å®¢æˆ·ç«¯è®¡ç®—å‡ºä¸€ä¸ªæ ¡éªŒæ•°æ®ï¼Œä½¿ç”¨ä¼šè¯å¯†é’¥åŠ å¯†åŽï¼Œä½œä¸º Encrypted Handshake Message1 å‘é€ç»™æœåŠ¡å™¨ã€‚ å¦‚ä¸‹å›¾ï¼Œå®¢æˆ·ç«¯å‘é€æŠ¥æ–‡ã€‚ å¦‚ä¸‹å›¾ï¼Œåœ¨ Client Key Exchange éƒ¨åˆ†å¯ä»¥çœ‹åˆ°ä½¿ç”¨æœåŠ¡å™¨çš„ RSA å…¬é’¥åŠ å¯†å‘é€çš„ PreMaster Secretã€‚ æ­¥éª¤ 4 - å¯†é’¥äº¤æ¢ï¼Œç”Ÿæˆä¼šè¯å¯†é’¥ æœåŠ¡å™¨å‘é€ `Change Cipher Spec, Encrypted Handshake Message`ã€‚ æœåŠ¡å™¨ä½¿ç”¨è‡ªå·±çš„ç§é’¥è§£å¯†å¾—åˆ° PreMaster Secretï¼Œæ­¤å³å¯†é’¥äº¤æ¢ã€‚ æœåŠ¡å™¨ä½¿ç”¨ Client Random, Server Random, PreMaster Secret ç”Ÿæˆä¼šè¯å¯†é’¥ Session Keyã€‚ æœåŠ¡å™¨ä½¿ç”¨ Session Key è§£å¯†å®¢æˆ·ç«¯å‘æ¥çš„æ ¡éªŒæ•°æ®ï¼Œå¹¶è®¡ç®—æŠ¥æ–‡å“ˆå¸Œå€¼ä¸Žæ ¡éªŒæ•°æ®è¿›è¡Œå¯¹æ¯”ã€‚ Change Cipher Spec å‘å®¢æˆ·ç«¯è¡¨æ˜Žï¼šæœåŠ¡å™¨å·²ç»æ‹¥æœ‰ä¼šè¯å¯†é’¥ï¼ŒæŽ¥ä¸‹æ¥å‘é€çš„æ‰€æœ‰æ•°æ®éƒ½ä¼šä½¿ç”¨ä¼šè¯å¯†é’¥åŠ å¯†ã€‚ æœåŠ¡å™¨è®¡ç®—å‡ºä¸€ä¸ªæ ¡éªŒæ•°æ®ï¼Œä½¿ç”¨ä¼šè¯å¯†é’¥åŠ å¯†åŽï¼Œä½œä¸º Encrypted Handshake Message2 å‘é€ç»™å®¢æˆ·ç«¯ã€‚ å¦‚ä¸‹å›¾ï¼ŒæœåŠ¡å™¨å‘é€æŠ¥æ–‡ã€‚ å¦‚ä¸‹å›¾ï¼ŒæŠ¥æ–‡ä¿¡æ¯é•¿è¿™æ ·ã€‚ æ­¥éª¤ 5 - å®Œæˆæ¡æ‰‹ï¼ŒåŠ å¯†é€šä¿¡ åŒæ–¹å‘é€ `Application Data`ã€‚ å®¢æˆ·ç«¯ä½¿ç”¨ Session Key è§£å¯†æœåŠ¡å™¨å‘æ¥çš„æ ¡éªŒæ•°æ®ï¼Œå¹¶è®¡ç®—æŠ¥æ–‡å“ˆå¸Œå€¼ä¸Žæ ¡éªŒæ•°æ®è¿›è¡Œå¯¹æ¯”ã€‚ TLS è¿žæŽ¥å»ºç«‹å®Œæˆã€‚æŽ¥ä¸‹æ¥åŒæ–¹ä½¿ç”¨ Session Key åŠ å¯†æ•°æ®ï¼Œè¿›è¡Œ HTTPS é€šä¿¡ã€‚ å¦‚ä¸‹å›¾ï¼Œå‘é€åŠ å¯†çš„ HTTP æŠ¥æ–‡ã€‚ æ­¥éª¤ 6 - æ–­å¼€è¿žæŽ¥ å®¢æˆ·ç«¯å‘é€ `Encrypted Alert`ã€‚ å®¢æˆ·ç«¯ä½¿ç”¨ Session Key åŠ å¯†ä¸€ä¸ªå‘Šè­¦ä¿¡æ¯ï¼Œå‘é€ Encrypted Alert3 ä»¥æ–­å¼€ TLS è¿žæŽ¥ã€‚åŽç»­å†å…³é—­ TCP çš„è¿žæŽ¥ã€‚ åŸºäºŽ ECDHE ç®—æ³• åœ¨ RSA æ¡æ‰‹ä¸­ï¼ŒPreMaster Secret ç”±å®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡å™¨ï¼Œä»Žè€Œå®Œæˆå¯†é’¥äº¤æ¢ï¼›è€Œåœ¨ DH ç®—æ³•ä¸­ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åŸºäºŽæ•°å­¦åŽŸç†ï¼Œæ ¹æ®ä¸€äº›å…¬å¼€çš„ä¿¡æ¯ç›´æŽ¥åœ¨å„è‡ªçš„æœ¬åœ°è®¡ç®—å‡º PreMaster Secretï¼Œè¿žç½‘ç»œä¼ è¾“éƒ½ç»™å¹²æŽ‰äº†ï¼Œæ‰€ä»¥ DH ç®—æ³•æ›´åŠ å®‰å…¨ã€‚ DH ç®—æ³•ç®€ä»‹ åŽŸç† DH ç®—æ³•æ˜¯ä¸€ç§å¯†é’¥äº¤æ¢ç®—æ³•ï¼Œæˆ‘ä»¬ä¸ç®¡æ•°å­¦ç»†èŠ‚ï¼Œæžç®€é˜è¿°åŽŸç†ï¼š 1 2 3 4 5 6 # å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å„æŒæœ‰ä¸€å¯¹ DH å…¬ç§é’¥ï¼Œä½¿ç”¨å®ƒä»¬å„è‡ªçš„ç§é’¥å’Œå¯¹ç«¯çš„å…¬é’¥å¯ä»¥ç”Ÿæˆä¸€ä¸ªä¼šè¯å¯†é’¥ï¼Œ # è€Œä¸¤ç«¯å„è‡ªç”Ÿæˆçš„ä¼šè¯å¯†é’¥åœ¨æ•°å­¦ä¸Šè¢«è¯æ˜Žæ˜¯ç›¸ç­‰çš„ã€‚æ¢è¨€ä¹‹ï¼Œåªè¦ä¸¤ç«¯äº’ç›¸äº¤æ¢å…¬é’¥å°±å¯ä»¥å®žçŽ° # æ— éœ€ç½‘ç»œä¼ è¾“çš„ä¼šè¯å¯†é’¥äº¤æ¢ã€‚ client-session-key = dh(client-private-key, server-public-key) server-session-key = dh(server-private-key, client-public-key) session-key = client-session-key = server-session-key åˆ†ç±» DH ç®—æ³•åŸºäºŽç¦»æ•£å¯¹æ•°é—®é¢˜è€Œè¯žç”Ÿï¼Œæ ¹æ®ç¦»æ•£å¯¹æ•°çš„è®¡ç®—æ–¹å¼ï¼ˆè§æ•°å­¦éš¾é¢˜ï¼‰å¯ä»¥åˆ†ä¸ºï¼š ä¸€èˆ¬çš„ DH ç®—æ³• ECDH ç®—æ³• æ ¹æ® DH çš„ç§é’¥æ˜¯å¦å›ºå®šï¼Œå¯ä»¥åˆ†ä¸ºï¼š Static DH Ephemeral DH(DHE) åœ¨ Static DH ç®—æ³•ä¸­ï¼ŒæœåŠ¡å™¨æ¯æ¬¡è¿žæŽ¥æ‰€ä½¿ç”¨çš„ DH ç§é’¥æ˜¯ä¸å˜çš„ï¼Œåº”è¯¥æ˜¯ç›´æŽ¥ä½¿ç”¨çš„ä¸Žå…¬é’¥è¯ä¹¦æˆå¯¹çš„é‚£ä¸ªç§é’¥ï¼Œé•¿æœŸä½¿ç”¨å®¹æ˜“æ³„éœ²ï¼Œä¸€æ—¦æ³„éœ²ï¼Œé»‘å®¢å°±èƒ½è§£å¯†å½“å‰å’Œä»¥å¾€æ¯æ¬¡è¿žæŽ¥çš„é€šä¿¡ï¼Œè¿™æ ·çš„ç®—æ³•ä¸å…·å¤‡å‰å‘å®‰å…¨æ€§ï¼›è€Œåœ¨ Ephemeral DH ç®—æ³•ä¸­ï¼ŒæœåŠ¡å™¨ä¼šä¸ºæ¯æ¬¡è¿žæŽ¥é‡æ–°ç”Ÿæˆä¸€ä¸ªä¸´æ—¶çš„ DH ç§é’¥ï¼Œè¿™æ ·å°±ç®—ç§é’¥æ³„éœ²ï¼Œä¹Ÿåªèƒ½è§£å¯†è¿™ä¸€æ¬¡è¿žæŽ¥çš„é€šä¿¡ï¼Œæ— æ³•è§£å¯†ä»¥å¾€çš„é€šä¿¡ï¼Œæ‰€ä»¥ç®—æ³•å…·å¤‡å‰å‘å®‰å…¨æ€§ã€‚ ECDHE æ¡æ‰‹æµç¨‹ æ­¥éª¤ 1 - å‘èµ·è¿žæŽ¥ï¼Œåå•†å‚æ•° å®¢æˆ·ç«¯å‘é€ `Client Hello`ã€‚ åŒ RSA æ¡æ‰‹ã€‚ æ­¥éª¤ 2 - åå•†å‚æ•°ï¼Œå‘é€è¯ä¹¦å’Œ ECDH ä¿¡æ¯ æœåŠ¡å™¨å‘é€ `Server Hello, Certificate, Server Key Exchange, Server Hello Done`ã€‚ ç›¸æ¯” RSA æ¡æ‰‹ï¼Œå¤šäº†ä¸€ä¸ª Server Key Exchangeï¼Œé˜è¿°å¦‚ä¸‹ã€‚ åœ¨è¿™æ­¥ï¼ŒæœåŠ¡å™¨ä¼šé€‰æ‹©ä¸€ç§æ¤­åœ†æ›²çº¿ï¼Œç”Ÿæˆä¸€å¯¹ ECDH å…¬ç§é’¥ï¼Œå¹¶ä½¿ç”¨ Server Private Key å¯¹ Client Random, Server Random, Curve Info, Server DH Public Key çš„ç»„åˆè¿›è¡Œç­¾åï¼Œæœ€åŽå°†æ›²çº¿ä¿¡æ¯ã€ECDH å…¬é’¥ã€ç­¾åéƒ½åŒ…å«è¿› Server Key Exchange ä¸­ã€‚ 1 2 3 signature = server-private-key( hash(client-random, server-random, curve-info, server-dh-public-key) ) æ­¤å¤„ç­¾åå’ŒåŽç»­éªŒç­¾çš„æ„ä¹‰åœ¨äºŽè¯æ˜Ž ECDH ä¿¡æ¯çš„ç¡®æ˜¯ç”±è¯ä¹¦ä¸­çš„å…¬é’¥æ‰€ä»£è¡¨çš„æœåŠ¡å™¨å‘é€çš„ã€‚ æœåŠ¡å™¨æ˜¯åå•†é€‰æ‹©æ¤­åœ†æ›²çº¿çš„ã€‚å®¢æˆ·ç«¯ä¼šé€šè¿‡ elliptic_curves æˆ– supported_groups æ‰©å±•å­—æ®µå‘é€å…¶æ”¯æŒçš„å…¨éƒ¨æ›²çº¿ï¼ŒéšåŽæœåŠ¡å™¨å†ä»Žä¸­é€‰æ‹©ä¸€ä¸ªã€‚éšç€æ ‡å‡†çš„ä¸æ–­å‘å±•ï¼Œelliptic_curves å·²ç»é€æ­¥è¢« supported_groups å–ä»£ã€‚å›  TLS ç‰ˆæœ¬çš„ä¸åŒï¼Œä¸Šè¿°è¯´æ³•å­˜åœ¨ä¸€äº›ç»†èŠ‚å‡ºå…¥ï¼Œä½†å¤§ä½“ä¸Šæ²¡é—®é¢˜ã€‚ å¦‚ä¸‹å›¾ï¼ŒæœåŠ¡å™¨å‘é€æŠ¥æ–‡ã€‚ å¦‚ä¸‹å›¾ï¼ŒæœåŠ¡å™¨é€‰æ‹©äº†ç®—æ³• TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256ã€‚è¿™é‡Œæˆ‘ä»¬æœåŠ¡å™¨çš„å¯†é’¥å¯¹æ˜¯ ECC å¯†é’¥å¯¹ï¼Œæ‰€ä»¥åå•†é€‰æ‹©äº† ECDSA ç­¾åç®—æ³•ã€‚ å¦‚ä¸‹å›¾ï¼ŒæœåŠ¡å™¨å‘é€äº†è‡ªå·±çš„è¯ä¹¦ï¼Œè¯¥è¯ä¹¦è¢« CA ç­¾åï¼Œç­¾åç®—æ³•æ˜¯ ECDSAï¼Œå“ˆå¸Œç®—æ³•æ˜¯ SHA256ã€‚è¿™é‡Œæˆ‘ä»¬ CA çš„å¯†é’¥å¯¹ä¹Ÿæ˜¯ ECC å¯†é’¥å¯¹ï¼Œä½¿ç”¨çš„ ECDSA ç®—æ³•ç­¾å‘çš„å…¬é’¥è¯ä¹¦ã€‚ å¦‚ä¸‹å›¾ï¼ŒæœåŠ¡å™¨å‘é€äº†è‡ªå·±ç”Ÿæˆçš„ ECDH å…¬é’¥ï¼Œå…¶é‡‡ç”¨çš„ ECC æ›²çº¿ä¸º Named Curve: secp256r1 (0x0017)ã€‚è®¡ç®—å‡ºçš„æ•°å­—ç­¾åä¹Ÿè¢«å‘é€ï¼Œç”±äºŽæœåŠ¡å™¨çš„ç§é’¥æ˜¯ ECC çš„ï¼Œæ‰€ä»¥ç­¾åç®—æ³•é€‰æ‹©äº† ECDSAã€‚ æ­¥éª¤ 3 - èº«ä»½è®¤è¯ï¼Œå¯†é’¥äº¤æ¢ï¼Œç”Ÿæˆä¼šè¯å¯†é’¥ å®¢æˆ·ç«¯å‘é€ `Client Key Exchange, Change Cipher Spec, Encrypted Handshake Message`ã€‚ å®¢æˆ·ç«¯ä»Ž Server Hello ä¸­èŽ·å¾—éšæœºæ•° Server Randomã€‚ å®¢æˆ·ç«¯ä½¿ç”¨ CA çš„è¯ä¹¦ï¼ˆä¸€èˆ¬å·²é¢„ç½®åœ¨æµè§ˆå™¨ä¸­ï¼‰éªŒè¯æœåŠ¡å™¨çš„è¯ä¹¦ï¼Œç”±æ­¤è¯æ˜ŽæœåŠ¡å™¨çš„èº«ä»½å€¼å¾—ä¿¡èµ–ï¼Œè¯ä¹¦ä¸­çš„å…¬é’¥çš„ç¡®ä»£è¡¨æœåŠ¡å™¨çš„èº«ä»½ï¼Œæ­¤å³èº«ä»½è®¤è¯ã€‚ å®¢æˆ·ç«¯ä½¿ç”¨è¯ä¹¦ä¸­çš„å…¬é’¥éªŒè¯ Server Key Exchange ä¸­çš„ç­¾åï¼Œç”±æ­¤è¯æ˜Ž ECDH ä¿¡æ¯çš„å‘é€è€…çš„ç¡®æ˜¯å…¬é’¥æ‰€ä»£è¡¨çš„æœåŠ¡å™¨ï¼Œæ­¤å³èº«ä»½è®¤è¯ã€‚ å®¢æˆ·ç«¯åŸºäºŽæœåŠ¡å™¨é€‰æ‹©çš„æ›²çº¿ç”Ÿæˆä¸€å¯¹ ECDH å…¬ç§é’¥ã€‚ å®¢æˆ·ç«¯å°†ç”Ÿæˆçš„ Client DH Public Key æ”¾å…¥ Client Key Exchange ä»¥å‘é€ç»™æœåŠ¡å™¨ã€‚ å®¢æˆ·ç«¯ä½¿ç”¨ Client DH Private Key, Server DH Public Key ç›´æŽ¥åœ¨æœ¬åœ°è®¡ç®—å‡º PreMaster Secretï¼ŒåŽç»­æœåŠ¡å™¨ä¹Ÿä¼šç›´æŽ¥åœ¨æœ¬åœ°è®¡ç®—å‡ºåŒæ ·çš„ PreMaster Secretï¼Œæ­¤å³å¯†é’¥äº¤æ¢ã€‚ å®¢æˆ·ç«¯ä½¿ç”¨ Client Random, Server Random, PreMaster Secret ç”Ÿæˆä¼šè¯å¯†é’¥ Session Keyã€‚ åŒ RSA æ¡æ‰‹ï¼Œå‘é€ Change Cipher Spec å’Œ Encrypted Handshake Message1ã€‚ å¦‚ä¸‹å›¾ï¼Œåœ¨ Client Key Exchange éƒ¨åˆ†å¯ä»¥çœ‹åˆ°å‘é€çš„ Client DH Public Keyã€‚ æ­¥éª¤ 4 - å¯†é’¥äº¤æ¢ï¼Œç”Ÿæˆä¼šè¯å¯†é’¥ æœåŠ¡å™¨å‘é€ `Change Cipher Spec, Encrypted Handshake Message`ã€‚ æœåŠ¡å™¨ä½¿ç”¨ Client DH Public Key, Server DH Private Key ç›´æŽ¥åœ¨æœ¬åœ°è®¡ç®—å‡ºä¸Žå®¢æˆ·ç«¯ä¸€è‡´çš„ PreMaster Secretï¼Œæ­¤å³å¯†é’¥äº¤æ¢ã€‚ æœåŠ¡å™¨ä½¿ç”¨ Client Random, Server Random, PreMaster Secret ç”Ÿæˆä¼šè¯å¯†é’¥ Session Keyã€‚ æœåŠ¡å™¨ä½¿ç”¨ Session Key è§£å¯†å®¢æˆ·ç«¯å‘æ¥çš„æ ¡éªŒæ•°æ®ï¼Œå¹¶è®¡ç®—æŠ¥æ–‡å“ˆå¸Œå€¼ä¸Žæ ¡éªŒæ•°æ®è¿›è¡Œå¯¹æ¯”ã€‚ åŒ RSA æ¡æ‰‹ï¼Œå‘é€ Change Cipher Spec å’Œ Encrypted Handshake Message2ã€‚ æ­¥éª¤ 5 - å®Œæˆæ¡æ‰‹ï¼ŒåŠ å¯†é€šä¿¡ åŒæ–¹å‘é€ `Application Data`ã€‚ åŒ RSA æ¡æ‰‹ã€‚ æ­¥éª¤ 6 - æ–­å¼€è¿žæŽ¥ å®¢æˆ·ç«¯å‘é€ `Encrypted Alert`ã€‚ åŒ RSA æ¡æ‰‹ã€‚ è¡¥å……è¯´æ˜Ž æ ¡éªŒæ•°æ® Finished Message The Illustrated TLS Connection: Every Byte Explained è¾ƒä¸ºè¯¦ç»†åœ°å±•ç¤ºäº† ECDHE æ¡æ‰‹çš„æµç¨‹ï¼Œå…¶è¯´æ³•å¦‚ä¸‹ï¼š 1 The verification data is built from a hash of all handshake messages and verifies the integrity of the handshake process. RFC5246 The Transport Layer Security (TLS) Protocol Version 1.2 çš„è¯´æ³•å¦‚ä¸‹ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 # 7.4.9 Finished The value handshake_messages includes all handshake messages starting at ClientHello up to, but not including, this Finished message. This may be different from handshake_messages in Section 7.4.8 because it would include the CertificateVerify message (if sent). Also, the handshake_messages for the Finished message sent by the client will be different from that for the Finished message sent by the server, because the one that is sent second will include the prior one. Note: ChangeCipherSpec messages, alerts, and any other record types are not handshake messages and are not included in the hash computations. Also, HelloRequest messages are omitted from handshake hashes. æ®æ­¤çŒœæµ‹ï¼Œæœ¬æ–‡ä¾‹å­ä¸­ï¼Œå‚ä¸Žå“ˆå¸Œçš„æŠ¥æ–‡åŒºé—´å¤§æ¦‚æ˜¯ [Client Hello, Client/Server Finished), Exclude(Change Cipher Spec)ã€‚ MAC æ‘˜è¦ æ‰€æœ‰ä½¿ç”¨ Session Key åŠ å¯†çš„æ•°æ®ï¼Œå…¶å†…éƒ½åŒ…å«äº†ä¸€ä¸ªåä¸º MAC (Message Authentication Code) çš„æŠ¥æ–‡æ‘˜è¦ã€‚MAC æœ‰å¤šç§å®žçŽ°ï¼Œæ¯”å¦‚ HMAC å’Œ GMACã€‚ HMAC å’Œ GMAC çš„ç‰¹ç‚¹ï¼ˆAIï¼‰ï¼š HMAC åŸºäºŽå“ˆå¸Œå‡½æ•°ï¼ˆå¦‚ SHA256ï¼‰ é€‚ç”¨äºŽé€šç”¨åœºæ™¯ éœ€è¦æ˜¾å¼åœ°ä¸ŽåŠ å¯†ç®—æ³•ï¼ˆå¦‚ AES-CBCï¼‰ç»“åˆä½¿ç”¨ GMAC åŸºäºŽ Galois åŸŸè¿ç®— ä¸“ä¸º GCM æ¨¡å¼è®¾è®¡ï¼Œé€šå¸¸ä¸Ž AES-GCM ç»“åˆä½¿ç”¨ã€‚ æä¾›æ›´é«˜çš„æ€§èƒ½ï¼Œå°¤å…¶æ˜¯åœ¨ç¡¬ä»¶åŠ é€Ÿçš„åœºæ™¯ä¸­ã€‚ å…·ä½“æœºåˆ¶æœ¬æ–‡ä¸ç ”ç©¶ï¼Œæˆ‘çš„ç†è§£æ˜¯æ•°æ®å’Œ MAC ä¸€èµ·è¢«åŠ å¯†ä¼ è¾“ï¼Œå¯¹ç«¯è§£å¯†åŽï¼Œå†è®¡ç®—æ•°æ®çš„ MAC ä¸ŽæŽ¥æ”¶åˆ°çš„ MAC å€¼å¯¹æ¯”ï¼Œä»Žè€ŒæŽ¢çŸ¥æ•°æ®æ˜¯å¦è¢«ç¯¡æ”¹ï¼Œæ­¤å³å®Œæ•´æ€§æ ¡éªŒã€‚ è¯•è®¡ç®— Server Key Exchange ä¸­çš„ç­¾åå¹¶éªŒç­¾ åœ¨ ECDHE æ¡æ‰‹-æ­¥éª¤ 2 ä¸­ï¼Œæˆ‘ä»¬æåˆ°ç­¾åæ˜¯å¯¹ Client Random, Server Random, Curve Info, Server DH Public Key çš„ç»„åˆè¿›è¡Œçš„ã€‚ä¿¡æ¯æ”¶é›†å¦‚ä¸‹ï¼š 1 2 # client random \\x5b\\x70\\x1c\\x25\\x8a\\xf4\\x56\\x6a\\x81\\xa7\\xee\\xcf\\xa0\\x9f\\xbb\\xcb\\x35\\xfd\\x64\\xae\\xe5\\xb0\\x46\\x03\\xda\\x92\\x4e\\xa0\\x07\\x79\\x35\\x2a 1 2 # server random \\xcc\\x26\\xf9\\x66\\x00\\x00\\x00\\x00\\x67\\x78\\x0a\\x00\\x00\\x00\\x00\\x00\\x3f\\x00\\x00\\x00\\x3f\\x00\\x00\\x00\\x3f\\x00\\x00\\x00\\x3f\\x00\\x00\\x00 1 2 3 4 5 6 # curve info \\x03\\x00\\x17 # server dh public key \\x41 \\x04\\x39\\x3b\\x76\\x31\\x87\\x80\\xe0\\x0b\\x27\\xd4\\xe7\\xc4\\x95\\x27\\x9c\\x2f\\xeb\\x96\\xa6\\xe8\\xd9\\x87\\x42\\x2e\\xce\\xac\\x84\\xa2\\x68\\xda\\x6f\\x6f\\x08\\x05\\xaa\\xf9\\x5d\\x23\\xa0\\x24\\xd1\\x25\\x30\\x84\\x11\\x55\\xcb\\xe9\\x69\\xeb\\xfb\\xcf\\xa8\\xbd\\xf8\\x96\\x8a\\x0a\\x7e\\xad\\x1c\\xef\\x84\\xa8 å°†è¿™äº›æ•°æ®åˆå¹¶åœ¨ä¸€èµ·ï¼š 1 2 # compose the data together echo -n &quot;\\x5b\\x70\\x1c\\x25\\x8a\\xf4\\x56\\x6a\\x81\\xa7\\xee\\xcf\\xa0\\x9f\\xbb\\xcb\\x35\\xfd\\x64\\xae\\xe5\\xb0\\x46\\x03\\xda\\x92\\x4e\\xa0\\x07\\x79\\x35\\x2a\\xcc\\x26\\xf9\\x66\\x00\\x00\\x00\\x00\\x67\\x78\\x0a\\x00\\x00\\x00\\x00\\x00\\x3f\\x00\\x00\\x00\\x3f\\x00\\x00\\x00\\x3f\\x00\\x00\\x00\\x3f\\x00\\x00\\x00\\x03\\x00\\x17\\x41\\x04\\x39\\x3b\\x76\\x31\\x87\\x80\\xe0\\x0b\\x27\\xd4\\xe7\\xc4\\x95\\x27\\x9c\\x2f\\xeb\\x96\\xa6\\xe8\\xd9\\x87\\x42\\x2e\\xce\\xac\\x84\\xa2\\x68\\xda\\x6f\\x6f\\x08\\x05\\xaa\\xf9\\x5d\\x23\\xa0\\x24\\xd1\\x25\\x30\\x84\\x11\\x55\\xcb\\xe9\\x69\\xeb\\xfb\\xcf\\xa8\\xbd\\xf8\\x96\\x8a\\x0a\\x7e\\xad\\x1c\\xef\\x84\\xa8&quot; &gt; data æœåŠ¡å™¨æœ¬èº«çš„ç§é’¥ä¹Ÿè´´åœ¨æ­¤å¤„ï¼Œæ–‡ä»¶ä»¥ \\n ç»“å°¾ã€‚è¿™æ˜¯ä¸€ä¸ªåŸºäºŽæ›²çº¿ prime256v1(secp256r1) çš„ ECC ç§é’¥ã€‚ 1 2 3 4 5 6 7 8 9 10 # server private key -----BEGIN EC PARAMETERS----- BggqhkjOPQMBBw== -----END EC PARAMETERS----- -----BEGIN EC PRIVATE KEY----- MHcCAQEEIIshQQR4px7Ek+5jRugTnySv5cjqSs1PbDlnmR1SSC4joAoGCCqGSM49 AwEHoUQDQgAE4Q+9ZBPkV4b2buqwPLB9EskoGByXTcPuF22znhtFG2R9gVlFyU4S 3GyXx3QaFOfLLNdyl/puch+GlZAZZsYKPw== -----END EC PRIVATE KEY----- å…¶åå…­è¿›åˆ¶ä¸ºï¼š 1 2 3 # server private key hex xxd -ps server-ecc-key.pem | tr -d &quot;\\n&quot; | sed &#39;s/\\(..\\)/\\\\x\\1/g&#39; \\x2d\\x2d\\x2d\\x2d\\x2d\\x42\\x45\\x47\\x49\\x4e\\x20\\x45\\x43\\x20\\x50\\x41\\x52\\x41\\x4d\\x45\\x54\\x45\\x52\\x53\\x2d\\x2d\\x2d\\x2d\\x2d\\x0a\\x42\\x67\\x67\\x71\\x68\\x6b\\x6a\\x4f\\x50\\x51\\x4d\\x42\\x42\\x77\\x3d\\x3d\\x0a\\x2d\\x2d\\x2d\\x2d\\x2d\\x45\\x4e\\x44\\x20\\x45\\x43\\x20\\x50\\x41\\x52\\x41\\x4d\\x45\\x54\\x45\\x52\\x53\\x2d\\x2d\\x2d\\x2d\\x2d\\x0a\\x2d\\x2d\\x2d\\x2d\\x2d\\x42\\x45\\x47\\x49\\x4e\\x20\\x45\\x43\\x20\\x50\\x52\\x49\\x56\\x41\\x54\\x45\\x20\\x4b\\x45\\x59\\x2d\\x2d\\x2d\\x2d\\x2d\\x0a\\x4d\\x48\\x63\\x43\\x41\\x51\\x45\\x45\\x49\\x49\\x73\\x68\\x51\\x51\\x52\\x34\\x70\\x78\\x37\\x45\\x6b\\x2b\\x35\\x6a\\x52\\x75\\x67\\x54\\x6e\\x79\\x53\\x76\\x35\\x63\\x6a\\x71\\x53\\x73\\x31\\x50\\x62\\x44\\x6c\\x6e\\x6d\\x52\\x31\\x53\\x53\\x43\\x34\\x6a\\x6f\\x41\\x6f\\x47\\x43\\x43\\x71\\x47\\x53\\x4d\\x34\\x39\\x0a\\x41\\x77\\x45\\x48\\x6f\\x55\\x51\\x44\\x51\\x67\\x41\\x45\\x34\\x51\\x2b\\x39\\x5a\\x42\\x50\\x6b\\x56\\x34\\x62\\x32\\x62\\x75\\x71\\x77\\x50\\x4c\\x42\\x39\\x45\\x73\\x6b\\x6f\\x47\\x42\\x79\\x58\\x54\\x63\\x50\\x75\\x46\\x32\\x32\\x7a\\x6e\\x68\\x74\\x46\\x47\\x32\\x52\\x39\\x67\\x56\\x6c\\x46\\x79\\x55\\x34\\x53\\x0a\\x33\\x47\\x79\\x58\\x78\\x33\\x51\\x61\\x46\\x4f\\x66\\x4c\\x4c\\x4e\\x64\\x79\\x6c\\x2f\\x70\\x75\\x63\\x68\\x2b\\x47\\x6c\\x5a\\x41\\x5a\\x5a\\x73\\x59\\x4b\\x50\\x77\\x3d\\x3d\\x0a\\x2d\\x2d\\x2d\\x2d\\x2d\\x45\\x4e\\x44\\x20\\x45\\x43\\x20\\x50\\x52\\x49\\x56\\x41\\x54\\x45\\x20\\x4b\\x45\\x59\\x2d\\x2d\\x2d\\x2d\\x2d\\x0a çŽ°åœ¨ä½¿ç”¨ç§é’¥å¯¹æ•°æ®ç­¾åï¼Œopenssl ä¼šæ ¹æ®ç§é’¥ç±»åž‹è‡ªåŠ¨é€‰æ‹©ç›¸åº”çš„ç­¾åç®—æ³•ï¼Œå¯¹äºŽ ECC ç§é’¥ï¼Œä¼šé»˜è®¤é€‰æ‹© ECDSA ç®—æ³•ã€‚æŠ¥æ–‡ä¸­å®žé™…ä½¿ç”¨çš„ç­¾åç®—æ³•ä¸º ecdsa_secp256r1_sha256ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ -sha256ï¼Œä½¿å“ˆå¸Œç®—æ³•ä¹Ÿä¿æŒä¸€è‡´ã€‚ 1 2 3 4 5 6 7 8 9 10 # sign the data with the server private key openssl dgst -sign server-ecc-key.pem -sha256 -out sig data # see the signature xxd -ps sig # result: 3044022020b6c7803f90785be49b6d70744f82bc7a421718da24e39abb74 3505fe23882b02203b56f27ca41156b86948f658e07eda922f06dc6c4284 bbd179c6da108a48b4e5 è‡³æ­¤æˆ‘ä»¬å¾—åˆ°äº†ç­¾åï¼Œä½†æ˜¯è¯¥ç­¾åä¸ŽæŠ¥æ–‡ä¸­çš„å®žé™…å€¼å¹¶ä¸ç›¸åŒã€‚ä¸ä»…å¦‚æ­¤ï¼Œä½ ä¼šå‘çŽ°æ¯æ¬¡ç­¾åå¾—åˆ°çš„ç»“æžœéƒ½æ˜¯ä¸åŒçš„ã€‚è¿™æ˜¯å› ä¸º ECDSA ç­¾åç®—æ³•å†…éƒ¨æ··å…¥äº†éšæœºå€¼ï¼Œå³ä¾¿ä½¿ç”¨åŒä¸€ç§é’¥å¯¹åŒä¸€æ¶ˆæ¯è¿›è¡Œå¤šæ¬¡ç­¾åï¼Œç»“æžœä¹Ÿä¼šä¸åŒã€‚ å¦‚æžœæ˜¯ RSA ç§é’¥ï¼Œé‚£ä¹ˆè®¡ç®—å¾—åˆ°çš„ RSA ç­¾åæ˜¯å¯ä»¥ä¸ŽæŠ¥æ–‡ä¸­çš„å®žé™…å€¼å¯¹ä¸Šçš„ã€‚ä½¿ç”¨åŒä¸€ç§é’¥å¯¹åŒä¸€æ¶ˆæ¯è¿›è¡Œå¤šæ¬¡ç­¾åï¼Œç»“æžœæ˜¯ç›¸åŒçš„ã€‚ ä¸è¿‡è¿™å¹¶ä¸ä¼šå½±å“éªŒç­¾çš„ç»“æžœã€‚ä¸‹é¢æˆ‘ä»¬è¿›è¡ŒéªŒç­¾ã€‚ å®žé™…éªŒç­¾æ—¶ï¼Œå®¢æˆ·ç«¯ä¼šä»ŽæœåŠ¡å™¨è¯ä¹¦ä¸­æå–å‡ºå…¬é’¥ã€‚å¦‚ä¸‹ï¼Œæ–‡ä»¶ä»¥ \\n ç»“å°¾ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 # extract the public key from the server certificate openssl x509 -in server-ecc-cert.pem -pubkey -noout &gt; server-ecc-pub.pem # server public key -----BEGIN PUBLIC KEY----- MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAE4Q+9ZBPkV4b2buqwPLB9EskoGByX TcPuF22znhtFG2R9gVlFyU4S3GyXx3QaFOfLLNdyl/puch+GlZAZZsYKPw== -----END PUBLIC KEY----- # server public key hex xxd -ps server-ecc-pub.pem | tr -d &quot;\\n&quot; | sed &#39;s/\\(..\\)/\\\\x\\1/g&#39; \\x2d\\x2d\\x2d\\x2d\\x2d\\x42\\x45\\x47\\x49\\x4e\\x20\\x50\\x55\\x42\\x4c\\x49\\x43\\x20\\x4b\\x45\\x59\\x2d\\x2d\\x2d\\x2d\\x2d\\x0a\\x4d\\x46\\x6b\\x77\\x45\\x77\\x59\\x48\\x4b\\x6f\\x5a\\x49\\x7a\\x6a\\x30\\x43\\x41\\x51\\x59\\x49\\x4b\\x6f\\x5a\\x49\\x7a\\x6a\\x30\\x44\\x41\\x51\\x63\\x44\\x51\\x67\\x41\\x45\\x34\\x51\\x2b\\x39\\x5a\\x42\\x50\\x6b\\x56\\x34\\x62\\x32\\x62\\x75\\x71\\x77\\x50\\x4c\\x42\\x39\\x45\\x73\\x6b\\x6f\\x47\\x42\\x79\\x58\\x0a\\x54\\x63\\x50\\x75\\x46\\x32\\x32\\x7a\\x6e\\x68\\x74\\x46\\x47\\x32\\x52\\x39\\x67\\x56\\x6c\\x46\\x79\\x55\\x34\\x53\\x33\\x47\\x79\\x58\\x78\\x33\\x51\\x61\\x46\\x4f\\x66\\x4c\\x4c\\x4e\\x64\\x79\\x6c\\x2f\\x70\\x75\\x63\\x68\\x2b\\x47\\x6c\\x5a\\x41\\x5a\\x5a\\x73\\x59\\x4b\\x50\\x77\\x3d\\x3d\\x0a\\x2d\\x2d\\x2d\\x2d\\x2d\\x45\\x4e\\x44\\x20\\x50\\x55\\x42\\x4c\\x49\\x43\\x20\\x4b\\x45\\x59\\x2d\\x2d\\x2d\\x2d\\x2d\\x0a ä½¿ç”¨å…¬é’¥éªŒç­¾ã€‚ 1 2 3 # verify the signature openssl dgst -verify server-ecc-pub.pem -signature sig -sha256 data Verified OK éªŒè¯é€šè¿‡ã€‚ ä¸ºä»€ä¹ˆéªŒç­¾è¦ä½¿ç”¨è¯ä¹¦è€Œä¸èƒ½ç›´æŽ¥ä½¿ç”¨å…¬é’¥ï¼Ÿ çŽ°æœ‰ä¸¤ä¸ªäºº A å’Œ Bï¼ŒB ç”¨è‡ªå·±çš„ç§é’¥ç­¾åäº†ä¸€æ®µä¿¡æ¯ï¼Œå‘ç»™ Aã€‚çŽ°åœ¨ A ç”¨ B çš„å…¬é’¥éªŒç­¾ï¼Œå‘çŽ°èƒ½å¤ŸæˆåŠŸè§£å¯†ï¼Œæ‰€ä»¥ä»¥æ­¤è®¤å®šä¿¡æ¯çš„å‘é€è€…æ˜¯ Bã€‚è¿™ä¼¼ä¹Žæ²¡æœ‰é—®é¢˜ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦å…¬é’¥è¯ä¹¦å‘¢ï¼Ÿ é—®é¢˜çš„å…³é”®åœ¨äºŽï¼ŒB çš„å…¬é’¥æ˜¯å¦å¯ä¿¡ï¼ŒB çš„å…¬é’¥æ˜¯å¦çœŸçš„æ˜¯ B çš„å…¬é’¥ã€‚å¦‚æžœæœ‰ä¸­é—´äººæ”»å‡»ï¼Œæ”»å‡»è€… C æŽ‰åŒ…äº† B çš„å…¬é’¥ä¸ºè‡ªå·±çš„å…¬é’¥ï¼Œç„¶åŽè‡ªå·±ç­¾åå‘é€ä¸€æ®µä¿¡æ¯ç»™ Aï¼Œé‚£ä¹ˆ A å°±ä¼šè¯¯ä»¥ä¸ºä¿¡æ¯çš„å‘é€è€…æ˜¯ Bï¼Œè€Œå®žé™…å‘é€è€…å´æ˜¯ Aã€‚ æ‰€ä»¥ï¼Œæœ‰å¿…è¦ç¡®ä¿å…¬é’¥çš„ç¡®æ˜¯ B çš„ï¼Œè€Œè¯ä¹¦èƒ½å¤Ÿè¯æ˜Žè¿™ä¸€ç‚¹ã€‚è¯ä¹¦ç”±å¹¿å—ç¤¾ä¼šä¿¡ä»»çš„ CA ç­¾å‘ï¼Œå…¶ä¸­åŒ…å«äº†å…¬é’¥æœ¬èº«å’Œå…¬é’¥æ‰€ä»£è¡¨çš„èº«ä»½ä¿¡æ¯ã€‚A åœ¨æ”¶åˆ° B çš„è¯ä¹¦åŽï¼Œä½¿ç”¨ CA çš„è¯ä¹¦éªŒè¯ B çš„è¯ä¹¦ï¼ŒéªŒè¯é€šè¿‡å³ä»£è¡¨ B çš„è¯ä¹¦çš„ç¡®æ˜¯ç”± CA ç­¾å‘çš„ï¼ŒCA ä¿¡ä»» B çš„èº«ä»½ï¼Œè€Œ CA æ˜¯å¹¿å—ä¿¡ä»»çš„ï¼ŒA è‡ªç„¶ä¹Ÿä¿¡ä»» CAï¼ŒäºŽæ˜¯ A å¯ä»¥ä¿¡ä»» B çš„èº«ä»½ï¼Œä¹Ÿå³ï¼šåªè¦éªŒè¿‡äº†è¯ä¹¦ï¼Œå°±å¯ä»¥ç›¸ä¿¡å…¬é’¥æ‰€ä»£è¡¨çš„èº«ä»½ï¼Œå°±è¯æ˜Žå…¬é’¥çš„ç¡®å±žäºŽå®ƒæ‰€ä»£è¡¨çš„é‚£ä¸ªèº«ä»½æœºæž„ã€‚ å³ä¾¿æ”»å‡»è€…æŽ‰åŒ… B çš„å…¬é’¥ï¼Œä»–ä¹Ÿæ— æ³•ä¼ªé€  CA çš„ç­¾åï¼Œæ‰€ä»¥æ”»å‡»è€…æ˜¯æ— æ³•ä¼ªé€ è¯ä¹¦çš„ã€‚è¯ä¹¦/ä¿¡ä»»é“¾æœºåˆ¶ä»¥ CA è¿™æ ·çš„ç¬¬ä¸‰æ–¹æƒå¨æœºæž„ä½œèƒŒä¹¦ï¼Œèƒ½å¤Ÿé˜²èŒƒä¸­é—´äººæ”»å‡»ï¼Œç¡®ä¿å…¬é’¥çš„çœŸå®žæ€§ã€‚ å¯¹äºŽä»¥ä¸‹æƒ…å†µï¼š A å’Œ B æ˜¯å¥½å‹ï¼ŒçŽ°åœ¨å°±é¢å¯¹é¢ç«™ç€äº¤æŽ¥å…¬é’¥ã€‚ B ä»¥ç”¨æˆ·åå¯†ç çš„æ–¹å¼å·²ç»é€šè¿‡äº† A çš„èº«ä»½è®¤è¯ï¼Œå†äº¤æŽ¥å…¬é’¥ã€‚ A èƒ½å¤Ÿç›´æŽ¥ä¿¡ä»» Bï¼Œç›´æŽ¥è®¤å¯å…¬é’¥çš„çœŸå®žæ€§ï¼Œè¿™å°±ä¸éœ€è¦è¯ä¹¦äº†ã€‚A ä»¥åŽç›´æŽ¥ä½¿ç”¨å…¬é’¥éªŒç­¾å³å¯ã€‚ç„¶è€Œï¼Œåœ¨å¼€æ”¾çš„ç½‘ç»œé€šä¿¡ä¸­ï¼Œè¯ä¹¦/ä¿¡ä»»é“¾æœºåˆ¶ä¸å¯æˆ–ç¼ºã€‚ TLS ç®—æ³•åç§°çš„å«ä¹‰ åœ¨ç†Ÿæ‚‰äº†æ¡æ‰‹çš„çŸ¥è¯†ä»¥åŽï¼Œæˆ‘ä»¬å†æ¥ç†è§£ç®—æ³•åç§°çš„å«ä¹‰ã€‚è¿™å¹¶æ²¡æœ‰æƒ³è±¡ä¸­é‚£ä¹ˆç®€å•ï¼Œç”±äºŽç®—æ³•ç‰ˆæœ¬çš„æ›´è¿­ï¼Œç®—æ³•åç§°çš„å«ä¹‰ä¼šæœ‰ä¸€äº›å·®åˆ«ã€‚å…ˆè´´ä¸Šå‡ ä¸ªç®—æ³•åç§°çš„ä¾‹å­ï¼š 1 2 3 4 5 6 7 8 9 TLS_RSA_WITH_AES_256_CBC_SHA256 TLS_RSA_WITH_AES_128_GCM_SHA256 TLS_RSA_WITH_AES_256_GCM_SHA384 TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256 TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384 TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 TLS_ECDH_RSA_WITH_AES_256_CBC_SHA TLS_ECDH_ECDSA_WITH_AES_256_CBC_SHA SHA æ˜¯æŒ‡ HMAC è®¡ç®—ä»¥åŠ Finished æ ¡éªŒç­‰æµç¨‹æ‰€ä½¿ç”¨çš„å“ˆå¸Œç®—æ³•ï¼ŒCBC/GCM æ˜¯åˆ†ç»„å¯†ç å·¥ä½œæ¨¡å¼ï¼ŒAES_256 æ˜¯å…±äº«å¯†ç ç®—æ³•å’Œå…±äº«å¯†é’¥é•¿åº¦ã€‚ç´§è·Ÿåœ¨ TLS åŽé¢çš„ RSA/ECDHE/ECDH æ˜¯å¯†é’¥äº¤æ¢ç®—æ³•ï¼Œå…¶ä¸­ DHE å¯†é’¥äº¤æ¢è¿‡ç¨‹ä¸­ä¼šç”¨åˆ°ç­¾åï¼Œæ‰€ä»¥åŽé¢è¿˜è·Ÿäº†ä¸€ä¸ªç­¾åç®—æ³•â€”â€”ECDSA/RSAã€‚ é—®é¢˜å‡ºçŽ°äº†ï¼ŒECDH å¯†é’¥äº¤æ¢ä¸­ï¼ŒECDH å¯†é’¥å¯¹ä¸æ˜¯ä¸´æ—¶ç”Ÿæˆçš„ï¼ŒæœåŠ¡å™¨æ˜¯ç›´æŽ¥å°†è¯ä¹¦ä½œä¸º ECDH å…¬é’¥å‘ç»™å®¢æˆ·ç«¯çš„ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­æœåŠ¡å™¨ä¸éœ€è¦è¿›è¡Œé¢å¤–çš„ç­¾åï¼Œé‚£ä¸ºä»€ä¹ˆä¼šå­˜åœ¨ ECDH_RSA/ECDH_ECDSA è¿™æ ·çš„ç®—æ³•åç§°å‘¢ï¼Ÿè¿™æ¶‰åŠä¸€ä¸ªè¢«å¹¿æ³›è¯¯è§£çš„é—®é¢˜ï¼šç®—æ³•åç§°ä¸­çš„ç­¾åç®—æ³•åˆ°åº•æ˜¯æŒ‡è¯ä¹¦ä¸Šæ‰€ä½¿ç”¨çš„ç­¾åè¿˜æ˜¯æ¡æ‰‹è¿‡ç¨‹ä¸­æ‰€ä½¿ç”¨çš„ç­¾åï¼Ÿæžæ¸…è¿™ä¸ªé—®é¢˜å¤§æ¦‚æ²¡ä»€ä¹ˆå®žç”¨ä»·å€¼ï¼Œä½†ä¸æžæ¸…å®žåœ¨è®©æˆ‘ä¸èˆ’æœðŸ˜£ã€‚åœ¨ä¸€ä¼— RFC ä¸­ï¼Œæˆ‘é€æ¸æ‰¾åˆ°äº†ç­”æ¡ˆã€‚ RFC4346 The Transport Layer Security (TLS) Protocol Version 1.1 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # 7.4.2 Server Certificate The certificate type MUST be appropriate for the selected cipher suite&#39;s key exchange algorithm, and is generally an X.509v3 certificate. It MUST contain a key that matches the key exchange method, as follows. Unless otherwise specified, the signing algorithm for the certificate MUST be the same as the algorithm for the certificate key. Unless otherwise specified, the public key MAY be of any length. Key Exchange Algorithm Certificate Key Type RSA RSA public key; the certificate MUST allow the key to be used for encryption. DHE_DSS DSS public key. DHE_RSA RSA public key that can be used for signing. DH_DSS Diffie-Hellman key. The algorithm used to sign the certificate MUST be DSS. DH_RSA Diffie-Hellman key. The algorithm used to sign the certificate MUST be RSA. è¿™æ˜¯ TLS1.1 çš„ RFCã€‚ä¸Šé¢çš„æ„æ€æ˜¯ï¼šè¯ä¹¦çš„ç­¾åç®—æ³•å¿…é¡»ä¸Žç¡®å®šå¯†é’¥å¯¹ç±»åž‹çš„ç®—æ³•ä¿æŒä¸€è‡´ã€‚æ–‡ä¸­è¿˜ä¸¾äº†å‡ ä¸ªä¾‹å­ï¼š å¯†é’¥äº¤æ¢ç®—æ³• å¯†é’¥å¯¹ç±»åž‹ æ¡æ‰‹ç­¾åç®—æ³•ï¼ˆæŽ¨ç†ï¼‰ è¯ä¹¦ç­¾åç®—æ³•ï¼ˆæŽ¨ç†ï¼‰ RSA RSA / RSA DHE_DSS DSS DSS DSS DHE_RSA RSA RSA RSA DH_DSS DH / DSS DH_RSA DH / RSA æ³¨ï¼ˆAIï¼‰ï¼šDSS æ˜¯ä¸€ä¸ªæ•°å­—ç­¾åæ ‡å‡†ï¼ŒDSA ç®—æ³•æ˜¯å…¶æœ€åˆçš„æ ¸å¿ƒå®žçŽ°ï¼Œéšç€ DSS æ ‡å‡†çš„ç‰ˆæœ¬æ›´æ–°ï¼ŒRSA å’Œ ECDSA ä¹Ÿè¢«çº³å…¥æ ‡å‡†ä¸­ã€‚ æˆ‘ä»¬å¯ä»¥å‘çŽ°ä¸Šè¡¨ä¸­çš„ä¸¤ä¸ª DH å¯†é’¥äº¤æ¢ç®—æ³•æ²¡æœ‰éµå®ˆâ€œè¯ä¹¦çš„ç­¾åç®—æ³•å¿…é¡»ä¸Žç¡®å®šå¯†é’¥å¯¹ç±»åž‹çš„ç®—æ³•ä¿æŒä¸€è‡´â€çš„è§„å®šï¼Œè¿™æ˜¯å› ä¸º DH ç®—æ³•åªèƒ½ç”¨ä½œå¯†é’¥äº¤æ¢ï¼Œä¸èƒ½ç”¨æ¥ç­¾åï¼Œè¿™æ‰é¢å¤–è¿½åŠ äº†ä¸€ä¸ªç®—æ³•åç§°ï¼Œç”¨äºŽæŒ‡å®šè¯ä¹¦çš„ç­¾åç®—æ³•ã€‚ RFC4346 The Transport Layer Security (TLS) Protocol Version 1.1 1 2 3 4 5 6 7 8 9 # F.1.1.3 Diffie-Hellman Key Exchange with Authentication When Diffie-Hellman key exchange is used, the server can either supply a certificate containing fixed Diffie-Hellman parameters or use the server key exchange message to send a set of temporary Diffie-Hellman parameters signed with a DSS or RSA certificate. Temporary parameters are hashed with the hello.random values before signing to ensure that attackers do not replay old parameters. In either case, the client can verify the certificate or signature to ensure that the parameters belong to the server. è¿™æ®µè¯´æ˜ŽæœåŠ¡å™¨å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼æä¾› DH å‚æ•°ï¼šä¸€ç§æ˜¯ç›´æŽ¥å‘é€ DH è¯ä¹¦ï¼Œå®¢æˆ·ç«¯é€šè¿‡éªŒè¯è¯ä¹¦è¯æ˜Ž DH å‚æ•°çš„ç¡®å±žäºŽæœåŠ¡å™¨ï¼›ä¸€ç§æ˜¯å‘é€å¸¦ç­¾åçš„ä¸´æ—¶ç”Ÿæˆçš„ DHE å‚æ•°ï¼Œå®¢æˆ·ç«¯é€šè¿‡éªŒç­¾è¯æ˜Ž DHE å‚æ•°çš„ç¡®å±žäºŽæœåŠ¡å™¨ã€‚ è¿™æ®µè‡³å°‘å¯ä»¥ä½è¯æˆ‘å¯¹ DH å’Œ DHE çš„ç†è§£æ˜¯æ­£ç¡®çš„ã€‚ RFC4492 Elliptic Curve Cryptography (ECC) Cipher Suites for Transport Layer Security (TLS) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # 2.1 ECDH_ECDSA In ECDH_ECDSA, the serverâ€™s certificate MUST contain an ECDH-capable public key and be signed with ECDSA. # 2.2 ECDHE_ECDSA In ECDHE_ECDSA, the serverâ€™s certificate MUST contain an ECDSA capable public key and be signed with ECDSA. # 2.3 ECDH_RSA This key exchange algorithm is the same as ECDH_ECDSA except that the serverâ€™s certificate MUST be signed with RSA rather than ECDSA. # 2.4 ECDHE_RSA This key exchange algorithm is the same as ECDHE_ECDSA except that the serverâ€™s certificate MUST contain an RSA public key authorized for signing, and that the signature in the ServerKeyExchange message must be computed with the corresponding RSA private key. The server certificate MUST be signed with RSA. è¿™æ˜¯ TLS1.1 ECC ç®—æ³•çš„ RFCã€‚æ‰€è¿°é€»è¾‘ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œä¸Žä¸Šé¢çš„è¯´æ³•éƒ½å¯¹å¾—ä¸Šã€‚ é—®é¢˜æ€»ç»“ - TLS1.1ï¼š è¯ä¹¦çš„ç­¾åç®—æ³•å¿…é¡»ä¸Žç¡®å®šå¯†é’¥å¯¹ç±»åž‹çš„ç®—æ³•ä¿æŒä¸€è‡´ã€‚ RSA å¯†é’¥äº¤æ¢ä¸­æ²¡æœ‰ç­¾åçš„è¿‡ç¨‹ï¼Œæ•…ç®—æ³•åç§°ä¸­æ²¡æœ‰ç­¾åç®—æ³•ã€‚è¯ä¹¦çš„ç­¾åç®—æ³•é¡»ä¸º RSAã€‚ DHE å¯†é’¥äº¤æ¢ä¸­æœ‰ç­¾åçš„è¿‡ç¨‹ï¼Œæ•…ç®—æ³•åç§°ä¸­æŒ‡å®šäº†ç­¾åç®—æ³•ï¼Œå¦‚ ECDHE_RSAã€‚è¯ä¹¦çš„ç­¾åç®—æ³•é¡»ä¸Žè¯¥ç­¾åç®—æ³•ä¸€è‡´ã€‚ DH å¯†é’¥äº¤æ¢ä¸­æ²¡æœ‰ç­¾åçš„è¿‡ç¨‹ï¼Œå…¶ç®—æ³•åç§°ä¸­æœ¬ä¸éœ€è¦æŒ‡å®šç­¾åç®—æ³•ï¼Œç„¶è¯ä¹¦çš„ç­¾åç®—æ³•é¡»ä¸Žç¡®å®šå¯†é’¥å¯¹ç±»åž‹çš„ç®—æ³•ï¼ˆDHï¼‰ä¿æŒä¸€è‡´ï¼Œè€Œ DH ç®—æ³•æ— æ³•ç”¨äºŽç­¾åï¼Œæ•…ç®—æ³•åç§°ä¸­é¢å¤–æŒ‡å®šäº†è¯ä¹¦çš„ç­¾åç®—æ³•ï¼Œå¦‚ ECDH_RSAã€‚ RFC5246 The Transport Layer Security (TLS) Protocol Version 1.2 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 # A.7 Changes to RFC 4492 As described in Sections 7.4.2 and 7.4.6, the restrictions on the signature algorithms used to sign certificates are no longer tied to the cipher suite (when used by the server) or the ClientCertificateType (when used by the client). Thus, the restrictions on the algorithm used to sign certificates specified in Sections 2 and 3 of RFC 4492 are also relaxed. # 7.4.2 Server Certificate If the client provided a &quot;signature_algorithms&quot; extension, then all certificates provided by the server MUST be signed by a hash/signature algorithm pair that appears in that extension. Note that this implies that a certificate containing a key for one signature algorithm MAY be signed using a different signature algorithm (for instance, an RSA key signed with a DSA key). This is a departure from TLS 1.1, which required that the algorithms be the same. Note that this also implies that the DH_DSS, DH_RSA, ECDH_ECDSA, and ECDH_RSA key exchange algorithms do not restrict the algorithm used to sign the certificate. Fixed DH certificates MAY be signed with any hash/signature algorithm pair appearing in the extension. The names DH_DSS, DH_RSA, ECDH_ECDSA, and ECDH_RSA are historical. # 7.4.1.4.1 Signature Algorithms The client uses the &quot;signature_algorithms&quot; extension to indicate to the server which signature/hash algorithm pairs may be used in digital signatures. # 7.4.1.4.1 Signature Algorithms The semantics of this extension are somewhat complicated because the cipher suite indicates permissible signature algorithms but not hash algorithms. Sections 7.4.2 and 7.4.3 describe the appropriate rules. # 7.4.3 Server Key Exchange Message If the client has offered the &quot;signature_algorithms&quot; extension, the signature algorithm and hash algorithm MUST be a pair listed in that extension. Note that there is a possibility for inconsistencies here. For instance, the client might offer DHE_DSS key exchange but omit any DSA pairs from its &quot;signature_algorithms&quot; extension. In order to negotiate correctly, the server MUST check any candidate cipher suites against the &quot;signature_algorithms&quot; extension before selecting them. This is somewhat inelegant but is a compromise designed to minimize changes to the original cipher suite design. è¿™æ˜¯ TLS1.2 çš„ RFCã€‚æ–°å¢žäº† signature_algorithms æ‰©å±•å­—æ®µï¼Œå®ƒä»£è¡¨äº†å®¢æˆ·ç«¯æ”¯æŒçš„ç­¾åç®—æ³•ã€‚å¯†é’¥äº¤æ¢è¿‡ç¨‹ä¸­å¯èƒ½ç”¨åˆ°çš„ç­¾åç®—æ³•ç”±æ­¤å­—æ®µåå•†è€Œæ¥ã€‚è¯ä¹¦çš„ç­¾åç®—æ³•ä¸å†å— TLS ç®—æ³•åç§°çº¦æŸï¼Œåªé¡»ä½åˆ— signature_algorithms æ‰€æ”¯æŒçš„ç®—æ³•åˆ—è¡¨ä¸­ã€‚ å¯¹äºŽå¯†é’¥äº¤æ¢è¿‡ç¨‹ä¸­å¯èƒ½å‡ºçŽ°çš„ç­¾åè¿‡ç¨‹ï¼ŒTLS ç®—æ³•åç§°ä¸­åªæŒ‡å®šäº†ç­¾åç®—æ³•ï¼Œå´æ²¡æœ‰å“ˆå¸Œç®—æ³•ï¼ˆåç§°ä¸­çš„å“ˆå¸Œç®—æ³•ä¸º HMAC æˆ– Finished æŠ¥æ–‡æ‰€ç”¨ï¼‰ï¼Œé‚æœ‰ signature_algorithmsï¼Œå…¶ä¸­çš„åç§°åŒæ—¶åŒ…å«äº†ç­¾åå’Œå“ˆå¸Œç®—æ³•ã€‚å¦‚æ­¤ï¼ŒTLS ç®—æ³•åç§°å’Œæ‰©å±•å­—æ®µéƒ½ç»™å‡ºäº†ç­¾åç®—æ³•åç§°ï¼Œä¸ºåŒæ—¶æ»¡è¶³äºŒè€…çº¦æŸï¼ŒæœåŠ¡å™¨å¿…é¡»äºˆä»¥æ£€æŸ¥ï¼Œæœ€ç»ˆåå•†é€‰æ‹©å‡ºçš„ç­¾åç®—æ³•é¡»åŒæ—¶å…¼å®¹ TLS ç®—æ³•åç§°å’Œæ‰©å±•å­—æ®µã€‚ ä¸¾ä¾‹ï¼Œè‹¥ TLS ç®—æ³•åç§°ä¸º ECDHE_ECDSAï¼Œæ‰©å±• signature_algorithms ä¸­å«æœ‰ ecdsa_secp256r1_sha256, rsa_pkcs1_sha256ï¼Œé‚£ä¹ˆæœåŠ¡å™¨åº”åå•†é€‰æ‹©å‡º ecdsa_secp256r1_sha256 ä½œä¸ºç­¾åç®—æ³•ã€‚æ—¢å¦‚æ­¤ï¼Œè¯ä¹¦åº”é€‰ç”¨ ECC è¯ä¹¦ï¼Œä½†è¯ä¹¦è‡ªå·±çš„ç­¾åå¯ä»¥æ˜¯ RSAã€‚ å¦ï¼Œå¯¹äºŽé™æ€ DH å¯†é’¥äº¤æ¢ç®—æ³•å¦‚ ECDH_ECDSA, ECDH_RSAï¼Œå…¶åç§°ä¸­çš„ç­¾åç®—æ³•å·²ç»ä¸å«æœ‰ä»»ä½•å®žé™…çº¦æŸæ„ä¹‰ï¼Œæ­¤ç±»è¿·æƒ‘æ€§åè¶³çš„åç§°ä¹‹å­˜åœ¨çš†ç³»åŽ†å²åŽŸå› ã€‚ RFC8422 Elliptic Curve Cryptography (ECC) Cipher Suites for Transport Layer Security (TLS) Versions 1.2 and Earlier 1 2 3 4 5 6 7 8 9 # 2.1 ECDHE_ECDSA In ECDHE_ECDSA, the serverâ€™s certificate MUST contain an ECDSA- or EdDSA-capable public key. # 2.2 ECDHE_RSA This key exchange algorithm is the same as ECDHE_ECDSA except that the serverâ€™s certificate MUST contain an RSA public key authorized for signing and the signature in the ServerKeyExchange message must be computed with the corresponding RSA private key. è¿™æ˜¯ TLS1.2 å‡ºçŽ°åŽï¼Œæœ‰å…³ ECC ç®—æ³•çš„ RFCã€‚ç›¸æ¯” RFC4492 çš„è¡¨è¿°ï¼Œè¯¥è¡¨è¿°æ²¡æœ‰å†ç‰¹åˆ«æåŠè¯ä¹¦æœ¬èº«çš„ç­¾ååº”ä¸ºä½•ç®—æ³•ï¼Œå› ä¸ºè¯ä¹¦çš„ç­¾åç®—æ³•å·²ä¸å†å— TLS ç®—æ³•åç§°çº¦æŸï¼Œåªè¦ä½åˆ— signature_algorithms çš„ç®—æ³•åˆ—è¡¨ï¼Œæ˜¯ä»€ä¹ˆç®—æ³•éƒ½æœ‰å¯èƒ½ã€‚ é—®é¢˜æ€»ç»“ - TLS1.2ï¼š å¯†é’¥äº¤æ¢è¿‡ç¨‹ä¸­å¯èƒ½ç”¨åˆ°çš„ç­¾åç®—æ³•æ ¹æ®å®¢æˆ·ç«¯æ”¯æŒçš„ TLS ç®—æ³•å’Œ signature_algorithms æ‰©å±•åå•†è€Œæ¥ã€‚ è¯ä¹¦çš„ç­¾åç®—æ³•ä¸å†å— TLS ç®—æ³•åç§°çº¦æŸï¼Œåªé¡»ä½åˆ— signature_algorithms æ‰€æ”¯æŒçš„ç®—æ³•åˆ—è¡¨ä¸­ã€‚ é™æ€ DH å¯†é’¥äº¤æ¢ç®—æ³•å¦‚ ECDH_ECDSA, ECDH_RSAï¼Œå…¶åç§°ä¸­çš„ç­¾åç®—æ³•ä¸å…·æœ‰ä»»ä½•å®žé™…çº¦æŸæ„ä¹‰ï¼Œæ­¤ç±»åç§°ä¹‹å­˜åœ¨çš†ç³»åŽ†å²åŽŸå› ã€‚ é—®é¢˜ç»“è®ºï¼š TLS ç®—æ³•åç§°ä¸­çš„ç­¾åç®—æ³•åŸºæœ¬æŒ‡çš„æ˜¯æ¡æ‰‹è¿‡ç¨‹ä¸­æ‰€ä½¿ç”¨çš„ç­¾åï¼Œè€Œéžç‰¹æŒ‡è¯ä¹¦æœ¬èº«çš„ç­¾åï¼Œä¸è¿‡äºŒè€…ä¹Ÿå¹¶éžæ¯«æ— å…³è”ï¼Œå…·ä½“ç»†èŠ‚å‚è§ä¸Šé¢çš„åˆ†æžå’Œæ€»ç»“ã€‚ æž„å»ºè¯ä¹¦é“¾ å°è¯•ä½¿ç”¨ openssl æž„å»ºå¦‚ä¸‹è¯ä¹¦é“¾ã€‚ 1 Root CA Cert -&gt; Intermediate CA Cert -&gt; End Entity Cert æ ¹ CA ä½œä¸ºä¿¡ä»»é”šç‚¹ï¼Œå®ƒçš„è¯ä¹¦æ˜¯è‡ªç­¾åè¯ä¹¦ï¼›æ ¹ CA ç»™ä¸­çº§ CA é¢å‘ä¸­çº§è¯ä¹¦ï¼›ä¸­çº§ CA ç»™ç”¨æˆ·é¢å‘æœ«ç«¯è¯ä¹¦ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 # build the root cert # generate private key for the root ca openssl genrsa -out root-ca-key.pem 2048 # generate cert sign request of the root ca # here the key content of the `openssl-ca.cnf` will show at the end openssl req -new -key root-ca-key.pem -out root-ca-csr.pem -config openssl-ca.cnf # fill the prompted fields like follows Country Name (2 letter code) [AU]:CN State or Province Name (full name) [Some-State]:Zhejiang Locality Name (eg, city) []:Hangzhou Organization Name (eg, company) [Internet Widgits Pty Ltd]:lcatmiao Organizational Unit Name (eg, section) []:lcatmiao-ca Common Name (e.g. server FQDN or YOUR name) []:lcatmiao-ca.com Email Address []:lcatmiao@test.com # self-sign the public key retrived implicitly from the cert sign request # of the root ca with the private key of also the root ca then get the # root cert openssl x509 -req -days 3650 -sha256 -extfile openssl-ca.cnf -extensions v3_ca -in root-ca-csr.pem -signkey root-ca-key.pem -out root-ca-cert.pem # build the intermediate cert # generate private key for the intermediate ca openssl genrsa -out intermediate-ca-key.pem 2048 # generate cert sign request of the intermediate ca openssl req -new -key intermediate-ca-key.pem -out intermediate-ca-csr.pem -config openssl-ca.cnf # fill the prompted fields like follows Country Name (2 letter code) [AU]:CN State or Province Name (full name) [Some-State]:Zhejiang Locality Name (eg, city) []:Hangzhou Organization Name (eg, company) [Internet Widgits Pty Ltd]:lcatmiao Organizational Unit Name (eg, section) []:lcatmiao-ca Common Name (e.g. server FQDN or YOUR name) []:lcatmiao-ca.com Email Address []:lcatmiao@test.com # sign the public key retrived implicitly from the cert sign request # of the intermediate ca with the private key of the root ca then # get the intermediate cert openssl x509 -req -days 3650 -sha256 -extfile openssl-ca.cnf -extensions v3_ca -in intermediate-ca-csr.pem -CA root-ca-cert.pem -CAkey root-ca-key.pem -CAcreateserial -out intermediate-ca-cert.pem # build the end entity cert # generate private key for the end entity openssl genrsa -out end-entity-key.pem 2048 # generate cert sign request of the end entity # here the key content of the `openssl-user.cnf` will show at the end openssl req -new -key end-entity-key.pem -out end-entity-csr.pem -config openssl-user.cnf # fill the prompted fields like follows Country Name (2 letter code) [AU]:CN State or Province Name (full name) [Some-State]:Zhejiang Locality Name (eg, city) []:Hangzhou Organization Name (eg, company) [Internet Widgits Pty Ltd]:lcatmiao Organizational Unit Name (eg, section) []:lcatmiao-user Common Name (e.g. server FQDN or YOUR name) []:172.168.10.110 Email Address []:lcatmiao@test.com # sign the public key retrived implicitly from the cert sign request # of the end entity with the private key of the intermediate ca then # get the end entity cert openssl x509 -req -days 3650 -sha256 -extfile openssl-user.cnf -extensions usr_cert -in end-entity-csr.pem -CA intermediate-ca-cert.pem -CAkey intermediate-ca-key.pem -CAcreateserial -out end-entity-cert.pem # After doing all the operations above, `ls` shows that # all the files we have are as follows. end-entity-cert.pem end-entity-csr.pem end-entity-key.pem intermediate-ca-cert.pem intermediate-ca-cert.srl intermediate-ca-csr.pem intermediate-ca-key.pem openssl-ca.cnf openssl-user.cnf root-ca-cert.pem root-ca-cert.srl root-ca-csr.pem root-ca-key.pem # we can see the cert info by using this cmd openssl x509 -in end-entity-cert.pem -noout -text 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # key content of the openssl-ca.cnf # the following is just a test example that only lists the modified cfg items [ req ] req_extensions = v3_req # The extensions to add to a certificate request [ v3_req ] basicConstraints = CA:TRUE # keyUsage = nonRepudiation, digitalSignature, keyEncipherment subjectAltName = @alt_names [ v3_ca ] subjectAltName = @alt_names [ alt_names ] DNS.1 = lcatmiao-ca.com 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # key content of the openssl-user.cnf # the following is just a test example that only lists the modified cfg items [ req ] req_extensions = v3_req # The extensions to add to a certificate request [ usr_cert ] subjectAltName = @alt_names [ v3_req ] basicConstraints = CA:FALSE # keyUsage = nonRepudiation, digitalSignature, keyEncipherment subjectAltName = @alt_names [ alt_names ] IP.1 = 172.168.10.110 IP.2 = 172.168.10.105 IP.3 = 172.168.10.106 IP.4 = 172.168.10.107 IP.5 = 172.168.10.108 è‡³æ­¤ï¼Œä¸€ä¸ªç®€å•çš„è¯ä¹¦é“¾å°±æž„å»ºå¥½äº†ã€‚ä¸‹é¢æˆ‘ä»¬æ¥éªŒè¯ä¸€ä¸‹è¿™ä¸ªè¯ä¹¦é“¾ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # verify the root cert which is a self-sign cert openssl verify -CAfile root-ca-cert.pem root-ca-cert.pem # output: root-ca-cert.pem: OK # verify the intermediate cert openssl verify -trusted root-ca-cert.pem intermediate-ca-cert.pem # output: intermediate-ca-cert.pem: OK # verify the end entity cert openssl verify -partial_chain -trusted intermediate-ca-cert.pem end-entity-cert.pem # output: end-entity-cert.pem: OK # directly verify the whole cert chain which has only three levels openssl verify -CAfile root-ca-cert.pem -untrusted intermediate-ca-cert.pem end-entity-cert.pem # output: end-entity-cert.pem: OK æœ¬åœ°ä½¿ç”¨å‘½ä»¤è¡Œéƒ½èƒ½éªŒè¿‡ï¼Œä¸ä»£è¡¨ç½‘ç»œé€šä¿¡æ—¶ä¹Ÿèƒ½éªŒè¿‡ã€‚å®žé™…é€šä¿¡çš„è¡Œä¸ºå—å„ç§é…ç½®çš„å½±å“ ï¼Œæ¯”å¦‚å®žæµ‹å‘çŽ°æœ«ç«¯è¯ä¹¦ä¸­é…ç½®çš„ IP åœ°å€æˆ–è€…åŸŸåè¦ä¸ŽæœåŠ¡å™¨ä¿æŒä¸€è‡´ï¼Œå¦åˆ™ä¸é€šã€‚ é¡ºå¸¦ä¸€æï¼Œå®žé™…æŠ¥æ–‡ä¸­ï¼Œè¯ä¹¦é“¾çš„é¡ºåºï¼šæœ«ç«¯è¯ä¹¦åœ¨å‰ï¼Œä¸­çº§è¯ä¹¦æŒ‰å±‚çº§é¡ºåºä¾æ¬¡è·Ÿéšï¼Œæ ¹è¯ä¹¦ä¸€èˆ¬ä¸åŒ…å«åœ¨é“¾ä¸­ã€‚ RFC5246 The Transport Layer Security (TLS) Protocol Version 1.2 1 2 3 4 5 6 7 8 9 10 # 7.4.2 Server Certificate certificate_list This is a sequence (chain) of certificates. The sender&#39;s certificate MUST come first in the list. Each following certificate MUST directly certify the one preceding it. Because certificate validation requires that root keys be distributed independently, the self-signed certificate that specifies the root certificate authority MAY be omitted from the chain, under the assumption that the remote end must already possess it in order to validate it in any case. æ¶ˆé™¤æµè§ˆå™¨å®‰å…¨è­¦å‘Š å½“å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰æ²¡èƒ½éªŒè¿‡æœåŠ¡å™¨å‘æ¥çš„è¯ä¹¦æ—¶ï¼Œå°±ä¼šæ˜¾ç¤ºå¦‚ä¸‹çš„å®‰å…¨è­¦å‘Šé¡µé¢ï¼Œå¹¶ä¸” URI æ ä¼šæœ‰â€œä¸å®‰å…¨â€çš„æç¤ºã€‚å¦‚æžœæœåŠ¡å™¨çš„è¯ä¹¦æ˜¯æˆ‘ä»¬è‡ªå·±ç­¾å‘çš„ï¼Œè‡ªç„¶æ— æ³•è¢«æµè§ˆå™¨å†…ç½®çš„ CA è¯ä¹¦éªŒè¿‡ï¼Œæˆ‘ä»¬éœ€è¦å°†è‡ªå·±ç”Ÿæˆçš„æ ¹è¯ä¹¦å¯¼å…¥æµè§ˆå™¨æ‰è¡Œã€‚ å°†è‡ªå·±ç”Ÿæˆçš„æ ¹è¯ä¹¦å¯¼å…¥æµè§ˆå™¨ï¼Œä½œä¸ºå—ä¿¡ä»»çš„é¢å‘æœºæž„ã€‚ æ­¤åŽå†è®¿é—®æœåŠ¡å™¨ï¼Œå°±æ˜¯æ­£å¸¸çš„ https è®¿é—®äº†ã€‚ å¦‚æžœæœåŠ¡å™¨å‘æ¥çš„è¯ä¹¦ä¸æ­¢ä¸€ä¸ªï¼Œè€Œæ˜¯å¤šçº§è¯ä¹¦ï¼Œå³è¯ä¹¦é“¾çš„ä¸€éƒ¨åˆ†ï¼Œé‚£ä¹ˆç†è®ºä¸Šå¯¼å…¥æµè§ˆå™¨çš„è¯ä¹¦åº”è¯¥æ˜¯è¯ä¹¦é“¾çš„å¦ä¸€éƒ¨åˆ†ï¼ŒäºŒè€…åˆä¸€è¦èƒ½æž„æˆå®Œæ•´çš„è¯ä¹¦é“¾æ‰è¡Œã€‚ å‚è€ƒèµ„æ–™ ã€Šå›¾è§£HTTPã€‹ Keyless SSL: The Nitty Gritty Technical Details The Illustrated TLS Connection: Every Byte Explained RFC4346 The Transport Layer Security (TLS) Protocol Version 1.1 RFC4492 Elliptic Curve Cryptography (ECC) Cipher Suites for Transport Layer Security (TLS) RFC5246 The Transport Layer Security (TLS) Protocol Version 1.2 RFC8422 Elliptic Curve Cryptography (ECC) Cipher Suites for Transport Layer Security (TLS) Versions 1.2 and Earlier RFC7919 Negotiated Finite Field Diffie-Hellman Ephemeral Parameters for Transport Layer Security (TLS) è„šæ³¨ ä½¿ç”¨ä¼šè¯å¯†é’¥åŠ å¯†åŽçš„ Client Finished æŠ¥æ–‡ã€‚Â &#8617;Â &#8617;2 ä½¿ç”¨ä¼šè¯å¯†é’¥åŠ å¯†åŽçš„ Server Finished æŠ¥æ–‡ã€‚Â &#8617;Â &#8617;2 ä½¿ç”¨ä¼šè¯å¯†é’¥åŠ å¯†åŽçš„ Close Notify æŠ¥æ–‡ã€‚Â &#8617;","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <title>ç®€æžHTTPS | å°é»‘çŒ«
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="å°é»‘çŒ«">
<meta name="application-name" content="å°é»‘çŒ«">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous">
  <link rel="dns-prefetch" href="https://fonts.gstatic.com">

  <!-- GA -->
  

  <!-- jsDelivr CDN -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css">

  <!--
  CSS selector for site.
-->

<link rel="stylesheet" href="/assets/css/style.css">


  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css">



  <!-- Manific Popup -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css">



  <!-- JavaScript -->

  <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>

</head>


  
    <!--
  Switch the mode between dark and light.
-->

<script type="text/javascript">
  class ModeToggle {
    static get MODE_KEY() { return "mode"; }
    static get MODE_ATTR() { return "data-mode"; }
    static get DARK_MODE() { return "dark"; }
    static get LIGHT_MODE() { return "light"; }
    static get ID() { return "mode-toggle"; }

    constructor() {
      if (this.hasMode) {
        if (this.isDarkMode) {
          if (!this.isSysDarkPrefer) {
            this.setDark();
          }
        } else {
          if (this.isSysDarkPrefer) {
            this.setLight();
          }
        }
      }

      let self = this;

      /* always follow the system prefers */
      this.sysDarkPrefers.addEventListener("change", () => {
        if (self.hasMode) {
          if (self.isDarkMode) {
            if (!self.isSysDarkPrefer) {
              self.setDark();
            }

          } else {
            if (self.isSysDarkPrefer) {
              self.setLight();
            }
          }

          self.clearMode();
        }

        self.notify();

      });

    } /* constructor() */

    get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); }

    get isSysDarkPrefer() { return this.sysDarkPrefers.matches; }

    get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; }

    get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; }

    get hasMode() { return this.mode != null; }

    get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); }

    /* get the current mode on screen */
    get modeStatus() {
      if (this.isDarkMode
        || (!this.hasMode && this.isSysDarkPrefer)) {
        return ModeToggle.DARK_MODE;
      } else {
        return ModeToggle.LIGHT_MODE;
      }
    }

    setDark() {
      $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE);
    }

    setLight() {
      $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE);
    }

    clearMode() {
      $('html').removeAttr(ModeToggle.MODE_ATTR);
      sessionStorage.removeItem(ModeToggle.MODE_KEY);
    }

    /* Notify another plugins that the theme mode has changed */
    notify() {
      window.postMessage({
        direction: ModeToggle.ID,
        message: this.modeStatus
      }, "*");
    }

  } /* ModeToggle */

  const toggle = new ModeToggle();

  function flipMode() {
    if (toggle.hasMode) {
      if (toggle.isSysDarkPrefer) {
        if (toggle.isLightMode) {
          toggle.clearMode();
        } else {
          toggle.setLight();
        }

      } else {
        if (toggle.isDarkMode) {
          toggle.clearMode();
        } else {
          toggle.setDark();
        }
      }

    } else {
      if (toggle.isSysDarkPrefer) {
        toggle.setLight();
      } else {
        toggle.setDark();
      }
    }

    toggle.notify();

  } /* flipMode() */

</script>

  

  <body data-spy="scroll" data-target="#toc" data-topbar-visible="true">

    <!--
  The Side Bar
-->

<div id="sidebar" class="d-flex flex-column align-items-end" lang="zh-CN">
  <div class="profile-wrapper text-center">
    <div id="avatar">
      <a href="/" alt="avatar" class="mx-auto">
        
          
          <img src="https://img-host-lcatmiao.oss-cn-hangzhou.aliyuncs.com/202202021358647.png" alt="avatar" onerror="this.style.display='none'">
        
      </a>
    </div>

    <div class="site-title mt-3">
      <a href="/">å°é»‘çŒ«</a>
    </div>
    <div class="site-subtitle font-italic">å–µï½ž</div>

  </div><!-- .profile-wrapper -->

  <ul class="w-100">

    <!-- home -->
    <li class="nav-item">
      <a href="/" class="nav-link">
        <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
        <span>é¦–é¡µ</span>
      </a>
    </li>
    <!-- the real tabs -->
    
    <li class="nav-item">
      <a href="/categories/" class="nav-link">
        <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>åˆ†ç±»</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/tags/" class="nav-link">
        <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>æ ‡ç­¾</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/archives/" class="nav-link">
        <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>å½’æ¡£</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/about/" class="nav-link">
        <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>å…³äºŽ</span>
      </a>
    </li> <!-- .nav-item -->
    

  </ul> <!-- ul.nav.flex-column -->

  <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center">

    
      <button class="mode-toggle btn" aria-label="Switch Mode">
        <i class="fas fa-adjust"></i>
      </button>

      
        <span class="icon-border"></span>
      
    

    
      

      
      <a href="https://github.com/lcatmiao" aria-label="github"
        target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
      

    
      

      
      <a href="https://twitter.com/twitter_username" aria-label="twitter"
        target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
      

    
      

      
      <a href="
          javascript:location.href = 'mailto:' + ['example','doamin.com'].join('@')" aria-label="email"
        >
        <i class="fas fa-envelope"></i>
      </a>
      

    
      

      
      <a href="/feed.xml" aria-label="rss"
        >
        <i class="fas fa-rss"></i>
      </a>
      

    

  </div> <!-- .sidebar-bottom -->

</div><!-- #sidebar -->


    <!--
  The Top Bar
-->

<div id="topbar-wrapper" class="row justify-content-center">
  <div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between">
    <span id="breadcrumb">

    

    

      

        
          <span>
            <a href="/">
              é¦–é¡µ
            </a>
          </span>

        

      

        

      

        

          
            <span>ç®€æžHTTPS</span>
          

        

      

    

    </span><!-- endof #breadcrumb -->

    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>

    <div id="topbar-title">
      æ–‡ç« 
    </div>

    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search"
        aria-label="search" autocomplete="off" placeholder="æœç´¢...">
      <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i>
    </span>
    <span id="search-cancel" >å–æ¶ˆ</span>
  </div>

</div>


    <div id="main-wrapper">
      <div id="main">

        



<div class="row">

  <!-- core -->
  <div id="core-wrapper" class="col-12 col-lg-11 col-xl-8">
    <div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">

    

    
      
      
        <!--
  Refactor the HTML structure.
-->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Add attribute 'hide-bullet' to the checkbox list -->



<!-- images -->




  
  

  
    
      
      
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  

  



<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    

    

  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    

    

  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    
      

      
      

      
      
      
      

      

    

    

  

  
  

  




<!-- Wrap prompt element of blockquote with the <div> tag -->







<!-- return -->







<h1 data-toc-skip>ç®€æžHTTPS</h1>

<div class="post-meta text-muted">

  <!-- author -->
  <div>
    
    

    

    ä½œè€…
    <em>
      
        <a href="https://github.com/lcatmiao">å°é»‘çŒ«</a>
      
    </em>
  </div>

  <div class="d-flex">
    <div>
      <!-- published date -->
      <span>
        å‘è¡¨äºŽ
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/timeago.js
-->

<em class="timeago"
    data-ts="1744714200"
    
      data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll"
    
    >
  2025-04-15
</em>

      </span>

      <!-- lastmod date -->
      

      <!-- read time -->
      <!--
  Calculate the post's reading time, and display the word count in tooltip
 -->



<!-- words per minute  -->










<!-- return element -->
<span class="readtime" data-toggle="tooltip" data-placement="bottom"
  title="8968 å­—">
  <em>49 åˆ†é’Ÿ</em>é˜…è¯»</span>


      <!-- page views -->
      
    </div>

  </div> <!-- .d-flex -->

</div> <!-- .post-meta -->

<div class="post-content">
  <h1 id="å†™åœ¨å‰é¢">å†™åœ¨å‰é¢</h1>

<p>é˜…è¯»ã€Šå›¾è§£HTTPã€‹ï¼Œå¤§è‡´ç†è§£äº† SSL/TLS çš„æ¡æ‰‹è¿‡ç¨‹å’Œæ€æƒ³åŽŸç†ã€‚ç„¶è€Œä½œä¸ºå…¥é—¨ä¹¦ï¼Œå®ƒæ²¡æœ‰ä»‹ç»åŸºäºŽ DH ç®—æ³•çš„ TLS æ¡æ‰‹è¿‡ç¨‹ï¼Œä¹Ÿæ²¡æœ‰ä»‹ç»è¯ä¹¦é“¾ç›¸å…³çš„çŸ¥è¯†ðŸ˜¡ã€‚æˆ‘ Google äº†ä¸å°‘èµ„æ–™ï¼Œç€é‡å•ƒäº†å‡ ç¯‡æ–‡ç« ï¼Œç»“åˆæŠ“åŒ…åˆ†æžï¼Œæœ¬æƒ³â€œå·®ä¸å¤šå¾—äº†â€ï¼Œå´æ²¡æ–™åˆ°å…¥äº†å¤§å‘ï¼Œç–‘é—®ä¸å‡åå¢žã€‚</p>

<p>ä¸€ç­¹èŽ«å±•ä¹‹é™…ï¼ŒAI æŠ€æœ¯å¤§ç«ï¼Œæ•‘æˆ‘ç‹—å‘½ã€‚å—æ­¤é¼“èˆžï¼Œå€ŸåŠ© AI è§£æƒ‘ï¼Œåˆæ‰“èµ·ç²¾ç¥žå•ƒè¯»äº†å¤šä¸ª RFC ç‰‡æ®µï¼Œé‚æ‹¨äº‘è§æ—¥ã€‚æœ¬æ–‡æ—¢æˆï¼Œè™½å¾—ç›ŠäºŽå¤©æ—¶ï¼Œç„¶äº¦å¯è°“ä¸€æ³¢ä¸‰æŠ˜ï¼ŒåŽ†å°½è‰°è¾›ã€‚æˆ‘çœŸç‰›é€¼ðŸ‘ã€‚</p>

<p>æœ¬æ–‡ä¸»è¦åŸºäºŽ TLS1.2 ç ”å†™ï¼ŒçŸ¥è¯†æ•´ç†äºŽæ­¤ðŸ‘‡ã€‚</p>

<h1 id="å…ˆè¡Œæ¦‚å¿µ">å…ˆè¡Œæ¦‚å¿µ</h1>

<p><strong>&gt; å¯†ç ä½“åˆ¶</strong></p>

<p>å¯†ç å­¦ä¸»è¦æœ‰ä¸¤ç§ä½“åˆ¶ï¼š</p>

<ul>
  <li>å…±äº«å¯†ç ä½“åˆ¶ï¼ˆå¯¹ç§°å¯†ç ä½“åˆ¶ï¼‰</li>
  <li>å…¬é’¥å¯†ç ä½“åˆ¶ï¼ˆéžå¯¹ç§°å¯†ç ä½“åˆ¶ï¼‰</li>
</ul>

<p><span id="math-hard-problem"><strong>&gt; æ•°å­¦éš¾é¢˜</strong></span></p>

<p>å…¬é’¥å¯†ç ä½“åˆ¶ä¸»è¦åŸºäºŽä»¥ä¸‹æ•°å­¦éš¾é¢˜ï¼š</p>

<ul>
  <li>å¤§æ•´æ•°åˆ†è§£é—®é¢˜</li>
  <li>ç¦»æ•£å¯¹æ•°é—®é¢˜ï¼ˆDLPï¼‰
    <ul>
      <li>ä¸€èˆ¬çš„ç¦»æ•£å¯¹æ•°é—®é¢˜</li>
      <li>æ¤­åœ†æ›²çº¿ç¦»æ•£å¯¹æ•°é—®é¢˜ï¼ˆECDLPï¼‰</li>
    </ul>
  </li>
</ul>

<p>ä¸€èˆ¬çš„è¯´æ³•ä¸­ï¼Œé€šå¸¸å°†æ¤­åœ†æ›²çº¿ç¦»æ•£å¯¹æ•°é—®é¢˜å•ç‹¬ä½œä¸ºä¸€ç±»ï¼Œä¸Žç¦»æ•£å¯¹æ•°é—®é¢˜ã€å¤§æ•´æ•°åˆ†è§£é—®é¢˜ä¸€èµ·ï¼Œå¹¶ç§°å¯†ç å­¦<strong>ä¸‰å¤§æ•°å­¦éš¾é¢˜</strong>ã€‚æ¤­åœ†æ›²çº¿ç¦»æ•£å¯¹æ•°é—®é¢˜æ¯”ä¸€èˆ¬çš„ç¦»æ•£å¯¹æ•°é—®é¢˜æ›´åŠ å›°éš¾ï¼Œè‡ªç„¶å°±è¯žç”Ÿäº†åŸºäºŽæ¤­åœ†æ›²çº¿çš„å¯†ç å­¦ï¼Œè¢«ç§°ä½œ<strong>æ¤­åœ†æ›²çº¿å¯†ç å­¦ï¼ˆECCï¼‰</strong>ã€‚ä¸€äº›åŽŸæœ¬åŸºäºŽä¸€èˆ¬ç¦»æ•£å¯¹æ•°é—®é¢˜çš„ç®—æ³•è¢«ç§»æ¤åˆ°æ¤­åœ†æ›²çº¿ä¸Šï¼Œå°±æœ‰äº† ECC çš„ç®—æ³•ç‰ˆæœ¬ï¼Œæ¯”å¦‚ DH ç®—æ³•çš„æ¤­åœ†æ›²çº¿ç‰ˆæœ¬ï¼Œå°±å« ECDH ç®—æ³•ã€‚</p>

<p>ä¸€äº›å…¬é’¥ç®—æ³•ä¸Žæ•°å­¦éš¾é¢˜çš„å¯¹åº”å…³ç³»ï¼š</p>

<ul>
  <li>RSA - å¤§æ•´æ•°åˆ†è§£é—®é¢˜</li>
  <li>DHã€DSA - ä¸€èˆ¬çš„ç¦»æ•£å¯¹æ•°é—®é¢˜</li>
  <li>ECDHã€ECDHEã€ECDSA - æ¤­åœ†æ›²çº¿ç¦»æ•£å¯¹æ•°é—®é¢˜</li>
</ul>

<h1 id="tls-æ¡æ‰‹è¿‡ç¨‹">TLS æ¡æ‰‹è¿‡ç¨‹</h1>

<p>TLS åœ¨æ¡æ‰‹ä¸­ä¸»è¦åšäº†ä¸‰ä»¶äº‹â€”â€”èº«ä»½è®¤è¯ã€å¯†é’¥äº¤æ¢å’Œå®Œæ•´æ€§æ ¡éªŒã€‚æ¡æ‰‹ä¸»è¦æ˜¯ä¸ºäº†ç”Ÿæˆå¹¶äº¤æ¢å…±äº«å¯†é’¥ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯ä½¿ç”¨å…¬é’¥ç®—æ³•è¿›è¡Œçš„ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½æ‹¥æœ‰å…±äº«å¯†é’¥åŽï¼ŒåŽç»­çš„é€šä¿¡å†ä½¿ç”¨å…±äº«å¯†é’¥ç®—æ³•è¿›è¡ŒåŠ å¯†ã€‚è¿™æ˜¯å®‰å…¨å’Œæ€§èƒ½ç»¼åˆè€ƒé‡çš„ç»“æžœã€‚å…¬é’¥ç®—æ³•å®‰å…¨ä½†æ€§èƒ½æ¶ˆè€—å¤šï¼Œå…±äº«å¯†é’¥ç®—æ³•ç›¸å¯¹ä¸é‚£ä¹ˆå®‰å…¨ä½†æ€§èƒ½æ¶ˆè€—å°‘ï¼Œæ‰€ä»¥çœŸæ­£çš„åŠ å¯†é€šä¿¡ä½¿ç”¨å…±äº«å¯†é’¥åŠ å¯†ï¼Œè€Œä¸”å…±äº«å¯†é’¥çš„äº¤æ¢åˆ™ç”±å…¬é’¥ç®—æ³•å®žçŽ°ã€‚</p>

<p>ä»¥ä¸‹åŸºäºŽ <strong>TLS1.2</strong> é˜è¿°å…¶æ¡æ‰‹è¿‡ç¨‹ã€‚</p>

<h2 id="åŸºäºŽ-rsa-ç®—æ³•">åŸºäºŽ RSA ç®—æ³• <a href="#åŸºäºŽ-rsa-ç®—æ³•" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2>

<p><img data-src="https://img-host-lcatmiao.oss-cn-hangzhou.aliyuncs.com/202410060915157.png" alt="" data-proofer-ignore></p>

<h3 id="æ­¥éª¤-1---å‘èµ·è¿žæŽ¥åå•†å‚æ•°">æ­¥éª¤ 1 - å‘èµ·è¿žæŽ¥ï¼Œåå•†å‚æ•° <a href="#æ­¥éª¤-1---å‘èµ·è¿žæŽ¥åå•†å‚æ•°" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3>

<p><u>å®¢æˆ·ç«¯å‘é€ `Client Hello`ã€‚</u></p>

<p>å®¢æˆ·ç«¯ç”Ÿæˆéšæœºæ•° <code class="language-plaintext highlighter-rouge">Client Random</code>ï¼Œå¹¶å‘é€ <code class="language-plaintext highlighter-rouge">Client Hello</code> æŠ¥æ–‡ã€‚è¯¥æŠ¥æ–‡ä¸­åŒ…å« <code class="language-plaintext highlighter-rouge">Client Random</code> éšæœºæ•°ä»¥åŠå®¢æˆ·ç«¯æ”¯æŒçš„ç®—æ³•å¥—ä»¶ç­‰ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯è¢«ä¼ é€’ç»™æœåŠ¡å™¨ç”¨äºŽåå•†ã€‚</p>

<p><img data-src="https://img-host-lcatmiao.oss-cn-hangzhou.aliyuncs.com/202410060957648.png" alt="" data-proofer-ignore></p>

<h3 id="æ­¥éª¤-2---åå•†å‚æ•°å‘é€è¯ä¹¦">æ­¥éª¤ 2 - åå•†å‚æ•°ï¼Œå‘é€è¯ä¹¦ <a href="#æ­¥éª¤-2---åå•†å‚æ•°å‘é€è¯ä¹¦" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3>

<p><u>æœåŠ¡å™¨å‘é€ `Server Hello, Certificate, Server Hello Done`ã€‚</u></p>

<ol>
  <li>
    <p>æœåŠ¡å™¨ä»Ž <code class="language-plaintext highlighter-rouge">Client Hello</code> ä¸­èŽ·å¾—éšæœºæ•° <code class="language-plaintext highlighter-rouge">Client Random</code>ã€‚</p>
  </li>
  <li>
    <p>æœåŠ¡å™¨ç”Ÿæˆ <code class="language-plaintext highlighter-rouge">Server Random</code>ï¼Œå°†è¯¥éšæœºæ•°åŒ…å«è¿› <code class="language-plaintext highlighter-rouge">Server Hello</code> ä¸­ã€‚æœåŠ¡å™¨ä¾æ®è‡ªèº«æƒ…å†µï¼Œä»Žå®¢æˆ·ç«¯ç®—æ³•å¥—ä»¶ä¸­æŒ‘é€‰ä¸€ä¸ªè‡ªèº«æ”¯æŒçš„ç®—æ³•ï¼Œå°†å…¶åŒ…å«è¿› <code class="language-plaintext highlighter-rouge">Server Hello</code> ä¸­ã€‚</p>
  </li>
  <li>
    <p>æœåŠ¡å™¨å‘é€è‡ªå·±çš„è¯ä¹¦ã€‚è¯ä¹¦ä¸­ä¸»è¦åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š</p>

    <ul>
      <li>
        <p>æœåŠ¡å™¨çš„å…¬é’¥</p>
      </li>
      <li>
        <p>æœåŠ¡å™¨çš„åŸŸå</p>
      </li>
      <li>
        <p>å…¶å®ƒé™„åŠ ä¿¡æ¯</p>
      </li>
      <li>
        <p>CA çš„ç­¾åï¼šä½¿ç”¨ CA çš„ç§é’¥å¯¹ä¸Šè¿°è¯ä¹¦ä¿¡æ¯çš„å“ˆå¸Œå€¼åŠ å¯†æ‰€å¾—çš„ç»“æžœã€‚</p>

        <div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>signature = ca-private-key((hash(cert-info)))
</pre></td></tr></tbody></table></code></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>æœåŠ¡å™¨å‘é€ <code class="language-plaintext highlighter-rouge">Server Hello Done</code>ã€‚</p>
  </li>
</ol>

<p>å¦‚ä¸‹å›¾ï¼ŒæœåŠ¡å™¨å‘é€æŠ¥æ–‡ã€‚</p>

<p><img data-src="https://img-host-lcatmiao.oss-cn-hangzhou.aliyuncs.com/202411161612539.png" alt="" data-proofer-ignore></p>

<p>å¦‚ä¸‹å›¾ï¼ŒæœåŠ¡å™¨é€‰æ‹©äº†ç®—æ³• <code class="language-plaintext highlighter-rouge">TLS_RSA_WITH_AES_256_CBC_SHA</code>ã€‚</p>

<p><img data-src="https://img-host-lcatmiao.oss-cn-hangzhou.aliyuncs.com/202411161609436.png" alt="" data-proofer-ignore></p>

<p>å¦‚ä¸‹å›¾ï¼ŒæœåŠ¡å™¨å‘é€äº†è‡ªå·±çš„è¯ä¹¦ï¼Œè¯¥è¯ä¹¦è¢« CA ç­¾åï¼Œç­¾åä½¿ç”¨çš„ç­¾åç®—æ³•æ˜¯ <code class="language-plaintext highlighter-rouge">RSA</code>ï¼Œå“ˆå¸Œç®—æ³•æ˜¯ <code class="language-plaintext highlighter-rouge">SHA256</code>ã€‚</p>

<p><img data-src="https://img-host-lcatmiao.oss-cn-hangzhou.aliyuncs.com/202410061035064.png" alt="" data-proofer-ignore></p>

<h3 id="æ­¥éª¤-3---èº«ä»½è®¤è¯å¯†é’¥äº¤æ¢ç”Ÿæˆä¼šè¯å¯†é’¥">æ­¥éª¤ 3 - èº«ä»½è®¤è¯ï¼Œå¯†é’¥äº¤æ¢ï¼Œç”Ÿæˆä¼šè¯å¯†é’¥ <a href="#æ­¥éª¤-3---èº«ä»½è®¤è¯å¯†é’¥äº¤æ¢ç”Ÿæˆä¼šè¯å¯†é’¥" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3>

<p><u>å®¢æˆ·ç«¯å‘é€ `Client Key Exchange, Change Cipher Spec, Encrypted Handshake Message`ã€‚</u></p>

<ol>
  <li>å®¢æˆ·ç«¯ä»Ž <code class="language-plaintext highlighter-rouge">Server Hello</code> ä¸­èŽ·å¾—éšæœºæ•° <code class="language-plaintext highlighter-rouge">Server Random</code>ã€‚</li>
  <li>å®¢æˆ·ç«¯ä½¿ç”¨ CA çš„è¯ä¹¦ï¼ˆä¸€èˆ¬å·²é¢„ç½®åœ¨æµè§ˆå™¨ä¸­ï¼‰éªŒè¯æœåŠ¡å™¨çš„è¯ä¹¦ã€‚ä½¿ç”¨ CA è¯ä¹¦ä¸­åŒ…å«çš„å…¬é’¥è§£å¯†æœåŠ¡å™¨è¯ä¹¦ä¸­çš„ç­¾åï¼Œå¾—åˆ°å“ˆå¸Œå€¼ï¼Œå†è®¡ç®—æœåŠ¡å™¨è¯ä¹¦ä¿¡æ¯çš„å“ˆå¸Œå€¼ï¼ŒäºŒè€…å¯¹æ¯”ï¼Œè‹¥ä¸€è‡´åˆ™éªŒè¯é€šè¿‡ã€‚éªŒè¯é€šè¿‡ï¼Œè¯æ˜Žäº†æœåŠ¡å™¨è¯ä¹¦æ˜¯ç”±æµè§ˆå™¨å†…ç½®çš„ CA è¯ä¹¦æ‰€ä»£è¡¨çš„ CA é¢å‘çš„ï¼Œå³è¯æ˜Žäº†å†…ç½® CA ä¿¡ä»»æœåŠ¡å™¨ï¼›è€Œå†…ç½®çš„ CA æ˜¯å¹¿å—ç¤¾ä¼šä¿¡ä»»çš„ CAï¼Œå·²ç»æ˜¯ä¿¡ä»»é”šç‚¹ã€‚å°±è¿™æ ·ï¼Œæµè§ˆå™¨ä¿¡ä»» CAï¼ŒCA ä¿¡ä»»æœåŠ¡å™¨ï¼Œæ‰€ä»¥æµè§ˆå™¨ä¿¡ä»»æœåŠ¡å™¨ã€‚è¿™ä¸€ä¿¡ä»»é“¾è¯æ˜Žäº†æœåŠ¡å™¨çš„èº«ä»½å€¼å¾—ä¿¡èµ–ï¼Œä¸”è¯ä¹¦ä¸­çš„å…¬é’¥çš„ç¡®å±žäºŽæœåŠ¡å™¨ï¼Œæ­¤å³<strong>èº«ä»½è®¤è¯</strong>ã€‚</li>
  <li>å®¢æˆ·ç«¯ç”Ÿæˆ <code class="language-plaintext highlighter-rouge">PreMaster Secret</code>ï¼Œå¹¶ä½¿ç”¨æœåŠ¡å™¨çš„å…¬é’¥åŠ å¯†ï¼Œä½¿ç”¨ <code class="language-plaintext highlighter-rouge">Client Key Exchange</code> å‘é€ç»™æœåŠ¡å™¨ï¼Œæ­¤å³<strong>å¯†é’¥äº¤æ¢</strong>ã€‚</li>
  <li>å®¢æˆ·ç«¯ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">Client Random, Server Random, PreMaster Secret</code> ç”Ÿæˆä¼šè¯å¯†é’¥ <code class="language-plaintext highlighter-rouge">Session Key</code>ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">Change Cipher Spec</code> å‘æœåŠ¡å™¨è¡¨æ˜Žï¼šå®¢æˆ·ç«¯å·²ç»æ‹¥æœ‰ä¼šè¯å¯†é’¥ï¼ŒæŽ¥ä¸‹æ¥å‘é€çš„æ‰€æœ‰æ•°æ®éƒ½ä¼šä½¿ç”¨ä¼šè¯å¯†é’¥åŠ å¯†ã€‚</li>
  <li>å®¢æˆ·ç«¯è®¡ç®—å‡ºä¸€ä¸ª<a href="#verification-data">æ ¡éªŒæ•°æ®</a>ï¼Œä½¿ç”¨ä¼šè¯å¯†é’¥åŠ å¯†åŽï¼Œä½œä¸º <code class="language-plaintext highlighter-rouge">Encrypted Handshake Message</code><sup id="fnref:client-finished" role="doc-noteref"><a href="#fn:client-finished" class="footnote" rel="footnote">1</a></sup> å‘é€ç»™æœåŠ¡å™¨ã€‚</li>
</ol>

<p>å¦‚ä¸‹å›¾ï¼Œå®¢æˆ·ç«¯å‘é€æŠ¥æ–‡ã€‚</p>

<p><img data-src="https://img-host-lcatmiao.oss-cn-hangzhou.aliyuncs.com/202411161621387.png" alt="" data-proofer-ignore></p>

<p>å¦‚ä¸‹å›¾ï¼Œåœ¨ <code class="language-plaintext highlighter-rouge">Client Key Exchange</code> éƒ¨åˆ†å¯ä»¥çœ‹åˆ°ä½¿ç”¨æœåŠ¡å™¨çš„ RSA å…¬é’¥åŠ å¯†å‘é€çš„ <code class="language-plaintext highlighter-rouge">PreMaster Secret</code>ã€‚</p>

<p><img data-src="https://img-host-lcatmiao.oss-cn-hangzhou.aliyuncs.com/202411161649483.png" alt="" data-proofer-ignore></p>

<h3 id="æ­¥éª¤-4---å¯†é’¥äº¤æ¢ç”Ÿæˆä¼šè¯å¯†é’¥">æ­¥éª¤ 4 - å¯†é’¥äº¤æ¢ï¼Œç”Ÿæˆä¼šè¯å¯†é’¥ <a href="#æ­¥éª¤-4---å¯†é’¥äº¤æ¢ç”Ÿæˆä¼šè¯å¯†é’¥" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3>

<p><u>æœåŠ¡å™¨å‘é€ `Change Cipher Spec, Encrypted Handshake Message`ã€‚</u></p>

<ol>
  <li>æœåŠ¡å™¨ä½¿ç”¨è‡ªå·±çš„ç§é’¥è§£å¯†å¾—åˆ° <code class="language-plaintext highlighter-rouge">PreMaster Secret</code>ï¼Œæ­¤å³<strong>å¯†é’¥äº¤æ¢</strong>ã€‚</li>
  <li>æœåŠ¡å™¨ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">Client Random, Server Random, PreMaster Secret</code> ç”Ÿæˆä¼šè¯å¯†é’¥ <code class="language-plaintext highlighter-rouge">Session Key</code>ã€‚</li>
  <li>æœåŠ¡å™¨ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">Session Key</code> è§£å¯†å®¢æˆ·ç«¯å‘æ¥çš„æ ¡éªŒæ•°æ®ï¼Œå¹¶è®¡ç®—æŠ¥æ–‡å“ˆå¸Œå€¼ä¸Žæ ¡éªŒæ•°æ®è¿›è¡Œå¯¹æ¯”ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">Change Cipher Spec</code> å‘å®¢æˆ·ç«¯è¡¨æ˜Žï¼šæœåŠ¡å™¨å·²ç»æ‹¥æœ‰ä¼šè¯å¯†é’¥ï¼ŒæŽ¥ä¸‹æ¥å‘é€çš„æ‰€æœ‰æ•°æ®éƒ½ä¼šä½¿ç”¨ä¼šè¯å¯†é’¥åŠ å¯†ã€‚</li>
  <li>æœåŠ¡å™¨è®¡ç®—å‡ºä¸€ä¸ª<a href="#verification-data">æ ¡éªŒæ•°æ®</a>ï¼Œä½¿ç”¨ä¼šè¯å¯†é’¥åŠ å¯†åŽï¼Œä½œä¸º <code class="language-plaintext highlighter-rouge">Encrypted Handshake Message</code><sup id="fnref:server-finished" role="doc-noteref"><a href="#fn:server-finished" class="footnote" rel="footnote">2</a></sup> å‘é€ç»™å®¢æˆ·ç«¯ã€‚</li>
</ol>

<p>å¦‚ä¸‹å›¾ï¼ŒæœåŠ¡å™¨å‘é€æŠ¥æ–‡ã€‚</p>

<p><img data-src="https://img-host-lcatmiao.oss-cn-hangzhou.aliyuncs.com/202411161651841.png" alt="" data-proofer-ignore></p>

<p>å¦‚ä¸‹å›¾ï¼ŒæŠ¥æ–‡ä¿¡æ¯é•¿è¿™æ ·ã€‚</p>

<p><img data-src="https://img-host-lcatmiao.oss-cn-hangzhou.aliyuncs.com/202411161654625.png" alt="" data-proofer-ignore></p>

<h3 id="æ­¥éª¤-5---å®Œæˆæ¡æ‰‹åŠ å¯†é€šä¿¡">æ­¥éª¤ 5 - å®Œæˆæ¡æ‰‹ï¼ŒåŠ å¯†é€šä¿¡ <a href="#æ­¥éª¤-5---å®Œæˆæ¡æ‰‹åŠ å¯†é€šä¿¡" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3>

<p><u>åŒæ–¹å‘é€ `Application Data`ã€‚</u></p>

<ol>
  <li>å®¢æˆ·ç«¯ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">Session Key</code> è§£å¯†æœåŠ¡å™¨å‘æ¥çš„æ ¡éªŒæ•°æ®ï¼Œå¹¶è®¡ç®—æŠ¥æ–‡å“ˆå¸Œå€¼ä¸Žæ ¡éªŒæ•°æ®è¿›è¡Œå¯¹æ¯”ã€‚</li>
  <li><strong>TLS è¿žæŽ¥å»ºç«‹å®Œæˆ</strong>ã€‚æŽ¥ä¸‹æ¥åŒæ–¹ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">Session Key</code> åŠ å¯†æ•°æ®ï¼Œè¿›è¡Œ HTTPS é€šä¿¡ã€‚</li>
</ol>

<p>å¦‚ä¸‹å›¾ï¼Œå‘é€åŠ å¯†çš„ HTTP æŠ¥æ–‡ã€‚</p>

<p><img data-src="https://img-host-lcatmiao.oss-cn-hangzhou.aliyuncs.com/202411161659966.png" alt="" data-proofer-ignore></p>

<p><img data-src="https://img-host-lcatmiao.oss-cn-hangzhou.aliyuncs.com/202411161701394.png" alt="" data-proofer-ignore></p>

<h3 id="æ­¥éª¤-6---æ–­å¼€è¿žæŽ¥">æ­¥éª¤ 6 - æ–­å¼€è¿žæŽ¥ <a href="#æ­¥éª¤-6---æ–­å¼€è¿žæŽ¥" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3>

<p><u>å®¢æˆ·ç«¯å‘é€ `Encrypted Alert`ã€‚</u></p>

<p>å®¢æˆ·ç«¯ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">Session Key</code> åŠ å¯†ä¸€ä¸ªå‘Šè­¦ä¿¡æ¯ï¼Œå‘é€ <code class="language-plaintext highlighter-rouge">Encrypted Alert</code><sup id="fnref:close-notify" role="doc-noteref"><a href="#fn:close-notify" class="footnote" rel="footnote">3</a></sup> ä»¥æ–­å¼€ TLS è¿žæŽ¥ã€‚åŽç»­å†å…³é—­ TCP çš„è¿žæŽ¥ã€‚</p>

<h2 id="åŸºäºŽ-ecdhe-ç®—æ³•">åŸºäºŽ ECDHE ç®—æ³• <a href="#åŸºäºŽ-ecdhe-ç®—æ³•" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2>

<p>åœ¨ RSA æ¡æ‰‹ä¸­ï¼Œ<code class="language-plaintext highlighter-rouge">PreMaster Secret</code> ç”±å®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡å™¨ï¼Œä»Žè€Œå®Œæˆå¯†é’¥äº¤æ¢ï¼›è€Œåœ¨ DH ç®—æ³•ä¸­ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åŸºäºŽæ•°å­¦åŽŸç†ï¼Œæ ¹æ®ä¸€äº›å…¬å¼€çš„ä¿¡æ¯ç›´æŽ¥åœ¨å„è‡ªçš„æœ¬åœ°è®¡ç®—å‡º <code class="language-plaintext highlighter-rouge">PreMaster Secret</code>ï¼Œè¿žç½‘ç»œä¼ è¾“éƒ½ç»™å¹²æŽ‰äº†ï¼Œæ‰€ä»¥ DH ç®—æ³•æ›´åŠ å®‰å…¨ã€‚</p>

<h3 id="dh-ç®—æ³•ç®€ä»‹">DH ç®—æ³•ç®€ä»‹ <a href="#dh-ç®—æ³•ç®€ä»‹" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3>

<h4 id="åŽŸç†">åŽŸç† <a href="#åŽŸç†" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>

<p>DH ç®—æ³•æ˜¯ä¸€ç§å¯†é’¥äº¤æ¢ç®—æ³•ï¼Œæˆ‘ä»¬ä¸ç®¡æ•°å­¦ç»†èŠ‚ï¼Œæžç®€é˜è¿°åŽŸç†ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre># å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å„æŒæœ‰ä¸€å¯¹ DH å…¬ç§é’¥ï¼Œä½¿ç”¨å®ƒä»¬å„è‡ªçš„ç§é’¥å’Œå¯¹ç«¯çš„å…¬é’¥å¯ä»¥ç”Ÿæˆä¸€ä¸ªä¼šè¯å¯†é’¥ï¼Œ
# è€Œä¸¤ç«¯å„è‡ªç”Ÿæˆçš„ä¼šè¯å¯†é’¥åœ¨æ•°å­¦ä¸Šè¢«è¯æ˜Žæ˜¯ç›¸ç­‰çš„ã€‚æ¢è¨€ä¹‹ï¼Œåªè¦ä¸¤ç«¯äº’ç›¸äº¤æ¢å…¬é’¥å°±å¯ä»¥å®žçŽ°
# æ— éœ€ç½‘ç»œä¼ è¾“çš„ä¼šè¯å¯†é’¥äº¤æ¢ã€‚
client-session-key = dh(client-private-key, server-public-key)
server-session-key = dh(server-private-key, client-public-key)
session-key = client-session-key = server-session-key
</pre></td></tr></tbody></table></code></div></div>

<h4 id="åˆ†ç±»">åˆ†ç±» <a href="#åˆ†ç±»" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>

<p>DH ç®—æ³•åŸºäºŽç¦»æ•£å¯¹æ•°é—®é¢˜è€Œè¯žç”Ÿï¼Œæ ¹æ®ç¦»æ•£å¯¹æ•°çš„è®¡ç®—æ–¹å¼ï¼ˆè§<a href="#math-hard-problem">æ•°å­¦éš¾é¢˜</a>ï¼‰å¯ä»¥åˆ†ä¸ºï¼š</p>

<ul>
  <li>ä¸€èˆ¬çš„ DH ç®—æ³•</li>
  <li>ECDH ç®—æ³•</li>
</ul>

<p>æ ¹æ® DH çš„ç§é’¥æ˜¯å¦å›ºå®šï¼Œå¯ä»¥åˆ†ä¸ºï¼š</p>

<ul>
  <li>Static DH</li>
  <li>Ephemeral DH(DHE)</li>
</ul>

<p>åœ¨ Static DH ç®—æ³•ä¸­ï¼ŒæœåŠ¡å™¨æ¯æ¬¡è¿žæŽ¥æ‰€ä½¿ç”¨çš„ DH ç§é’¥æ˜¯ä¸å˜çš„ï¼Œåº”è¯¥æ˜¯ç›´æŽ¥ä½¿ç”¨çš„ä¸Žå…¬é’¥è¯ä¹¦æˆå¯¹çš„é‚£ä¸ªç§é’¥ï¼Œé•¿æœŸä½¿ç”¨å®¹æ˜“æ³„éœ²ï¼Œä¸€æ—¦æ³„éœ²ï¼Œé»‘å®¢å°±èƒ½è§£å¯†å½“å‰å’Œä»¥å¾€æ¯æ¬¡è¿žæŽ¥çš„é€šä¿¡ï¼Œè¿™æ ·çš„ç®—æ³•ä¸å…·å¤‡å‰å‘å®‰å…¨æ€§ï¼›è€Œåœ¨ Ephemeral DH ç®—æ³•ä¸­ï¼ŒæœåŠ¡å™¨ä¼šä¸ºæ¯æ¬¡è¿žæŽ¥é‡æ–°ç”Ÿæˆä¸€ä¸ªä¸´æ—¶çš„ DH ç§é’¥ï¼Œè¿™æ ·å°±ç®—ç§é’¥æ³„éœ²ï¼Œä¹Ÿåªèƒ½è§£å¯†è¿™ä¸€æ¬¡è¿žæŽ¥çš„é€šä¿¡ï¼Œæ— æ³•è§£å¯†ä»¥å¾€çš„é€šä¿¡ï¼Œæ‰€ä»¥ç®—æ³•å…·å¤‡<strong>å‰å‘å®‰å…¨æ€§</strong>ã€‚</p>

<h3 id="ecdhe-æ¡æ‰‹æµç¨‹"><span id="ecdhe-handshake-process">ECDHE æ¡æ‰‹æµç¨‹</span> <a href="#ecdhe-æ¡æ‰‹æµç¨‹" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3>

<p><img data-src="https://img-host-lcatmiao.oss-cn-hangzhou.aliyuncs.com/202411132011394.png" alt="" data-proofer-ignore></p>

<h4 id="æ­¥éª¤-1---å‘èµ·è¿žæŽ¥åå•†å‚æ•°-1">æ­¥éª¤ 1 - å‘èµ·è¿žæŽ¥ï¼Œåå•†å‚æ•° <a href="#æ­¥éª¤-1---å‘èµ·è¿žæŽ¥åå•†å‚æ•°-1" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>

<p><u>å®¢æˆ·ç«¯å‘é€ `Client Hello`ã€‚</u></p>

<p>åŒ RSA æ¡æ‰‹ã€‚</p>

<h4 id="æ­¥éª¤-2---åå•†å‚æ•°å‘é€è¯ä¹¦å’Œ-ecdh-ä¿¡æ¯"><span id="ecdhe-handshake-proc2">æ­¥éª¤ 2 - åå•†å‚æ•°ï¼Œå‘é€è¯ä¹¦å’Œ ECDH ä¿¡æ¯</span> <a href="#æ­¥éª¤-2---åå•†å‚æ•°å‘é€è¯ä¹¦å’Œ-ecdh-ä¿¡æ¯" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>

<p><u>æœåŠ¡å™¨å‘é€ `Server Hello, Certificate, Server Key Exchange, Server Hello Done`ã€‚</u></p>

<p>ç›¸æ¯” RSA æ¡æ‰‹ï¼Œå¤šäº†ä¸€ä¸ª <code class="language-plaintext highlighter-rouge">Server Key Exchange</code>ï¼Œé˜è¿°å¦‚ä¸‹ã€‚</p>

<p>åœ¨è¿™æ­¥ï¼ŒæœåŠ¡å™¨ä¼šé€‰æ‹©ä¸€ç§æ¤­åœ†æ›²çº¿ï¼Œç”Ÿæˆä¸€å¯¹ ECDH å…¬ç§é’¥ï¼Œå¹¶ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">Server Private Key</code> å¯¹ <code class="language-plaintext highlighter-rouge">Client Random, Server Random, Curve Info, Server DH Public Key</code> çš„ç»„åˆè¿›è¡Œç­¾åï¼Œæœ€åŽå°†æ›²çº¿ä¿¡æ¯ã€ECDH å…¬é’¥ã€ç­¾åéƒ½åŒ…å«è¿› <code class="language-plaintext highlighter-rouge">Server Key Exchange</code> ä¸­ã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>signature = server-private-key(
    hash(client-random, server-random, curve-info, server-dh-public-key)
)
</pre></td></tr></tbody></table></code></div></div>

<p>æ­¤å¤„ç­¾åå’ŒåŽç»­éªŒç­¾çš„æ„ä¹‰åœ¨äºŽè¯æ˜Ž ECDH ä¿¡æ¯çš„ç¡®æ˜¯ç”±è¯ä¹¦ä¸­çš„å…¬é’¥æ‰€ä»£è¡¨çš„æœåŠ¡å™¨å‘é€çš„ã€‚</p>

<blockquote>
  <p>æœåŠ¡å™¨æ˜¯åå•†é€‰æ‹©æ¤­åœ†æ›²çº¿çš„ã€‚å®¢æˆ·ç«¯ä¼šé€šè¿‡ <code class="language-plaintext highlighter-rouge">elliptic_curves</code> æˆ– <code class="language-plaintext highlighter-rouge">supported_groups</code> æ‰©å±•å­—æ®µå‘é€å…¶æ”¯æŒçš„å…¨éƒ¨æ›²çº¿ï¼ŒéšåŽæœåŠ¡å™¨å†ä»Žä¸­é€‰æ‹©ä¸€ä¸ªã€‚éšç€æ ‡å‡†çš„ä¸æ–­å‘å±•ï¼Œ<code class="language-plaintext highlighter-rouge">elliptic_curves</code> å·²ç»é€æ­¥è¢« <code class="language-plaintext highlighter-rouge">supported_groups</code> å–ä»£ã€‚å›  TLS ç‰ˆæœ¬çš„ä¸åŒï¼Œä¸Šè¿°è¯´æ³•å­˜åœ¨ä¸€äº›ç»†èŠ‚å‡ºå…¥ï¼Œä½†å¤§ä½“ä¸Šæ²¡é—®é¢˜ã€‚</p>
</blockquote>

<p>å¦‚ä¸‹å›¾ï¼ŒæœåŠ¡å™¨å‘é€æŠ¥æ–‡ã€‚</p>

<p><img data-src="https://img-host-lcatmiao.oss-cn-hangzhou.aliyuncs.com/202411171231362.png" alt="" data-proofer-ignore></p>

<p>å¦‚ä¸‹å›¾ï¼ŒæœåŠ¡å™¨é€‰æ‹©äº†ç®—æ³• <code class="language-plaintext highlighter-rouge">TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256</code>ã€‚è¿™é‡Œæˆ‘ä»¬æœåŠ¡å™¨çš„å¯†é’¥å¯¹æ˜¯ ECC å¯†é’¥å¯¹ï¼Œæ‰€ä»¥åå•†é€‰æ‹©äº† <code class="language-plaintext highlighter-rouge">ECDSA</code> ç­¾åç®—æ³•ã€‚</p>

<p><img data-src="https://img-host-lcatmiao.oss-cn-hangzhou.aliyuncs.com/202411171233162.png" alt="" data-proofer-ignore></p>

<p>å¦‚ä¸‹å›¾ï¼ŒæœåŠ¡å™¨å‘é€äº†è‡ªå·±çš„è¯ä¹¦ï¼Œè¯¥è¯ä¹¦è¢« CA ç­¾åï¼Œç­¾åç®—æ³•æ˜¯ <code class="language-plaintext highlighter-rouge">ECDSA</code>ï¼Œå“ˆå¸Œç®—æ³•æ˜¯ <code class="language-plaintext highlighter-rouge">SHA256</code>ã€‚è¿™é‡Œæˆ‘ä»¬ CA çš„å¯†é’¥å¯¹ä¹Ÿæ˜¯ ECC å¯†é’¥å¯¹ï¼Œä½¿ç”¨çš„ <code class="language-plaintext highlighter-rouge">ECDSA</code> ç®—æ³•ç­¾å‘çš„å…¬é’¥è¯ä¹¦ã€‚</p>

<p><img data-src="https://img-host-lcatmiao.oss-cn-hangzhou.aliyuncs.com/202411171238485.png" alt="" data-proofer-ignore></p>

<p>å¦‚ä¸‹å›¾ï¼ŒæœåŠ¡å™¨å‘é€äº†è‡ªå·±ç”Ÿæˆçš„ ECDH å…¬é’¥ï¼Œå…¶é‡‡ç”¨çš„ ECC æ›²çº¿ä¸º <code class="language-plaintext highlighter-rouge">Named Curve: secp256r1 (0x0017)</code>ã€‚è®¡ç®—å‡ºçš„æ•°å­—ç­¾åä¹Ÿè¢«å‘é€ï¼Œç”±äºŽæœåŠ¡å™¨çš„ç§é’¥æ˜¯ ECC çš„ï¼Œæ‰€ä»¥ç­¾åç®—æ³•é€‰æ‹©äº† <code class="language-plaintext highlighter-rouge">ECDSA</code>ã€‚</p>

<p><img data-src="https://img-host-lcatmiao.oss-cn-hangzhou.aliyuncs.com/202411171432172.png" alt="" data-proofer-ignore></p>

<h4 id="æ­¥éª¤-3---èº«ä»½è®¤è¯å¯†é’¥äº¤æ¢ç”Ÿæˆä¼šè¯å¯†é’¥-1">æ­¥éª¤ 3 - èº«ä»½è®¤è¯ï¼Œå¯†é’¥äº¤æ¢ï¼Œç”Ÿæˆä¼šè¯å¯†é’¥ <a href="#æ­¥éª¤-3---èº«ä»½è®¤è¯å¯†é’¥äº¤æ¢ç”Ÿæˆä¼šè¯å¯†é’¥-1" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>

<p><u>å®¢æˆ·ç«¯å‘é€ `Client Key Exchange, Change Cipher Spec, Encrypted Handshake Message`ã€‚</u></p>

<ol>
  <li>å®¢æˆ·ç«¯ä»Ž <code class="language-plaintext highlighter-rouge">Server Hello</code> ä¸­èŽ·å¾—éšæœºæ•° <code class="language-plaintext highlighter-rouge">Server Random</code>ã€‚</li>
  <li>å®¢æˆ·ç«¯ä½¿ç”¨ CA çš„è¯ä¹¦ï¼ˆä¸€èˆ¬å·²é¢„ç½®åœ¨æµè§ˆå™¨ä¸­ï¼‰éªŒè¯æœåŠ¡å™¨çš„è¯ä¹¦ï¼Œç”±æ­¤è¯æ˜ŽæœåŠ¡å™¨çš„èº«ä»½å€¼å¾—ä¿¡èµ–ï¼Œè¯ä¹¦ä¸­çš„å…¬é’¥çš„ç¡®ä»£è¡¨æœåŠ¡å™¨çš„èº«ä»½ï¼Œæ­¤å³<strong>èº«ä»½è®¤è¯</strong>ã€‚</li>
  <li>å®¢æˆ·ç«¯ä½¿ç”¨è¯ä¹¦ä¸­çš„å…¬é’¥éªŒè¯ <code class="language-plaintext highlighter-rouge">Server Key Exchange</code> ä¸­çš„ç­¾åï¼Œç”±æ­¤è¯æ˜Ž ECDH ä¿¡æ¯çš„å‘é€è€…çš„ç¡®æ˜¯å…¬é’¥æ‰€ä»£è¡¨çš„æœåŠ¡å™¨ï¼Œæ­¤å³<strong>èº«ä»½è®¤è¯</strong>ã€‚</li>
  <li>å®¢æˆ·ç«¯åŸºäºŽæœåŠ¡å™¨é€‰æ‹©çš„æ›²çº¿ç”Ÿæˆä¸€å¯¹ ECDH å…¬ç§é’¥ã€‚</li>
  <li>å®¢æˆ·ç«¯å°†ç”Ÿæˆçš„ <code class="language-plaintext highlighter-rouge">Client DH Public Key</code> æ”¾å…¥ <code class="language-plaintext highlighter-rouge">Client Key Exchange</code> ä»¥å‘é€ç»™æœåŠ¡å™¨ã€‚</li>
  <li>å®¢æˆ·ç«¯ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">Client DH Private Key, Server DH Public Key</code> ç›´æŽ¥åœ¨æœ¬åœ°è®¡ç®—å‡º <code class="language-plaintext highlighter-rouge">PreMaster Secret</code>ï¼ŒåŽç»­æœåŠ¡å™¨ä¹Ÿä¼šç›´æŽ¥åœ¨æœ¬åœ°è®¡ç®—å‡ºåŒæ ·çš„ <code class="language-plaintext highlighter-rouge">PreMaster Secret</code>ï¼Œæ­¤å³<strong>å¯†é’¥äº¤æ¢</strong>ã€‚</li>
  <li>å®¢æˆ·ç«¯ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">Client Random, Server Random, PreMaster Secret</code> ç”Ÿæˆä¼šè¯å¯†é’¥ <code class="language-plaintext highlighter-rouge">Session Key</code>ã€‚</li>
  <li>åŒ RSA æ¡æ‰‹ï¼Œå‘é€ <code class="language-plaintext highlighter-rouge">Change Cipher Spec</code> å’Œ <code class="language-plaintext highlighter-rouge">Encrypted Handshake Message</code><sup id="fnref:client-finished:1" role="doc-noteref"><a href="#fn:client-finished" class="footnote" rel="footnote">1</a></sup>ã€‚</li>
</ol>

<p>å¦‚ä¸‹å›¾ï¼Œåœ¨ <code class="language-plaintext highlighter-rouge">Client Key Exchange</code> éƒ¨åˆ†å¯ä»¥çœ‹åˆ°å‘é€çš„ <code class="language-plaintext highlighter-rouge">Client DH Public Key</code>ã€‚</p>

<p><img data-src="https://img-host-lcatmiao.oss-cn-hangzhou.aliyuncs.com/202502112210011.png" alt="image-20250211175214373" data-proofer-ignore></p>

<h4 id="æ­¥éª¤-4---å¯†é’¥äº¤æ¢ç”Ÿæˆä¼šè¯å¯†é’¥-1">æ­¥éª¤ 4 - å¯†é’¥äº¤æ¢ï¼Œç”Ÿæˆä¼šè¯å¯†é’¥ <a href="#æ­¥éª¤-4---å¯†é’¥äº¤æ¢ç”Ÿæˆä¼šè¯å¯†é’¥-1" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>

<p><u>æœåŠ¡å™¨å‘é€ `Change Cipher Spec, Encrypted Handshake Message`ã€‚</u></p>

<ol>
  <li>æœåŠ¡å™¨ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">Client DH Public Key, Server DH Private Key</code> ç›´æŽ¥åœ¨æœ¬åœ°è®¡ç®—å‡ºä¸Žå®¢æˆ·ç«¯ä¸€è‡´çš„ <code class="language-plaintext highlighter-rouge">PreMaster Secret</code>ï¼Œæ­¤å³<strong>å¯†é’¥äº¤æ¢</strong>ã€‚</li>
  <li>æœåŠ¡å™¨ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">Client Random, Server Random, PreMaster Secret</code> ç”Ÿæˆä¼šè¯å¯†é’¥ <code class="language-plaintext highlighter-rouge">Session Key</code>ã€‚</li>
  <li>æœåŠ¡å™¨ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">Session Key</code> è§£å¯†å®¢æˆ·ç«¯å‘æ¥çš„æ ¡éªŒæ•°æ®ï¼Œå¹¶è®¡ç®—æŠ¥æ–‡å“ˆå¸Œå€¼ä¸Žæ ¡éªŒæ•°æ®è¿›è¡Œå¯¹æ¯”ã€‚</li>
  <li>åŒ RSA æ¡æ‰‹ï¼Œå‘é€ <code class="language-plaintext highlighter-rouge">Change Cipher Spec</code> å’Œ <code class="language-plaintext highlighter-rouge">Encrypted Handshake Message</code><sup id="fnref:server-finished:1" role="doc-noteref"><a href="#fn:server-finished" class="footnote" rel="footnote">2</a></sup>ã€‚</li>
</ol>

<h4 id="æ­¥éª¤-5---å®Œæˆæ¡æ‰‹åŠ å¯†é€šä¿¡-1">æ­¥éª¤ 5 - å®Œæˆæ¡æ‰‹ï¼ŒåŠ å¯†é€šä¿¡ <a href="#æ­¥éª¤-5---å®Œæˆæ¡æ‰‹åŠ å¯†é€šä¿¡-1" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>

<p><u>åŒæ–¹å‘é€ `Application Data`ã€‚</u></p>

<p>åŒ RSA æ¡æ‰‹ã€‚</p>

<h4 id="æ­¥éª¤-6---æ–­å¼€è¿žæŽ¥-1">æ­¥éª¤ 6 - æ–­å¼€è¿žæŽ¥ <a href="#æ­¥éª¤-6---æ–­å¼€è¿žæŽ¥-1" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4>

<p><u>å®¢æˆ·ç«¯å‘é€ `Encrypted Alert`ã€‚</u></p>

<p>åŒ RSA æ¡æ‰‹ã€‚</p>

<h2 id="è¡¥å……è¯´æ˜Ž">è¡¥å……è¯´æ˜Ž <a href="#è¡¥å……è¯´æ˜Ž" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2>

<h3 id="æ ¡éªŒæ•°æ®-finished-message"><span id="verification-data">æ ¡éªŒæ•°æ® Finished Message</span> <a href="#æ ¡éªŒæ•°æ®-finished-message" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3>

<p><a href="https://tls12.xargs.org/#client-handshake-finished">The Illustrated TLS Connection: Every Byte Explained</a> è¾ƒä¸ºè¯¦ç»†åœ°å±•ç¤ºäº† <a href="#ecdhe-handshake-process">ECDHE æ¡æ‰‹</a>çš„æµç¨‹ï¼Œå…¶è¯´æ³•å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>The verification data is built from a hash of all handshake messages and verifies the integrity of the handshake process.
</pre></td></tr></tbody></table></code></div></div>

<p><a href="https://www.rfc-editor.org/info/rfc5246">RFC5246  The Transport Layer Security (TLS) Protocol Version 1.2</a> çš„è¯´æ³•å¦‚ä¸‹ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre># 7.4.9  Finished
The value handshake_messages includes all handshake messages starting
at ClientHello up to, but not including, this Finished message.  This
may be different from handshake_messages in Section 7.4.8 because it
would include the CertificateVerify message (if sent).  Also, the
handshake_messages for the Finished message sent by the client will
be different from that for the Finished message sent by the server,
because the one that is sent second will include the prior one.

Note: ChangeCipherSpec messages, alerts, and any other record types
are not handshake messages and are not included in the hash
computations.  Also, HelloRequest messages are omitted from handshake
hashes.
</pre></td></tr></tbody></table></code></div></div>

<p>æ®æ­¤çŒœæµ‹ï¼Œæœ¬æ–‡ä¾‹å­ä¸­ï¼Œå‚ä¸Žå“ˆå¸Œçš„æŠ¥æ–‡åŒºé—´å¤§æ¦‚æ˜¯ <code class="language-plaintext highlighter-rouge">[Client Hello, Client/Server Finished), Exclude(Change Cipher Spec)</code>ã€‚</p>

<h3 id="mac-æ‘˜è¦">MAC æ‘˜è¦ <a href="#mac-æ‘˜è¦" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3>

<p>æ‰€æœ‰ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">Session Key</code> åŠ å¯†çš„æ•°æ®ï¼Œå…¶å†…éƒ½åŒ…å«äº†ä¸€ä¸ªåä¸º <code class="language-plaintext highlighter-rouge">MAC (Message Authentication Code)</code> çš„æŠ¥æ–‡æ‘˜è¦ã€‚MAC æœ‰å¤šç§å®žçŽ°ï¼Œæ¯”å¦‚ HMAC å’Œ GMACã€‚</p>

<p>HMAC å’Œ GMAC çš„ç‰¹ç‚¹ï¼ˆAIï¼‰ï¼š</p>

<ul>
  <li>HMAC
    <ul>
      <li>åŸºäºŽå“ˆå¸Œå‡½æ•°ï¼ˆå¦‚ SHA256ï¼‰</li>
      <li>é€‚ç”¨äºŽé€šç”¨åœºæ™¯</li>
      <li>éœ€è¦æ˜¾å¼åœ°ä¸ŽåŠ å¯†ç®—æ³•ï¼ˆå¦‚ AES-CBCï¼‰ç»“åˆä½¿ç”¨</li>
    </ul>
  </li>
  <li>GMAC
    <ul>
      <li>åŸºäºŽ Galois åŸŸè¿ç®—</li>
      <li>ä¸“ä¸º GCM æ¨¡å¼è®¾è®¡ï¼Œé€šå¸¸ä¸Ž AES-GCM ç»“åˆä½¿ç”¨ã€‚</li>
      <li>æä¾›æ›´é«˜çš„æ€§èƒ½ï¼Œå°¤å…¶æ˜¯åœ¨ç¡¬ä»¶åŠ é€Ÿçš„åœºæ™¯ä¸­ã€‚</li>
    </ul>
  </li>
</ul>

<p>å…·ä½“æœºåˆ¶æœ¬æ–‡ä¸ç ”ç©¶ï¼Œæˆ‘çš„ç†è§£æ˜¯æ•°æ®å’Œ MAC ä¸€èµ·è¢«åŠ å¯†ä¼ è¾“ï¼Œå¯¹ç«¯è§£å¯†åŽï¼Œå†è®¡ç®—æ•°æ®çš„ MAC ä¸ŽæŽ¥æ”¶åˆ°çš„ MAC å€¼å¯¹æ¯”ï¼Œä»Žè€ŒæŽ¢çŸ¥æ•°æ®æ˜¯å¦è¢«ç¯¡æ”¹ï¼Œæ­¤å³<strong>å®Œæ•´æ€§æ ¡éªŒ</strong>ã€‚</p>

<h3 id="è¯•è®¡ç®—-server-key-exchange-ä¸­çš„ç­¾åå¹¶éªŒç­¾">è¯•è®¡ç®— Server Key Exchange ä¸­çš„ç­¾åå¹¶éªŒç­¾ <a href="#è¯•è®¡ç®—-server-key-exchange-ä¸­çš„ç­¾åå¹¶éªŒç­¾" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3>

<p>åœ¨ <a href="#ecdhe-handshake-proc2">ECDHE æ¡æ‰‹-æ­¥éª¤ 2</a> ä¸­ï¼Œæˆ‘ä»¬æåˆ°ç­¾åæ˜¯å¯¹ <code class="language-plaintext highlighter-rouge">Client Random, Server Random, Curve Info, Server DH Public Key</code> çš„ç»„åˆè¿›è¡Œçš„ã€‚ä¿¡æ¯æ”¶é›†å¦‚ä¸‹ï¼š</p>

<p><img data-src="https://img-host-lcatmiao.oss-cn-hangzhou.aliyuncs.com/202411171440510.png" alt="" data-proofer-ignore></p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre># client random
\x5b\x70\x1c\x25\x8a\xf4\x56\x6a\x81\xa7\xee\xcf\xa0\x9f\xbb\xcb\x35\xfd\x64\xae\xe5\xb0\x46\x03\xda\x92\x4e\xa0\x07\x79\x35\x2a
</pre></td></tr></tbody></table></code></div></div>

<p><img data-src="https://img-host-lcatmiao.oss-cn-hangzhou.aliyuncs.com/202411171447191.png" alt="" data-proofer-ignore></p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre># server random
\xcc\x26\xf9\x66\x00\x00\x00\x00\x67\x78\x0a\x00\x00\x00\x00\x00\x3f\x00\x00\x00\x3f\x00\x00\x00\x3f\x00\x00\x00\x3f\x00\x00\x00
</pre></td></tr></tbody></table></code></div></div>

<p><img data-src="https://img-host-lcatmiao.oss-cn-hangzhou.aliyuncs.com/202411171450931.png" alt="" data-proofer-ignore></p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre># curve info
\x03\x00\x17

# server dh public key
\x41
\x04\x39\x3b\x76\x31\x87\x80\xe0\x0b\x27\xd4\xe7\xc4\x95\x27\x9c\x2f\xeb\x96\xa6\xe8\xd9\x87\x42\x2e\xce\xac\x84\xa2\x68\xda\x6f\x6f\x08\x05\xaa\xf9\x5d\x23\xa0\x24\xd1\x25\x30\x84\x11\x55\xcb\xe9\x69\xeb\xfb\xcf\xa8\xbd\xf8\x96\x8a\x0a\x7e\xad\x1c\xef\x84\xa8
</pre></td></tr></tbody></table></code></div></div>

<p>å°†è¿™äº›æ•°æ®åˆå¹¶åœ¨ä¸€èµ·ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre># compose the data together
echo -n "\x5b\x70\x1c\x25\x8a\xf4\x56\x6a\x81\xa7\xee\xcf\xa0\x9f\xbb\xcb\x35\xfd\x64\xae\xe5\xb0\x46\x03\xda\x92\x4e\xa0\x07\x79\x35\x2a\xcc\x26\xf9\x66\x00\x00\x00\x00\x67\x78\x0a\x00\x00\x00\x00\x00\x3f\x00\x00\x00\x3f\x00\x00\x00\x3f\x00\x00\x00\x3f\x00\x00\x00\x03\x00\x17\x41\x04\x39\x3b\x76\x31\x87\x80\xe0\x0b\x27\xd4\xe7\xc4\x95\x27\x9c\x2f\xeb\x96\xa6\xe8\xd9\x87\x42\x2e\xce\xac\x84\xa2\x68\xda\x6f\x6f\x08\x05\xaa\xf9\x5d\x23\xa0\x24\xd1\x25\x30\x84\x11\x55\xcb\xe9\x69\xeb\xfb\xcf\xa8\xbd\xf8\x96\x8a\x0a\x7e\xad\x1c\xef\x84\xa8" &gt; data
</pre></td></tr></tbody></table></code></div></div>

<p>æœåŠ¡å™¨æœ¬èº«çš„ç§é’¥ä¹Ÿè´´åœ¨æ­¤å¤„ï¼Œæ–‡ä»¶ä»¥ <code class="language-plaintext highlighter-rouge">\n</code> ç»“å°¾ã€‚è¿™æ˜¯ä¸€ä¸ªåŸºäºŽæ›²çº¿ <code class="language-plaintext highlighter-rouge">prime256v1(secp256r1)</code> çš„ ECC ç§é’¥ã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre># server private key
-----BEGIN EC PARAMETERS-----
BggqhkjOPQMBBw==
-----END EC PARAMETERS-----
-----BEGIN EC PRIVATE KEY-----
MHcCAQEEIIshQQR4px7Ek+5jRugTnySv5cjqSs1PbDlnmR1SSC4joAoGCCqGSM49
AwEHoUQDQgAE4Q+9ZBPkV4b2buqwPLB9EskoGByXTcPuF22znhtFG2R9gVlFyU4S
3GyXx3QaFOfLLNdyl/puch+GlZAZZsYKPw==
-----END EC PRIVATE KEY-----

</pre></td></tr></tbody></table></code></div></div>

<p>å…¶åå…­è¿›åˆ¶ä¸ºï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre># server private key hex
xxd -ps server-ecc-key.pem | tr -d "\n" | sed 's/\(..\)/\\x\1/g'
\x2d\x2d\x2d\x2d\x2d\x42\x45\x47\x49\x4e\x20\x45\x43\x20\x50\x41\x52\x41\x4d\x45\x54\x45\x52\x53\x2d\x2d\x2d\x2d\x2d\x0a\x42\x67\x67\x71\x68\x6b\x6a\x4f\x50\x51\x4d\x42\x42\x77\x3d\x3d\x0a\x2d\x2d\x2d\x2d\x2d\x45\x4e\x44\x20\x45\x43\x20\x50\x41\x52\x41\x4d\x45\x54\x45\x52\x53\x2d\x2d\x2d\x2d\x2d\x0a\x2d\x2d\x2d\x2d\x2d\x42\x45\x47\x49\x4e\x20\x45\x43\x20\x50\x52\x49\x56\x41\x54\x45\x20\x4b\x45\x59\x2d\x2d\x2d\x2d\x2d\x0a\x4d\x48\x63\x43\x41\x51\x45\x45\x49\x49\x73\x68\x51\x51\x52\x34\x70\x78\x37\x45\x6b\x2b\x35\x6a\x52\x75\x67\x54\x6e\x79\x53\x76\x35\x63\x6a\x71\x53\x73\x31\x50\x62\x44\x6c\x6e\x6d\x52\x31\x53\x53\x43\x34\x6a\x6f\x41\x6f\x47\x43\x43\x71\x47\x53\x4d\x34\x39\x0a\x41\x77\x45\x48\x6f\x55\x51\x44\x51\x67\x41\x45\x34\x51\x2b\x39\x5a\x42\x50\x6b\x56\x34\x62\x32\x62\x75\x71\x77\x50\x4c\x42\x39\x45\x73\x6b\x6f\x47\x42\x79\x58\x54\x63\x50\x75\x46\x32\x32\x7a\x6e\x68\x74\x46\x47\x32\x52\x39\x67\x56\x6c\x46\x79\x55\x34\x53\x0a\x33\x47\x79\x58\x78\x33\x51\x61\x46\x4f\x66\x4c\x4c\x4e\x64\x79\x6c\x2f\x70\x75\x63\x68\x2b\x47\x6c\x5a\x41\x5a\x5a\x73\x59\x4b\x50\x77\x3d\x3d\x0a\x2d\x2d\x2d\x2d\x2d\x45\x4e\x44\x20\x45\x43\x20\x50\x52\x49\x56\x41\x54\x45\x20\x4b\x45\x59\x2d\x2d\x2d\x2d\x2d\x0a
</pre></td></tr></tbody></table></code></div></div>

<p>çŽ°åœ¨ä½¿ç”¨ç§é’¥å¯¹æ•°æ®ç­¾åï¼Œ<code class="language-plaintext highlighter-rouge">openssl</code> ä¼šæ ¹æ®ç§é’¥ç±»åž‹è‡ªåŠ¨é€‰æ‹©ç›¸åº”çš„ç­¾åç®—æ³•ï¼Œå¯¹äºŽ ECC ç§é’¥ï¼Œä¼šé»˜è®¤é€‰æ‹© ECDSA ç®—æ³•ã€‚æŠ¥æ–‡ä¸­å®žé™…ä½¿ç”¨çš„ç­¾åç®—æ³•ä¸º <code class="language-plaintext highlighter-rouge">ecdsa_secp256r1_sha256</code>ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">-sha256</code>ï¼Œä½¿å“ˆå¸Œç®—æ³•ä¹Ÿä¿æŒä¸€è‡´ã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre># sign the data with the server private key
openssl dgst -sign server-ecc-key.pem -sha256 -out sig data

# see the signature
xxd -ps sig

# result:
3044022020b6c7803f90785be49b6d70744f82bc7a421718da24e39abb74
3505fe23882b02203b56f27ca41156b86948f658e07eda922f06dc6c4284
bbd179c6da108a48b4e5
</pre></td></tr></tbody></table></code></div></div>

<p>è‡³æ­¤æˆ‘ä»¬å¾—åˆ°äº†ç­¾åï¼Œä½†æ˜¯è¯¥ç­¾åä¸ŽæŠ¥æ–‡ä¸­çš„å®žé™…å€¼å¹¶ä¸ç›¸åŒã€‚ä¸ä»…å¦‚æ­¤ï¼Œä½ ä¼šå‘çŽ°æ¯æ¬¡ç­¾åå¾—åˆ°çš„ç»“æžœéƒ½æ˜¯ä¸åŒçš„ã€‚è¿™æ˜¯å› ä¸º ECDSA ç­¾åç®—æ³•å†…éƒ¨æ··å…¥äº†éšæœºå€¼ï¼Œå³ä¾¿ä½¿ç”¨åŒä¸€ç§é’¥å¯¹åŒä¸€æ¶ˆæ¯è¿›è¡Œå¤šæ¬¡ç­¾åï¼Œç»“æžœä¹Ÿä¼šä¸åŒã€‚</p>

<p><img data-src="https://img-host-lcatmiao.oss-cn-hangzhou.aliyuncs.com/202502181001719.png" alt="image-20250218100041736" data-proofer-ignore></p>

<blockquote>
  <p>å¦‚æžœæ˜¯ RSA ç§é’¥ï¼Œé‚£ä¹ˆè®¡ç®—å¾—åˆ°çš„ RSA ç­¾åæ˜¯å¯ä»¥ä¸ŽæŠ¥æ–‡ä¸­çš„å®žé™…å€¼å¯¹ä¸Šçš„ã€‚ä½¿ç”¨åŒä¸€ç§é’¥å¯¹åŒä¸€æ¶ˆæ¯è¿›è¡Œå¤šæ¬¡ç­¾åï¼Œç»“æžœæ˜¯ç›¸åŒçš„ã€‚</p>
</blockquote>

<p>ä¸è¿‡è¿™å¹¶ä¸ä¼šå½±å“éªŒç­¾çš„ç»“æžœã€‚ä¸‹é¢æˆ‘ä»¬è¿›è¡ŒéªŒç­¾ã€‚</p>

<p>å®žé™…éªŒç­¾æ—¶ï¼Œå®¢æˆ·ç«¯ä¼šä»ŽæœåŠ¡å™¨è¯ä¹¦ä¸­æå–å‡ºå…¬é’¥ã€‚å¦‚ä¸‹ï¼Œæ–‡ä»¶ä»¥ <code class="language-plaintext highlighter-rouge">\n</code> ç»“å°¾ã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre># extract the public key from the server certificate
openssl x509 -in server-ecc-cert.pem -pubkey -noout &gt; server-ecc-pub.pem

# server public key
-----BEGIN PUBLIC KEY-----
MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAE4Q+9ZBPkV4b2buqwPLB9EskoGByX
TcPuF22znhtFG2R9gVlFyU4S3GyXx3QaFOfLLNdyl/puch+GlZAZZsYKPw==
-----END PUBLIC KEY-----

# server public key hex
xxd -ps server-ecc-pub.pem | tr -d "\n" | sed 's/\(..\)/\\x\1/g'
\x2d\x2d\x2d\x2d\x2d\x42\x45\x47\x49\x4e\x20\x50\x55\x42\x4c\x49\x43\x20\x4b\x45\x59\x2d\x2d\x2d\x2d\x2d\x0a\x4d\x46\x6b\x77\x45\x77\x59\x48\x4b\x6f\x5a\x49\x7a\x6a\x30\x43\x41\x51\x59\x49\x4b\x6f\x5a\x49\x7a\x6a\x30\x44\x41\x51\x63\x44\x51\x67\x41\x45\x34\x51\x2b\x39\x5a\x42\x50\x6b\x56\x34\x62\x32\x62\x75\x71\x77\x50\x4c\x42\x39\x45\x73\x6b\x6f\x47\x42\x79\x58\x0a\x54\x63\x50\x75\x46\x32\x32\x7a\x6e\x68\x74\x46\x47\x32\x52\x39\x67\x56\x6c\x46\x79\x55\x34\x53\x33\x47\x79\x58\x78\x33\x51\x61\x46\x4f\x66\x4c\x4c\x4e\x64\x79\x6c\x2f\x70\x75\x63\x68\x2b\x47\x6c\x5a\x41\x5a\x5a\x73\x59\x4b\x50\x77\x3d\x3d\x0a\x2d\x2d\x2d\x2d\x2d\x45\x4e\x44\x20\x50\x55\x42\x4c\x49\x43\x20\x4b\x45\x59\x2d\x2d\x2d\x2d\x2d\x0a
</pre></td></tr></tbody></table></code></div></div>

<p>ä½¿ç”¨å…¬é’¥éªŒç­¾ã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre># verify the signature
openssl dgst -verify server-ecc-pub.pem -signature sig -sha256 data
Verified OK
</pre></td></tr></tbody></table></code></div></div>

<p>éªŒè¯é€šè¿‡ã€‚</p>

<h3 id="ä¸ºä»€ä¹ˆéªŒç­¾è¦ä½¿ç”¨è¯ä¹¦è€Œä¸èƒ½ç›´æŽ¥ä½¿ç”¨å…¬é’¥">ä¸ºä»€ä¹ˆéªŒç­¾è¦ä½¿ç”¨è¯ä¹¦è€Œä¸èƒ½ç›´æŽ¥ä½¿ç”¨å…¬é’¥ï¼Ÿ <a href="#ä¸ºä»€ä¹ˆéªŒç­¾è¦ä½¿ç”¨è¯ä¹¦è€Œä¸èƒ½ç›´æŽ¥ä½¿ç”¨å…¬é’¥" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3>

<p>çŽ°æœ‰ä¸¤ä¸ªäºº A å’Œ Bï¼ŒB ç”¨è‡ªå·±çš„ç§é’¥ç­¾åäº†ä¸€æ®µä¿¡æ¯ï¼Œå‘ç»™ Aã€‚çŽ°åœ¨ A ç”¨ B çš„å…¬é’¥éªŒç­¾ï¼Œå‘çŽ°èƒ½å¤ŸæˆåŠŸè§£å¯†ï¼Œæ‰€ä»¥ä»¥æ­¤è®¤å®šä¿¡æ¯çš„å‘é€è€…æ˜¯ Bã€‚è¿™ä¼¼ä¹Žæ²¡æœ‰é—®é¢˜ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦å…¬é’¥è¯ä¹¦å‘¢ï¼Ÿ</p>

<p>é—®é¢˜çš„å…³é”®åœ¨äºŽï¼ŒB çš„å…¬é’¥æ˜¯å¦å¯ä¿¡ï¼ŒB çš„å…¬é’¥æ˜¯å¦çœŸçš„æ˜¯ B çš„å…¬é’¥ã€‚å¦‚æžœæœ‰ä¸­é—´äººæ”»å‡»ï¼Œæ”»å‡»è€… C æŽ‰åŒ…äº† B çš„å…¬é’¥ä¸ºè‡ªå·±çš„å…¬é’¥ï¼Œç„¶åŽè‡ªå·±ç­¾åå‘é€ä¸€æ®µä¿¡æ¯ç»™ Aï¼Œé‚£ä¹ˆ A å°±ä¼šè¯¯ä»¥ä¸ºä¿¡æ¯çš„å‘é€è€…æ˜¯ Bï¼Œè€Œå®žé™…å‘é€è€…å´æ˜¯ Aã€‚</p>

<p>æ‰€ä»¥ï¼Œæœ‰å¿…è¦ç¡®ä¿å…¬é’¥çš„ç¡®æ˜¯ B çš„ï¼Œè€Œè¯ä¹¦èƒ½å¤Ÿè¯æ˜Žè¿™ä¸€ç‚¹ã€‚è¯ä¹¦ç”±å¹¿å—ç¤¾ä¼šä¿¡ä»»çš„ CA ç­¾å‘ï¼Œå…¶ä¸­åŒ…å«äº†å…¬é’¥æœ¬èº«å’Œå…¬é’¥æ‰€ä»£è¡¨çš„èº«ä»½ä¿¡æ¯ã€‚A åœ¨æ”¶åˆ° B çš„è¯ä¹¦åŽï¼Œä½¿ç”¨ CA çš„è¯ä¹¦éªŒè¯ B çš„è¯ä¹¦ï¼ŒéªŒè¯é€šè¿‡å³ä»£è¡¨ B çš„è¯ä¹¦çš„ç¡®æ˜¯ç”± CA ç­¾å‘çš„ï¼ŒCA ä¿¡ä»» B çš„èº«ä»½ï¼Œè€Œ CA æ˜¯å¹¿å—ä¿¡ä»»çš„ï¼ŒA è‡ªç„¶ä¹Ÿä¿¡ä»» CAï¼ŒäºŽæ˜¯ A å¯ä»¥ä¿¡ä»» B çš„èº«ä»½ï¼Œä¹Ÿå³ï¼š<strong>åªè¦éªŒè¿‡äº†è¯ä¹¦ï¼Œå°±å¯ä»¥ç›¸ä¿¡å…¬é’¥æ‰€ä»£è¡¨çš„èº«ä»½ï¼Œå°±è¯æ˜Žå…¬é’¥çš„ç¡®å±žäºŽå®ƒæ‰€ä»£è¡¨çš„é‚£ä¸ªèº«ä»½æœºæž„</strong>ã€‚</p>

<p>å³ä¾¿æ”»å‡»è€…æŽ‰åŒ… B çš„å…¬é’¥ï¼Œä»–ä¹Ÿæ— æ³•ä¼ªé€  CA çš„ç­¾åï¼Œæ‰€ä»¥æ”»å‡»è€…æ˜¯æ— æ³•ä¼ªé€ è¯ä¹¦çš„ã€‚è¯ä¹¦/ä¿¡ä»»é“¾æœºåˆ¶ä»¥ CA è¿™æ ·çš„ç¬¬ä¸‰æ–¹æƒå¨æœºæž„ä½œèƒŒä¹¦ï¼Œèƒ½å¤Ÿé˜²èŒƒä¸­é—´äººæ”»å‡»ï¼Œç¡®ä¿å…¬é’¥çš„çœŸå®žæ€§ã€‚</p>

<p>å¯¹äºŽä»¥ä¸‹æƒ…å†µï¼š</p>

<ul>
  <li>A å’Œ B æ˜¯å¥½å‹ï¼ŒçŽ°åœ¨å°±é¢å¯¹é¢ç«™ç€äº¤æŽ¥å…¬é’¥ã€‚</li>
  <li>B ä»¥ç”¨æˆ·åå¯†ç çš„æ–¹å¼å·²ç»é€šè¿‡äº† A çš„èº«ä»½è®¤è¯ï¼Œå†äº¤æŽ¥å…¬é’¥ã€‚</li>
</ul>

<p>A èƒ½å¤Ÿç›´æŽ¥ä¿¡ä»» Bï¼Œç›´æŽ¥è®¤å¯å…¬é’¥çš„çœŸå®žæ€§ï¼Œè¿™å°±ä¸éœ€è¦è¯ä¹¦äº†ã€‚A ä»¥åŽç›´æŽ¥ä½¿ç”¨å…¬é’¥éªŒç­¾å³å¯ã€‚ç„¶è€Œï¼Œåœ¨å¼€æ”¾çš„ç½‘ç»œé€šä¿¡ä¸­ï¼Œè¯ä¹¦/ä¿¡ä»»é“¾æœºåˆ¶ä¸å¯æˆ–ç¼ºã€‚</p>

<h1 id="tls-ç®—æ³•åç§°çš„å«ä¹‰">TLS ç®—æ³•åç§°çš„å«ä¹‰</h1>

<p>åœ¨ç†Ÿæ‚‰äº†æ¡æ‰‹çš„çŸ¥è¯†ä»¥åŽï¼Œæˆ‘ä»¬å†æ¥ç†è§£ç®—æ³•åç§°çš„å«ä¹‰ã€‚è¿™å¹¶æ²¡æœ‰æƒ³è±¡ä¸­é‚£ä¹ˆç®€å•ï¼Œç”±äºŽç®—æ³•ç‰ˆæœ¬çš„æ›´è¿­ï¼Œç®—æ³•åç§°çš„å«ä¹‰ä¼šæœ‰ä¸€äº›å·®åˆ«ã€‚å…ˆè´´ä¸Šå‡ ä¸ªç®—æ³•åç§°çš„ä¾‹å­ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre>TLS_RSA_WITH_AES_256_CBC_SHA256
TLS_RSA_WITH_AES_128_GCM_SHA256
TLS_RSA_WITH_AES_256_GCM_SHA384
TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA
TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256
TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384
TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
TLS_ECDH_RSA_WITH_AES_256_CBC_SHA
TLS_ECDH_ECDSA_WITH_AES_256_CBC_SHA
</pre></td></tr></tbody></table></code></div></div>

<p><code class="language-plaintext highlighter-rouge">SHA</code> æ˜¯æŒ‡ HMAC è®¡ç®—ä»¥åŠ Finished æ ¡éªŒç­‰æµç¨‹æ‰€ä½¿ç”¨çš„å“ˆå¸Œç®—æ³•ï¼Œ<code class="language-plaintext highlighter-rouge">CBC/GCM</code> æ˜¯åˆ†ç»„å¯†ç å·¥ä½œæ¨¡å¼ï¼Œ<code class="language-plaintext highlighter-rouge">AES_256</code> æ˜¯å…±äº«å¯†ç ç®—æ³•å’Œå…±äº«å¯†é’¥é•¿åº¦ã€‚ç´§è·Ÿåœ¨ TLS åŽé¢çš„ <code class="language-plaintext highlighter-rouge">RSA/ECDHE/ECDH</code> æ˜¯å¯†é’¥äº¤æ¢ç®—æ³•ï¼Œå…¶ä¸­ <code class="language-plaintext highlighter-rouge">DHE</code> å¯†é’¥äº¤æ¢è¿‡ç¨‹ä¸­ä¼šç”¨åˆ°ç­¾åï¼Œæ‰€ä»¥åŽé¢è¿˜è·Ÿäº†ä¸€ä¸ªç­¾åç®—æ³•â€”â€”<code class="language-plaintext highlighter-rouge">ECDSA/RSA</code>ã€‚</p>

<p>é—®é¢˜å‡ºçŽ°äº†ï¼Œ<code class="language-plaintext highlighter-rouge">ECDH</code> å¯†é’¥äº¤æ¢ä¸­ï¼ŒECDH å¯†é’¥å¯¹ä¸æ˜¯ä¸´æ—¶ç”Ÿæˆçš„ï¼ŒæœåŠ¡å™¨æ˜¯ç›´æŽ¥å°†è¯ä¹¦ä½œä¸º <code class="language-plaintext highlighter-rouge">ECDH</code> å…¬é’¥å‘ç»™å®¢æˆ·ç«¯çš„ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­æœåŠ¡å™¨ä¸éœ€è¦è¿›è¡Œé¢å¤–çš„ç­¾åï¼Œé‚£ä¸ºä»€ä¹ˆä¼šå­˜åœ¨ <code class="language-plaintext highlighter-rouge">ECDH_RSA/ECDH_ECDSA</code> è¿™æ ·çš„ç®—æ³•åç§°å‘¢ï¼Ÿ<strong>è¿™æ¶‰åŠä¸€ä¸ªè¢«å¹¿æ³›è¯¯è§£çš„é—®é¢˜ï¼šç®—æ³•åç§°ä¸­çš„ç­¾åç®—æ³•åˆ°åº•æ˜¯æŒ‡è¯ä¹¦ä¸Šæ‰€ä½¿ç”¨çš„ç­¾åè¿˜æ˜¯æ¡æ‰‹è¿‡ç¨‹ä¸­æ‰€ä½¿ç”¨çš„ç­¾åï¼Ÿ</strong>æžæ¸…è¿™ä¸ªé—®é¢˜å¤§æ¦‚æ²¡ä»€ä¹ˆå®žç”¨ä»·å€¼ï¼Œä½†ä¸æžæ¸…å®žåœ¨è®©æˆ‘ä¸èˆ’æœðŸ˜£ã€‚åœ¨ä¸€ä¼— RFC ä¸­ï¼Œæˆ‘é€æ¸æ‰¾åˆ°äº†ç­”æ¡ˆã€‚</p>

<p><a href="https://www.rfc-editor.org/info/rfc4346">RFC4346  The Transport Layer Security (TLS) Protocol Version 1.1</a></p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre># 7.4.2  Server Certificate
The certificate type MUST be appropriate for the selected cipher
suite's key exchange algorithm, and is generally an X.509v3
certificate.  It MUST contain a key that matches the key exchange
method, as follows.  Unless otherwise specified, the signing
algorithm for the certificate MUST be the same as the algorithm
for the certificate key.  Unless otherwise specified, the public
key MAY be of any length.

Key Exchange Algorithm  Certificate Key Type
RSA                     RSA public key; the certificate MUST
                        allow the key to be used for encryption.
DHE_DSS                 DSS public key.
DHE_RSA                 RSA public key that can be used for
                        signing.
DH_DSS                  Diffie-Hellman key. The algorithm used
                        to sign the certificate MUST be DSS.
DH_RSA                  Diffie-Hellman key. The algorithm used
                        to sign the certificate MUST be RSA.
</pre></td></tr></tbody></table></code></div></div>

<p>è¿™æ˜¯ TLS1.1 çš„ RFCã€‚ä¸Šé¢çš„æ„æ€æ˜¯ï¼š<strong>è¯ä¹¦çš„ç­¾åç®—æ³•å¿…é¡»ä¸Žç¡®å®šå¯†é’¥å¯¹ç±»åž‹çš„ç®—æ³•ä¿æŒä¸€è‡´ã€‚</strong>æ–‡ä¸­è¿˜ä¸¾äº†å‡ ä¸ªä¾‹å­ï¼š</p>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th style="text-align: center">å¯†é’¥äº¤æ¢ç®—æ³•</th>
      <th style="text-align: center">å¯†é’¥å¯¹ç±»åž‹</th>
      <th style="text-align: center">æ¡æ‰‹ç­¾åç®—æ³•ï¼ˆæŽ¨ç†ï¼‰</th>
      <th style="text-align: center">è¯ä¹¦ç­¾åç®—æ³•ï¼ˆæŽ¨ç†ï¼‰</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">RSA</td>
      <td style="text-align: center">RSA</td>
      <td style="text-align: center">/</td>
      <td style="text-align: center">RSA</td>
    </tr>
    <tr>
      <td style="text-align: center">DHE_DSS</td>
      <td style="text-align: center">DSS</td>
      <td style="text-align: center">DSS</td>
      <td style="text-align: center">DSS</td>
    </tr>
    <tr>
      <td style="text-align: center">DHE_RSA</td>
      <td style="text-align: center">RSA</td>
      <td style="text-align: center">RSA</td>
      <td style="text-align: center">RSA</td>
    </tr>
    <tr>
      <td style="text-align: center">DH_DSS</td>
      <td style="text-align: center">DH</td>
      <td style="text-align: center">/</td>
      <td style="text-align: center">DSS</td>
    </tr>
    <tr>
      <td style="text-align: center">DH_RSA</td>
      <td style="text-align: center">DH</td>
      <td style="text-align: center">/</td>
      <td style="text-align: center">RSA</td>
    </tr>
  </tbody>
</table></div>

<blockquote>
  <p>æ³¨ï¼ˆAIï¼‰ï¼šDSS æ˜¯ä¸€ä¸ªæ•°å­—ç­¾åæ ‡å‡†ï¼ŒDSA ç®—æ³•æ˜¯å…¶æœ€åˆçš„æ ¸å¿ƒå®žçŽ°ï¼Œéšç€ DSS æ ‡å‡†çš„ç‰ˆæœ¬æ›´æ–°ï¼ŒRSA å’Œ ECDSA ä¹Ÿè¢«çº³å…¥æ ‡å‡†ä¸­ã€‚</p>
</blockquote>

<p>æˆ‘ä»¬å¯ä»¥å‘çŽ°ä¸Šè¡¨ä¸­çš„ä¸¤ä¸ª <code class="language-plaintext highlighter-rouge">DH</code> å¯†é’¥äº¤æ¢ç®—æ³•æ²¡æœ‰éµå®ˆâ€œè¯ä¹¦çš„ç­¾åç®—æ³•å¿…é¡»ä¸Žç¡®å®šå¯†é’¥å¯¹ç±»åž‹çš„ç®—æ³•ä¿æŒä¸€è‡´â€çš„è§„å®šï¼Œè¿™æ˜¯å› ä¸º <code class="language-plaintext highlighter-rouge">DH</code> ç®—æ³•åªèƒ½ç”¨ä½œå¯†é’¥äº¤æ¢ï¼Œä¸èƒ½ç”¨æ¥ç­¾åï¼Œè¿™æ‰é¢å¤–è¿½åŠ äº†ä¸€ä¸ªç®—æ³•åç§°ï¼Œç”¨äºŽæŒ‡å®šè¯ä¹¦çš„ç­¾åç®—æ³•ã€‚</p>

<p><a href="https://www.rfc-editor.org/info/rfc4346">RFC4346  The Transport Layer Security (TLS) Protocol Version 1.1</a></p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre># F.1.1.3  Diffie-Hellman Key Exchange with Authentication
When Diffie-Hellman key exchange is used, the server can either
supply a certificate containing fixed Diffie-Hellman parameters or
use the server key exchange message to send a set of temporary
Diffie-Hellman parameters signed with a DSS or RSA certificate.
Temporary parameters are hashed with the hello.random values before
signing to ensure that attackers do not replay old parameters.  In
either case, the client can verify the certificate or signature to
ensure that the parameters belong to the server.
</pre></td></tr></tbody></table></code></div></div>

<p>è¿™æ®µè¯´æ˜ŽæœåŠ¡å™¨å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼æä¾› DH å‚æ•°ï¼šä¸€ç§æ˜¯ç›´æŽ¥å‘é€ DH è¯ä¹¦ï¼Œå®¢æˆ·ç«¯é€šè¿‡éªŒè¯è¯ä¹¦è¯æ˜Ž DH å‚æ•°çš„ç¡®å±žäºŽæœåŠ¡å™¨ï¼›ä¸€ç§æ˜¯å‘é€å¸¦ç­¾åçš„ä¸´æ—¶ç”Ÿæˆçš„ DHE å‚æ•°ï¼Œå®¢æˆ·ç«¯é€šè¿‡éªŒç­¾è¯æ˜Ž DHE å‚æ•°çš„ç¡®å±žäºŽæœåŠ¡å™¨ã€‚</p>

<p>è¿™æ®µè‡³å°‘å¯ä»¥ä½è¯æˆ‘å¯¹ DH å’Œ DHE çš„ç†è§£æ˜¯æ­£ç¡®çš„ã€‚</p>

<p><a href="https://www.rfc-editor.org/info/rfc4492">RFC4492  Elliptic Curve Cryptography (ECC) Cipher Suites for Transport Layer Security (TLS)</a></p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre># 2.1  ECDH_ECDSA
In ECDH_ECDSA, the serverâ€™s certificate MUST contain an ECDH-capable
public key and be signed with ECDSA.

# 2.2  ECDHE_ECDSA
In ECDHE_ECDSA, the serverâ€™s certificate MUST contain an ECDSA
capable public key and be signed with ECDSA.

# 2.3  ECDH_RSA
This key exchange algorithm is the same as ECDH_ECDSA except that the
serverâ€™s certificate MUST be signed with RSA rather than ECDSA.

# 2.4  ECDHE_RSA
This key exchange algorithm is the same as ECDHE_ECDSA except that
the serverâ€™s certificate MUST contain an RSA public key authorized
for signing, and that the signature in the ServerKeyExchange message
must be computed with the corresponding RSA private key.  The server
certificate MUST be signed with RSA.
</pre></td></tr></tbody></table></code></div></div>

<p>è¿™æ˜¯ TLS1.1 ECC ç®—æ³•çš„ RFCã€‚æ‰€è¿°é€»è¾‘ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œä¸Žä¸Šé¢çš„è¯´æ³•éƒ½å¯¹å¾—ä¸Šã€‚</p>

<p><strong>é—®é¢˜æ€»ç»“ - TLS1.1ï¼š</strong></p>

<ul>
  <li>è¯ä¹¦çš„ç­¾åç®—æ³•å¿…é¡»ä¸Žç¡®å®šå¯†é’¥å¯¹ç±»åž‹çš„ç®—æ³•ä¿æŒä¸€è‡´ã€‚</li>
  <li>RSA å¯†é’¥äº¤æ¢ä¸­æ²¡æœ‰ç­¾åçš„è¿‡ç¨‹ï¼Œæ•…ç®—æ³•åç§°ä¸­æ²¡æœ‰ç­¾åç®—æ³•ã€‚è¯ä¹¦çš„ç­¾åç®—æ³•é¡»ä¸º <code class="language-plaintext highlighter-rouge">RSA</code>ã€‚</li>
  <li>DHE å¯†é’¥äº¤æ¢ä¸­æœ‰ç­¾åçš„è¿‡ç¨‹ï¼Œæ•…ç®—æ³•åç§°ä¸­æŒ‡å®šäº†ç­¾åç®—æ³•ï¼Œå¦‚ <code class="language-plaintext highlighter-rouge">ECDHE_RSA</code>ã€‚è¯ä¹¦çš„ç­¾åç®—æ³•é¡»ä¸Žè¯¥ç­¾åç®—æ³•ä¸€è‡´ã€‚</li>
  <li>DH å¯†é’¥äº¤æ¢ä¸­æ²¡æœ‰ç­¾åçš„è¿‡ç¨‹ï¼Œå…¶ç®—æ³•åç§°ä¸­æœ¬ä¸éœ€è¦æŒ‡å®šç­¾åç®—æ³•ï¼Œç„¶è¯ä¹¦çš„ç­¾åç®—æ³•é¡»ä¸Žç¡®å®šå¯†é’¥å¯¹ç±»åž‹çš„ç®—æ³•ï¼ˆDHï¼‰ä¿æŒä¸€è‡´ï¼Œè€Œ DH ç®—æ³•æ— æ³•ç”¨äºŽç­¾åï¼Œæ•…ç®—æ³•åç§°ä¸­é¢å¤–æŒ‡å®šäº†è¯ä¹¦çš„ç­¾åç®—æ³•ï¼Œå¦‚ <code class="language-plaintext highlighter-rouge">ECDH_RSA</code>ã€‚</li>
</ul>

<p><a href="https://www.rfc-editor.org/info/rfc5246">RFC5246  The Transport Layer Security (TLS) Protocol Version 1.2</a></p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre></td><td class="rouge-code"><pre># A.7  Changes to RFC 4492
As described in Sections 7.4.2 and 7.4.6, the restrictions on the
signature algorithms used to sign certificates are no longer tied to
the cipher suite (when used by the server) or the
ClientCertificateType (when used by the client).  Thus, the
restrictions on the algorithm used to sign certificates specified in
Sections 2 and 3 of RFC 4492 are also relaxed.

# 7.4.2  Server Certificate
If the client provided a "signature_algorithms" extension, then all
certificates provided by the server MUST be signed by a
hash/signature algorithm pair that appears in that extension.  Note
that this implies that a certificate containing a key for one
signature algorithm MAY be signed using a different signature
algorithm (for instance, an RSA key signed with a DSA key).  This is
a departure from TLS 1.1, which required that the algorithms be the
same.  Note that this also implies that the DH_DSS, DH_RSA,
ECDH_ECDSA, and ECDH_RSA key exchange algorithms do not restrict the
algorithm used to sign the certificate.  Fixed DH certificates MAY be
signed with any hash/signature algorithm pair appearing in the
extension.  The names DH_DSS, DH_RSA, ECDH_ECDSA, and ECDH_RSA are
historical.

# 7.4.1.4.1  Signature Algorithms
The client uses the "signature_algorithms" extension to indicate to
the server which signature/hash algorithm pairs may be used in
digital signatures.

# 7.4.1.4.1  Signature Algorithms
The semantics of this extension are somewhat complicated because the
cipher suite indicates permissible signature algorithms but not hash
algorithms.  Sections 7.4.2 and 7.4.3 describe the appropriate rules.

# 7.4.3  Server Key Exchange Message
If the client has offered the "signature_algorithms" extension, the
signature algorithm and hash algorithm MUST be a pair listed in that
extension.  Note that there is a possibility for inconsistencies
here.  For instance, the client might offer DHE_DSS key exchange but
omit any DSA pairs from its "signature_algorithms" extension.  In
order to negotiate correctly, the server MUST check any candidate
cipher suites against the "signature_algorithms" extension before
selecting them.  This is somewhat inelegant but is a compromise
designed to minimize changes to the original cipher suite design.
</pre></td></tr></tbody></table></code></div></div>

<p>è¿™æ˜¯ TLS1.2 çš„ RFCã€‚æ–°å¢žäº† <code class="language-plaintext highlighter-rouge">signature_algorithms</code> æ‰©å±•å­—æ®µï¼Œå®ƒä»£è¡¨äº†å®¢æˆ·ç«¯æ”¯æŒçš„ç­¾åç®—æ³•ã€‚å¯†é’¥äº¤æ¢è¿‡ç¨‹ä¸­å¯èƒ½ç”¨åˆ°çš„ç­¾åç®—æ³•ç”±æ­¤å­—æ®µåå•†è€Œæ¥ã€‚<strong>è¯ä¹¦çš„ç­¾åç®—æ³•ä¸å†å— TLS ç®—æ³•åç§°çº¦æŸï¼Œåªé¡»ä½åˆ— <code class="language-plaintext highlighter-rouge">signature_algorithms</code> æ‰€æ”¯æŒçš„ç®—æ³•åˆ—è¡¨ä¸­ã€‚</strong></p>

<p>å¯¹äºŽå¯†é’¥äº¤æ¢è¿‡ç¨‹ä¸­å¯èƒ½å‡ºçŽ°çš„ç­¾åè¿‡ç¨‹ï¼ŒTLS ç®—æ³•åç§°ä¸­åªæŒ‡å®šäº†ç­¾åç®—æ³•ï¼Œå´æ²¡æœ‰å“ˆå¸Œç®—æ³•ï¼ˆåç§°ä¸­çš„å“ˆå¸Œç®—æ³•ä¸º HMAC æˆ– Finished æŠ¥æ–‡æ‰€ç”¨ï¼‰ï¼Œé‚æœ‰ <code class="language-plaintext highlighter-rouge">signature_algorithms</code>ï¼Œå…¶ä¸­çš„åç§°åŒæ—¶åŒ…å«äº†ç­¾åå’Œå“ˆå¸Œç®—æ³•ã€‚å¦‚æ­¤ï¼ŒTLS ç®—æ³•åç§°å’Œæ‰©å±•å­—æ®µéƒ½ç»™å‡ºäº†ç­¾åç®—æ³•åç§°ï¼Œä¸ºåŒæ—¶æ»¡è¶³äºŒè€…çº¦æŸï¼ŒæœåŠ¡å™¨å¿…é¡»äºˆä»¥æ£€æŸ¥ï¼Œæœ€ç»ˆåå•†é€‰æ‹©å‡ºçš„ç­¾åç®—æ³•é¡»åŒæ—¶å…¼å®¹ TLS ç®—æ³•åç§°å’Œæ‰©å±•å­—æ®µã€‚</p>

<p>ä¸¾ä¾‹ï¼Œè‹¥ TLS ç®—æ³•åç§°ä¸º <code class="language-plaintext highlighter-rouge">ECDHE_ECDSA</code>ï¼Œæ‰©å±• <code class="language-plaintext highlighter-rouge">signature_algorithms</code> ä¸­å«æœ‰ <code class="language-plaintext highlighter-rouge">ecdsa_secp256r1_sha256, rsa_pkcs1_sha256</code>ï¼Œé‚£ä¹ˆæœåŠ¡å™¨åº”åå•†é€‰æ‹©å‡º <code class="language-plaintext highlighter-rouge">ecdsa_secp256r1_sha256</code> ä½œä¸ºç­¾åç®—æ³•ã€‚æ—¢å¦‚æ­¤ï¼Œè¯ä¹¦åº”é€‰ç”¨ ECC è¯ä¹¦ï¼Œä½†è¯ä¹¦è‡ªå·±çš„ç­¾åå¯ä»¥æ˜¯ <code class="language-plaintext highlighter-rouge">RSA</code>ã€‚</p>

<p><strong>å¦ï¼Œå¯¹äºŽé™æ€ DH å¯†é’¥äº¤æ¢ç®—æ³•å¦‚ <code class="language-plaintext highlighter-rouge">ECDH_ECDSA, ECDH_RSA</code>ï¼Œå…¶åç§°ä¸­çš„ç­¾åç®—æ³•å·²ç»ä¸å«æœ‰ä»»ä½•å®žé™…çº¦æŸæ„ä¹‰ï¼Œæ­¤ç±»è¿·æƒ‘æ€§åè¶³çš„åç§°ä¹‹å­˜åœ¨çš†ç³»åŽ†å²åŽŸå› ã€‚</strong></p>

<p><a href="https://www.rfc-editor.org/info/rfc8422">RFC8422  Elliptic Curve Cryptography (ECC) Cipher Suites for Transport Layer Security (TLS) Versions 1.2 and Earlier</a></p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre># 2.1  ECDHE_ECDSA
In ECDHE_ECDSA, the serverâ€™s certificate MUST contain an ECDSA- or
EdDSA-capable public key.

# 2.2  ECDHE_RSA
This key exchange algorithm is the same as ECDHE_ECDSA except that
the serverâ€™s certificate MUST contain an RSA public key authorized
for signing and the signature in the ServerKeyExchange message must
be computed with the corresponding RSA private key.
</pre></td></tr></tbody></table></code></div></div>

<p>è¿™æ˜¯ TLS1.2 å‡ºçŽ°åŽï¼Œæœ‰å…³ ECC ç®—æ³•çš„ RFCã€‚ç›¸æ¯” <a href="https://www.rfc-editor.org/info/rfc4492">RFC4492</a> çš„è¡¨è¿°ï¼Œè¯¥è¡¨è¿°æ²¡æœ‰å†ç‰¹åˆ«æåŠè¯ä¹¦æœ¬èº«çš„ç­¾ååº”ä¸ºä½•ç®—æ³•ï¼Œå› ä¸ºè¯ä¹¦çš„ç­¾åç®—æ³•å·²ä¸å†å— TLS ç®—æ³•åç§°çº¦æŸï¼Œåªè¦ä½åˆ— <code class="language-plaintext highlighter-rouge">signature_algorithms</code> çš„ç®—æ³•åˆ—è¡¨ï¼Œæ˜¯ä»€ä¹ˆç®—æ³•éƒ½æœ‰å¯èƒ½ã€‚</p>

<p><strong>é—®é¢˜æ€»ç»“ - TLS1.2ï¼š</strong></p>

<ul>
  <li>å¯†é’¥äº¤æ¢è¿‡ç¨‹ä¸­å¯èƒ½ç”¨åˆ°çš„ç­¾åç®—æ³•æ ¹æ®å®¢æˆ·ç«¯æ”¯æŒçš„ TLS ç®—æ³•å’Œ <code class="language-plaintext highlighter-rouge">signature_algorithms</code> æ‰©å±•åå•†è€Œæ¥ã€‚</li>
  <li>è¯ä¹¦çš„ç­¾åç®—æ³•ä¸å†å— TLS ç®—æ³•åç§°çº¦æŸï¼Œåªé¡»ä½åˆ— <code class="language-plaintext highlighter-rouge">signature_algorithms</code> æ‰€æ”¯æŒçš„ç®—æ³•åˆ—è¡¨ä¸­ã€‚</li>
  <li>é™æ€ DH å¯†é’¥äº¤æ¢ç®—æ³•å¦‚ <code class="language-plaintext highlighter-rouge">ECDH_ECDSA, ECDH_RSA</code>ï¼Œå…¶åç§°ä¸­çš„ç­¾åç®—æ³•ä¸å…·æœ‰ä»»ä½•å®žé™…çº¦æŸæ„ä¹‰ï¼Œæ­¤ç±»åç§°ä¹‹å­˜åœ¨çš†ç³»åŽ†å²åŽŸå› ã€‚</li>
</ul>

<p><strong>é—®é¢˜ç»“è®ºï¼š</strong></p>

<p>TLS ç®—æ³•åç§°ä¸­çš„ç­¾åç®—æ³•åŸºæœ¬æŒ‡çš„æ˜¯<strong>æ¡æ‰‹è¿‡ç¨‹ä¸­æ‰€ä½¿ç”¨çš„ç­¾å</strong>ï¼Œè€Œéžç‰¹æŒ‡è¯ä¹¦æœ¬èº«çš„ç­¾åï¼Œä¸è¿‡äºŒè€…ä¹Ÿå¹¶éžæ¯«æ— å…³è”ï¼Œå…·ä½“ç»†èŠ‚å‚è§ä¸Šé¢çš„åˆ†æžå’Œæ€»ç»“ã€‚</p>

<h1 id="æž„å»ºè¯ä¹¦é“¾">æž„å»ºè¯ä¹¦é“¾</h1>

<p>å°è¯•ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">openssl</code> æž„å»ºå¦‚ä¸‹è¯ä¹¦é“¾ã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>Root CA Cert -&gt; Intermediate CA Cert -&gt; End Entity Cert
</pre></td></tr></tbody></table></code></div></div>

<p>æ ¹ CA ä½œä¸ºä¿¡ä»»é”šç‚¹ï¼Œå®ƒçš„è¯ä¹¦æ˜¯è‡ªç­¾åè¯ä¹¦ï¼›æ ¹ CA ç»™ä¸­çº§ CA é¢å‘ä¸­çº§è¯ä¹¦ï¼›ä¸­çº§ CA ç»™ç”¨æˆ·é¢å‘æœ«ç«¯è¯ä¹¦ã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
</pre></td><td class="rouge-code"><pre># build the root cert
# generate private key for the root ca
openssl genrsa -out root-ca-key.pem 2048

# generate cert sign request of the root ca
# here the key content of the `openssl-ca.cnf` will show at the end
openssl req -new -key root-ca-key.pem -out root-ca-csr.pem -config openssl-ca.cnf

# fill the prompted fields like follows
Country Name (2 letter code) [AU]:CN
State or Province Name (full name) [Some-State]:Zhejiang
Locality Name (eg, city) []:Hangzhou
Organization Name (eg, company) [Internet Widgits Pty Ltd]:lcatmiao
Organizational Unit Name (eg, section) []:lcatmiao-ca
Common Name (e.g. server FQDN or YOUR name) []:lcatmiao-ca.com
Email Address []:lcatmiao@test.com

# self-sign the public key retrived implicitly from the cert sign request 
# of the root ca with the private key of also the root ca then get the 
# root cert
openssl x509 -req -days 3650 -sha256 -extfile openssl-ca.cnf -extensions v3_ca -in root-ca-csr.pem -signkey root-ca-key.pem -out root-ca-cert.pem

# build the intermediate cert
# generate private key for the intermediate ca
openssl genrsa -out intermediate-ca-key.pem 2048

# generate cert sign request of the intermediate ca
openssl req -new -key intermediate-ca-key.pem -out intermediate-ca-csr.pem -config openssl-ca.cnf

# fill the prompted fields like follows
Country Name (2 letter code) [AU]:CN
State or Province Name (full name) [Some-State]:Zhejiang
Locality Name (eg, city) []:Hangzhou
Organization Name (eg, company) [Internet Widgits Pty Ltd]:lcatmiao
Organizational Unit Name (eg, section) []:lcatmiao-ca
Common Name (e.g. server FQDN or YOUR name) []:lcatmiao-ca.com
Email Address []:lcatmiao@test.com

# sign the public key retrived implicitly from the cert sign request 
# of the intermediate ca with the private key of the root ca then 
# get the intermediate cert
openssl x509 -req -days 3650 -sha256 -extfile openssl-ca.cnf -extensions v3_ca -in intermediate-ca-csr.pem -CA root-ca-cert.pem -CAkey root-ca-key.pem -CAcreateserial -out intermediate-ca-cert.pem

# build the end entity cert
# generate private key for the end entity
openssl genrsa -out end-entity-key.pem 2048

# generate cert sign request of the end entity
# here the key content of the `openssl-user.cnf` will show at the end
openssl req -new -key end-entity-key.pem -out end-entity-csr.pem -config openssl-user.cnf

# fill the prompted fields like follows
Country Name (2 letter code) [AU]:CN
State or Province Name (full name) [Some-State]:Zhejiang
Locality Name (eg, city) []:Hangzhou
Organization Name (eg, company) [Internet Widgits Pty Ltd]:lcatmiao
Organizational Unit Name (eg, section) []:lcatmiao-user
Common Name (e.g. server FQDN or YOUR name) []:172.168.10.110
Email Address []:lcatmiao@test.com

# sign the public key retrived implicitly from the cert sign request 
# of the end entity with the private key of the intermediate ca then 
# get the end entity cert
openssl x509 -req -days 3650 -sha256 -extfile openssl-user.cnf -extensions usr_cert -in end-entity-csr.pem -CA intermediate-ca-cert.pem -CAkey intermediate-ca-key.pem -CAcreateserial -out end-entity-cert.pem

# After doing all the operations above, `ls` shows that 
# all the files we have are as follows.
end-entity-cert.pem
end-entity-csr.pem
end-entity-key.pem
intermediate-ca-cert.pem
intermediate-ca-cert.srl
intermediate-ca-csr.pem
intermediate-ca-key.pem
openssl-ca.cnf
openssl-user.cnf
root-ca-cert.pem
root-ca-cert.srl
root-ca-csr.pem
root-ca-key.pem

# we can see the cert info by using this cmd
openssl x509 -in end-entity-cert.pem -noout -text
</pre></td></tr></tbody></table></code></div></div>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre># key content of the openssl-ca.cnf
# the following is just a test example that only lists the modified cfg items

[ req ]
req_extensions = v3_req # The extensions to add to a certificate request

[ v3_req ]
basicConstraints = CA:TRUE
# keyUsage = nonRepudiation, digitalSignature, keyEncipherment
subjectAltName = @alt_names

[ v3_ca ]
subjectAltName = @alt_names

[ alt_names ]
DNS.1 = lcatmiao-ca.com
</pre></td></tr></tbody></table></code></div></div>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre># key content of the openssl-user.cnf
# the following is just a test example that only lists the modified cfg items

[ req ]
req_extensions = v3_req # The extensions to add to a certificate request

[ usr_cert ]
subjectAltName = @alt_names

[ v3_req ]
basicConstraints = CA:FALSE
# keyUsage = nonRepudiation, digitalSignature, keyEncipherment
subjectAltName = @alt_names

[ alt_names ]
IP.1 = 172.168.10.110
IP.2 = 172.168.10.105
IP.3 = 172.168.10.106
IP.4 = 172.168.10.107
IP.5 = 172.168.10.108
</pre></td></tr></tbody></table></code></div></div>

<p>è‡³æ­¤ï¼Œä¸€ä¸ªç®€å•çš„è¯ä¹¦é“¾å°±æž„å»ºå¥½äº†ã€‚ä¸‹é¢æˆ‘ä»¬æ¥éªŒè¯ä¸€ä¸‹è¿™ä¸ªè¯ä¹¦é“¾ã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre># verify the root cert which is a self-sign cert
openssl verify -CAfile root-ca-cert.pem root-ca-cert.pem
# output:
root-ca-cert.pem: OK

# verify the intermediate cert
openssl verify -trusted root-ca-cert.pem intermediate-ca-cert.pem
# output:
intermediate-ca-cert.pem: OK

# verify the end entity cert
openssl verify -partial_chain -trusted intermediate-ca-cert.pem end-entity-cert.pem
# output:
end-entity-cert.pem: OK

# directly verify the whole cert chain which has only three levels
openssl verify -CAfile root-ca-cert.pem -untrusted intermediate-ca-cert.pem end-entity-cert.pem
# output:
end-entity-cert.pem: OK
</pre></td></tr></tbody></table></code></div></div>

<p>æœ¬åœ°ä½¿ç”¨å‘½ä»¤è¡Œéƒ½èƒ½éªŒè¿‡ï¼Œä¸ä»£è¡¨ç½‘ç»œé€šä¿¡æ—¶ä¹Ÿèƒ½éªŒè¿‡ã€‚å®žé™…é€šä¿¡çš„è¡Œä¸ºå—å„ç§é…ç½®çš„å½±å“ ï¼Œæ¯”å¦‚å®žæµ‹å‘çŽ°æœ«ç«¯è¯ä¹¦ä¸­é…ç½®çš„ IP åœ°å€æˆ–è€…åŸŸåè¦ä¸ŽæœåŠ¡å™¨ä¿æŒä¸€è‡´ï¼Œå¦åˆ™ä¸é€šã€‚</p>

<p>é¡ºå¸¦ä¸€æï¼Œå®žé™…æŠ¥æ–‡ä¸­ï¼Œ<strong>è¯ä¹¦é“¾çš„é¡ºåºï¼šæœ«ç«¯è¯ä¹¦åœ¨å‰ï¼Œä¸­çº§è¯ä¹¦æŒ‰å±‚çº§é¡ºåºä¾æ¬¡è·Ÿéšï¼Œæ ¹è¯ä¹¦ä¸€èˆ¬ä¸åŒ…å«åœ¨é“¾ä¸­ã€‚</strong></p>

<p><a href="https://www.rfc-editor.org/info/rfc5246">RFC5246  The Transport Layer Security (TLS) Protocol Version 1.2</a></p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="å·²å¤åˆ¶ï¼"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre># 7.4.2  Server Certificate
certificate_list
   This is a sequence (chain) of certificates.  The sender's
   certificate MUST come first in the list.  Each following
   certificate MUST directly certify the one preceding it.  Because
   certificate validation requires that root keys be distributed
   independently, the self-signed certificate that specifies the root
   certificate authority MAY be omitted from the chain, under the
   assumption that the remote end must already possess it in order to
   validate it in any case.
</pre></td></tr></tbody></table></code></div></div>

<h1 id="æ¶ˆé™¤æµè§ˆå™¨å®‰å…¨è­¦å‘Š">æ¶ˆé™¤æµè§ˆå™¨å®‰å…¨è­¦å‘Š</h1>

<p>å½“å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰æ²¡èƒ½éªŒè¿‡æœåŠ¡å™¨å‘æ¥çš„è¯ä¹¦æ—¶ï¼Œå°±ä¼šæ˜¾ç¤ºå¦‚ä¸‹çš„å®‰å…¨è­¦å‘Šé¡µé¢ï¼Œå¹¶ä¸” URI æ ä¼šæœ‰â€œä¸å®‰å…¨â€çš„æç¤ºã€‚å¦‚æžœæœåŠ¡å™¨çš„è¯ä¹¦æ˜¯æˆ‘ä»¬è‡ªå·±ç­¾å‘çš„ï¼Œè‡ªç„¶æ— æ³•è¢«æµè§ˆå™¨å†…ç½®çš„ CA è¯ä¹¦éªŒè¿‡ï¼Œæˆ‘ä»¬éœ€è¦å°†è‡ªå·±ç”Ÿæˆçš„æ ¹è¯ä¹¦å¯¼å…¥æµè§ˆå™¨æ‰è¡Œã€‚</p>

<p><img data-src="https://img-host-lcatmiao.oss-cn-hangzhou.aliyuncs.com/202502061014960.png" alt="" data-proofer-ignore></p>

<p>å°†è‡ªå·±ç”Ÿæˆçš„æ ¹è¯ä¹¦å¯¼å…¥æµè§ˆå™¨ï¼Œä½œä¸ºå—ä¿¡ä»»çš„é¢å‘æœºæž„ã€‚</p>

<p><img data-src="https://img-host-lcatmiao.oss-cn-hangzhou.aliyuncs.com/202502061027289.png" alt="" data-proofer-ignore></p>

<p>æ­¤åŽå†è®¿é—®æœåŠ¡å™¨ï¼Œå°±æ˜¯æ­£å¸¸çš„ https è®¿é—®äº†ã€‚</p>

<blockquote>
  <p>å¦‚æžœæœåŠ¡å™¨å‘æ¥çš„è¯ä¹¦ä¸æ­¢ä¸€ä¸ªï¼Œè€Œæ˜¯å¤šçº§è¯ä¹¦ï¼Œå³è¯ä¹¦é“¾çš„ä¸€éƒ¨åˆ†ï¼Œé‚£ä¹ˆç†è®ºä¸Šå¯¼å…¥æµè§ˆå™¨çš„è¯ä¹¦åº”è¯¥æ˜¯è¯ä¹¦é“¾çš„å¦ä¸€éƒ¨åˆ†ï¼ŒäºŒè€…åˆä¸€è¦èƒ½æž„æˆå®Œæ•´çš„è¯ä¹¦é“¾æ‰è¡Œã€‚</p>
</blockquote>

<h1 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h1>

<ol>
  <li>ã€Šå›¾è§£HTTPã€‹</li>
  <li><a href="https://blog.cloudflare.com/keyless-ssl-the-nitty-gritty-technical-details/">Keyless SSL: The Nitty Gritty Technical Details</a></li>
  <li><a href="https://tls12.xargs.org/">The Illustrated TLS Connection: Every Byte Explained</a></li>
  <li><a href="https://www.rfc-editor.org/info/rfc4346">RFC4346  The Transport Layer Security (TLS) Protocol Version 1.1</a></li>
  <li><a href="https://www.rfc-editor.org/info/rfc4492">RFC4492  Elliptic Curve Cryptography (ECC) Cipher Suites for Transport Layer Security (TLS)</a></li>
  <li><a href="https://www.rfc-editor.org/info/rfc5246">RFC5246  The Transport Layer Security (TLS) Protocol Version 1.2</a></li>
  <li><a href="https://www.rfc-editor.org/info/rfc8422">RFC8422  Elliptic Curve Cryptography (ECC) Cipher Suites for Transport Layer Security (TLS) Versions 1.2 and Earlier</a></li>
  <li><a href="https://www.rfc-editor.org/info/rfc7919">RFC7919  Negotiated Finite Field Diffie-Hellman Ephemeral Parameters for Transport Layer Security (TLS)</a></li>
</ol>

<h1 id="è„šæ³¨">è„šæ³¨</h1>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:client-finished" role="doc-endnote">
      <p>ä½¿ç”¨ä¼šè¯å¯†é’¥åŠ å¯†åŽçš„ <code class="language-plaintext highlighter-rouge">Client Finished</code> æŠ¥æ–‡ã€‚Â <a href="#fnref:client-finished" class="reversefootnote" role="doc-backlink">&#8617;</a>Â <a href="#fnref:client-finished:1" class="reversefootnote" role="doc-backlink">&#8617;<sup>2</sup></a></p>
    </li>
    <li id="fn:server-finished" role="doc-endnote">
      <p>ä½¿ç”¨ä¼šè¯å¯†é’¥åŠ å¯†åŽçš„ <code class="language-plaintext highlighter-rouge">Server Finished</code> æŠ¥æ–‡ã€‚Â <a href="#fnref:server-finished" class="reversefootnote" role="doc-backlink">&#8617;</a>Â <a href="#fnref:server-finished:1" class="reversefootnote" role="doc-backlink">&#8617;<sup>2</sup></a></p>
    </li>
    <li id="fn:close-notify" role="doc-endnote">
      <p>ä½¿ç”¨ä¼šè¯å¯†é’¥åŠ å¯†åŽçš„ <code class="language-plaintext highlighter-rouge">Close Notify</code> æŠ¥æ–‡ã€‚Â <a href="#fnref:close-notify" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>

</div>

<div class="post-tail-wrapper text-muted">

  <!-- categories -->
  
  <div class="post-meta mb-3">
    <i class="far fa-folder-open fa-fw mr-1"></i>
    
      <a href='/categories/tech/'>Tech</a>,
      <a href='/categories/network/'>Network</a>
  </div>
  

  <!-- tags -->
  
  <div class="post-tags">
    <i class="fa fa-tags fa-fw mr-1"></i>
      
      <a href="/tags/tls/"
          class="post-tag no-text-decoration" >tls</a>
      
  </div>
  

  <div class="post-tail-bottom
    d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
    <div class="license-wrapper">

      

        

        æœ¬æ–‡ç”±ä½œè€…æŒ‰ç…§ 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         è¿›è¡ŒæŽˆæƒ

      
    </div>

    <!--
 Post sharing snippet
-->

<div class="share-wrapper">
  <span class="share-label text-muted mr-1">åˆ†äº«</span>
  <span class="share-icons">
    
    

    
      
        <a href="https://twitter.com/intent/tweet?text=ç®€æžHTTPS - å°é»‘çŒ«&amp;url=http://0.0.0.0:4000/posts/%E7%AE%80%E6%9E%90HTTPS/" data-toggle="tooltip" data-placement="top"
          title="Twitter" target="_blank" rel="noopener" aria-label="Twitter">
          <i class="fa-fw fab fa-twitter"></i>
        </a>
    
      
        <a href="https://www.facebook.com/sharer/sharer.php?title=ç®€æžHTTPS - å°é»‘çŒ«&amp;u=http://0.0.0.0:4000/posts/%E7%AE%80%E6%9E%90HTTPS/" data-toggle="tooltip" data-placement="top"
          title="Facebook" target="_blank" rel="noopener" aria-label="Facebook">
          <i class="fa-fw fab fa-facebook-square"></i>
        </a>
    
      
        <a href="https://t.me/share/url?url=http://0.0.0.0:4000/posts/%E7%AE%80%E6%9E%90HTTPS/&amp;text=ç®€æžHTTPS - å°é»‘çŒ«" data-toggle="tooltip" data-placement="top"
          title="Telegram" target="_blank" rel="noopener" aria-label="Telegram">
          <i class="fa-fw fab fa-telegram"></i>
        </a>
    

    <i id="copy-link" class="fa-fw fas fa-link small"
        data-toggle="tooltip" data-placement="top"
        title="åˆ†äº«é“¾æŽ¥"
        data-title-succeed="é“¾æŽ¥å·²å¤åˆ¶ï¼">
    </i>

  </span>
</div>


  </div><!-- .post-tail-bottom -->

</div><!-- div.post-tail-wrapper -->


      
    
    

    </div>
  </div> <!-- #core-wrapper -->

  <!-- pannel -->
  <div id="panel-wrapper" class="col-xl-3 pl-2 text-muted">

    <div class="access">
      















  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">çƒ­é—¨æ ‡ç­¾</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

    
      
      <a class="post-tag" href="/tags/gdb/">gdb</a>
    
      
      <a class="post-tag" href="/tags/bash/">bash</a>
    
      
      <a class="post-tag" href="/tags/git/">git</a>
    
      
      <a class="post-tag" href="/tags/kdb/">kdb</a>
    
      
      <a class="post-tag" href="/tags/shell/">shell</a>
    
      
      <a class="post-tag" href="/tags/tls/">tls</a>
    

    </div>
  </div>


    </div>

    
      
      



<!-- BS-toc.js will be loaded at medium priority -->
<script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script>

<div id="toc-wrapper" class="pl-0 pr-4 mb-5">
  <div class="panel-heading pl-3 pt-2 mb-2">æ–‡ç« å†…å®¹</div>
  <nav id="toc" data-toggle="toc"></nav>
</div>


    
  </div>

</div>

<!-- tail -->

<div class="row">
  <div class="col-12 col-lg-11 col-xl-8">
    <div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">
      
        
        <!--
 Recommend the other 3 posts according to the tags and categories of the current post,
 if the number is not enough, use the other latest posts to supplement.
-->

<!-- The total size of related posts  -->


<!-- An random integer that bigger than 0  -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy}  -->








  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  
    
  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  








<!-- Fill with the other newlest posts  -->






  <div id="related-posts" class="mt-5 mb-2 mb-sm-4">
    <h3 class="pt-2 mt-1 mb-4 ml-1"
      data-toc-skip>ç›¸å…³æ–‡ç« </h3>
    <div class="card-deck mb-4">
    
      
      
      <div class="card">
        <a href="/posts/%E5%87%BD%E6%95%B0%E4%BC%A0%E5%8F%82/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/timeago.js
-->

<em class="timeago small"
    data-ts="1669563000"
    
    >
  2022-11-27
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>å‡½æ•°ä¼ å‚</h3>
            <div class="text-muted small">
              <p>
                





                ä¼ å‚åˆ†ç±»

ä»Žä¼ å‚ç±»åž‹ä¸Šçœ‹

ä¼ å‚åˆ†ä¸ºä¼ å€¼å’Œä¼ æŒ‡é’ˆã€‚


  ä¼ æŒ‡é’ˆæœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¼ å€¼ï¼Œåªä¸è¿‡ä¼ çš„æ˜¯æŒ‡é’ˆå€¼ã€‚ç”±äºŽä¼ ä¸€èˆ¬å€¼å’Œä¼ æŒ‡é’ˆå€¼è¿˜æ˜¯æœ‰ç‚¹åŒºåˆ«ï¼Œæ‰€ä»¥åˆ†æˆä¸¤ç§è¯´æ³•ã€‚ä¼ å€¼ä¸€èˆ¬å°±æŒ‡ä¼ ä¸€èˆ¬å€¼ï¼Œä¼ æŒ‡é’ˆä¸“é—¨ç”¨äºŽæè¿°ä¼ æŒ‡é’ˆå€¼ã€‚


ä»Žä¼ å‚è¡Œä¸ºä¸Šçœ‹

ä¼ å‚åˆ†ä¸ºå€¼å¤åˆ¶å’Œä¼ è‡ªå·±ã€‚


  ä¼ è‡ªå·±æœ¬è´¨ä¸Šä¹Ÿæ˜¯å€¼å¤åˆ¶ï¼Œåªä¸è¿‡æ˜¯å–åœ°å€ä¼ æ— åæŒ‡é’ˆï¼Œå½¢å‚ç›´æŽ¥æŽ¥ä¸Šï¼›è€Œä¸æ˜¯ç›´æŽ¥ä¼ æœ‰åæŒ‡é’ˆã€‚ä¾‹å¦‚ï¼š


// å‡½æ•°è°ƒç”¨
func1(i...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/C%E8%AF%AD%E8%A8%80%E6%A0%87%E5%87%86%E5%8F%91%E5%B1%95%E5%8E%86%E5%8F%B2/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/timeago.js
-->

<em class="timeago small"
    data-ts="1708764817"
    
    >
  2024-02-24
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Cè¯­è¨€æ ‡å‡†å‘å±•åŽ†å²</h3>
            <div class="text-muted small">
              <p>
                





                å¯¹å„ç§ C æ ‡å‡†è¿›è¡Œç®€è¿°ã€‚

å‚è€ƒèµ„æ–™ï¼šStandards (Using the GNU Compiler Collection (GCC))

ANSI Cï¼ŒISO C89/90

ANSI C æ˜¯æœ€åˆçš„ C è¯­è¨€æ ‡å‡†ï¼Œåœ¨ 1989 å¹´èŽ·å¾—æ‰¹å‡†ï¼Œ1990 å¹´å‘å¸ƒã€‚

1990 å¹´æ™šäº›æ—¶å€™ï¼Œè¯¥æ ‡å‡†æˆä¸ºäº† ISO C89/90 æ ‡å‡†ã€‚

è¿™ä¸¤ä¸ªæ ‡å‡†ä¹‹é—´æ²¡æœ‰æŠ€æœ¯ä¸Šçš„å·®å¼‚ï¼Œå¯ä»¥å½“ä½œå°±æ˜¯ä¸€ä¸ªæ ‡å‡†ã€‚
...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/%E7%9C%9F%E5%80%BC%E4%B8%8E%E5%86%85%E5%AD%98%E7%9A%84%E7%9B%B8%E4%BA%92%E8%BD%AC%E6%8D%A2/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/timeago.js
-->

<em class="timeago small"
    data-ts="1711792680"
    
    >
  2024-03-30
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>çœŸå€¼ä¸Žå†…å­˜çš„ç›¸äº’è½¬æ¢</h3>
            <div class="text-muted small">
              <p>
                





                æ€»è§ˆ

ä¸€äº›è‡ªåˆ›çš„åè¯å®šä¹‰ï¼š


  
    åœ¨å†…å­˜ä¸­å®žé™…å­˜å‚¨çš„å€¼ç§°ä¸ºå†…å­˜å€¼ã€‚
  
  
    å†…å­˜å€¼ç»è¿‡å­—èŠ‚åºè½¬æ¢åŽï¼Œä»¥æ— ç¬¦å·å½¢å¼å†™æˆçš„æ•°å€¼ï¼Œç§°ä¸ºå†…å­˜æ•°å€¼ã€‚å†…å­˜æ•°å€¼ç”¨æ¥ç›´è§‚çº¯ç²¹åœ°åæ˜ å†…å­˜å€¼çš„æ ·è²Œã€‚

    ç”¨äºŒè¿›åˆ¶è¡¨ç¤ºçš„å†…å­˜æ•°å€¼ç§°ä¸ºå†…å­˜äºŒè¿›åˆ¶ã€‚

    ç”¨åå…­è¿›åˆ¶è¡¨ç¤ºçš„å†…å­˜æ•°å€¼ç§°ä¸ºå†…å­˜åå…­è¿›åˆ¶ã€‚

    ç”¨å…«è¿›åˆ¶è¡¨ç¤ºçš„å†…å­˜æ•°å€¼ç§°ä¸ºå†…å­˜å…«è¿›åˆ¶ã€‚

    ç”¨æ— ç¬¦å·åè¿›åˆ¶è¡¨ç¤ºçš„å†…å­˜...
              </p>
            </div>
          </div>
        </a>
      </div>
    
    </div> <!-- .card-deck -->
  </div> <!-- #related-posts -->


      
        
        <!--
  Navigation buttons at the bottom of the post.
-->

<div class="post-navigation d-flex justify-content-between">
  
  <a href="/posts/%E7%9C%9F%E5%80%BC%E4%B8%8E%E5%86%85%E5%AD%98%E7%9A%84%E7%9B%B8%E4%BA%92%E8%BD%AC%E6%8D%A2/" class="btn btn-outline-primary"
    prompt="ä¸Šä¸€ç¯‡">
    <p>çœŸå€¼ä¸Žå†…å­˜çš„ç›¸äº’è½¬æ¢</p>
  </a>
  

  
  <a href="/posts/gdb%E6%97%A0-g%E8%B0%83%E8%AF%95%E5%AE%9E%E6%88%98%E8%AE%B0%E5%BD%95/" class="btn btn-outline-primary"
    prompt="ä¸‹ä¸€ç¯‡">
    <p>gdbæ— -gè°ƒè¯•å®žæˆ˜è®°å½•</p>
  </a>
  

</div>

      
        
        <!--  The comments switcher -->


      
    </div>
  </div>
</div> <!-- .row -->



        <!--
  The Footer
-->

<footer class="d-flex w-100 justify-content-center">
  <div class="d-flex justify-content-between align-items-center text-muted">
    <div class="footer-left">
      <p class="mb-0">
        Â© 2025
        <a href="https://github.com/lcatmiao">å°é»‘çŒ«</a>.
        
        <span data-toggle="tooltip" data-placement="top"
          title="é™¤éžå¦æœ‰è¯´æ˜Žï¼Œæœ¬ç½‘ç«™ä¸Šçš„åšå®¢æ–‡ç« å‡ç”±ä½œè€…æŒ‰ç…§çŸ¥è¯†å…±äº«ç½²å 4.0 å›½é™… (CC BY 4.0) è®¸å¯åè®®è¿›è¡ŒæŽˆæƒã€‚">ä¿ç•™éƒ¨åˆ†æƒåˆ©ã€‚</span>
        
      </p>
    </div>

    <div class="footer-right">
      <p class="mb-0">
        

        

        æœ¬ç«™ç”± 
          <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>
         ç”Ÿæˆï¼Œé‡‡ç”¨ 
          <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a>
         ä¸»é¢˜ã€‚

      </p>
    </div>

  </div> <!-- div.d-flex -->
</footer>


      </div>

      <!--
  The Search results
-->
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-12 col-sm-11 post-content">
    <div id="search-hints">
      















  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">çƒ­é—¨æ ‡ç­¾</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

    
      
      <a class="post-tag" href="/tags/gdb/">gdb</a>
    
      
      <a class="post-tag" href="/tags/bash/">bash</a>
    
      
      <a class="post-tag" href="/tags/git/">git</a>
    
      
      <a class="post-tag" href="/tags/kdb/">kdb</a>
    
      
      <a class="post-tag" href="/tags/shell/">shell</a>
    
      
      <a class="post-tag" href="/tags/tls/">tls</a>
    

    </div>
  </div>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>


    </div> <!-- #main-wrapper -->

    

    <div id="mask"></div>

    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a>

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script>

<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="{url}">{title}</a>  <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    {categories}    {tags}  </div>  <p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5">æœç´¢ç»“æžœä¸ºç©º</p>',
  templateMiddleware: function(prop, value, template) {
    if (prop === 'categories') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
      }
    }

    if (prop === 'tags') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
      }
    }
  }
});
</script>


    <!--
  JS selector for site.
-->

<!-- layout specified -->


  



  <!-- image lazy-loading & popup -->
  <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script>




  

  <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1,npm/dayjs@1/locale/zh.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script>





<script defer src="/assets/js/dist/post.min.js"></script>



<!-- commons -->

<script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script>




  </body>

</html>

